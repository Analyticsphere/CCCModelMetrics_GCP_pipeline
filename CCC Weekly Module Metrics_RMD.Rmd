---
title: "Weekly CCC Metrics for Sections BOH, LAW, MRE, and SAS"
author: "Kelsey Dowling"
date: "`r Sys.Date()`"
output:
  pdf_document: default
header-includes:
  \usepackage{placeins}
---


```{r, include=FALSE, warning=FALSE}

 # \usepackage{caption}
 # \captionsetup[figure]{labelformat=empty}


#old.packages()
#update.packages("tinytex")


library(bigrquery)
library(dplyr)
library(gmodels)
library(epiDisplay)
library(lubridate)
library(tidyverse)
library(gt)
library(knitr)
library(gtsummary)
#install_tinytex()
library(tinytex)
library(vtable)
library(kableExtra)



bq_auth()


# ```{r setup, include=FALSE}
# options(width = 80)
# options(tinytex.verbose = TRUE) --- didn't work
# ```

```


```{r, include=FALSE}

# ##Make sure SQL queries are properly running
# 
# 
# check_sch_query_status <- 
#   function(project, table_name){
# 
#     ## Set default project for BQ CLI
#     #set_proj_cmd <- paste0("bq ls -j --project_id ", project, " > /dev/null")
#     #system(set_proj_cmd)
#     
#     # Get list of scheduled queries from bq
#     bq_request <- 'bq ls --transfer_config --transfer_location="us" --filter="dataSourceIds:scheduled_query"'
#     response   <- system(bq_request, intern=TRUE)
#     # Remove second line "----" of table and remove white space from each row
#     response   <- lapply(response[-2], function(x) scan(text = x, what = ""))
#     header     <- simplify2array(response[1]) # Array of column names
#     
#     # Bind rows of data into one array
#     for (i in length(header)){
#       x <- c() # Initialize array with first non-header line of data
#       # Loop through remaining data
#       for (line in response[2:length(response)]){
#         x <- rbind(x, line)
#       }
#     }
#     
#     # Format as dataframe
#     df <- data.frame(x, row.names = NULL)
#     colnames(df) <- header
#     
#     # Return sch. query status as "SUCCEEDED", "PENDING", "RUNNING" or "FAILED".
#     df$state[df$displayName==table_name] 
#   }
# 
# 
# table_name <- "FlatConnect.participants_JP"
# project    <- "nih-nci-dceg-connect-prod-6d04"
# 
# # Check status of scheduled query
# query_status <- check_sch_query_status(project, table_name)
# switch(query_status,
#  "FAILED"    = stop(paste0("The sch. query for ", table_name, " failed. Reach out to Jake.")),
#   "PENDING"   = stop(paste0("The query for ", table_name, " is scheduled and waiting to be run.")),
#   "RUNNING"   = stop(paste0("The sch. query for ", table_name, " is still running. Wait until complete.")),
#   "SUCCEEDED" = print(paste0("The most recent scheduled query for ", table_name, " succeeded. The table is up-to-date."))
# )
# 
# 
# table_name <- "FlatConnect.bioSurvey_v1_JP"
# project    <- "nih-nci-dceg-connect-prod-6d04"
# 
# # Check status of scheduled query
# query_status <- check_sch_query_status(project, table_name)
# switch(query_status,
#  "FAILED"    = stop(paste0("The sch. query for ", table_name, " failed. Reach out to Jake.")),
#   "PENDING"   = stop(paste0("The query for ", table_name, " is scheduled and waiting to be run.")),
#   "RUNNING"   = stop(paste0("The sch. query for ", table_name, " is still running. Wait until complete.")),
#   "SUCCEEDED" = print(paste0("The most recent scheduled query for ", table_name, " succeeded. The table is up-to-date."))
# )


```


```{r, include=FALSE}
## CCC WEEKLY METRICS REPORT 



### To run the code, note questions 1,5,6,7, and 8 apply to all modules and questions 2-4 apply individually to each module. Run #1 first, then #2-4 for reach module, then #6-8



##Load Data from BQ

project_cc = "nih-nci-dceg-connect-prod-6d04"
billing_cc= "nih-nci-dceg-connect-prod-6d04"
queryreccc <- "SELECT  Connect_ID, d_512820379, d_821247024, d_914594314, d_832139544, d_949302066 , d_205553981, d_536735468 , d_976570371, d_663265240, d_265193023, d_222161762,d_770257102, d_264644252, d_265193023, d_541836531, d_386488297, d_452942800, d_517311251 , d_822499427 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` where Connect_ID IS NOT NULL"

rec_table_cc <- bq_project_query(project_cc, queryreccc)
data_c <- bq_table_download(rec_table_cc, bigint = "integer64")

#data_ccc=merge(mod1_data_cc, data_ccc, by="Connect_ID")  #tidyverse has left join

data_cc <- data_c %>% filter(d_821247024==197316935) #must be verified
dim(data_cc) #Number of verified participants 

active_c <- data_cc %>% filter(d_512820379==486306141)
passive_c <- data_cc %>% filter(d_512820379==854703046)
data_ccc <- data_cc %>% filter(d_512820379==486306141 | d_512820379==854703046) #must be active or passive
dim(data_ccc)


### Stratify by verified before all modules available in prod and, verified after all modules available in prod ###

started_m1= data_ccc %>%  filter(!is.na(d_205553981) & (d_949302066==615768760 | d_949302066==231311385))  #CID 4201878434 has no start date but completed module 1....
dim(started_m1)

data_ccc_after <- data_ccc %>% filter(!is.na(d_914594314) & d_914594314>=as.Date("2022-07-05"))  #those verified AFTER all modules were available 
dim(data_ccc_after)

data_ccc_before <- data_ccc %>% filter(!is.na(d_914594314) & d_914594314<"2022-07-05") #those verified BEFORE all were available
dim(data_ccc_before)


active_c_after <- data_ccc_after %>% filter(d_512820379==486306141)
dim(active_c_after)
passive_c_after <- data_ccc_after %>% filter(d_512820379==854703046)
dim(passive_c_after)

active_c_before <- data_ccc_before %>% filter(d_512820379==486306141)
dim(active_c_before)
passive_c_before <- data_ccc_before %>% filter(d_512820379==854703046)
dim(passive_c_before)

active_all <- data_ccc %>% filter(d_512820379==486306141)
dim(active_all)
passive_all <- data_ccc %>% filter(d_512820379==854703046)
dim(passive_all)



knitr::opts_chunk$set(comment = NA)
```



```{r, echo=FALSE}
cat("Verified Participants:", dim(data_ccc)[[1]])
cat("Date all sections available in prod: July 5, 2022")
cat("Participants Verified Before All Sections Available:", dim(data_ccc_before)[[1]])
cat("Participants Verified On or After All Sections Available:", dim(data_ccc_after)[[1]])
```
Some of the metrics below are stratified into separate tables by whether the participant was verified before all modules were available in prod verses on or after. These are denoted by 'Before' and 'After'.

```{r, include=FALSE}

#```{css, echo=FALSE}
# <!-- pre { -->
# <!-- max-width: 70px; -->
# <!-- overflow-y: auto;  -->
# <!-- }  -->
# 
# <!--  pre[class] { -->
# <!-- max-width: 70px;  -->
# <!-- }  -->
# 
# <!-- .chart-shim {  -->
# <!-- overflow: auto;  -->
# <!-- }  -->

#```

```

\newpage


# 1.	% Submission of surveys by verified participants (including impossible scenarios)
# 

```{r, include=FALSE, warning=FALSE, message=FALSE}
####### ALL MODULES ########

##BEFORE

#1. Survey status of verified participants: None Completed, Some Completed (Combinations), All completed. This includes impossible selections for QC check

##BEFORE ALL AV'L--- run through once with data_tib set to before data first for first startified table
data_tib= as_tibble(data_ccc_before) #HAD TO MAKE A TIBBLE FOR GT() TABLE FUNCTION
head(data_tib)


modules <- data_tib[,c("Connect_ID","d_512820379","d_949302066","d_536735468","d_976570371","d_663265240")] 
mods <- c("d_949302066","d_536735468","d_976570371","d_663265240")
modules$modules <- 0
modules$none <-0
for(i in 1:length(mods)){
  module <- modules[,mods[i]]
  count <- ifelse((!is.na(module) & module ==231311385), 1, 0)
  modules$modules <- count+modules$modules
  count1 <- ifelse((!is.na(module) & module==972455046), 1, 0)
  modules$none <- count1+modules$none
}

table(modules$modules)

table(modules$none)

table(modules$modules,modules$d_949302066)
CrossTable(modules$d_949302066, modules$modules,digits=4, prop.t=FALSE, prop.r=TRUE, prop.c=TRUE,prop.chisq=FALSE)

length(modules[which(modules$modules==3 & modules$d_663265240==231311385 & modules$d_536735468==231311385),])
# modules1 <- modules %>% mutate(process=case_when(d_949302066 == 231311385 & modules==1 ~ "BOH Section only",
#                                                  d_536735468 == 231311385 & modules==1 ~ "MRE Section only",
#                                                  d_976570371 == 231311385 & modules==1 ~ "SAS Section only",
#                                                  d_663265240 == 231311385 & modules==1 ~ "LAW Section only",
#                                                  modules ==2 & d_949302066 == 231311385 & d_536735468 == 231311385 ~ "BOH and MRE Sections" ,
#                                                  modules ==2 & d_949302066 == 231311385 & d_976570371 == 231311385 ~ "BOH and SAS Sections" ,
#                                                  modules ==2 & d_949302066 == 231311385 & d_663265240 == 231311385 ~ "BOH and LAW Sections" ,
#                                                  modules ==2 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "MRE and SAS Sections",
#                                                  modules ==2 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "MRE and LAW Sections" ,
#                                                  modules ==2 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "SAS and LAW Sections" ,
#                                                  modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "BOH, MRE, and SAS Sections" ,
#                                                  modules ==3 & d_949302066 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385~ "BOH, SAS, and LAW Sections" ,
#                                                  modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "BOH, MRE, and LAW Sections",
#                                                  modules ==3 & d_536735468 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "MRE, SAS, and LAW Sections" ,
#                                                  modules ==0 ~ "None",
#                                                  modules ==4 ~ "All"))

modules1 <- modules %>% mutate(process = case_when(d_949302066 == '231311385' & as.character(modules) == '1' ~ "BOH Section only",
                                                   d_536735468 == '231311385' & as.character(modules) == '1' ~ "MRE Section only",
                                                   d_976570371 == '231311385' & as.character(modules) == '1' ~ "SAS Section only",
                                                   d_663265240 == '231311385' & as.character(modules) == '1' ~ "LAW Section only",
                                                   as.character(modules) == '2' & d_949302066 == '231311385' & d_536735468 == '231311385' ~ "BOH and MRE Sections" ,
                                                   as.character(modules) =='2' & d_949302066 == '231311385' & d_976570371 == '231311385' ~ "BOH and SAS Sections" , 
                                                   as.character(modules) =='2' & d_949302066 == '231311385' & d_663265240 == '231311385' ~ "BOH and LAW Sections" ,   
                                                   as.character(modules) =='2' & d_536735468 == '231311385' & d_976570371 == '231311385' ~ "MRE and SAS Sections",
                                                   as.character(modules) =='2' & d_536735468 == '231311385' & d_663265240 == '231311385' ~ "MRE and LAW Sections" ,
                                                   as.character(modules) =='2' & d_976570371 == '231311385' & d_663265240 == '231311385' ~ "SAS and LAW Sections" , 
                                                   as.character(modules) =='3' & d_949302066 == '231311385' & d_536735468 == '231311385' & d_976570371 == '231311385' ~ "BOH, MRE, and SAS Sections" ,  
                                                   as.character(modules) =='3' & d_949302066 == '231311385' & d_976570371 == '231311385' & d_663265240 == '231311385'~ "BOH, SAS, and LAW Sections" , 
                                                   as.character(modules) =='3' & d_949302066 == '231311385' & d_536735468 == '231311385' & d_663265240 == '231311385' ~ "BOH, MRE, and LAW Sections",
                                                   as.character(modules) =='3' & d_536735468 == '231311385' & d_976570371 == '231311385' & d_663265240 == '231311385' ~ "MRE, SAS, and LAW Sections" ,
                                                   as.character(modules) =='0' ~ "None",   
                                                   as.character(modules) =='4' ~ "All"))

table(modules1$process)
tab1(modules1$process, decimal=2,sort.group = "decreasing", cum.percent = TRUE)$output.table


```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#Make the automated table

completion_summary <- modules1  %>% dplyr::group_by(process) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(process, n, percentage) 

completion_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = html("Table 1a. Verified Participants Survey Completion (Before)")) %>% 
  tab_footnote(
    footnote = "This includes impossible scenarios: Sections LAW, MRE, and/or SAS being completed without BOH Section first completed. Only scenarios that have occured will show on this table.") %>%
  cols_label(process = md("**Modules Completed**"), n = md("**Number of participants**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows(
    # groups= FALSE,
    # columns = vars(n, percentage),
    # fns= list(
    #   Sum= ~sum(.)),
    # #formatter = fmt_number,
    # decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = process,
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "gray90"),
      locations = cells_body(
      rows = c(1,3,5,7,9)
    )
  ) #%>%  opt_row_striping()
```



```{r, include=FALSE, warning=FALSE, message=FALSE}

##AFTER 


##AFTER ALL AV'L--- then run through again with data tib set to after data for second straitified table
data_tib= as_tibble(data_ccc_after) #HAD TO MAKE A TIBBLE FOR GT() TABLE FUNCTION
head(data_tib)

modules <- data_tib[,c("Connect_ID","d_512820379","d_949302066","d_536735468","d_976570371","d_663265240")] 
mods <- c("d_949302066","d_536735468","d_976570371","d_663265240")
modules$modules <- 0
modules$none <-0
for(i in 1:length(mods)){
  module <- modules[,mods[i]]
  count <- ifelse((!is.na(module) & module ==231311385), 1, 0)
  modules$modules <- count+modules$modules
  count1 <- ifelse((!is.na(module) & module==972455046), 1, 0)
  modules$none <- count1+modules$none
}

table(modules$modules)

table(modules$none)

table(modules$modules,modules$d_949302066)
CrossTable(modules$d_949302066, modules$modules,digits=4, prop.t=FALSE, prop.r=TRUE, prop.c=TRUE,prop.chisq=FALSE)

length(modules[which(modules$modules==3 & modules$d_663265240==231311385 & modules$d_536735468==231311385),])
modules1 <- modules %>% mutate(process=case_when(d_949302066 == 231311385 & modules==1 ~ "BOH Section only",
                                                 d_536735468 == 231311385 & modules==1 ~ "MRE Section only",
                                                 d_976570371 == 231311385 & modules==1 ~ "SAS Section only",
                                                 d_663265240 == 231311385 & modules==1 ~ "LAW Section only",
                                                 modules ==2 & d_949302066 == 231311385 & d_536735468 == 231311385 ~ "BOH and MRE Sections" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_976570371 == 231311385 ~ "BOH and SAS Sections" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_663265240 == 231311385 ~ "BOH and LAW Sections" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "MRE and SAS Sections" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "MRE and LAW Sections" ,
                                                 modules ==2 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "SAS and LAW Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "BOH, MRE, and SAS Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385~ "BOH, SAS, and LAW Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "BOH, MRE, and LAW Sections",
                                                 modules ==3 & d_536735468 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "MRE, SAS, and LAW Sections" ,
                                                 modules ==0 ~ "None",
                                                 modules ==4 ~ "All"))



table(modules1$process)
tab1(modules1$process, decimal=2,sort.group = "decreasing", cum.percent = TRUE)$output.table





```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#Make the automated table

completion_summary <- modules1  %>% dplyr::group_by(process) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(process, n, percentage) 

completion_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = html("Table 1b. Verified Participants Survey Completion (After)")) %>% 
  tab_footnote(
    footnote = "This includes impossible scenarios: Sections LAW, MRE, and/or SAS being completed without BOH Section first completed. Only scenarios that have occured will show on this table.") %>%
  cols_label(process = md("**Sections Completed**"), n = md("**Number of participants**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows(     groups= FALSE,
    # columns = c(n, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = process,
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "gray90"),
      locations = cells_body(
      rows = c(1,3,5,7,9)
    )
  ) %>%  opt_row_striping()
```


```{r, include=FALSE, warning=FALSE, message=FALSE}

##ALL PARTICIPANTS 


##TOTAL- ALL PARTICIPANTS 
data_tib= as_tibble(data_ccc) #HAD TO MAKE A TIBBLE FOR GT() TABLE FUNCTION
head(data_tib)

modules <- data_tib[,c("Connect_ID","d_512820379","d_949302066","d_536735468","d_976570371","d_663265240")] 
mods <- c("d_949302066","d_536735468","d_976570371","d_663265240")
modules$modules <- 0
modules$none <-0
for(i in 1:length(mods)){
  module <- modules[,mods[i]]
  count <- ifelse((!is.na(module) & module ==231311385), 1, 0)
  modules$modules <- count+modules$modules
  count1 <- ifelse((!is.na(module) & module==972455046), 1, 0)
  modules$none <- count1+modules$none
}

table(modules$modules)

table(modules$none)

table(modules$modules,modules$d_949302066)
CrossTable(modules$d_949302066, modules$modules,digits=4, prop.t=FALSE, prop.r=TRUE, prop.c=TRUE,prop.chisq=FALSE)

length(modules[which(modules$modules==3 & modules$d_663265240==231311385 & modules$d_536735468==231311385),])
modules1 <- modules %>% mutate(process=case_when(d_949302066 == 231311385 & modules==1 ~ "BOH Section only",
                                                 d_536735468 == 231311385 & modules==1 ~ "MRE Section only",
                                                 d_976570371 == 231311385 & modules==1 ~ "SAS Section only",
                                                 d_663265240 == 231311385 & modules==1 ~ "LAW Section only",
                                                 modules ==2 & d_949302066 == 231311385 & d_536735468 == 231311385 ~ "BOH and MRE Sections" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_976570371 == 231311385 ~ "BOH and SAS Sections" ,
                                                 modules ==2 & d_949302066 == 231311385 & d_663265240 == 231311385 ~ "BOH and LAW Sections" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "MRE and SAS Sections" ,
                                                 modules ==2 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "MRE and LAW Sections" ,
                                                 modules ==2 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "SAS and LAW Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_976570371 == 231311385 ~ "BOH, MRE, and SAS Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385~ "BOH, SAS, and LAW Sections" ,
                                                 modules ==3 & d_949302066 == 231311385 & d_536735468 == 231311385 & d_663265240 == 231311385 ~ "BOH, MRE, and LAW Sections",
                                                 modules ==3 & d_536735468 == 231311385 & d_976570371 == 231311385 & d_663265240 == 231311385 ~ "MRE, SAS< and LAW Sections" ,
                                                 modules ==0 ~ "None",
                                                 modules ==4 ~ "All"))
table(modules1$process)
tab1(modules1$process, decimal=2,sort.group = "decreasing", cum.percent = TRUE)$output.table




```
 
 \newpage
 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
#Make the automated table

completion_summary <- modules1  %>% dplyr::group_by(process) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(process, n, percentage) 

completion_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = html("Table 1c. All Verified Participants Survey Completion")) %>% 
  tab_footnote(
    footnote = "This includes impossible scenarios: Sections LAW, MRE, and/or SAS being completed without BOH Section first completed. Only scenarios that have occured will show on this table.") %>%
  cols_label(process = md("**Sections Completed**"), n = md("**Number of participants**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows(     groups= F,
    # columns = c(n, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
  grand_summary_rows(columns=c(n, percentage), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = process,
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "gray90"),
      locations = cells_body(
      rows = c(1,3,5,7,9)
    )
  ) %>%  opt_row_striping()
```

\newpage

# 2.	Completion of baseline tasks with percentile of not started, started, submitted of each section (active, passive, and total) for verified participants. Note, each section will be stratified into one table before all sections were available in prod, and one table after all sections were available in prod.  


## BOH Section



```{r, include=FALSE}

############### MODULE 1 ########################################
### Before all modules available 


# 2.	Completion of baseline tasks with number and % not started, started, submitted of each module (active_c, passive_c and total)
dim(active_c_before)
dim(passive_c_before)
dim(data_ccc_before)

  ### BEFORE ALL MODULES AV'L
sum(active_c_before$d_949302066==972455046, na.rm=TRUE)
round((sum(active_c_before$d_949302066==972455046, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2) #not started
sum(active_c_before$d_949302066==615768760, na.rm=TRUE)
round((sum(active_c_before$d_949302066==615768760, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2)#started
sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
round((sum(active_c_before$d_949302066==231311385, na.rm=TRUE)/length(active_c_before$d_949302066))*100, digits=2)#submitted

sum(passive_c_before$d_949302066==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==972455046, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2) #not started
sum(passive_c_before$d_949302066==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==615768760, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2)#started
sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)/length(passive_c_before$d_949302066))*100, digits=2)#submitted

sum(data_ccc_before$d_949302066==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==972455046, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #not started
sum(data_ccc_before$d_949302066==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==615768760, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #started
sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)/length(data_ccc_before$d_949302066))*100, digits=2) #submitted


#Make the automated table
data_tib2b= as_tibble(data_ccc_before) 
head(data_tib2b)

data_tib2a= as_tibble(data_ccc_after) 
head(data_tib2a)

data_tib2_all= as_tibble(data_ccc) 
head(data_tib2_all)

 ##BERFORE
dt2b <- data_tib2b[ , c(1,2,6 )] #want only frequency, process and percentage of participants 
head(dt2b)

dt2b= dt2b %>%  mutate(freq=rep(1, dim(dt2b)[[1]]))
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= round((ccc2b$freq.Active/dim(ccc2b)[[1]])*100 , digits=2)
head(ccc2b)

ccc2b$percentage.Passive= round((ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 , digits=2)
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_949302066 == 972455046  ~ "BOH Section Not Started",
                                               d_949302066 == 615768760  ~ "BOH Section Started",
                                               d_949302066 == 231311385  ~ "BOH Section Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              

```



```{r, warning=FALSE, echo=FALSE,  max.width='80px', inlcude=FALSE}


#Num2_M1=
  ccc2b_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table2a. BOH Section Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
               tab_spanner(
                 label="Active Participants",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive Participants",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total Participants",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns =  c(freq.Active,freq.Passive, freq, percentage),
                 # fns= list(
                 #   Sum= ~sum(.)
                 # ), decimals=0) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns = c(percentage.Active, percentage.Passive),
                 # fns= list(
                 #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive),fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF",
                 table.width=pct(50)
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

#knitr::kable(as.data.frame(Num2_M1[,c(1:8)]),caption='BOH Section Completion Status of Verified Participants (Before)',align=c("l", "c", "c","c", "c","c","c"), booktabs = TRUE) %>% add_header_above(c(" "=2, "Total" = 2, "Active" = 2,"Passive"=2))

#knitr::kable(Num2_M1) %>% kable_styling(latex_options = c("striped", "scale_down")) %>% landscape()


# attempt= kable(Num2_M1)
# attempt %>%  kable_styling(latex_options = "scale_down") %>% landscape()
# 
# kable(Num2_M1, format="latex", booktabs=T) %>%  kable_styling(latex_option="scale down")
# 
# Num2_M1 %>%  kable_styling() %>% kableExtra::scroll_box(width = "100%", height = "100px")


# ```{r kable, results = "asis"}
# Num2_M1 %>%
# kable(format = "pdf") %>%
# kable_styling() %>%
# kableExtra::scroll_box(width = "100%", height = "100px")
# ```

```



```{r, include=FALSE}
  ### AFTER ALL MODULES AV'L 
dim(active_c_after)
dim(passive_c_after)
dim(data_ccc_after)

sum(active_c_after$d_949302066==972455046, na.rm=TRUE)
round((sum(active_c_after$d_949302066==972455046, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2) #not started
sum(active_c_after$d_949302066==615768760, na.rm=TRUE)
round((sum(active_c_after$d_949302066==615768760, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2)#started
sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
round((sum(active_c_after$d_949302066==231311385, na.rm=TRUE)/length(active_c_after$d_949302066))*100, digits=2)#submitted

sum(passive_c_after$d_949302066==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==972455046, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2) #not started
sum(passive_c_after$d_949302066==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==615768760, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2)#started
sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)/length(passive_c_after$d_949302066))*100, digits=2)#submitted

sum(data_ccc_after$d_949302066==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==972455046, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #not started
sum(data_ccc_after$d_949302066==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==615768760, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #started
sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)/length(data_ccc_after$d_949302066))*100, digits=2) #submitted


#Make the automated table

dt2a <- data_tib2a[ , c(1,2,6 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=rep(1, dim(dt2a)[[1]]))
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_949302066 == 972455046  ~ "BOH Section Not Started",
                                             d_949302066 == 615768760  ~ "BOH Section Started",
                                             d_949302066 == 231311385  ~ "BOH Section Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2b. BOH Section Completion Status of Verified Participants (After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


```{r, include=FALSE}
  ### TOTAL 
dim(active_all)
dim(passive_all)
dim(data_ccc)

sum(active_all$d_949302066==972455046, na.rm=TRUE)
round((sum(active_all$d_949302066==972455046, na.rm=TRUE)/length(active_all$d_949302066))*100, digits=2) #not started
sum(active_all$d_949302066==615768760, na.rm=TRUE)
round((sum(active_all$d_949302066==615768760, na.rm=TRUE)/length(active_all$d_949302066))*100, digits=2)#started
sum(active_all$d_949302066==231311385, na.rm=TRUE)
round((sum(active_all$d_949302066==231311385, na.rm=TRUE)/length(active_all$d_949302066))*100, digits=2)#submitted

sum(passive_all$d_949302066==972455046, na.rm=TRUE)
round((sum(passive_all$d_949302066==972455046, na.rm=TRUE)/length(passive_all$d_949302066))*100, digits=2) #not started
sum(passive_all$d_949302066==615768760, na.rm=TRUE)
round((sum(passive_all$d_949302066==615768760, na.rm=TRUE)/length(passive_all$d_949302066))*100, digits=2)#started
sum(passive_all$d_949302066==231311385, na.rm=TRUE)
round((sum(passive_all$d_949302066==231311385, na.rm=TRUE)/length(passive_all$d_949302066))*100, digits=2)#submitted

sum(data_ccc$d_949302066==972455046, na.rm=TRUE)
round((sum(data_ccc$d_949302066==972455046, na.rm=TRUE)/length(data_ccc$d_949302066))*100, digits=2) #not started
sum(data_ccc$d_949302066==615768760, na.rm=TRUE)
round((sum(data_ccc$d_949302066==615768760, na.rm=TRUE)/length(data_ccc$d_949302066))*100, digits=2) #started
sum(data_ccc$d_949302066==231311385, na.rm=TRUE)
round((sum(data_ccc$d_949302066==231311385, na.rm=TRUE)/length(data_ccc$d_949302066))*100, digits=2) #submitted


#Make the automated table

dt2all <- data_tib2_all[ , c(1,2,6 )] #want only frequency, process and percentage of participants 
head(dt2all)

dt2all= dt2all %>%  mutate(freq=rep(1, dim(dt2all)[[1]]))
head(dt2a)
dim(dt2all)[[1]]

ccc2_all= dt2all %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2_all)

ccc2_all= ccc2_all %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2_all)

ccc2_all$percentage= (ccc2_all$freq/dim(ccc2_all)[[1]])*100 
head(ccc2_all) 

ccc2_all$percentage.Active= (ccc2_all$freq.Active/dim(ccc2_all)[[1]])*100 
head(ccc2_all)

ccc2_all$percentage.Passive= (ccc2_all$freq.Passive/dim(ccc2_all)[[1]])*100 
head(ccc2_all)
  
  
ccc2_all <- ccc2_all %>% mutate(status=case_when(d_949302066 == 972455046  ~ "BOH Section Not Started",
                                             d_949302066 == 615768760  ~ "BOH Section Started",
                                             d_949302066 == 231311385  ~ "BOH Section Completed"))
head(ccc2_all)



ccc2_all <- ccc2_all[, c(4:10)] #
head(ccc2_all)

ccc2_all_summary <- ccc2_all %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2_all_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}



ccc2_all_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2c. BOH Section Completion Status of All Verified Participants")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

\newpage
## MRE Section

```{r, include=FALSE}
### BEFORE ALL MODULES AV'L
sum(active_c_before$d_536735468==972455046, na.rm=TRUE)
round((sum(active_c_before$d_536735468==972455046, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2) #not started
sum(active_c_before$d_536735468==615768760, na.rm=TRUE)
round((sum(active_c_before$d_536735468==615768760, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2)#started
sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
round((sum(active_c_before$d_536735468==231311385, na.rm=TRUE)/length(active_c_before$d_536735468))*100, digits=2)#submitted

sum(passive_c_before$d_536735468==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==972455046, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2) #not started
sum(passive_c_before$d_536735468==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==615768760, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2)#started
sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)/length(passive_c_before$d_536735468))*100, digits=2)#submitted

sum(data_ccc_before$d_536735468==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==972455046, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #not started
sum(data_ccc_before$d_536735468==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==615768760, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #started
sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)/length(data_ccc_before$d_536735468))*100, digits=2) #submitted


dt2b <- data_tib2b[ , c(1,2,8 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=rep(1, dim(dt2b)[[1]]))
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_536735468 == 972455046  ~ "MRE Section Not Started",
                                               d_536735468 == 615768760  ~ "MRE Section Started",
                                               d_536735468 == 231311385  ~ "MRE Section Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}
#Make the automated table




ccc2b_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2d. MRE Section Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
               tab_spanner(
                 label="Active Participants",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive Participants",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total Participants",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns =  c(freq.Active,freq.Passive, freq, percentage),
                 # fns= list(
                 #   Sum= ~sum(.)
                 # ), decimals=0) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns = c(percentage.Active, percentage.Passive),
                 # fns= list(
                 #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

```


```{r, include=FALSE}

### AFTER ALL MODULES AV'L
dim(active_c_after)
dim(passive_c_after)
dim(data_ccc_after)

sum(active_c_after$d_536735468==972455046, na.rm=TRUE)
round((sum(active_c_after$d_536735468==972455046, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2) #not started
sum(active_c_after$d_536735468==615768760, na.rm=TRUE)
round((sum(active_c_after$d_536735468==615768760, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2)#started
sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
round((sum(active_c_after$d_536735468==231311385, na.rm=TRUE)/length(active_c_after$d_536735468))*100, digits=2)#submitted

sum(passive_c_after$d_536735468==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==972455046, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2) #not started
sum(passive_c_after$d_536735468==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==615768760, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2)#started
sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)/length(passive_c_after$d_536735468))*100, digits=2)#submitted

sum(data_ccc_after$d_536735468==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==972455046, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #not started
sum(data_ccc_after$d_536735468==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==615768760, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #started
sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)/length(data_ccc_after$d_536735468))*100, digits=2) #submitted


#Make the automated table
dt2a <- data_tib2a[ , c(1,2,8 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=rep(1, dim(dt2a)[[1]]))
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_536735468 == 972455046  ~ "MRE Section Not Started",
                                             d_536735468 == 615768760  ~ "MRE Section Started",
                                             d_536735468 == 231311385  ~ "MRE Section Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE, warning=FALSE}


ccc2a_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2e. MRE Section Completion Status of Verified Participants (After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


```{r, include=FALSE}

### ALL PARTICIPANTS 
dim(active_all)
dim(passive_all)
dim(data_ccc)

sum(active_all$d_536735468==972455046, na.rm=TRUE)
round((sum(active_all$d_536735468==972455046, na.rm=TRUE)/length(active_all$d_536735468))*100, digits=2) #not started
sum(active_all$d_536735468==615768760, na.rm=TRUE)
round((sum(active_all$d_536735468==615768760, na.rm=TRUE)/length(active_all$d_536735468))*100, digits=2)#started
sum(active_all$d_536735468==231311385, na.rm=TRUE)
round((sum(active_all$d_536735468==231311385, na.rm=TRUE)/length(active_all$d_536735468))*100, digits=2)#submitted

sum(passive_all$d_536735468==972455046, na.rm=TRUE)
round((sum(passive_all$d_536735468==972455046, na.rm=TRUE)/length(passive_all$d_536735468))*100, digits=2) #not started
sum(passive_all$d_536735468==615768760, na.rm=TRUE)
round((sum(passive_all$d_536735468==615768760, na.rm=TRUE)/length(passive_all$d_536735468))*100, digits=2)#started
sum(passive_all$d_536735468==231311385, na.rm=TRUE)
round((sum(passive_all$d_536735468==231311385, na.rm=TRUE)/length(passive_all$d_536735468))*100, digits=2)#submitted

sum(data_ccc$d_536735468==972455046, na.rm=TRUE)
round((sum(data_ccc$d_536735468==972455046, na.rm=TRUE)/length(data_ccc$d_536735468))*100, digits=2) #not started
sum(data_ccc$d_536735468==615768760, na.rm=TRUE)
round((sum(data_ccc$d_536735468==615768760, na.rm=TRUE)/length(data_ccc$d_536735468))*100, digits=2) #started
sum(data_ccc$d_536735468==231311385, na.rm=TRUE)
round((sum(data_ccc$d_536735468==231311385, na.rm=TRUE)/length(data_ccc$d_536735468))*100, digits=2) #submitted


#Make the automated table
dt2all <- data_tib2_all[ , c(1,2,8 )] #want only frequency, process and percentage of participants 
head(dt2all)

dt2all= dt2all %>%  mutate(freq=rep(1, dim(dt2all)[[1]]))
head(dt2all)
dim(dt2all)[[1]]

ccc2_all= dt2all %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2_all)

ccc2_all= ccc2_all %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2_all)

ccc2_all$percentage= (ccc2_all$freq/dim(ccc2_all)[[1]])*100 
head(ccc2_all) 

ccc2_all$percentage.Active= (ccc2_all$freq.Active/dim(ccc2_all)[[1]])*100 
head(ccc2_all)

ccc2_all$percentage.Passive= (ccc2_all$freq.Passive/dim(ccc2_all)[[1]])*100 
head(ccc2_all)
  
  
ccc2_all <- ccc2_all %>% mutate(status=case_when(d_536735468 == 972455046  ~ "MRE Section Not Started",
                                             d_536735468 == 615768760  ~ "MRE Section Started",
                                             d_536735468 == 231311385  ~ "MRE Section Completed"))
head(ccc2_all)



ccc2_all <- ccc2_all[, c(4:10)] #
head(ccc2_all)

ccc2_all_summary <- ccc2_all %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2_all_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE, warning=FALSE}


ccc2_all_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2f. MRE Section Completion Status of All Verified Participants")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

\newpage
# 
## SAS Section

```{r, include=FALSE}

### BEFORE ALL MODULES AV'L
sum(active_c_before$d_976570371==972455046, na.rm=TRUE)
round((sum(active_c_before$d_976570371==972455046, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2) #not started
sum(active_c_before$d_976570371==615768760, na.rm=TRUE)
round((sum(active_c_before$d_976570371==615768760, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2)#started
sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
round((sum(active_c_before$d_976570371==231311385, na.rm=TRUE)/length(active_c_before$d_976570371))*100, digits=2)#submitted

sum(passive_c_before$d_976570371==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==972455046, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2) #not started
sum(passive_c_before$d_976570371==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==615768760, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2)#started
sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)/length(passive_c_before$d_976570371))*100, digits=2)#submitted

sum(data_ccc_before$d_976570371==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==972455046, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #not started
sum(data_ccc_before$d_976570371==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==615768760, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #started
sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)/length(data_ccc_before$d_976570371))*100, digits=2) #submitted


dt2b <- data_tib2b[ , c(1,2,9 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=rep(1, dim(dt2b)[[1]]))
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_976570371 == 972455046  ~ "SAS Section Not Started",
                                               d_976570371 == 615768760  ~ "SAS Section Started",
                                               d_976570371 == 231311385  ~ "SAS Section Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A
```

```{r, echo=FALSE, warning=FALSE}
#Make the automated table



ccc2b_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2g. SAS Section Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
               tab_spanner(
                 label="Active Participants",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive Participants",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total Participants",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns =  c(freq.Active,freq.Passive, freq, percentage),
                 # fns= list(
                 #   Sum= ~sum(.)
                 # ), decimals=0) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns = c(percentage.Active, percentage.Passive),
                 # fns= list(
                 #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()

```


```{r, include=FALSE}

### AFTER ALL MODULES AV'L 
sum(active_c_after$d_976570371==972455046, na.rm=TRUE)
round((sum(active_c_after$d_976570371==972455046, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2) #not started
sum(active_c_after$d_976570371==615768760, na.rm=TRUE)
round((sum(active_c_after$d_976570371==615768760, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2)#started
sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
round((sum(active_c_after$d_976570371==231311385, na.rm=TRUE)/length(active_c_after$d_976570371))*100, digits=2)#submitted

sum(passive_c_after$d_976570371==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==972455046, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2) #not started
sum(passive_c_after$d_976570371==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==615768760, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2)#started
sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)/length(passive_c_after$d_976570371))*100, digits=2)#submitted

sum(data_ccc_after$d_976570371==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==972455046, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #not started
sum(data_ccc_after$d_976570371==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==615768760, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #started
sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)/length(data_ccc_after$d_976570371))*100, digits=2) #submitted


#Make the automated table
dt2a <- data_tib2a[ , c(1,2,9 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=rep(1, dim(dt2a)[[1]]))
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_976570371 == 972455046  ~ "SAS Section Not Started",
                                             d_976570371 == 615768760  ~ "SAS Section Started",
                                             d_976570371 == 231311385  ~ "SAS Section Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2h. SAS Section Completion Status of Verified Participants (After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

```{r, include=FALSE}

### ALL PARTICIPANTS  
sum(active_all$d_976570371==972455046, na.rm=TRUE)
round((sum(active_all$d_976570371==972455046, na.rm=TRUE)/length(active_all$d_976570371))*100, digits=2) #not started
sum(active_all$d_976570371==615768760, na.rm=TRUE)
round((sum(active_all$d_976570371==615768760, na.rm=TRUE)/length(active_all$d_976570371))*100, digits=2)#started
sum(active_all$d_976570371==231311385, na.rm=TRUE)
round((sum(active_all$d_976570371==231311385, na.rm=TRUE)/length(active_all$d_976570371))*100, digits=2)#submitted

sum(passive_all$d_976570371==972455046, na.rm=TRUE)
round((sum(passive_all$d_976570371==972455046, na.rm=TRUE)/length(passive_all$d_976570371))*100, digits=2) #not started
sum(passive_all$d_976570371==615768760, na.rm=TRUE)
round((sum(passive_all$d_976570371==615768760, na.rm=TRUE)/length(passive_all$d_976570371))*100, digits=2)#started
sum(passive_all$d_976570371==231311385, na.rm=TRUE)
round((sum(passive_all$d_976570371==231311385, na.rm=TRUE)/length(passive_all$d_976570371))*100, digits=2)#submitted

sum(data_ccc$d_976570371==972455046, na.rm=TRUE)
round((sum(data_ccc$d_976570371==972455046, na.rm=TRUE)/length(data_ccc$d_976570371))*100, digits=2) #not started
sum(data_ccc$d_976570371==615768760, na.rm=TRUE)
round((sum(data_ccc$d_976570371==615768760, na.rm=TRUE)/length(data_ccc$d_976570371))*100, digits=2) #started
sum(data_ccc$d_976570371==231311385, na.rm=TRUE)
round((sum(data_ccc$d_976570371==231311385, na.rm=TRUE)/length(data_ccc$d_976570371))*100, digits=2) #submitted


#Make the automated table
dt2all <- data_tib2_all[ , c(1,2,9 )] #want only frequency, process and percentage of participants 
head(dt2all)

dt2all= dt2all %>%  mutate(freq=rep(1, dim(dt2all)[[1]]))
head(dt2all)
dim(dt2all)[[1]]

ccc2_all= dt2all %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2_all)

ccc2_all= ccc2_all %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2_all)

ccc2_all$percentage= (ccc2_all$freq/dim(ccc2_all)[[1]])*100 
head(ccc2_all) 

ccc2_all$percentage.Active= (ccc2_all$freq.Active/dim(ccc2_all)[[1]])*100 
head(ccc2_all)

ccc2_all$percentage.Passive= (ccc2_all$freq.Passive/dim(ccc2_all)[[1]])*100 
head(ccc2_all)
  
  
ccc2_all <- ccc2_all %>% mutate(status=case_when(d_976570371 == 972455046  ~ "SAS Section Not Started",
                                             d_976570371 == 615768760  ~ "SAS Section Started",
                                             d_976570371 == 231311385  ~ "SAS Section Completed"))
head(ccc2_all)



ccc2_all <- ccc2_all[, c(4:10)] #
head(ccc2_all)

ccc2_all_summary <- ccc2_all %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2_all_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2_all_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2i. SAS Section Completion Status of All Verified Participants")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

\newpage
# 
## LAW Section

```{r, include=FALSE}
# 2.	Completion of baseline tasks with number and % not started, started, submitted of each module (active_c, passive_c and total)  

###BEFORE ALL MODULES AV'L
sum(active_c_before$d_663265240==972455046, na.rm=TRUE)
round((sum(active_c_before$d_663265240==972455046, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2) #not started
sum(active_c_before$d_663265240==615768760, na.rm=TRUE)
round((sum(active_c_before$d_663265240==615768760, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2)#started
sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
round((sum(active_c_before$d_663265240==231311385, na.rm=TRUE)/length(active_c_before$d_663265240))*100, digits=2)#submitted

sum(passive_c_before$d_663265240==972455046, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==972455046, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2) #not started
sum(passive_c_before$d_663265240==615768760, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==615768760, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2)#started
sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
round((sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)/length(passive_c_before$d_663265240))*100, digits=2)#submitted

sum(data_ccc_before$d_663265240==972455046, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==972455046, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #not started
sum(data_ccc_before$d_663265240==615768760, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==615768760, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #started
sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)
round((sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)/length(data_ccc_before$d_663265240))*100, digits=2) #submitted


#Make automated table
dt2b <- data_tib2b[ , c(1,2,10 )] #want only frequency, process and percentage of participants 
head(dt2b)
table(dt2b$d_536735468)

dt2b= dt2b %>%  mutate(freq=rep(1, dim(dt2b)[[1]]))
head(dt2b)
dim(dt2b)[[1]]

ccc2b= dt2b %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2b)

ccc2b= ccc2b %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2b)

ccc2b$percentage= (ccc2b$freq/dim(ccc2b)[[1]])*100 
head(ccc2b) 

ccc2b$percentage.Active= (ccc2b$freq.Active/dim(ccc2b)[[1]])*100 
head(ccc2b)

ccc2b$percentage.Passive= (ccc2b$freq.Passive/dim(ccc2b)[[1]])*100 
head(ccc2b)


ccc2b <- ccc2b %>% mutate(status=case_when(d_663265240 == 972455046  ~ "LAW Section Not Started",
                                               d_663265240 == 615768760  ~ "LAW Section Started",
                                               d_663265240 == 231311385  ~ "LAW Section Completed"))
head(ccc2b)



ccc2b <- ccc2b[, c(4:10)] #
head(ccc2b)

ccc2b_summary <- ccc2b %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2b_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE, warning=FALSE}



ccc2b_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2j. LAW Section Completion Status of Verified Participants (Before)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
               tab_footnote(
                 footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
               tab_spanner(
                 label="Active Participants",
                 columns=vars(freq.Active,percentage.Active)
               ) %>% 
               tab_spanner(
                 label="Passive Participants",
                 columns=vars(freq.Passive,percentage.Passive)
               ) %>% 
               tab_spanner(
                 label="Total Participants",
                 columns=vars(freq, percentage)
               ) %>% 
               # tab_style(
               #   cell_text(
               #   align="center"),
               #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
               # ) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns =  c(freq.Active,freq.Passive, freq, percentage),
                 # fns= list(
                 #   Sum= ~sum(.)
                 # ), decimals=0) %>% 
                 # summary_rows(     groups= FALSE,
                 # #    groups= T, 
                 # columns = c(percentage.Active, percentage.Passive),
                 # fns= list(
                 #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
               tab_options(
                 heading.title.font.size = 25,
                 heading.padding = 10,
                 row_group.font.weight = "bolder",
                 summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
                 row_group.background.color =    "#99CCFF"
               ) %>%
               tab_style(
                 style = list(
                   cell_text(weight = "bold")
                 ),
                 locations = cells_body(
                   columns = status,
                 )
               )  %>% 
               tab_style(
                 style= list(
                   cell_text(
                     align="center"
                   )
                 ),
                 locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
               ) %>%  opt_row_striping()


```


```{r, include=FALSE}
### AFTER ALL MODULES AV'L 
sum(active_c_after$d_663265240==972455046, na.rm=TRUE)
round((sum(active_c_after$d_663265240==972455046, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2) #not started
sum(active_c_after$d_663265240==615768760, na.rm=TRUE)
round((sum(active_c_after$d_663265240==615768760, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2)#started
sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
round((sum(active_c_after$d_663265240==231311385, na.rm=TRUE)/length(active_c_after$d_663265240))*100, digits=2)#submitted

sum(passive_c_after$d_663265240==972455046, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==972455046, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2) #not started
sum(passive_c_after$d_663265240==615768760, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==615768760, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2)#started
sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
round((sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)/length(passive_c_after$d_663265240))*100, digits=2)#submitted

sum(data_ccc_after$d_663265240==972455046, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==972455046, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #not started
sum(data_ccc_after$d_663265240==615768760, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==615768760, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #started
sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)
round((sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)/length(data_ccc_after$d_663265240))*100, digits=2) #submitted

#Make automated table
dt2a <- data_tib2a[ , c(1,2,10 )] #want only frequency, process and percentage of participants 
head(dt2a)

dt2a= dt2a %>%  mutate(freq=rep(1, dim(dt2a)[[1]]))
head(dt2a)
dim(dt2a)[[1]]

ccc2a= dt2a %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2a)

ccc2a= ccc2a %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2a)

ccc2a$percentage= (ccc2a$freq/dim(ccc2a)[[1]])*100 
head(ccc2a) 

ccc2a$percentage.Active= (ccc2a$freq.Active/dim(ccc2a)[[1]])*100 
head(ccc2a)

ccc2a$percentage.Passive= (ccc2a$freq.Passive/dim(ccc2a)[[1]])*100 
head(ccc2a)
  
  
ccc2a <- ccc2a %>% mutate(status=case_when(d_663265240 == 972455046  ~ "LAW Section Not Started",
                                             d_663265240 == 615768760  ~ "LAW Section Started",
                                             d_663265240 == 231311385  ~ "LAW Section Completed"))
head(ccc2a)



ccc2a <- ccc2a[, c(4:10)] #
head(ccc2a)

ccc2a_summary <- ccc2a %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2a_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2a_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2k. LAW Section Completion Status of Verified Participants (After)")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()


```


```{r, include=FALSE}
### ALL PARTICIPANTS 
sum(active_all$d_663265240==972455046, na.rm=TRUE)
round((sum(active_all$d_663265240==972455046, na.rm=TRUE)/length(active_all$d_663265240))*100, digits=2) #not started
sum(active_all$d_663265240==615768760, na.rm=TRUE)
round((sum(active_all$d_663265240==615768760, na.rm=TRUE)/length(active_all$d_663265240))*100, digits=2)#started
sum(active_all$d_663265240==231311385, na.rm=TRUE)
round((sum(active_all$d_663265240==231311385, na.rm=TRUE)/length(active_all$d_663265240))*100, digits=2)#submitted

sum(passive_all$d_663265240==972455046, na.rm=TRUE)
round((sum(passive_all$d_663265240==972455046, na.rm=TRUE)/length(passive_all$d_663265240))*100, digits=2) #not started
sum(passive_all$d_663265240==615768760, na.rm=TRUE)
round((sum(passive_all$d_663265240==615768760, na.rm=TRUE)/length(passive_all$d_663265240))*100, digits=2)#started
sum(passive_all$d_663265240==231311385, na.rm=TRUE)
round((sum(passive_all$d_663265240==231311385, na.rm=TRUE)/length(passive_all$d_663265240))*100, digits=2)#submitted

sum(data_ccc$d_663265240==972455046, na.rm=TRUE)
round((sum(data_ccc$d_663265240==972455046, na.rm=TRUE)/length(data_ccc$d_663265240))*100, digits=2) #not started
sum(data_ccc$d_663265240==615768760, na.rm=TRUE)
round((sum(data_ccc$d_663265240==615768760, na.rm=TRUE)/length(data_ccc$d_663265240))*100, digits=2) #started
sum(data_ccc$d_663265240==231311385, na.rm=TRUE)
round((sum(data_ccc$d_663265240==231311385, na.rm=TRUE)/length(data_ccc$d_663265240))*100, digits=2) #submitted

#Make automated table
dt2all <- data_tib2_all[ , c(1,2,10 )] #want only frequency, process and percentage of participants 
head(dt2all)

dt2all= dt2all %>%  mutate(freq=rep(1, dim(dt2all)[[1]]))
head(dt2all)
dim(dt2all)[[1]]

ccc2_all= dt2all %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc2_all)

ccc2_all= ccc2_all %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc2_all)

ccc2_all$percentage= (ccc2_all$freq/dim(ccc2_all)[[1]])*100 
head(ccc2_all) 

ccc2_all$percentage.Active= (ccc2_all$freq.Active/dim(ccc2_all)[[1]])*100 
head(ccc2_all)

ccc2_all$percentage.Passive= (ccc2_all$freq.Passive/dim(ccc2_all)[[1]])*100 
head(ccc2_all)
  
  
ccc2_all <- ccc2_all %>% mutate(status=case_when(d_663265240 == 972455046  ~ "LAW Section Not Started",
                                             d_663265240 == 615768760  ~ "LAW Section Started",
                                             d_663265240 == 231311385  ~ "LAW Section Completed"))
head(ccc2_all)



ccc2_all <- ccc2_all[, c(4:10)] #
head(ccc2_all)

ccc2_all_summary <- ccc2_all %>%  group_by(status)  %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc2_all_summary)                                                                              
gt_print2A


```

```{r, echo=FALSE, warning=FALSE}



ccc2_all_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 2l. LAW Section Completion Status of All Verified Participants")) %>% 
  cols_label(status = md("**Completion Status**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()


```

\newpage
\FloatBarrier

# 3. Time in minutes from verification to completion of each section- 25, 50, 75 percentiles (active, passive, and total). 

# 
## BOH Section 

```{r, include=FALSE}


# 3.	Time from verification to completion of each module- Hours 25, 50, 75 percentile (active_c, passive_c and total)  
#d_914594314 verified
#d_517311251 Mod1 completion time stamp

time.var1 <- c("d_914594314","d_517311251")

###BEFORE
#All verified participant totals that have completed mod1
act_before= active_c_before %>% filter(d_949302066==231311385)
dim(act_before)
pas_before= passive_c_before %>% filter(d_949302066==231311385)
dim(pas_before)
mer_before= data_ccc_before %>% filter(d_949302066==231311385)
dim(mer_before)


#Active
act_before_time<- act_before[complete.cases(act_before[ , time.var1]), ]


tmp1A <- act_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1A$d_914594314 <- as.POSIXct(ymd_hms(tmp1A$d_914594314))
tmp1A$d_517311251 <- as.POSIXct(ymd_hms(tmp1A$d_517311251))


tmp1A$Mod1completionA <- difftime(tmp1A$d_517311251, tmp1A$d_914594314, units="hours")
#summary(as.numeric(tmp1A$Mod1completionA)) #normal for some of these to be negative, active parts. can get verified later on

df_tmp1A <-as_tibble(tmp1A)
#data(df_tmp1A)
st(tmp1A, vars = c('Mod1completionA'))


#Passive
pas_before_time<- pas_before[complete.cases(pas_before[ , time.var1]), ]


tmp1P <- pas_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1P$d_914594314 <- as.POSIXct(ymd_hms(tmp1P$d_914594314))
tmp1P$d_517311251 <- as.POSIXct(ymd_hms(tmp1P$d_517311251))


tmp1P$Mod1completionP <- difftime(tmp1P$d_517311251, tmp1P$d_914594314, units="hours")
summary(as.numeric(tmp1P$Mod1completionP)) #good that these are all positive, passives NEED to be verified first 


#Total
mer_before_time<- mer_before[complete.cases(mer_before[ , time.var1]), ]


tmp1T <- mer_before_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1T$d_914594314 <- as.POSIXct(ymd_hms(tmp1T$d_914594314))
tmp1T$d_517311251 <- as.POSIXct(ymd_hms(tmp1T$d_517311251))


tmp1T$Mod1completionT <- difftime(tmp1T$d_517311251, tmp1T$d_914594314, units="hours")
summary(as.numeric(tmp1T$Mod1completionT))



```

```{r, echo=FALSE, warning=FALSE, message=FALSE}

#cat("Active(n=", dim(act_before)[[1]], ")")
#summary(as.numeric(tmp1A$Mod1completionA))
#st(tmp1A, vars = c('Mod1completionA', title='Table 3a. BOH Active (Before)'))
#summarise(tmp1A)

Table3a = tmp1A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3a,caption='BOH Active (Before)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3a.


#cat("Passive(n=", dim(pas_before)[[1]], ")")
#st(tmp1P, vars = c('Mod1completionP', title='Table 3b. BOH Passive (Before)'))

Table3b = tmp1P %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionP,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3b,caption='BOH Passive (Before)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3b. 


#cat("Total(n=", dim(mer_before)[[1]], ")")
#summary(as.numeric(tmp1T$Mod1completionT))
#st(tmp1T, vars = c('Mod1completionT', title='Table 3c. BOH Total (Before)'))

Table3c = tmp1T %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3c,caption='BOH Total (Before)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3c.

```


```{r, include=FALSE}

###AFTER
#All verified participant totals that have completed mod1
act_after= active_c_after %>% filter(d_949302066==231311385)
dim(act_after)
pas_after= passive_c_after %>% filter(d_949302066==231311385)
dim(pas_after)
mer_after= data_ccc_after %>% filter(d_949302066==231311385)
dim(mer_after)


#Active
act_after_time<- act_after[complete.cases(act_after[ , time.var1]), ]


tmp1A_A <- act_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1A_A$d_914594314 <- as.POSIXct(ymd_hms(tmp1A_A$d_914594314))
tmp1A_A$d_517311251 <- as.POSIXct(ymd_hms(tmp1A_A$d_517311251))


tmp1A_A$Mod1completionA <- difftime(tmp1A_A$d_517311251, tmp1A_A$d_914594314, units="hours")
summary(as.numeric(tmp1A_A$Mod1completionA)) #normal for some of these to be negative, active parts. can get verified later on

#Passive
pas_after_time<- pas_after[complete.cases(pas_after[ , time.var1]), ]


tmp1P_A <- pas_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1P_A$d_914594314 <- as.POSIXct(ymd_hms(tmp1P_A$d_914594314))
tmp1P_A$d_517311251 <- as.POSIXct(ymd_hms(tmp1P_A$d_517311251))


tmp1P_A$Mod1completionP <- difftime(tmp1P_A$d_517311251, tmp1P_A$d_914594314, units="hours")
summary(as.numeric(tmp1P_A$Mod1completionP)) #good that these are all positive, passsive NEED to be verified first 


#Total
mer_after_time<- mer_after[complete.cases(mer_after[ , time.var1]), ]


tmp1T_A <- mer_after_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1T_A$d_914594314 <- as.POSIXct(ymd_hms(tmp1T_A$d_914594314))
tmp1T_A$d_517311251 <- as.POSIXct(ymd_hms(tmp1T_A$d_517311251))


tmp1T_A$Mod1completionT <- difftime(tmp1T_A$d_517311251, tmp1T_A$d_914594314, units="hours")
summary(as.numeric(tmp1T_A$Mod1completionT))
```

```{r, echo=FALSE}

#cat("Active(n=", dim(act_after)[[1]], ")")
#summary(as.numeric(tmp1A_A$Mod1completionA))
#st(tmp1A_A, vars = c('Mod1completionA', title='Table 3d. BOH Active (After)'))

Table3d = tmp1A_A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3d,caption='BOH Active (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3d. 


#cat("Passive(n=", dim(pas_after)[[1]], ")")
#summary(as.numeric(tmp1P_A$Mod1completionP))
#st(tmp1P_A, vars = c('Mod1completionP', title='Table 3e. BOH Passive (After)'))

Table3e = tmp1P_A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionP,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3e,caption='BOH Passive (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3e.


#cat("Total(n=", dim(mer_after)[[1]], ")")
#summary(as.numeric(tmp1T_A$Mod1completionT))
#st(tmp1T_A, vars = c('Mod1completionT', title='Table 3f. BOH Total (After)'))

Table3f = tmp1T_A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3f,caption='BOH Total (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3f.
```


```{r, include=FALSE}

#####ALL PARTICIPANTS 
act_all= active_c %>% filter(d_949302066==231311385)
dim(act_all)
pas_all= passive_c %>% filter(d_949302066==231311385)
dim(pas_all)
mer_all= data_ccc %>% filter(d_949302066==231311385)
dim(mer_all)


#Active
act_all_time<- act_all[complete.cases(act_all[ , time.var1]), ]


tmp1A_All <- act_all_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1A_All$d_914594314 <- as.POSIXct(ymd_hms(tmp1A_All$d_914594314))
tmp1A_All$d_517311251 <- as.POSIXct(ymd_hms(tmp1A_All$d_517311251))


tmp1A_All$Mod1completionA <- difftime(tmp1A_All$d_517311251, tmp1A_All$d_914594314, units="hours")
summary(as.numeric(tmp1A_All$Mod1completionA)) #normal for some of these to be negative, active parts. can get verified later on

#Passive
pas_all_time<- pas_all[complete.cases(pas_all[ , time.var1]), ]


tmp1P_All <- pas_all_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1P_All$d_914594314 <- as.POSIXct(ymd_hms(tmp1P_All$d_914594314))
tmp1P_All$d_517311251 <- as.POSIXct(ymd_hms(tmp1P_All$d_517311251))


tmp1P_All$Mod1completionP <- difftime(tmp1P_All$d_517311251, tmp1P_All$d_914594314, units="hours")
summary(as.numeric(tmp1P_All$Mod1completionP)) #good that these are all positive, passsive NEED to be verified first 


#Total
mer_all_time<- mer_all[complete.cases(mer_all[ , time.var1]), ]


tmp1T_All <- mer_all_time[,c("Connect_ID","d_914594314","d_517311251")]
tmp1T_All$d_914594314 <- as.POSIXct(ymd_hms(tmp1T_All$d_914594314))
tmp1T_All$d_517311251 <- as.POSIXct(ymd_hms(tmp1T_All$d_517311251))


tmp1T_All$Mod1completionT <- difftime(tmp1T_All$d_517311251, tmp1T_All$d_914594314, units="hours")
summary(as.numeric(tmp1T_All$Mod1completionT))
```

```{r, echo=FALSE}

#cat("Active(n=", dim(act_all)[[1]], ")")
#summary(as.numeric(tmp1A_All$Mod1completionA))
#st(tmp1A_All, vars = c('Mod1completionA', title='Table 3g. All BOH Active'))

Table3g = tmp1A_All %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3g,caption='All BOH Active',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3g. 


#cat("Passive(n=", dim(pas_all)[[1]], ")")
#summary(as.numeric(tmp1P_All$Mod1completionP))
#st(tmp1P_All, vars = c('Mod1completionP', title='Table 3h. All BOH Passive'))

Table3h = tmp1P_All %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionP,na.rm = TRUE), digits=2), end = -1))
 
knitr::kable(Table3h,caption='All BOH Passive',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3h.


#cat("Total(n=", dim(mer_all)[[1]], ")")
#summary(as.numeric(tmp1T_All$Mod1completionT))
#st(tmp1T_All, vars = c('Mod1completionT', title='Table 3i. All BOH Total'))

Table3i = tmp1T_All %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3i,caption='All BOH Total',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3i.
```


# 
\newpage
\FloatBarrier


\newpage
## MRE Section 

```{r, include=FALSE}


# 3.	Time from verification to completion of each module (active, passive and total) 
time.var2 <- c("d_914594314","d_832139544")


##AFTER
#All verified participant totals, verified active total and verified passive total
act2 <- active_c_after %>%  filter(d_536735468==231311385)
dim(act2)
pas2 <- passive_c_after %>% filter(d_536735468==231311385)
dim(pas2)
mer2 <- data_ccc_after %>% filter(d_536735468==231311385)
dim(mer2)

#Active
act2_time<- act2[complete.cases(act2[ , time.var2]), ]

tmp2A <- act2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmp2A$d_914594314 <- as.POSIXct(ymd_hms(tmp2A$d_914594314))
tmp2A$d_832139544 <- as.POSIXct(ymd_hms(tmp2A$d_832139544))


tmp2A$Mod2completionA <- difftime(tmp2A$d_832139544, tmp2A$d_914594314, units="hours")
summary(as.numeric(tmp2A$Mod2completionA))   #normal for some of these to be negative, active parts. can get verified later on
# library(vtable)
# st(tmp2A$Mod2completionA)



#Passive
pas2_time<- pas2[complete.cases(pas2[ , time.var2]), ]


tmp2P <- pas2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmp2P$d_914594314 <- as.POSIXct(ymd_hms(tmp2P$d_914594314))
tmp2P$d_832139544 <- as.POSIXct(ymd_hms(tmp2P$d_832139544))


tmp2P$Mod2completionP <- difftime(tmp2P$d_832139544, tmp2P$d_914594314, units="hours")
summary(as.numeric(tmp2P$Mod2completionP)) #good that these are all positive, passives NEED to be verified first 

#Total
mer2_time<- mer2[complete.cases(mer2[ , time.var2]), ]


tmp2T <- mer2_time[,c("Connect_ID","d_914594314","d_832139544")]
tmp2T$d_914594314 <- as.POSIXct(ymd_hms(tmp2T$d_914594314))
tmp2T$d_832139544 <- as.POSIXct(ymd_hms(tmp2T$d_832139544))


tmp2T$Mod2completionT <- difftime(tmp2T$d_832139544, tmp2T$d_914594314, units="hours")
summary(as.numeric(tmp2T$Mod2completionT))


```


```{r, echo=FALSE}

#cat("Active(n=", dim(act2)[[1]], ")")
#summary(as.numeric(tmp2A$Mod2completionA))
#st(tmp2A, vars = c('Mod2completionA', title='Table 3g. MRE Active (After)'))

Table3j = tmp2A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod2completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod2completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod2completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod2completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod2completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod2completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod2completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3j,caption='MRE Active (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3j. 

#cat("Passive(n=", dim(pas2)[[1]], ")")
#summary(as.numeric(tmp2P$Mod2completionP))
#st(tmp2P, vars = c('Mod2completionP', title='Table 3h. MRE Passive (After)'))

Table3k = tmp2P %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod2completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod2completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod2completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod2completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod2completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod2completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod2completionP,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3k,caption='All MRE Passive (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3k. 

#cat("Total(n=", dim(mer2)[[1]], ")")
#summary(as.numeric(tmp2T$Mod2completionT))
#st(tmp2T, vars = c('Mod2completionT', title='Table 3i. MRE Total (After)'))

Table3l = tmp2T %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod2completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod2completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod2completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod2completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod2completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod2completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod2completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3l,caption='MRE Total (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3l. 

```

\newpage
\FloatBarrier


## SAS Section
```{r, include=FALSE}

# 3.	Time from verification to completion of each module (active, passive and total) 
#d_770257102 completed
time.var3 <- c("d_914594314","d_770257102")


#All verified participant totals, verified active total and verified passive total
act3 <- active_c_after %>% filter(d_976570371==231311385)
dim(act3)
pas3 <- passive_c_after %>% filter(d_976570371==231311385)
dim(pas3)
mer3 <- data_ccc_after %>% filter(d_976570371==231311385)
dim(mer3)

#Active
#act3_time <- act3[complete.cases(time.var3)]
act3_time<- act3[complete.cases(act3[ , time.var3]), ]


tmp3A <- act3_time[,c("Connect_ID","d_914594314","d_770257102")]
tmp3A$d_914594314 <- as.POSIXct(ymd_hms(tmp3A$d_914594314))
tmp3A$d_770257102 <- as.POSIXct(ymd_hms(tmp3A$d_770257102))


tmp3A$Mod3completionA <- difftime(tmp3A$d_770257102, tmp3A$d_914594314, units="hours")
summary(as.numeric(tmp3A$Mod3completionA))


#Passive
#pas3_time <- pas3[complete.cases(time.var3)]
pas3_time<- pas3[complete.cases(pas3[ , time.var3]), ]


Ptmp3A <- pas3_time[,c("Connect_ID","d_914594314","d_770257102")]
Ptmp3A$d_914594314 <- as.POSIXct(ymd_hms(Ptmp3A$d_914594314))
Ptmp3A$d_770257102 <- as.POSIXct(ymd_hms(Ptmp3A$d_770257102))


Ptmp3A$Mod3completionP <- difftime(Ptmp3A$d_770257102, Ptmp3A$d_914594314, units="hours")
summary(as.numeric(Ptmp3A$Mod3completionP))


#Total
#mer3_time <- mer3[complete.cases(time.var3)]
mer3_time<- mer3[complete.cases(mer3[ , time.var3]), ]


Ttmp3T <- mer3_time[,c("Connect_ID","d_914594314","d_770257102")]
Ttmp3T$d_914594314 <- as.POSIXct(ymd_hms(Ttmp3T$d_914594314))
Ttmp3T$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3T$d_770257102))


Ttmp3T$Mod3completionT <- difftime(Ttmp3T$d_770257102, Ttmp3T$d_914594314, units="hours")
summary(as.numeric(Ttmp3T$Mod3completionT))

data_ccc$Connect_ID[which.max(Ttmp3T$Mod3completionT)]
data_ccc$Connect_ID[which.min(Ttmp3T$Mod3completionT)]
```

```{r, echo=FALSE}

#cat("Active(n=", dim(act3)[[1]], ")")
#summary(as.numeric(tmp3A$Mod3completionA))
#st(tmp3A, vars = c('Mod3completionA', title='Table 3m. SAS Active (After)'))

Table3m = tmp3A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod3completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod3completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod3completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod3completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod3completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod3completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod3completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3m,caption='SAS Active (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3m. 


#cat("Passive(n=", dim(pas3)[[1]], ")")
#summary(as.numeric(Ptmp3A$Mod3completionP))
#st(Ptmp3A, vars = c('Mod3completionP', title='Table 3n. SAS Passive (After)'))

Table3n = Ptmp3A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod3completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod3completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod3completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod3completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod3completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod3completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod3completionP,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3n,caption='SAS Passive (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3n. 


#cat("Total(n=", dim(mer3)[[1]], ")")
#summary(as.numeric(Ttmp3T$Mod3completionT))
#st(Ttmp3T, vars = c('Mod3completionT', title='Table 3o. SAS Total (After)'))

Table3o = Ttmp3T %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod3completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod3completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod3completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod3completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod3completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod3completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod3completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3o,caption='SAS Total (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3o. 
```


\newpage
\FloatBarrier


## LAW Section 

```{r, include=FALSE}

# 3.	Time from verification to completion of each module (active, passive and total)  
#264644252 completion

time.var4 <- c("d_914594314","d_264644252")

#All verified participant totals, verified active total and verified passive total
act4 <- active_c_after %>%   filter(d_663265240==231311385)
dim(act4)
pas4 <- passive_c_after  %>% filter(d_663265240==231311385)
dim(pas4)
mer4 <- data_ccc_after %>% filter(d_663265240==231311385)
dim(mer4)


#Active
#act4_time <- act4[complete.cases(time.var4)]
act4_time<- act4[complete.cases(act4[ , time.var4]), ]


tmp4A <- act4_time[,c("Connect_ID","d_914594314","d_264644252")]
tmp4A$d_914594314 <- as.POSIXct(ymd_hms(tmp4A$d_914594314))
tmp4A$d_264644252 <- as.POSIXct(ymd_hms(tmp4A$d_264644252))


tmp4A$Mod4completionA <- difftime(tmp4A$d_264644252, tmp4A$d_914594314, units="hours")
summary(as.numeric(tmp4A$Mod4completionA))

#Passive
#pas4_time <- pas4[complete.cases(time.var4)]
pas4_time<- pas4[complete.cases(pas4[ , time.var4]), ]

Ptmp4A <- pas4_time[,c("Connect_ID","d_914594314","d_264644252")]
Ptmp4A$d_914594314 <- as.POSIXct(ymd_hms(Ptmp4A$d_914594314))
Ptmp4A$d_264644252 <- as.POSIXct(ymd_hms(Ptmp4A$d_264644252))


Ptmp4A$Mod4completionP <- difftime(Ptmp4A$d_264644252, Ptmp4A$d_914594314, units="hours")
summary(as.numeric(Ptmp4A$Mod4completionP))

#Total
#mer4_time <- mer4[complete.cases(time.var4)]
mer4_time<- mer4[complete.cases(mer4[ , time.var4]), ]


Ttmp4 <- mer4_time[,c("Connect_ID","d_914594314","d_264644252")]
Ttmp4$d_914594314 <- as.POSIXct(ymd_hms(Ttmp4$d_914594314))
Ttmp4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp4$d_264644252))


Ttmp4$Mod4completionT <- difftime(Ttmp4$d_264644252, Ttmp4$d_914594314, units="hours")
summary(as.numeric(Ttmp4$Mod4completionT))

```

```{r, echo=FALSE, fig.cap=''}

#cat("Active(n=", dim(act4)[[1]], ")")
#summary(as.numeric(tmp4A$Mod4completionA))
#st(tmp4A, vars = c('Mod4completionA', title='Table 3p. LAW Active (After)'))

Table3p = tmp4A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod4completionA,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod4completionA,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod4completionA,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod4completionA,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod4completionA, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod4completionA, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod4completionA,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3p,caption='LAW Active (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3p. 

#cat("Passive(n=", dim(pas4)[[1]], ")")
#summary(as.numeric(Ptmp4A$Mod4completionP))
#st(Ptmp4A, vars = c('Mod4completionP', title='Table 3q. LAW Passive (After)'))

Table3q = Ptmp4A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod4completionP,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod4completionP,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod4completionP,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod4completionP,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod4completionP, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod4completionP, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod4completionP,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3q,caption='LAW Passive (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3q. 

#cat("Total(n=", dim(mer4)[[1]], ")")
#summary(as.numeric(Ttmp4$Mod4completionT))
#st(Ttmp4, vars = c('Mod4completionT', title='Table 3r. LAW Total (After)'))

Table3r = Ttmp4 %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod4completionT,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod4completionT,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod4completionT,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod4completionT,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod4completionT, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod4completionT, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod4completionT,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table3r,caption='LAW Total (After)',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #Table 3r. 

```

\newpage
\newpage


# 4.	Duration in minutes from start to submission for each section:  25, 50, 75 percentiles (active, passive, and total).  

### Also listed are percentages of activate/passive/total participants completing the section in different time ranges. Note, each section will be stratified into one table before all sections were available in prod, and one table after all sections were available in prod.  

# 
## BOH Section 


```{r, include=FALSE, warning = FALSE}
#4.	Duration from start to submitted for each module (active_c, passive_c and total)  
#d_205553981 time stamp started
#d_517311251 time stamp finished 

time.var.1 <- c("d_205553981","d_517311251")


##BEFORE
#All participant totals, active_c total and passive_c total
sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)

s4_1bA=sum(active_c_before$d_949302066==231311385, na.rm=TRUE)
s4_1bP=sum(passive_c_before$d_949302066==231311385, na.rm=TRUE)
s4_1bT=sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE)

#active_c
act1= active_c_before %>% filter(active_c_before$d_949302066==231311385)
#act1_time <- act1[complete.cases(time.var.1)]
act1_time<- act1[complete.cases(act1[ , time.var.1]), ]


Atmp1 <- act1_time[,c("Connect_ID","d_205553981","d_517311251")]
Atmp1$d_205553981 <- as.POSIXct(ymd_hms(Atmp1$d_205553981))
Atmp1$d_517311251 <- as.POSIXct(ymd_hms(Atmp1$d_517311251))


Atmp1$Mod1completionA <- difftime(Atmp1$d_517311251, Atmp1$d_205553981, units="mins")
summary(as.numeric(Atmp1$Mod1completionA))

round((100*(sum(Atmp1$Mod1completionA<10)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Atmp1$Mod1completionA & Atmp1$Mod1completionA>10)/sum(active_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Atmp1$Mod1completionA & Atmp1$Mod1completionA>20)/sum(active_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Atmp1$Mod1completionA>30)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)

#passive_c
pas1= passive_c_before %>% filter(passive_c_before$d_949302066==231311385)
#pas1_time <- pas1[complete.cases(time.var.1)]
pas1_time<- pas1[complete.cases(pas1[ , time.var.1]), ]


Ptmp1 <- pas1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ptmp1$d_205553981 <- as.POSIXct(ymd_hms(Ptmp1$d_205553981))
Ptmp1$d_517311251 <- as.POSIXct(ymd_hms(Ptmp1$d_517311251))


Ptmp1$Mod1completionP <- difftime(Ptmp1$d_517311251, Ptmp1$d_205553981, units="mins")
Ptmp1$Mod1completionP <- as.numeric(Ptmp1$Mod1completionP)
summary(Ptmp1$Mod1completionP)

round((100*(sum(Ptmp1$Mod1completionP<10, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>10, na.rm=TRUE)/sum(passive_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>20, na.rm=TRUE)/sum(passive_c_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ptmp1$Mod1completionP>30, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Total
mer1= data_ccc_before %>% filter(data_ccc_before$d_949302066==231311385)
#mer1_time <- mer1[complete.cases(time.var.1)]
mer1_time<- mer1[complete.cases(mer1[ , time.var.1]), ]


Ttmp1 <- mer1_time[,c("Connect_ID","d_205553981","d_517311251", "d_512820379")]
Ttmp1$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1$d_205553981))
Ttmp1$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1$d_517311251))


Ttmp1$Mod1completionT <- difftime(Ttmp1$d_517311251, Ttmp1$d_205553981, units="mins")
summary(as.numeric(Ttmp1$Mod1completionT))

round((100*(sum(Ttmp1$Mod1completionT<10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp1$Mod1completionT & Ttmp1$Mod1completionT>10, na.rm=TRUE)/sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp1$Mod1completionT & Ttmp1$Mod1completionT>20, na.rm=TRUE)/sum(data_ccc_before$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp1$Mod1completionT>40, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Make automated table
head(Ttmp1)
head(mer1$d_512820379)


Ttmp1b= Ttmp1 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp1b)

ccc4_b1= Ttmp1b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b1)

ccc4_b1= ccc4_b1 %>%  mutate(freq=rep(1, dim(ccc4_b1)[[1]]))
head(ccc4_b1)
dim(ccc4_b1)[[1]]

ccc4_b1= ccc4_b1 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b1)

ccc4_b1= ccc4_b1 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b1)

ccc4_b1$percentage= (ccc4_b1$freq/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1) 

ccc4_b1$percentage.Active= (ccc4_b1$freq.Active/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1)

ccc4_b1$percentage.Passive= (ccc4_b1$freq.Passive/dim(ccc4_b1)[[1]])*100 
head(ccc4_b1)

ccc4_b1 <- ccc4_b1[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b1)



ccc4_b1 <- ccc4_b1 %>% mutate(time_frame=case_when(Mod1completionT<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod1completionT & Mod1completionT>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod1completionT & Mod1completionT>20  ~ "Completed in 20-30 minutes",
                                                   Mod1completionT>30 ~ "Completed in 30+ minutes"))
head(ccc4_b1)

#ccc4_b1 %>% mutate(timeOrdered = fct_relevel(char, c('Completed in Under 10 Minutes', 'Completed in 10-20 minutes', 'Completed in 20-30 minutes', 'Completed in 30+ minutes')))

ccc4_b1_summary <- ccc4_b1 %>%  group_by(time_frame) %>% arrange(rank(time_frame)) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE)   
gt_print2A <- gt(ccc4_b1_summary)                                                                              
gt_print2A





```

```{r, echo=FALSE}
#cat("Active(n=", s4_1bA, ")")
#summary(as.numeric(Atmp1$Mod1completionA))
#st(Atmp1, vars = c('Mod1completionA', title='Table 4a. BOH Active (Before)', add.median = T))-- no longer needed

#cat("Passive(n=", s4_1bP, ")")
#summary(Ptmp1$Mod1completionP)
#st(Ptmp1, vars = c('Mod1completionP', title='Table 4b. BOH Passive (Before)', add.median = T))-- no longer needed

#cat("Total(n=", s4_1bT, ")")
#summary(as.numeric(Ttmp1$Mod1completionT))
#st(Ttmp1, vars = c('Mod1completionT', title='Table 4c. BOH Total (Before)', add.median = T))-- no longer needed

```

```{r, echo=FALSE, warning=FALSE}

# #-- no longer needed ########
# 
# table4d <- ccc4_b1_summary %>%  gt() %>%  
#   fmt_number(columns = "percentage.Active", decimals = 2) %>% 
#   fmt_number(columns = "percentage.Passive", decimals = 2) %>%
#   fmt_number(columns = "percentage", decimals = 2) %>%
#   tab_header(title = html("Table 4d. BOH Section Completion Time of Verified Participants (Before)")) %>% 
#   cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
#              freq = md("**(N)**"), 
#              percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
#   tab_footnote(
#     footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
#   tab_spanner(
#     label="Active Participants",
#     columns=vars(freq.Active,percentage.Active)
#   ) %>% 
#   tab_spanner(
#     label="Passive Participants",
#     columns=vars(freq.Passive,percentage.Passive)
#   ) %>% 
#   tab_spanner(
#     label="Total Participants",
#     columns=vars(freq, percentage)
#   ) %>% 
#   # tab_style(
#   #   cell_text(
#   #   align="center"),
#   #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
#   # ) %>% 
#     summary_rows(     groups= FALSE,
#     #    groups= T, 
#     columns =  c(freq.Active,freq.Passive, freq, percentage),
#     fns= list(
#       Sum= ~sum(.)
#     ), decimals=0) %>% 
#     summary_rows(     groups= FALSE,
#     #    groups= T, 
#     columns = c(percentage.Active, percentage.Passive),
#     fns= list(
#       Sum= ~sum(.))) %>%
#   tab_options(
#     heading.title.font.size = 25,
#     heading.padding = 10,
#     row_group.font.weight = "bolder",
#     summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
#     row_group.background.color =    "#99CCFF"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = time_frame,
#     )
#   )  %>% 
#   tab_style(
#     style= list(
#       cell_text(
#         align="center"
#       )
#     ),
#     locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
#   ) %>%  opt_row_striping() #%>%  row_group_order(groups=c('Completed in Under 10 Minutes', 'Completed in 10-20 minutes', 'Completed in 20-30 minutes', 'Completed in 30+ minutes'))
# 
# table4d 

```



```{r, include=FALSE}
##AFTER
#All participant totals, active_c total and passive_c total
sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)

s4_1aA=sum(active_c_after$d_949302066==231311385, na.rm=TRUE)
s4_1aP=sum(passive_c_after$d_949302066==231311385, na.rm=TRUE)
s4_1aT=sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE)

#active_c
act1= active_c_after %>% filter(active_c_after$d_949302066==231311385)
#act1_time <- act1[complete.cases(time.var.1)]
act1_time<- act1[complete.cases(act1[ , time.var.1]), ]


Atmp1 <- act1_time[,c("Connect_ID","d_205553981","d_517311251")]
Atmp1$d_205553981 <- as.POSIXct(ymd_hms(Atmp1$d_205553981))
Atmp1$d_517311251 <- as.POSIXct(ymd_hms(Atmp1$d_517311251))


Atmp1$Mod1completionA <- difftime(Atmp1$d_517311251, Atmp1$d_205553981, units="mins")
summary(as.numeric(Atmp1$Mod1completionA))

round((100*(sum(Atmp1$Mod1completionA<10)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Atmp1$Mod1completionA & Atmp1$Mod1completionA>10)/sum(active_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Atmp1$Mod1completionA & Atmp1$Mod1completionA>20)/sum(active_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Atmp1$Mod1completionA>30)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)

#passive_c
pas1= passive_c_after %>% filter(passive_c_after$d_949302066==231311385)
#pas1_time <- pas1[complete.cases(time.var.1)]
pas1_time<- pas1[complete.cases(pas1[ , time.var.1]), ]


Ptmp1 <- pas1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ptmp1$d_205553981 <- as.POSIXct(ymd_hms(Ptmp1$d_205553981))
Ptmp1$d_517311251 <- as.POSIXct(ymd_hms(Ptmp1$d_517311251))


Ptmp1$Mod1completionP <- difftime(Ptmp1$d_517311251, Ptmp1$d_205553981, units="mins")
Ptmp1$Mod1completionP <- as.numeric(Ptmp1$Mod1completionP)
summary(Ptmp1$Mod1completionP)

round((100*(sum(Ptmp1$Mod1completionP<10, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>10, na.rm=TRUE)/sum(passive_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>20, na.rm=TRUE)/sum(passive_c_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ptmp1$Mod1completionP>30, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Total
mer1a= data_ccc_after %>% filter(data_ccc_after$d_949302066==231311385)
#mer1a_time <- mer1a[complete.cases(time.var.1)]
mer1a_time<- mer1a[complete.cases(mer1a[ , time.var.1]), ]


Ttmp1a <- mer1a_time[,c("Connect_ID","d_205553981","d_517311251", "d_512820379")]
Ttmp1a$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1a$d_205553981))
Ttmp1a$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1a$d_517311251))


Ttmp1a$Mod1completionT.A <- difftime(Ttmp1a$d_517311251, Ttmp1a$d_205553981, units="mins")
summary(as.numeric(Ttmp1a$Mod1completionT.A))

round((100*(sum(Ttmp1a$Mod1completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp1a$Mod1completionT.A & Ttmp1a$Mod1completionT.A>10, na.rm=TRUE)/sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp1a$Mod1completionT.A & Ttmp1a$Mod1completionT.A>20, na.rm=TRUE)/sum(data_ccc_after$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp1a$Mod1completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Make automatic table
head(Ttmp1a)


Ttmp1a= Ttmp1a %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp1a)

ccc4_a1= Ttmp1a %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a1)

ccc4_a1= ccc4_a1 %>%  mutate(freq=rep(1, dim(ccc4_a1)[[1]]))
head(ccc4_a1)
dim(ccc4_a1)[[1]]

ccc4_a1= ccc4_a1 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a1)

ccc4_a1= ccc4_a1 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a1)

ccc4_a1$percentage= (ccc4_a1$freq/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1) 

ccc4_a1$percentage.Active= (ccc4_a1$freq.Active/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1)

ccc4_a1$percentage.Passive= (ccc4_a1$freq.Passive/dim(ccc4_a1)[[1]])*100 
head(ccc4_a1)

ccc4_a1 <- ccc4_a1[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a1)



ccc4_a1 <- ccc4_a1 %>% mutate(time_frame=case_when(Mod1completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod1completionT.A & Mod1completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod1completionT.A & Mod1completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod1completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a1)


ccc4_a1_summary <- ccc4_a1 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a1_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE}

#cat("Active(n=", s4_1aA, ")")
#summary(as.numeric(Atmp1$Mod1completionA))
#st(Atmp1, vars = c('Mod1completionA', title='Table 4e. BOH Active (After)', add.median = T))-- no longer needed

#cat("Passive(n=", s4_1aP, ")")
#summary(Ptmp1$Mod1completionP)
#st(Ptmp1, vars = c('Mod1completionP', title='Table 4f. BOH Passive (After)', add.median = T))-- no longer needed

#cat("Total(n=", s4_1aT, ")")
#summary(as.numeric(Ttmp1a$Mod1completionT.A))
#st(Ttmp1a, vars = c('Mod1completionT.A', title='Table 4g. BOH Total (After)', add.median = T))-- no longer needed

```

```{r, echo=FALSE, warning = FALSE}


# # -- no longer needed #######
# 
# table4h <- ccc4_a1_summary %>%  gt() %>%  
#   fmt_number(columns = "percentage.Active", decimals = 2) %>% 
#   fmt_number(columns = "percentage.Passive", decimals = 2) %>%
#   fmt_number(columns = "percentage", decimals = 2) %>%
#   tab_header(title = html("Table 4h. BOH Section Completion Time of Verified Participants (After)")) %>% 
#   cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
#              freq = md("**(N)**"), 
#              percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
#   tab_footnote(
#     footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
#   tab_spanner(
#     label="Active",
#     columns=vars(freq.Active,percentage.Active)
#   ) %>% 
#   tab_spanner(
#     label="Passive",
#     columns=vars(freq.Passive,percentage.Passive)
#   ) %>% 
#   tab_spanner(
#     label="Total",
#     columns=vars(freq, percentage)
#   ) %>% 
#   # tab_style(
#   #   cell_text(
#   #   align="center"),
#   #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
#   # ) %>% 
#     summary_rows(     groups= FALSE,
#     #    groups= T, 
#     columns =  c(freq.Active,freq.Passive, freq, percentage),
#     fns= list(
#       Sum= ~sum(.)
#     ), decimals=0) %>% 
#     summary_rows(     groups= FALSE,
#     #    groups= T, 
#     columns = c(percentage.Active, percentage.Passive),
#     fns= list(
#       Sum= ~sum(.))) %>%
#   tab_options(
#     heading.title.font.size = 25,
#     heading.padding = 10,
#     row_group.font.weight = "bolder",
#     summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
#     row_group.background.color =    "#99CCFF"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = time_frame,
#     )
#   )  %>% 
#   tab_style(
#     style= list(
#       cell_text(
#         align="center"
#       )
#     ),
#     locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
#   ) %>%  opt_row_striping()
# 
# table4h 

```


```{r, include=FALSE}
##All Participants
sum(active_all$d_949302066==231311385, na.rm=TRUE)
sum(passive_all$d_949302066==231311385, na.rm=TRUE)
sum(data_ccc$d_949302066==231311385, na.rm=TRUE)


#active_c
act1= active_all %>% filter(active_all$d_949302066==231311385)
#act1_time <- act1[complete.cases(time.var.1)]
act1_time<- act1[complete.cases(act1[ , time.var.1]), ]


Atmp1 <- act1_time[,c("Connect_ID","d_205553981","d_517311251")]
Atmp1$d_205553981 <- as.POSIXct(ymd_hms(Atmp1$d_205553981))
Atmp1$d_517311251 <- as.POSIXct(ymd_hms(Atmp1$d_517311251))


Atmp1$Mod1completionA <- difftime(Atmp1$d_517311251, Atmp1$d_205553981, units="mins")
summary(as.numeric(Atmp1$Mod1completionA))

round((100*(sum(Atmp1$Mod1completionA<10)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Atmp1$Mod1completionA & Atmp1$Mod1completionA>10)/sum(active_all$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Atmp1$Mod1completionA & Atmp1$Mod1completionA>20)/sum(active_all$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Atmp1$Mod1completionA>30)/sum(active_c$d_949302066==231311385, na.rm=TRUE))), digits=2)

#passive_c
pas1= passive_all %>% filter(passive_all$d_949302066==231311385)
#pas1_time <- pas1[complete.cases(time.var.1)]
pas1_time<- pas1[complete.cases(pas1[ , time.var.1]), ]


Ptmp1 <- pas1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ptmp1$d_205553981 <- as.POSIXct(ymd_hms(Ptmp1$d_205553981))
Ptmp1$d_517311251 <- as.POSIXct(ymd_hms(Ptmp1$d_517311251))


Ptmp1$Mod1completionP <- difftime(Ptmp1$d_517311251, Ptmp1$d_205553981, units="mins")
Ptmp1$Mod1completionP <- as.numeric(Ptmp1$Mod1completionP)
summary(Ptmp1$Mod1completionP)

round((100*(sum(Ptmp1$Mod1completionP<10, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>10, na.rm=TRUE)/sum(passive_all$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ptmp1$Mod1completionP & Ptmp1$Mod1completionP>20, na.rm=TRUE)/sum(passive_all$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ptmp1$Mod1completionP>30, na.rm=TRUE)/sum(passive_c$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Total
mer1a= data_ccc %>% filter(data_ccc$d_949302066==231311385)
#mer1a_time <- mer1a[complete.cases(time.var.1)]
mer1a_time<- mer1a[complete.cases(mer1a[ , time.var.1]), ]


Ttmp1a <- mer1a_time[,c("Connect_ID","d_205553981","d_517311251", "d_512820379")]
Ttmp1a$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1a$d_205553981))
Ttmp1a$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1a$d_517311251))


Ttmp1a$Mod1completionT.A <- round(difftime(Ttmp1a$d_517311251, Ttmp1a$d_205553981, units="mins"), digits=2)
summary(as.numeric(Ttmp1a$Mod1completionT.A))

round((100*(sum(Ttmp1a$Mod1completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp1a$Mod1completionT.A & Ttmp1a$Mod1completionT.A>10, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp1a$Mod1completionT.A & Ttmp1a$Mod1completionT.A>20, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp1a$Mod1completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_949302066==231311385, na.rm=TRUE))), digits=2)


#Make automatic table

Ttmp1a= Ttmp1a %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp1a)

ccc4_all_1= Ttmp1a %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_1)

ccc4_all_1= ccc4_all_1 %>%  mutate(freq=rep(1, dim(ccc4_all_1)[[1]]))
head(ccc4_all_1)
dim(ccc4_all_1)[[1]]

ccc4_all_1= ccc4_all_1 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_all_1)

ccc4_all_1= ccc4_all_1 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_1)

ccc4_all_1$percentage= (ccc4_all_1$freq/dim(ccc4_all_1)[[1]])*100
head(ccc4_all_1)

ccc4_all_1$percentage.Active= (ccc4_all_1$freq.Active/dim(ccc4_all_1)[[1]])*100
head(ccc4_all_1)

ccc4_all_1$percentage.Passive= (ccc4_all_1$freq.Passive/dim(ccc4_all_1)[[1]])*100
head(ccc4_all_1)

ccc4_all_1 <- ccc4_all_1[ , c(5:13)] #want only frequency, process and percentage of participants
head(ccc4_all_1)



ccc4_all_1 <- ccc4_all_1 %>% mutate(time_frame=case_when(Mod1completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>=Mod1completionT.A & Mod1completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>=Mod1completionT.A & Mod1completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   #Mod1completionT.A>30 ~ "Completed in 30+ minutes"))
                                                  TRUE ~ "Completed in 30+ minutes"))
                                    #, RStatus= case_when())
head(ccc4_all_1)
ccc4_all_1$time_frame <- factor(ccc4_all_1$time_frame,levels=c("Completed in Under 10 Minutes", "Completed in 10-20 minutes", "Completed in 20-30 minutes", "Completed in 30+ minutes"))


 ccc4_all_1_summary <- ccc4_all_1 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE)
# gt_print2A <- gt(ccc4_all_1_summary)
# gt_print2A


#ccc4_all_1_summary <- ccc4_all_1  %>% dplyr::group_by(time_frame) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time_frame, n, percentage)

```
\FloatBarrier
```{r, echo=FALSE}

#summary(as.numeric(Atmp1$Mod1completionA))
#st(Atmp1, vars = c('Mod1completionA', title='Table 5a. All BOH Active', add.median = T))-- no longer needed

#summary(Ptmp1$Mod1completionP)
#st(Ptmp1, vars = c('Mod1completionP', title='Table 5b. All BOH Passive', add.median = T))-- no longer needed

#summary(as.numeric(Ttmp1a$Mod1completionT.A))
#st(Ttmp1a, vars = c('Mod1completionT.A', title='Table 5c. All BOH Total', add.median = T))


Table4a2 = Ttmp1a %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod1completionT.A,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod1completionT.A,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod1completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod1completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod1completionT.A, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod1completionT.A, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod1completionT.A,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table4a2,caption='All BOH Total Participants',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #caption='Table 4a2. All BOH Total Participants'

```

```{r, echo=FALSE, warning = FALSE}
ccc4_all_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 4a. BOH Section Completion Time of All Verified Participants")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()





```



\newpage

# 
## MRE Section


```{r, include=FALSE, warning = FALSE}
time.var.2 <- c("d_541836531","d_832139544")

##BEFORE
#All participant totals, active total and passive total
sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)

s4_2bA=sum(active_c_before$d_536735468==231311385, na.rm=TRUE)
s4_2bP=sum(passive_c_before$d_536735468==231311385, na.rm=TRUE)
s4_2bT=sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE)

#Active
actm2= active_c_before %>% filter(active_c_before$d_536735468==231311385)
#actm2_time <- actm2[complete.cases(time.var.2)]
actm2_time<- actm2[complete.cases(actm2[ , time.var.2]), ]


tmp <- actm2_time[,c("Connect_ID","d_541836531","d_832139544")]
tmp$d_541836531 <- as.POSIXct(ymd_hms(tmp$d_541836531))
tmp$d_832139544 <- as.POSIXct(ymd_hms(tmp$d_832139544))


tmp$Mod2completionA <- difftime(tmp$d_832139544, tmp$d_541836531, units="mins")
summary(as.numeric(tmp$Mod2completionA))

round((100*(sum(tmp$Mod2completionA<10, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp$Mod2completionA & tmp$Mod2completionA>10, na.rm=TRUE)/sum(active_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp$Mod2completionA & tmp$Mod2completionA>20, na.rm=TRUE)/sum(active_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp$Mod2completionA>30, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm2= passive_c_before %>% filter(passive_c_before$d_536735468==231311385)
#pasm2_time <- pasm2[complete.cases(time.var.2)]
pasm2_time<- pasm2[complete.cases(pasm2[ , time.var.2]), ]


ptmp <- pasm2_time[,c("Connect_ID","d_541836531","d_832139544")]
ptmp$d_541836531 <- as.POSIXct(ymd_hms(ptmp$d_541836531))
ptmp$d_832139544 <- as.POSIXct(ymd_hms(ptmp$d_832139544))


ptmp$Mod2completionP <- difftime(ptmp$d_832139544, ptmp$d_541836531, units="mins")
summary(as.numeric(ptmp$Mod2completionP))

round((100*(sum(ptmp$Mod2completionP<10, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp$Mod2completionP & ptmp$Mod2completionP>10, na.rm=TRUE)/sum(passive_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp$Mod2completionP & ptmp$Mod2completionP>20, na.rm=TRUE)/sum(passive_c_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp$Mod2completionP>30, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Total
merm2= data_ccc_before %>% filter(data_ccc_before$d_536735468==231311385)
#merm2_time <- merm2[complete.cases(time.var.2)]
merm2_time<- merm2[complete.cases(merm2[ , time.var.2]), ]


Ttmp2 <- merm2_time[,c("Connect_ID","d_541836531","d_832139544", "d_512820379")]
Ttmp2$d_541836531 <- as.POSIXct(ymd_hms(Ttmp2$d_541836531))
Ttmp2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp2$d_832139544))


Ttmp2$Mod2completionT.B <- difftime(Ttmp2$d_832139544, Ttmp2$d_541836531, units="mins")
summary(as.numeric(Ttmp2$Mod2completionT.B))

round((100*(sum(Ttmp2$Mod2completionT.B<10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp2$Mod2completionT.B & Ttmp2$Mod2completionT.B>10, na.rm=TRUE)/sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp2$Mod2completionT.B & Ttmp2$Mod2completionT.B>20, na.rm=TRUE)/sum(data_ccc_before$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp2$Mod2completionT.B>30, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Make an automatic table
head(Ttmp2)
head(mer1$d_512820379)


Ttmp2b= Ttmp2 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp2b)

ccc4_b2= Ttmp2b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b2)

ccc4_b2= ccc4_b2 %>%  mutate(freq=rep(1, dim(ccc4_b2)[[1]]))
head(ccc4_b2)
dim(ccc4_b2)[[1]]

ccc4_b2= ccc4_b2 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b2)

ccc4_b2= ccc4_b2 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b2)

ccc4_b2$percentage= (ccc4_b2$freq/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2) 

ccc4_b2$percentage.Active= (ccc4_b2$freq.Active/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2)

ccc4_b2$percentage.Passive= (ccc4_b2$freq.Passive/dim(ccc4_b2)[[1]])*100 
head(ccc4_b2)

ccc4_b2 <- ccc4_b2[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b2)



ccc4_b2 <- ccc4_b2 %>% mutate(time_frame=case_when(Mod2completionT.B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod2completionT.B & Mod2completionT.B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod2completionT.B & Mod2completionT.B>20  ~ "Completed in 20-30 minutes",
                                               Mod2completionT.B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b2)


ccc4_b2_summary <- ccc4_b2 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b2_summary)                                                                              
gt_print4B





```

```{r, echo=FALSE}

#cat("Active(n=", s4_2bA, ")")
#summary(as.numeric(tmp$Mod2completionA))
#st(tmp, vars = c('Mod2completionA', title='Table 6a. MRE Active (Before)', add.median = T))--no longer needed

#cat("Passive(n=", s4_2bP, ")")
#summary(as.numeric(ptmp$Mod2completionP))
#st(ptmp, vars = c('Mod2completionP', title='Table 6b. MRE Passive (Before)', add.median = T))--no longer needed

#cat("Total(n=", s4_2bT, ")")
#summary(as.numeric(Ttmp2$Mod2completionT.B))
#st(Ttmp2, vars = c('Mod2completionT.B', title='Table 6c. MRE Total (Before)', add.median = T))--no longer needed

```

```{r, echo=FALSE, warning = FALSE}
table6d <- ccc4_b2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 6d. MRE Section Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table6d <- no longer needed

```


```{r, include=FALSE, warning = FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)


s4_2aA=sum(active_c_after$d_536735468==231311385, na.rm=TRUE)
s4_2aP=sum(passive_c_after$d_536735468==231311385, na.rm=TRUE)
s4_2aT=sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE)


#Active
actm2= active_c_after %>% filter(active_c_after$d_536735468==231311385)
#actm2_time <- actm2[complete.cases(time.var.2)]
actm2_time<- actm2[complete.cases(actm2[ , time.var.2]), ]


tmp <- actm2_time[,c("Connect_ID","d_541836531","d_832139544")]
tmp$d_541836531 <- as.POSIXct(ymd_hms(tmp$d_541836531))
tmp$d_832139544 <- as.POSIXct(ymd_hms(tmp$d_832139544))


tmp$Mod2completionA <- difftime(tmp$d_832139544, tmp$d_541836531, units="mins")
summary(as.numeric(tmp$Mod2completionA))

round((100*(sum(tmp$Mod2completionA<10, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp$Mod2completionA & tmp$Mod2completionA>10, na.rm=TRUE)/sum(active_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp$Mod2completionA & tmp$Mod2completionA>20, na.rm=TRUE)/sum(active_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp$Mod2completionA>30, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm2= passive_c_after %>% filter(passive_c_after$d_536735468==231311385)
#pasm2_time <- pasm2[complete.cases(time.var.2)]
pasm2_time<- pasm2[complete.cases(pasm2[ , time.var.2]), ]


ptmp <- pasm2_time[,c("Connect_ID","d_541836531","d_832139544")]
ptmp$d_541836531 <- as.POSIXct(ymd_hms(ptmp$d_541836531))
ptmp$d_832139544 <- as.POSIXct(ymd_hms(ptmp$d_832139544))


ptmp$Mod2completionP <- difftime(ptmp$d_832139544, ptmp$d_541836531, units="mins")
summary(as.numeric(ptmp$Mod2completionP))

round((100*(sum(ptmp$Mod2completionP<10, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp$Mod2completionP & ptmp$Mod2completionP>10, na.rm=TRUE)/sum(passive_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp$Mod2completionP & ptmp$Mod2completionP>20, na.rm=TRUE)/sum(passive_c_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp$Mod2completionP>30, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Total
merm2= data_ccc_after %>% filter(data_ccc_after$d_536735468==231311385)
#merm2_time <- merm2[complete.cases(time.var.2)]
merm2_time<- merm2[complete.cases(merm2[ , time.var.2]), ]


Ttmp2A <- merm2_time[,c("Connect_ID","d_541836531","d_832139544", "d_512820379")]
Ttmp2A$d_541836531 <- as.POSIXct(ymd_hms(Ttmp2A$d_541836531))
Ttmp2A$d_832139544 <- as.POSIXct(ymd_hms(Ttmp2A$d_832139544))


Ttmp2A$Mod2completionT.A <- difftime(Ttmp2A$d_832139544, Ttmp2A$d_541836531, units="mins")
summary(as.numeric(Ttmp2A$Mod2completionT.A))

round((100*(sum(Ttmp2A$Mod2completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp2A$Mod2completionT.A & Ttmp2A$Mod2completionT.A>10, na.rm=TRUE)/sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp2A$Mod2completionT.A & Ttmp2A$Mod2completionT.A>20, na.rm=TRUE)/sum(data_ccc_after$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp2A$Mod2completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Make an automatic table
head(Ttmp2A)


Ttmp2A= Ttmp2A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp2A)

ccc4_a2= Ttmp2A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a2)

ccc4_a2= ccc4_a2 %>%  mutate(freq=rep(1, dim(ccc4_a2)[[1]]))
head(ccc4_a2)
dim(ccc4_a2)[[1]]

ccc4_a2= ccc4_a2 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a2)

ccc4_a2= ccc4_a2 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a2)

ccc4_a2$percentage= (ccc4_a2$freq/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2) 

ccc4_a2$percentage.Active= (ccc4_a2$freq.Active/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2)

ccc4_a2$percentage.Passive= (ccc4_a2$freq.Passive/dim(ccc4_a2)[[1]])*100 
head(ccc4_a2)

ccc4_a2 <- ccc4_a2[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a2)



ccc4_a2 <- ccc4_a2 %>% mutate(time_frame=case_when(Mod2completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod2completionT.A & Mod2completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod2completionT.A & Mod2completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod2completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a2)

ccc4_a2_summary <- ccc4_a2 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a2_summary)                                                                              
gt_print2A

```

```{r, echo=FALSE}

#cat("Active(n=", s4_2aA, ")")
#summary(as.numeric(tmp$Mod2completionA))
#st(tmp, vars = c('Mod2completionA', title='Table 6e. MRE Active (After)', add.median = T))--no longer needed

#cat("Passive(n=", s4_2aP, ")")
#summary(as.numeric(ptmp$Mod2completionP))
#st(ptmp, vars = c('Mod2completionP', title='Table 6f. MRE Passive (After)', add.median = T))--no longer needed

#cat("Total(n=", s4_2aT, ")")
#summary(as.numeric(Ttmp2A$Mod2completionT.A))
#st(Ttmp2A, vars = c('Mod2completionT.A', title='Table 6g. MRE Total (After)', add.median = T))--no longer needed
```

```{r, echo=FALSE, warning = FALSE}

table6h <- ccc4_a2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 6h. MRE Section Completion Time of Verified Participants (After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table6h -- no longer needed

```


```{r, include=FALSE, warning = FALSE}
##All Participants 
sum(active_all$d_536735468==231311385, na.rm=TRUE)
sum(passive_all$d_536735468==231311385, na.rm=TRUE)
sum(data_ccc$d_536735468==231311385, na.rm=TRUE)


#Active
actm2= active_all %>% filter(active_all$d_536735468==231311385)
#actm2_time <- actm2[complete.cases(time.var.2)]
actm2_time<- actm2[complete.cases(actm2[ , time.var.2]), ]


tmp <- actm2_time[,c("Connect_ID","d_541836531","d_832139544")]
tmp$d_541836531 <- as.POSIXct(ymd_hms(tmp$d_541836531))
tmp$d_832139544 <- as.POSIXct(ymd_hms(tmp$d_832139544))


tmp$Mod2completionA <- difftime(tmp$d_832139544, tmp$d_541836531, units="mins")
summary(as.numeric(tmp$Mod2completionA))

round((100*(sum(tmp$Mod2completionA<10, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp$Mod2completionA & tmp$Mod2completionA>10, na.rm=TRUE)/sum(active_all$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp$Mod2completionA & tmp$Mod2completionA>20, na.rm=TRUE)/sum(active_all$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp$Mod2completionA>30, na.rm=TRUE)/sum(active_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm2= passive_all %>% filter(passive_all$d_536735468==231311385)
#pasm2_time <- pasm2[complete.cases(time.var.2)]
pasm2_time<- pasm2[complete.cases(pasm2[ , time.var.2]), ]


ptmp <- pasm2_time[,c("Connect_ID","d_541836531","d_832139544")]
ptmp$d_541836531 <- as.POSIXct(ymd_hms(ptmp$d_541836531))
ptmp$d_832139544 <- as.POSIXct(ymd_hms(ptmp$d_832139544))


ptmp$Mod2completionP <- difftime(ptmp$d_832139544, ptmp$d_541836531, units="mins")
summary(as.numeric(ptmp$Mod2completionP))

round((100*(sum(ptmp$Mod2completionP<10, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp$Mod2completionP & ptmp$Mod2completionP>10, na.rm=TRUE)/sum(passive_all$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp$Mod2completionP & ptmp$Mod2completionP>20, na.rm=TRUE)/sum(passive_all$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp$Mod2completionP>30, na.rm=TRUE)/sum(passive_c$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Total
merm2= data_ccc %>% filter(data_ccc$d_536735468==231311385)
#merm2_time <- merm2[complete.cases(time.var.2)]
merm2_time<- merm2[complete.cases(merm2[ , time.var.2]), ]


Ttmp2A <- merm2_time[,c("Connect_ID","d_541836531","d_832139544", "d_512820379")]
Ttmp2A$d_541836531 <- as.POSIXct(ymd_hms(Ttmp2A$d_541836531))
Ttmp2A$d_832139544 <- as.POSIXct(ymd_hms(Ttmp2A$d_832139544))


Ttmp2A$Mod2completionT.A <- difftime(Ttmp2A$d_832139544, Ttmp2A$d_541836531, units="mins")
summary(as.numeric(Ttmp2A$Mod2completionT.A))

round((100*(sum(Ttmp2A$Mod2completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp2A$Mod2completionT.A & Ttmp2A$Mod2completionT.A>10, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp2A$Mod2completionT.A & Ttmp2A$Mod2completionT.A>20, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp2A$Mod2completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_536735468==231311385, na.rm=TRUE))), digits=2)

#Make an automatic table
head(Ttmp2A)


Ttmp2A= Ttmp2A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp2A)

ccc4_all_2= Ttmp2A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_2)

ccc4_all_2= ccc4_all_2 %>%  mutate(freq=rep(1, dim(ccc4_all_2)[[1]]))
head(ccc4_all_2)
dim(ccc4_all_2)[[1]]

ccc4_all_2= ccc4_all_2 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_all_2)

ccc4_all_2= ccc4_all_2 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_2)

ccc4_all_2$percentage= (ccc4_all_2$freq/dim(ccc4_all_2)[[1]])*100 
head(ccc4_all_2) 

ccc4_all_2$percentage.Active= (ccc4_all_2$freq.Active/dim(ccc4_all_2)[[1]])*100 
head(ccc4_all_2)

ccc4_all_2$percentage.Passive= (ccc4_all_2$freq.Passive/dim(ccc4_all_2)[[1]])*100 
head(ccc4_all_2)

ccc4_all_2 <- ccc4_all_2[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_all_2)



ccc4_all_2 <- ccc4_all_2 %>% mutate(time_frame=case_when(Mod2completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod2completionT.A & Mod2completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod2completionT.A & Mod2completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod2completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_all_2)
ccc4_all_2$time_frame <- factor(ccc4_all_2$time_frame,levels=c("Completed in Under 10 Minutes", "Completed in 10-20 minutes", "Completed in 20-30 minutes", "Completed in 30+ minutes"))

ccc4_all_2_summary <- ccc4_all_2 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_all_2_summary)                                                                              
gt_print2A

```
\FloatBarrier
```{r, echo=FALSE}

#summary(as.numeric(tmp$Mod2completionA))
#st(tmp, vars = c('Mod2completionA', title='Table 7a. All MRE Active Participants', add.median = T))-- no longer needed

#summary(as.numeric(ptmp$Mod2completionP))
#st(ptmp, vars = c('Mod2completionP', title='Table 7b. All MRE Passive Participants', add.median = T))--no longer needed

#summary(as.numeric(Ttmp2A$Mod2completionT.A))
#st(Ttmp2A, vars = c('Mod2completionT.A', title='Table 7c. All MRE Total Participants', add.median = T))

Table7c = Ttmp2A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod2completionT.A,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod2completionT.A,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod2completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod2completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod2completionT.A, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod2completionT.A, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod2completionT.A,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table7c,caption='All MRE Total Participants',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #caption='Table 7c. All MRE Total Participants'
```

```{r, echo=FALSE, warning = FALSE}

ccc4_all_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 4b. MRE Section Completion Time of All Verified Participants")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

\newpage

# 
## SAS Section

```{r, include= FALSE, warning=FALSE}
#d_770257102 completed
#d_386488297 start 

time.var.3 <- c("d_386488297","d_770257102")

##BEFORE
#All particiapnt totals, active total and passive total
sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)

s4_3bA=sum(active_c_before$d_976570371==231311385, na.rm=TRUE)
s4_3bP=sum(passive_c_before$d_976570371==231311385, na.rm=TRUE)
s4_3bT=sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE)


#Active
actm3= active_c_before %>% filter(active_c_before$d_976570371==231311385)
#actm3_time <- actm3[complete.cases(time.var.3)]
actm3_time<- actm3[complete.cases(actm3[ , time.var.3]), ]


tmp.3A <- actm3_time[,c("Connect_ID","d_386488297","d_770257102")]
tmp.3A$d_386488297 <- as.POSIXct(ymd_hms(tmp.3A$d_386488297))
tmp.3A$d_770257102 <- as.POSIXct(ymd_hms(tmp.3A$d_770257102))


tmp.3A$Mod3completionA <- difftime(tmp.3A$d_770257102, tmp.3A$d_386488297, units="mins")
summary(as.numeric(tmp.3A$Mod3completionA))

round((100*(sum(tmp.3A$Mod3completionA<10, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>10, na.rm=TRUE)/sum(active_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>20, na.rm=TRUE)/sum(active_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.3A$Mod3completionA>30, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm3= passive_c_before %>% filter(passive_c_before$d_976570371==231311385)
#pasm3_time <- pasm3[complete.cases(time.var.3)]
pasm3_time<- pasm3[complete.cases(pasm3[ , time.var.3]), ]


ptmp3 <- pasm3_time[,c("Connect_ID","d_386488297","d_770257102")]
ptmp3$d_386488297 <- as.POSIXct(ymd_hms(ptmp3$d_386488297))
ptmp3$d_770257102 <- as.POSIXct(ymd_hms(ptmp3$d_770257102))


ptmp3$Mod3completionP <- difftime(ptmp3$d_770257102, ptmp3$d_386488297, units="mins")
summary(as.numeric(ptmp3$Mod3completionP))

round((100*(sum(ptmp3$Mod3completionP<10, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp3$Mod3completionP & ptmp3$Mod3completionP>10, na.rm=TRUE)/sum(passive_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp3$Mod3completionP & ptmp3$Mod3completionP>20, na.rm=TRUE)/sum(passive_c_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp3$Mod3completionP>30, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Total
#Total
merm3= data_ccc_before %>% filter(data_ccc_before$d_976570371==231311385)
#merm3_time <- merm3[complete.cases(time.var.3)]
merm3_time<- merm3[complete.cases(merm3[ , time.var.3]), ]


Ttmp3 <- merm3_time[,c("Connect_ID","d_386488297","d_770257102", "d_512820379")]
Ttmp3$d_386488297 <- as.POSIXct(ymd_hms(Ttmp3$d_386488297))
Ttmp3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3$d_770257102))


Ttmp3$Mod3completionT.B <- difftime(Ttmp3$d_770257102, Ttmp3$d_386488297, units="mins")
summary(as.numeric(Ttmp3$Mod3completionT.B))

round((100*(sum(Ttmp3$Mod3completionT.B<10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp3$Mod3completionT.B & Ttmp3$Mod3completionT.B>10, na.rm=TRUE)/sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp3$Mod3completionT.B & Ttmp3$Mod3completionT.B>20, na.rm=TRUE)/sum(data_ccc_before$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp3$Mod3completionT.B>30, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp3)


Ttmp3b= Ttmp3 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp3b)

ccc4_b3= Ttmp3b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b3)

ccc4_b3= ccc4_b3 %>%  mutate(freq=rep(1, dim(ccc4_b3)[[1]]))
head(ccc4_b3)
dim(ccc4_b3)[[1]]

ccc4_b3= ccc4_b3 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b3)

ccc4_b3= ccc4_b3 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b3)

ccc4_b3$percentage= (ccc4_b3$freq/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3) 

ccc4_b3$percentage.Active= (ccc4_b3$freq.Active/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3)

ccc4_b3$percentage.Passive= (ccc4_b3$freq.Passive/dim(ccc4_b3)[[1]])*100 
head(ccc4_b3)

ccc4_b3 <- ccc4_b3[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b3)



ccc4_b3 <- ccc4_b3 %>% mutate(time_frame=case_when(Mod3completionT.B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod3completionT.B & Mod3completionT.B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod3completionT.B & Mod3completionT.B>20  ~ "Completed in 20-30 minutes",
                                               Mod3completionT.B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b3)


ccc4_b3_summary <- ccc4_b3 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b3_summary)                                                                              
gt_print4B



```

```{r, echo=FALSE}

#cat("Active(n=", s4_3bA, ")")
#summary(as.numeric(tmp.3A$Mod3completionA))
#st(tmp.3A, vars = c('Mod3completionA', title='Table 8a. SAS Active (Before)', add.median = T))--no longer needed

#cat("Passive(n=", s4_3bP, ")")
#summary(as.numeric(ptmp3$Mod3completionP))
#st(ptmp3, vars = c('Mod3completionP', title='Table 8b. SAS Passive (Before)', add.median = T))--no longer needed

#cat("Total(n=", s4_3bT, ")")
#summary(as.numeric(Ttmp3$Mod3completionT.B))
#st(Ttmp3, vars = c('Mod3completionT.B', title='Table 8c. SAS Total (Before)', add.median = T))--no longer needed

```

```{r, echo=FALSE, warning = FALSE}
table8d <- ccc4_b3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 8d. SAS Section Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table8d -- no longer needed

```


```{r, include= FALSE, warning=FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)

s4_3aA=sum(active_c_after$d_976570371==231311385, na.rm=TRUE)
s4_3aP=sum(passive_c_after$d_976570371==231311385, na.rm=TRUE)
s4_3aT=sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE)

#Active
actm3= active_c_after %>% filter(active_c_after$d_976570371==231311385)
#actm3_time <- actm3[complete.cases(time.var.3)]
actm3_time<- actm3[complete.cases(actm3[ , time.var.3]), ]


tmp.3A <- actm3_time[,c("Connect_ID","d_386488297","d_770257102")]
tmp.3A$d_386488297 <- as.POSIXct(ymd_hms(tmp.3A$d_386488297))
tmp.3A$d_770257102 <- as.POSIXct(ymd_hms(tmp.3A$d_770257102))


tmp.3A$Mod3completionA <- difftime(tmp.3A$d_770257102, tmp.3A$d_386488297, units="mins")
summary(as.numeric(tmp.3A$Mod3completionA))

round((100*(sum(tmp.3A$Mod3completionA<10, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>10, na.rm=TRUE)/sum(active_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>20, na.rm=TRUE)/sum(active_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.3A$Mod3completionA>30, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm3= passive_c_after %>% filter(passive_c_after$d_976570371==231311385)
#pasm3_time <- pasm3[complete.cases(time.var.3)]
pasm3_time<- pasm3[complete.cases(pasm3[ , time.var.3]), ]


ptmp3 <- pasm3_time[,c("Connect_ID","d_386488297","d_770257102")]
ptmp3$d_386488297 <- as.POSIXct(ymd_hms(ptmp3$d_386488297))
ptmp3$d_770257102 <- as.POSIXct(ymd_hms(ptmp3$d_770257102))


ptmp3$Mod3completionP <- difftime(ptmp3$d_770257102, ptmp3$d_386488297, units="mins")
summary(as.numeric(ptmp3$Mod3completionP))

round((100*(sum(ptmp3$Mod3completionP<10, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp3$Mod3completionP & ptmp3$Mod3completionP>10, na.rm=TRUE)/sum(passive_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp3$Mod3completionP & ptmp3$Mod3completionP>20, na.rm=TRUE)/sum(passive_c_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp3$Mod3completionP>30, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Total
#Total
merm3= data_ccc_after %>% filter(data_ccc_after$d_976570371==231311385)
#merm3_time <- merm3[complete.cases(time.var.3)]
merm3_time<- merm3[complete.cases(merm3[ , time.var.3]), ]


Ttmp3A <- merm3_time[,c("Connect_ID","d_386488297","d_770257102", "d_512820379")]
Ttmp3A$d_386488297 <- as.POSIXct(ymd_hms(Ttmp3A$d_386488297))
Ttmp3A$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3A$d_770257102))


Ttmp3A$Mod3completionT.A <- difftime(Ttmp3A$d_770257102, Ttmp3A$d_386488297, units="mins")
summary(as.numeric(Ttmp3A$Mod3completionT.A))

round((100*(sum(Ttmp3A$Mod3completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp3A$Mod3completionT.A & Ttmp3A$Mod3completionT.A>10, na.rm=TRUE)/sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp3A$Mod3completionT.A & Ttmp3A$Mod3completionT.A>20, na.rm=TRUE)/sum(data_ccc_after$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp3A$Mod3completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp3A)


Ttmp3A= Ttmp3A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp3A)

ccc4_a3= Ttmp3A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a3)

ccc4_a3= ccc4_a3 %>%  mutate(freq=rep(1, dim(ccc4_a3)[[1]]))
head(ccc4_a3)
dim(ccc4_a3)[[1]]

ccc4_a3= ccc4_a3 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a3)

ccc4_a3= ccc4_a3 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a3)

ccc4_a3$percentage= (ccc4_a3$freq/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3) 

ccc4_a3$percentage.Active= (ccc4_a3$freq.Active/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3)

ccc4_a3$percentage.Passive= (ccc4_a3$freq.Passive/dim(ccc4_a3)[[1]])*100 
head(ccc4_a3)

ccc4_a3 <- ccc4_a3[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a3)



ccc4_a3 <- ccc4_a3 %>% mutate(time_frame=case_when(Mod3completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod3completionT.A & Mod3completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod3completionT.A & Mod3completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod3completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a3)

ccc4_a3_summary <- ccc4_a3 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_a3_summary)                                                                              
gt_print2A




```

```{r, echo=FALSE}

#summary(as.numeric(tmp.3A$Mod3completionA))
#cat("Active(n=", s4_3aA, ")")
#st(tmp.3A, vars = c('Mod3completionA', title='Table 8e. SAS Active (After)', add.median = T))--no longer needed

#summary(as.numeric(ptmp3$Mod3completionP))
#cat("Passive(n=", s4_3aP, ")")
#st(ptmp3, vars = c('Mod3completionP', title='Table 8f. SAS Passice (After)', add.median = T))--no longer needed

#summary(as.numeric(Ttmp3A$Mod3completionT.A))
#cat("Total(n=", s4_3aT, ")")
#st(Ttmp3A, vars = c('Mod3completionT.A', title='Table 8g. SAS Total (After)', add.median = T))--no longer needed
```

```{r, echo=FALSE, warning = FALSE}
table8h <- ccc4_a3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 8h. SAS Section Completion Time of Verified Participants (After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table8h - no longer needed

```



```{r, include= FALSE, warning=FALSE}
##All Participants 
sum(active_all$d_976570371==231311385, na.rm=TRUE)
sum(passive_all$d_976570371==231311385, na.rm=TRUE)
sum(data_ccc$d_976570371==231311385, na.rm=TRUE)


#Active
actm3= active_all %>% filter(active_all$d_976570371==231311385)
#actm3_time <- actm3[complete.cases(time.var.3)]
actm3_time<- actm3[complete.cases(actm3[ , time.var.3]), ]


tmp.3A <- actm3_time[,c("Connect_ID","d_386488297","d_770257102")]
tmp.3A$d_386488297 <- as.POSIXct(ymd_hms(tmp.3A$d_386488297))
tmp.3A$d_770257102 <- as.POSIXct(ymd_hms(tmp.3A$d_770257102))


tmp.3A$Mod3completionA <- difftime(tmp.3A$d_770257102, tmp.3A$d_386488297, units="mins")
summary(as.numeric(tmp.3A$Mod3completionA))

round((100*(sum(tmp.3A$Mod3completionA<10, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>10, na.rm=TRUE)/sum(active_all$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.3A$Mod3completionA & tmp.3A$Mod3completionA>20, na.rm=TRUE)/sum(active_all$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.3A$Mod3completionA>30, na.rm=TRUE)/sum(active_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Passive
pasm3= passive_all %>% filter(passive_all$d_976570371==231311385)
#pasm3_time <- pasm3[complete.cases(time.var.3)]
pasm3_time<- pasm3[complete.cases(pasm3[ , time.var.3]), ]


ptmp3 <- pasm3_time[,c("Connect_ID","d_386488297","d_770257102")]
ptmp3$d_386488297 <- as.POSIXct(ymd_hms(ptmp3$d_386488297))
ptmp3$d_770257102 <- as.POSIXct(ymd_hms(ptmp3$d_770257102))


ptmp3$Mod3completionP <- difftime(ptmp3$d_770257102, ptmp3$d_386488297, units="mins")
summary(as.numeric(ptmp3$Mod3completionP))

round((100*(sum(ptmp3$Mod3completionP<10, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp3$Mod3completionP & ptmp3$Mod3completionP>10, na.rm=TRUE)/sum(passive_all$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp3$Mod3completionP & ptmp3$Mod3completionP>20, na.rm=TRUE)/sum(passive_all$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp3$Mod3completionP>30, na.rm=TRUE)/sum(passive_c$d_976570371==231311385, na.rm=TRUE))), digits=2)

#Total
#Total
merm3= data_ccc %>% filter(data_ccc$d_976570371==231311385)
#merm3_time <- merm3[complete.cases(time.var.3)]
merm3_time<- merm3[complete.cases(merm3[ , time.var.3]), ]


Ttmp3A <- merm3_time[,c("Connect_ID","d_386488297","d_770257102", "d_512820379")]
Ttmp3A$d_386488297 <- as.POSIXct(ymd_hms(Ttmp3A$d_386488297))
Ttmp3A$d_770257102 <- as.POSIXct(ymd_hms(Ttmp3A$d_770257102))


Ttmp3A$Mod3completionT.A <- difftime(Ttmp3A$d_770257102, Ttmp3A$d_386488297, units="mins")
summary(as.numeric(Ttmp3A$Mod3completionT.A))

round((100*(sum(Ttmp3A$Mod3completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp3A$Mod3completionT.A & Ttmp3A$Mod3completionT.A>10, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp3A$Mod3completionT.A & Ttmp3A$Mod3completionT.A>20, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp3A$Mod3completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_976570371==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp3A)


Ttmp3A= Ttmp3A %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp3A)

ccc4_all_3= Ttmp3A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_3)

ccc4_all_3= ccc4_all_3 %>%  mutate(freq=rep(1, dim(ccc4_all_3)[[1]]))
head(ccc4_all_3)
dim(ccc4_all_3)[[1]]

ccc4_all_3= ccc4_all_3 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_all_3)

ccc4_all_3= ccc4_all_3 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_3)

ccc4_all_3$percentage= (ccc4_all_3$freq/dim(ccc4_all_3)[[1]])*100 
head(ccc4_all_3) 

ccc4_all_3$percentage.Active= (ccc4_all_3$freq.Active/dim(ccc4_all_3)[[1]])*100 
head(ccc4_all_3)

ccc4_all_3$percentage.Passive= (ccc4_all_3$freq.Passive/dim(ccc4_all_3)[[1]])*100 
head(ccc4_all_3)

ccc4_all_3 <- ccc4_all_3[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_all_3)



ccc4_all_3 <- ccc4_all_3 %>% mutate(time_frame=case_when(Mod3completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod3completionT.A & Mod3completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod3completionT.A & Mod3completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod3completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_all_3)
ccc4_all_3$time_frame <- factor(ccc4_all_3$time_frame,levels=c("Completed in Under 10 Minutes", "Completed in 10-20 minutes", "Completed in 20-30 minutes", "Completed in 30+ minutes"))

ccc4_all_3_summary <- ccc4_all_3 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print2A <- gt(ccc4_all_3_summary)                                                                              
gt_print2A




```
\FloatBarrier
```{r, echo=FALSE}

#summary(as.numeric(tmp.3A$Mod3completionA))
#cat("Active(n=", s4_3aA, ")")
#st(tmp.3A, vars = c('Mod3completionA', title='Table 9a. All SAS Active Participants', add.median = T))-- no longer needed

#summary(as.numeric(ptmp3$Mod3completionP))
#cat("Passive(n=", s4_3aP, ")")
#st(ptmp3, vars = c('Mod3completionP', title='Table 9b. SAS Passice Participants', add.median = T))--no longer needed

#summary(as.numeric(Ttmp3A$Mod3completionT.A))
#cat("Total(n=", s4_3aT, ")")
#st(Ttmp3A, vars = c('Mod3completionT.A', title='Table 9c. SAS Total Participants', add.median = T))


Table9c = Ttmp3A %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod3completionT.A,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod3completionT.A,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod3completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod3completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod3completionT.A, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod3completionT.A, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod3completionT.A,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table9c,caption='All SAS Total Participants',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #caption='Table 9c. All SAS Total Participants'
```

```{r, echo=FALSE, warning = FALSE}
ccc4_all_3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 4c. SAS Section Completion Time of All Verified Participants")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

\newpage

## LAW Section

```{r, include= FALSE, warning=FALSE}
# 4.	Duration from start to submitted for each module (active, passive and total) 
#264644252 completion
#452942800 start 
time.var.4 <- c("d_452942800","d_264644252")


##BEFORE
#All participant totals, active total and passive total
sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)

s4_4bA=sum(active_c_before$d_663265240==231311385, na.rm=TRUE)
s4_4bP=sum(passive_c_before$d_663265240==231311385, na.rm=TRUE)
s4_4bT=sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE)

#Active
actm4= active_c_before %>% filter(active_c_before$d_663265240==231311385)
#actm4_time <- actm4[complete.cases(time.var.4)]
actm4_time<- actm4[complete.cases(actm4[ , time.var.4]), ]


tmp.4 <- actm4_time[,c("Connect_ID","d_452942800","d_264644252")]
tmp.4$d_452942800 <- as.POSIXct(ymd_hms(tmp.4$d_452942800))
tmp.4$d_264644252 <- as.POSIXct(ymd_hms(tmp.4$d_264644252))


tmp.4$Mod4completionA <- difftime(tmp.4$d_264644252, tmp.4$d_452942800, units="mins")
summary(as.numeric(tmp.4$Mod4completionA))

round((100*(sum(tmp.4$Mod4completionA<10, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.4$Mod4completionA & tmp.4$Mod4completionA>10, na.rm=TRUE)/sum(active_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.4$Mod4completionA & tmp.4$Mod4completionA>20, na.rm=TRUE)/sum(active_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.4$Mod4completionA>30, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Passive
pasm4= passive_c_before %>% filter(passive_c_before$d_663265240==231311385)
#pasm4_time <- pasm4[complete.cases(time.var.4)]
pasm4_time<- pasm4[complete.cases(pasm4[ , time.var.4]), ]


ptmp4 <- pasm4_time[,c("Connect_ID","d_452942800","d_264644252")]
ptmp4$d_452942800 <- as.POSIXct(ymd_hms(ptmp4$d_452942800))
ptmp4$d_264644252 <- as.POSIXct(ymd_hms(ptmp4$d_264644252))


ptmp4$Mod4completionP <- difftime(ptmp4$d_264644252, ptmp4$d_452942800, units="mins")
summary(as.numeric(ptmp4$Mod4completionP))

round((100*(sum(ptmp4$Mod4completionP<10, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp4$Mod4completionP & ptmp4$Mod4completionP>10, na.rm=TRUE)/sum(passive_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp4$Mod4completionP & ptmp4$Mod4completionP>20, na.rm=TRUE)/sum(passive_c_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp4$Mod4completionP>30, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)

#Total
merm4= data_ccc_before %>% filter(data_ccc_before$d_663265240==231311385)
#merm4_time <- merm4[complete.cases(time.var.4)]
merm4_time<- merm4[complete.cases(merm4[ , time.var.4]), ]


Ttmp.4 <- merm4_time[,c("Connect_ID","d_452942800","d_264644252", 'd_512820379')]
Ttmp.4$d_452942800 <- as.POSIXct(ymd_hms(Ttmp.4$d_452942800))
Ttmp.4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.4$d_264644252))


Ttmp.4$Mod4completionT.B <- difftime(Ttmp.4$d_264644252, Ttmp.4$d_452942800, units="mins")
summary(as.numeric(Ttmp.4$Mod4completionT.B))

round((100*(sum(Ttmp.4$Mod4completionT.B<10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp.4$Mod4completionT.B & Ttmp.4$Mod4completionT.B>10, na.rm=TRUE)/sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp.4$Mod4completionT.B & Ttmp.4$Mod4completionT.B>20, na.rm=TRUE)/sum(data_ccc_before$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp.4$Mod4completionT.B>30, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp.4)


Ttmp.4b= Ttmp.4 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp.4b)

ccc4_b4= Ttmp.4b %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b4)

ccc4_b4= ccc4_b4 %>% mutate(freq=rep(1, dim(ccc4_b4)[[1]]))
head(ccc4_b4)
dim(ccc4_b4)[[1]]

ccc4_b4= ccc4_b4 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_b4)

ccc4_b4= ccc4_b4 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_b4)

ccc4_b4$percentage= (ccc4_b4$freq/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4) 

ccc4_b4$percentage.Active= (ccc4_b4$freq.Active/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4)

ccc4_b4$percentage.Passive= (ccc4_b4$freq.Passive/dim(ccc4_b4)[[1]])*100 
head(ccc4_b4)

ccc4_b4 <- ccc4_b4[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_b4)



ccc4_b4 <- ccc4_b4 %>% mutate(time_frame=case_when(Mod4completionT.B<10  ~ "Completed in Under 10 Minutes",
                                               20>Mod4completionT.B & Mod4completionT.B>10  ~ "Completed in 10-20 minutes",
                                               30>Mod4completionT.B & Mod4completionT.B>20  ~ "Completed in 20-30 minutes",
                                               Mod4completionT.B>30 ~ "Completed in 30+ minutes"))
head(ccc4_b4)

ccc4_b4_summary <- ccc4_b4 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4B <- gt(ccc4_b4_summary)                                                                              
gt_print4B


```

```{r, echo=FALSE}

#cat("Active(n=", s4_4bA, ")")
#summary(as.numeric(tmp.4$Mod4completionA))
#st(tmp.4, vars = c('Mod4completionA', title='Table 10a. LAW Active (Before)', add.median = T))-- no longer needed

#cat("Passive(n=", s4_4bP, ")")
#summary(as.numeric(ptmp4$Mod4completionP))
#st(ptmp4, vars = c('Mod4completionP', title='Table 10b. LAW Active (Before)', add.median = T))--no longer needed

#cat("Total(n=", s4_4bT, ")")
#summary(as.numeric(Ttmp.4$Mod4completionT.B))
#st(Ttmp.4, vars = c('Mod4completionT.B', title='Table 10c. LAW Active (Before)', add.median = T))--no longer needed
```

```{r, echo=FALSE, warning = FALSE}

table10d <- ccc4_b4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 10d. LAW Section Completion Time of Verified Participants (Before)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed prior to July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table10d -- no longer needed

```



```{r, include= FALSE, warning=FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)

s4_4aA=sum(active_c_after$d_663265240==231311385, na.rm=TRUE)
s4_4aP=sum(passive_c_after$d_663265240==231311385, na.rm=TRUE)
s4_4aT=sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE)

#Active
actm4= active_c_after %>% filter(active_c_after$d_663265240==231311385)
#actm4_time <- actm4[complete.cases(time.var.4)]
actm4_time<- actm4[complete.cases(actm4[ , time.var.4]), ]


tmp.4 <- actm4_time[,c("Connect_ID","d_452942800","d_264644252")]
tmp.4$d_452942800 <- as.POSIXct(ymd_hms(tmp.4$d_452942800))
tmp.4$d_264644252 <- as.POSIXct(ymd_hms(tmp.4$d_264644252))


tmp.4$Mod4completionA <- difftime(tmp.4$d_264644252, tmp.4$d_452942800, units="mins")
summary(as.numeric(tmp.4$Mod4completionA))

round((100*(sum(tmp.4$Mod4completionA<10, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.4$Mod4completionA & tmp.4$Mod4completionA>10, na.rm=TRUE)/sum(active_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.4$Mod4completionA & tmp.4$Mod4completionA>20, na.rm=TRUE)/sum(active_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.4$Mod4completionA>30, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Passive
pasm4= passive_c_after %>% filter(passive_c_after$d_663265240==231311385)
#pasm4_time <- pasm4[complete.cases(time.var.4)]
pasm4_time<- pasm4[complete.cases(pasm4[ , time.var.4]), ]


ptmp4 <- pasm4_time[,c("Connect_ID","d_452942800","d_264644252")]
ptmp4$d_452942800 <- as.POSIXct(ymd_hms(ptmp4$d_452942800))
ptmp4$d_264644252 <- as.POSIXct(ymd_hms(ptmp4$d_264644252))


ptmp4$Mod4completionP <- difftime(ptmp4$d_264644252, ptmp4$d_452942800, units="mins")
summary(as.numeric(ptmp4$Mod4completionP))

round((100*(sum(ptmp4$Mod4completionP<10, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp4$Mod4completionP & ptmp4$Mod4completionP>10, na.rm=TRUE)/sum(passive_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp4$Mod4completionP & ptmp4$Mod4completionP>20, na.rm=TRUE)/sum(passive_c_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp4$Mod4completionP>30, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)

#Total
merm4= data_ccc_after %>% filter(data_ccc_after$d_663265240==231311385)
#merm4_time <- merm4[complete.cases(time.var.4)]
merm4_time<- merm4[complete.cases(merm4[ , time.var.4]), ]


Ttmp.4 <- merm4_time[,c("Connect_ID","d_452942800","d_264644252", "d_512820379")]
Ttmp.4$d_452942800 <- as.POSIXct(ymd_hms(Ttmp.4$d_452942800))
Ttmp.4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.4$d_264644252))


Ttmp.4$Mod4completionT.A <- difftime(Ttmp.4$d_264644252, Ttmp.4$d_452942800, units="mins")
summary(as.numeric(Ttmp.4$Mod4completionT.A))

round((100*(sum(Ttmp.4$Mod4completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp.4$Mod4completionT.A & Ttmp.4$Mod4completionT.A>10, na.rm=TRUE)/sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp.4$Mod4completionT.A & Ttmp.4$Mod4completionT.A>20, na.rm=TRUE)/sum(data_ccc_after$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp.4$Mod4completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp.4)


Ttmp.4A= Ttmp.4 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp.4A)

ccc4_a4= Ttmp.4A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a4)

ccc4_a4= ccc4_a4 %>%  mutate(freq=rep(1, dim(ccc4_a4)[[1]]))
head(ccc4_a4)
dim(ccc4_a4)[[1]]

ccc4_a4= ccc4_a4 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_a4)

ccc4_a4= ccc4_a4 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_a4)

ccc4_a4$percentage= (ccc4_a4$freq/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4) 

ccc4_a4$percentage.Active= (ccc4_a4$freq.Active/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4)

ccc4_a4$percentage.Passive= (ccc4_a4$freq.Passive/dim(ccc4_a4)[[1]])*100 
head(ccc4_a4)

ccc4_a4 <- ccc4_a4[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_a4)



ccc4_a4 <- ccc4_a4 %>% mutate(time_frame=case_when(Mod4completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod4completionT.A & Mod4completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod4completionT.A & Mod4completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod4completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_a4)

ccc4_a4_summary <- ccc4_a4 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4A <- gt(ccc4_a4_summary)                                                                              
gt_print4A
```

```{r, echo=FALSE}

#cat("Active(n=", s4_4aA, ")")
#summary(as.numeric(tmp.4$Mod4completionA))
#st(tmp.4, vars = c('Mod4completionA', title='Table 10e. LAW Active (After)', add.median = T))--no longer needed 

#cat("Passive(n=", s4_4aP, ")")
#summary(as.numeric(ptmp4$Mod4completionP))
#st(ptmp4, vars = c('Mod4completionP', title='Table 10f. LAW Active (After)', add.median = T))--no longer needed

#cat("Total(n=", s4_4aT, ")")
#summary(as.numeric(Ttmp.4$Mod4completionT.A))
#st(Ttmp.4, vars = c('Mod4completionT.A', title='Table 10g. LAW Active (After)', add.median = T))--no longer needed
```

```{r, echo=FALSE, warning = FALSE}
table10h <- ccc4_a4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 10h. LAW Section Completion Time of Verified Participants (After)")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_footnote(
    footnote = "Verification completed on or after July 5,2022 when all sections became available in prod") %>%
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

#table10h <- no longer needed
```


```{r, include= FALSE, warning=FALSE}
##AFTER
#All participant totals, active total and passive total
sum(active_all$d_663265240==231311385, na.rm=TRUE)
sum(passive_all$d_663265240==231311385, na.rm=TRUE)
sum(data_ccc$d_663265240==231311385, na.rm=TRUE)


#Active
actm4= active_all %>% filter(active_all$d_663265240==231311385)
#actm4_time <- actm4[complete.cases(time.var.4)]
actm4_time<- actm4[complete.cases(actm4[ , time.var.4]), ]


tmp.4 <- actm4_time[,c("Connect_ID","d_452942800","d_264644252")]
tmp.4$d_452942800 <- as.POSIXct(ymd_hms(tmp.4$d_452942800))
tmp.4$d_264644252 <- as.POSIXct(ymd_hms(tmp.4$d_264644252))


tmp.4$Mod4completionA <- difftime(tmp.4$d_264644252, tmp.4$d_452942800, units="mins")
summary(as.numeric(tmp.4$Mod4completionA))

round((100*(sum(tmp.4$Mod4completionA<10, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>tmp.4$Mod4completionA & tmp.4$Mod4completionA>10, na.rm=TRUE)/sum(active_all$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>tmp.4$Mod4completionA & tmp.4$Mod4completionA>20, na.rm=TRUE)/sum(active_all$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(tmp.4$Mod4completionA>30, na.rm=TRUE)/sum(active_c$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Passive
pasm4= passive_all %>% filter(passive_all$d_663265240==231311385)
#pasm4_time <- pasm4[complete.cases(time.var.4)]
pasm4_time<- pasm4[complete.cases(pasm4[ , time.var.4]), ]


ptmp4 <- pasm4_time[,c("Connect_ID","d_452942800","d_264644252")]
ptmp4$d_452942800 <- as.POSIXct(ymd_hms(ptmp4$d_452942800))
ptmp4$d_264644252 <- as.POSIXct(ymd_hms(ptmp4$d_264644252))


ptmp4$Mod4completionP <- difftime(ptmp4$d_264644252, ptmp4$d_452942800, units="mins")
summary(as.numeric(ptmp4$Mod4completionP))

round((100*(sum(ptmp4$Mod4completionP<10, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>ptmp4$Mod4completionP & ptmp4$Mod4completionP>10, na.rm=TRUE)/sum(passive_all$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>ptmp4$Mod4completionP & ptmp4$Mod4completionP>20, na.rm=TRUE)/sum(passive_all$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(ptmp4$Mod4completionP>30, na.rm=TRUE)/sum(passive_c$d_663265240==231311385, na.rm=TRUE))), digits=2)

#Total
merm4= data_ccc %>% filter(data_ccc$d_663265240==231311385)
#merm4_time <- merm4[complete.cases(time.var.4)]
merm4_time<- merm4[complete.cases(merm4[ , time.var.4]), ]


Ttmp.4 <- merm4_time[,c("Connect_ID","d_452942800","d_264644252", "d_512820379")]
Ttmp.4$d_452942800 <- as.POSIXct(ymd_hms(Ttmp.4$d_452942800))
Ttmp.4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.4$d_264644252))


Ttmp.4$Mod4completionT.A <- difftime(Ttmp.4$d_264644252, Ttmp.4$d_452942800, units="mins")
summary(as.numeric(Ttmp.4$Mod4completionT.A))

round((100*(sum(Ttmp.4$Mod4completionT.A<10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(20>Ttmp.4$Mod4completionT.A & Ttmp.4$Mod4completionT.A>10, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(30>Ttmp.4$Mod4completionT.A & Ttmp.4$Mod4completionT.A>20, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)
round((100*(sum(Ttmp.4$Mod4completionT.A>30, na.rm=TRUE)/sum(data_ccc$d_663265240==231311385, na.rm=TRUE))), digits=2)


#Make an automatic table
head(Ttmp.4)


Ttmp.4A= Ttmp.4 %>%  mutate(Active= ifelse((d_512820379 == 486306141), 1, 0))
head(Ttmp.4A)

ccc4_all_4= Ttmp.4A %>%  mutate(Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_4)

ccc4_all_4= ccc4_all_4 %>%  mutate(freq=rep(1, dim(ccc4_all_4)[[1]]))
head(ccc4_all_4)
dim(ccc4_all_4)[[1]]

ccc4_all_4= ccc4_all_4 %>%  mutate(freq.Active= ifelse((d_512820379 == 486306141), 1, 0))
head(ccc4_all_4)

ccc4_all_4= ccc4_all_4 %>%  mutate(freq.Passive= ifelse((d_512820379 == 854703046), 1, 0))
head(ccc4_all_4)

ccc4_all_4$percentage= (ccc4_all_4$freq/dim(ccc4_all_4)[[1]])*100 
head(ccc4_all_4) 

ccc4_all_4$percentage.Active= (ccc4_all_4$freq.Active/dim(ccc4_all_4)[[1]])*100 
head(ccc4_all_4)

ccc4_all_4$percentage.Passive= (ccc4_all_4$freq.Passive/dim(ccc4_all_4)[[1]])*100 
head(ccc4_all_4)

ccc4_all_4 <- ccc4_all_4[ , c(5:13)] #want only frequency, process and percentage of participants 
head(ccc4_all_4)



ccc4_all_4 <- ccc4_all_4 %>% mutate(time_frame=case_when(Mod4completionT.A<10  ~ "Completed in Under 10 Minutes",
                                                   20>Mod4completionT.A & Mod4completionT.A>10  ~ "Completed in 10-20 minutes",
                                                   30>Mod4completionT.A & Mod4completionT.A>20  ~ "Completed in 20-30 minutes",
                                                   Mod4completionT.A>30 ~ "Completed in 30+ minutes"))
head(ccc4_all_4)

ccc4_all_4$time_frame <- factor(ccc4_all_4$time_frame,levels=c("Completed in Under 10 Minutes", "Completed in 10-20 minutes", "Completed in 20-30 minutes", "Completed in 30+ minutes"))


ccc4_all_4_summary <- ccc4_all_4 %>%  group_by(time_frame)  %>% arrange(time_frame) %>% summarize_at(c('freq', "percentage", 'freq.Active', "freq.Passive", "percentage.Active", "percentage.Passive"), sum, na.rm = TRUE) 
gt_print4A <- gt(ccc4_all_4_summary)                                                                              
gt_print4A
```
\FloatBarrier
```{r, echo=FALSE}

#cat("Active(n=", s4_4aA, ")")
#summary(as.numeric(tmp.4$Mod4completionA))
#st(tmp.4, vars = c('Mod4completionA', title='Table 11a. All LAW Participants', add.median = T))--no longer needed

#cat("Passive(n=", s4_4aP, ")")
#summary(as.numeric(ptmp4$Mod4completionP))
#st(ptmp4, vars = c('Mod4completionP', title='Table 11b. All LAW Participants', add.median = T))--no longer needed

#cat("Total(n=", s4_4aT, ")")
#summary(as.numeric(Ttmp.4$Mod4completionT.A))
#st(Ttmp.4, vars = c('Mod4completionT.A', title='Table 11c. All LAW Participants', add.median = T))

Table11c = Ttmp.4 %>% #biochk_outlier,
  dplyr::summarize('N'=n(),
                   Median = str_sub(round(median(Mod4completionT.A,na.rm = TRUE), digits=2), end = -1),   #str_sub(, end = -4),
                   Mean = str_sub(round(mean(Mod4completionT.A,na.rm = TRUE),digits=2), end = -1), 
                   SD= str_sub(round(sd(Mod4completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Min = str_sub(round(min(Mod4completionT.A,na.rm = TRUE), digits=2), end = -1),
                   Q1 = str_sub(round(quantile(Mod4completionT.A, 0.25,na.rm = TRUE), digits=2), end = -1),
                   Q3 = str_sub(round(quantile(Mod4completionT.A, 0.75,na.rm = TRUE), digits=2), end = -1),
                   Max = str_sub(round(max(Mod4completionT.A,na.rm = TRUE), digits=2), end = -1))

knitr::kable(Table9c,caption='All LAW Total Participants',row.names=FALSE, align=c("l","c","c","c","c","c","c","c"),digits=2, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down") #caption='Table 11c. All LAW Total Participants'
```

```{r, echo=FALSE, warning = FALSE}

ccc4_all_4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage.Active", decimals = 2) %>% 
  fmt_number(columns = "percentage.Passive", decimals = 2) %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Table 4d. LAW Section Completion Time of All Verified Participants")) %>% 
  cols_label(time_frame = md("**Completion Time**"), freq.Active = md("**(N)**"), freq.Passive = md("**(N)**"), 
             freq = md("**(N)**"), 
             percentage.Active = md("**%**"), percentage.Passive = md("**%**"), percentage= md("**%**")) %>% 
  tab_spanner(
    label="Active Participants",
    columns=vars(freq.Active,percentage.Active)
  ) %>% 
  tab_spanner(
    label="Passive Participants",
    columns=vars(freq.Passive,percentage.Passive)
  ) %>% 
  tab_spanner(
    label="Total Participants",
    columns=vars(freq, percentage)
  ) %>% 
  # tab_style(
  #   cell_text(
  #   align="center"),
  #   locations= cells_column_spanners(spanners=vars("Active", "Passive"))
  # ) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq.Active,freq.Passive, freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns = c(percentage.Active, percentage.Passive),
    # fns= list(
    #   Sum= ~sum(.))) %>%
grand_summary_rows(columns=c(freq.Active, freq.Passive, freq, percentage, percentage.Active, percentage.Passive), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time_frame,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


\newpage

# 5.	% Submission of surveys sections by active recruits who cannot be verified
```{r, include=FALSE}
# 5.	% Submission of surveys modules by active recruits who cannot be verified   
#d_512820379==486306141 <-- active

cannot_verify <- data_c %>% filter(d_821247024==219863910& d_512820379==486306141) #active
dim(cannot_verify)

cannot_verify_all <- data_c %>% filter(d_821247024==219863910) #all
dim(cannot_verify_all)
#Only 1 active_c participant that cannot be verified

#>No survey modules submitted
active_c_NV_NS <- data_c %>% filter(d_821247024==219863910 & d_512820379==486306141 & (d_949302066==972455046 | d_949302066==615768760) & (d_536735468==972455046 | d_536735468==615768760) &
                                      (d_976570371==972455046 | d_976570371==615768760) & (d_663265240==972455046| d_663265240==615768760))
dim(active_c_NV_NS)
dim(active_c_NV_NS)[[1]]/dim(cannot_verify)[[1]]

#>Any survey modules submitted
active_c_NV_SB <- data_c %>% filter(d_821247024==219863910 & d_512820379==486306141 & (d_949302066==231311385 | d_536735468==231311385 | d_976570371==231311385 | d_663265240==231311385))
dim(active_c_NV_SB)
dim(active_c_NV_SB)[[1]]/dim(cannot_verify)[[1]]
```

```{r, echo=FALSE, include=FALSE}

Numb5= cannot_verify %>%  mutate(freq=rep(1, dim(cannot_verify)[[1]]))
Numb5$percentage= (Numb5$freq/dim(Numb5)[[1]])*100 

Numb5= Numb5 %>%  mutate(submit=case_when((d_949302066==972455046 | d_949302066==615768760) & (d_536735468==972455046 | d_536735468==615768760) &
                                      (d_976570371==972455046 | d_976570371==615768760) & (d_663265240==972455046| d_663265240==615768760)~"None",
                                      (d_821247024==219863910 & d_512820379==486306141 & (d_949302066==231311385 | d_536735468==231311385 | d_976570371==231311385 | d_663265240==231311385))~"At Least One"))

Numb5 <- Numb5[ , c(21:23)] #want only frequency, process and percentage of participants 

Numb5_summary <- Numb5 %>%  group_by(submit)  %>% arrange(submit) %>% summarize_at(c('freq', "percentage"), sum, na.rm = TRUE) 


```


```{r, echo=FALSE, warning = FALSE}
Numb5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  tab_header(title = html("Sections Submitted by Non-Verified Active Participants")) %>% 
  cols_label(submit = md("**Sections Completed**"), freq = md("**Participants (N)**"), percentage = md("**Percentage**")) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
  grand_summary_rows(columns=c(freq, percentage), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = submit,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```


```{r, echo=FALSE, include=FALSE}
cat("Number of Active Participants that cannot be verified:", dim(cannot_verify)[[1]])
cat("\n", "Percent of no Surveys Completed by these Participants (N=", dim(active_c_NV_NS)[[1]] ,")") 
cat("\t", 100*(dim(active_c_NV_NS)[[1]]/dim(cannot_verify)[[1]]), "%")
cat("\n" , "Percent Where at Least 1 Survey Completed by these Participants (N=", dim(active_c_NV_SB)[[1]] ,")")
cat("\t", (100*(dim(active_c_NV_SB)[[1]]/dim(cannot_verify)[[1]])), "%")
```


```{r, include=FALSE}

#######################################################################################################
##### ALL MODULES #####  
dim(data_ccc)






#6.	Time from start of Module 1 to completion of most recent module (in hours) to get overall averages --- review this code! Might have swapped all mod1 completions status with Mod 4, and Mod3 with Mod1

time.var.1_1 <- c("d_205553981","d_517311251")
mer1_1= data_ccc_after %>% filter(data_ccc_after$d_949302066==231311385 & (d_205553981>="2022-07-05"))
#mer1_2_time <- mer1_2[complete.cases(time.var.1_2)]
mer1_1_time<- mer1_1[complete.cases(mer1_1[ , time.var.1_1]), ]


Ttmp1_1 <- mer1_1_time[,c("Connect_ID","d_205553981","d_517311251")]
Ttmp1_1$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_1$d_205553981))
Ttmp1_1$d_517311251 <- as.POSIXct(ymd_hms(Ttmp1_1$d_517311251))


Ttmp1_1$Mod2completionT <- difftime(Ttmp1_1$d_517311251, Ttmp1_1$d_205553981, units="hours")
summary(as.numeric(Ttmp1_1$Mod2completionT))

#mod 1 and 2
time.var.1_2 <- c("d_205553981","d_832139544")
mer1_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240!=231311385)
#mer1_2_time <- mer1_2[complete.cases(time.var.1_2)]
mer1_2_time<- mer1_2[complete.cases(mer1_2[ , time.var.1_2]), ]


Ttmp1_2 <- mer1_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2$d_205553981))
Ttmp1_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_2$d_832139544))


Ttmp1_2$Mod2completionT <- difftime(Ttmp1_2$d_832139544, Ttmp1_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2$Mod2completionT))



#mod 1 & 3
time.var.1_3 <- c("d_205553981","d_770257102")
merm1_3= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240!=231311385)
#merm1_3_time <- merm1_3[complete.cases(time.var.1_3)]
merm1_3_time<- merm1_3[complete.cases(merm1_3[ , time.var.1_3]), ]


Ttmp1_3 <- merm1_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3$d_205553981))
Ttmp1_3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp1_3$d_770257102))


Ttmp1_3$Mod1_3completionT <- difftime(Ttmp1_3$d_770257102, Ttmp1_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3$Mod1_3completionT))

#mod 1 & 4
time.var.1_4 <- c("d_205553981","d_264644252")
merm1_4= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371!=231311385 & d_663265240==231311385)
#merm1_4_time <- merm1_4[complete.cases(time.var.1_4)]
merm1_4_time<- merm1_4[complete.cases(merm1_4[ , time.var.1_4]), ]


Ttmp.1_4 <- merm1_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp.1_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp.1_4$d_205553981))
Ttmp.1_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp.1_4$d_264644252))


Ttmp.1_4$Mod1_4completionT <- difftime(Ttmp.1_4$d_264644252, Ttmp.1_4$d_205553981, units="hours")
summary(as.numeric(Ttmp.1_4$Mod1_4completionT))


#mod 1, 2 & 3   
time.var.1_2_3 <- c("d_205553981","d_770257102")
merm1_2_3= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240!=231311385 & d_832139544 < d_770257102)
#merm1_2_3_time <- merm1_2_3[complete.cases(time.var.1_2_3)]
merm1_2_3_time<- merm1_2_3[complete.cases(merm1_2_3[ , time.var.1_2_3]), ]


Ttmp1_2_3 <- merm1_2_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_2_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_3$d_205553981))
Ttmp1_2_3$d_770257102 <- as.POSIXct(ymd_hms(Ttmp1_2_3$d_770257102))


Ttmp1_2_3$Mod1_2_3completionT <- difftime(Ttmp1_2_3$d_770257102, Ttmp1_2_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_3$Mod1_2_3completionT))

#mod 1, 3 & 2 (answering mod 3 before mod2)   
time.var.1_3_2 <- c("d_205553981","d_832139544")
merm1_3_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240!=231311385 & d_770257102 < d_832139544)
#merm1_3_2_time <- merm1_3_2[complete.cases(time.var.1_3_2)]
merm1_3_2_time<- merm1_3_2[complete.cases(merm1_3_2[ , time.var.1_3_2]), ]


Ttmp1_3_2 <- merm1_3_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_3_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3_2$d_205553981))
Ttmp1_3_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_3_2$d_832139544))


Ttmp1_3_2$Mod1_3_2completionT <- difftime(Ttmp1_3_2$d_832139544, Ttmp1_3_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3_2$Mod1_3_2completionT))


#mod 1, 2 & 4   
time.var.1_2_4 <- c("d_205553981","d_264644252")
merm1_2_4= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240==231311385 & d_832139544 < d_264644252)
#merm1_2_4_time <- merm1_2_4[complete.cases(time.var.1_2_4)]
merm1_2_4_time<- merm1_2_4[complete.cases(merm1_2_4[ , time.var.1_2_4]), ]


Ttmp1_2_4 <- merm1_2_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_2_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_4$d_205553981))
Ttmp1_2_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_2_4$d_264644252))


Ttmp1_2_4$Mod1_2_4completionT <- difftime(Ttmp1_2_4$d_264644252, Ttmp1_2_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_4$Mod1_2_4completionT))

#mod 1, 4 & 2 (answering 2 before four )   
time.var.1_4_2 <- c("d_205553981","d_832139544")
merm1_4_2= mer1_1 %>% filter(d_536735468==231311385 & d_976570371!=231311385 & d_663265240==231311385 & d_264644252 < d_832139544)
#merm1_4_2_time <- merm1_4_2[complete.cases(time.var.1_4_2)]
merm1_4_2_time<- merm1_4_2[complete.cases(merm1_4_2[ , time.var.1_4_2]), ]


Ttmp1_4_2 <- merm1_4_2_time[,c("Connect_ID","d_205553981","d_832139544")]
Ttmp1_4_2$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_4_2$d_205553981))
Ttmp1_4_2$d_832139544 <- as.POSIXct(ymd_hms(Ttmp1_4_2$d_832139544))


Ttmp1_4_2$Mod1_4_2completionT <- difftime(Ttmp1_4_2$d_832139544, Ttmp1_4_2$d_205553981, units="hours")
summary(as.numeric(Ttmp1_4_2$Mod1_4_2completionT))

#mod 1, 3 & 4 
time.var.1_3_4 <- c("d_205553981","d_264644252")
merm1_3_4= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240==231311385 & d_770257102 < d_264644252)
#merm1_3_4_time <- merm1_3_4[complete.cases(time.var.1_3_4)]
merm1_3_4_time<- merm1_3_4[complete.cases(merm1_3_4[ , time.var.1_3_4]), ]


Ttmp1_3_4 <- merm1_3_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_3_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_3_4$d_205553981))
Ttmp1_3_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_3_4$d_264644252))


Ttmp1_3_4$Mod1_3_4completionT <- difftime(Ttmp1_3_4$d_264644252, Ttmp1_3_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_3_4$Mod1_3_4completionT))

#mod 1, 4 & 3 
time.var.1_4_3 <- c("d_205553981","d_770257102")
merm1_4_3= mer1_1 %>% filter(d_536735468!=231311385 & d_976570371==231311385 & d_663265240==231311385 & d_264644252 < d_770257102)
#merm1_4_3_time <- merm1_4_3[complete.cases(time.var.1_4_3)]
merm1_4_3_time<- merm1_4_3[complete.cases(merm1_4_3[ , time.var.1_4_3]), ]


Ttmp1_4_3 <- merm1_4_3_time[,c("Connect_ID","d_205553981","d_770257102")]
Ttmp1_4_3$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_4_3$d_205553981))
Ttmp1_4_3$d_7702571022 <- as.POSIXct(ymd_hms(Ttmp1_4_3$d_770257102))


Ttmp1_4_3$Mod1_4_3completionT <- difftime(Ttmp1_4_3$d_770257102, Ttmp1_4_3$d_205553981, units="hours")
summary(as.numeric(Ttmp1_4_3$Mod1_4_3completionT))


#mod 1, 2, 3 & 4   ----- assuming in order
time.var.1_2_3_4 <- c("d_205553981","d_264644252")
merm1_2_3_4= mer1_1 %>% filter(d_536735468==231311385 & d_976570371==231311385 & d_663265240==231311385 & 
                                 d_517311251 < d_832139544 & d_832139544 < d_770257102 & d_770257102 < d_264644252)
#merm1_2_3_4_time <- merm1_2_3_4[complete.cases(time.var.1_2_3_4)]
merm1_2_3_4_time<- merm1_2_3_4[complete.cases(merm1_2_3_4[ , time.var.1_2_3_4]), ]


Ttmp1_2_3_4 <- merm1_2_3_4_time[,c("Connect_ID","d_205553981","d_264644252")]
Ttmp1_2_3_4$d_205553981 <- as.POSIXct(ymd_hms(Ttmp1_2_3_4$d_205553981))
Ttmp1_2_3_4$d_264644252 <- as.POSIXct(ymd_hms(Ttmp1_2_3_4$d_264644252))


Ttmp1_2_3_4$Mod1_2_3_4completionT <- difftime(Ttmp1_2_3_4$d_264644252, Ttmp1_2_3_4$d_205553981, units="hours")
summary(as.numeric(Ttmp1_2_3_4$Mod1_2_3_4completionT))


```

\newpage

# 6. Menstrual Cycle Survey Completion Status for Eligible Participants
```{r, include=FALSE}
#8. Connect_IDs of those who completed the menstrual cycle survey---need to convert to SQL code since d_459098666 and D_299215535.D_112151599 are in participants table and aren't flattened

mens_ccc <- "SELECT Connect_ID, D_112151599
 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.bioSurvey_v1_JP`"
prts_ccc <- "SELECT Connect_ID,  d_265193023,  d_459098666, d_827220437 from `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP`"
#site_ccc <- "SELECT d_789843387 FROM `nih-nci-dceg-connect-prod-6d04.Biospecimens.FlatConnect.boxes_JP`"


mens_table_cc <- bq_project_query(project_cc, mens_ccc)
prts_table_cc <- bq_project_query(project_cc, prts_ccc)
#site_table_cc <- bq_project_query(project_cc, site_ccc)

mens_data_ccc <- bq_table_download(mens_table_cc, bigint = "integer64")
prts_data_ccc <- bq_table_download(prts_table_cc, bigint = "integer64")
#site_data_ccc <- bq_table_download(site_table_cc, bigint = "integer64")

table7 <- left_join(mens_data_ccc, prts_data_ccc , by="Connect_ID")

menstrual <- table7 %>% filter(D_112151599=='353358909' & d_265193023==231311385 )
dim(menstrual)


# cid <- menstrual %>% filter(d_827220437==327912200)  %>%  select(Connect_ID)
# head(cid)

mens_complete <- table7  %>%  filter(d_459098666==231311385 )
dim(mens_complete)

round(100*(dim(mens_complete)[[1]]/dim(menstrual)[[1]]), digits=2)


```

```{r, include=FALSE}

Numb6= menstrual %>%  mutate(freq=rep(1, dim(menstrual)[[1]]))

#Numb6= Numb6 %>%  mutate(freq.Research= ifelse((d_789843387==531629870 | d_789843387==548392715| d_789843387==303349821| d_789843387==657167265| d_789843387==809703864), 1, 0))
#Numb6= Numb6 %>%  mutate(freq.Clinical= ifelse((d_789843387==125001209 | d_789843387==327912200 | d_789843387==300267574 | d_789843387==452412599), 1, 0))

Numb6$percentage= (Numb6$freq/dim(Numb6)[[1]])*100 

Numb6= Numb6 %>%  mutate(menst=case_when(d_459098666==231311385~"Completed",
                                          d_459098666==231311385 | d_459098666==972455046 | d_459098666==615768760~"Eligible but not Completed"))

Numb6 <- Numb6[ , c(6:8)] #want only frequency, process and percentage of participants 

Numb6_summary <- Numb6 %>%  group_by(menst)  %>% arrange(menst) %>% summarize_at(c('freq', "percentage"), sum, na.rm = TRUE) 


```


```{r, echo=FALSE, warning = FALSE}
Numb6_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "freq", decimals = 0) %>%
  #tab_header(title = html("Sections Submitted by Non-Verified Active Participants")) %>% 
  cols_label(menst = md("**Menstrual Survey Status**"), freq = md("**Participants (N)**"), percentage = md("**Percentage**")) %>% 
    # summary_rows(     groups= FALSE,
    # #    groups= T, 
    # columns =  c(freq, percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>% 
    grand_summary_rows(columns=c(freq, percentage), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>
  tab_options(
    heading.title.font.size = 25,
    heading.padding = 10,
    row_group.font.weight = "bolder",
    summary_row.background.color = "blanchedalmond", #<---- what to call the final summary in order to bold and color it
    row_group.background.color =    "#99CCFF"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = menst,
    )
  )  %>% 
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  ) %>%  opt_row_striping()

```

```{r, echo=FALSE, include=FALSE}
cat('Number of participants who have completed:', dim(mens_complete)[[1]])
cat('Number of participans who are eligiible:', dim(menstrual)[[1]])
cat('Percent completed:', round(100*(dim(mens_complete)[[1]]/dim(menstrual)[[1]]), digits=2), "%")
```

\newpage

# 7.	Presence of survey completion time stamp, survey start time stamp, and survey completion flag for those who have completed a section. 
```{r, include=FALSE}
#M1
m1_cf=sum(data_ccc$d_949302066==231311385) #COMPLETION FLAGS
m1_done= data_ccc %>% filter(d_949302066==231311385)
m1_sts=sum(!is.na(m1_done$d_205553981)) #START TIME STAMP
m1_cts=sum(!is.na(m1_done$d_517311251)) #COMPLETION TIME STAMP

#M2
m2_cf=sum(data_ccc$d_536735468==231311385) #COMPLETION FLAGS
m2_done= data_ccc %>% filter(d_536735468==231311385)
m2_sts=sum(!is.na(m2_done$d_541836531)) #START TIME STAMP
m2_cts=sum(!is.na(m2_done$d_832139544)) #COMPLETION TIME STAMP

#M3
m3_cf=sum(data_ccc$d_976570371==231311385) #COMPLETION FLAGS
m3_done= data_ccc %>% filter(d_976570371==231311385)
m3_sts=sum(!is.na(m3_done$d_386488297)) #START TIME STAMP
m3_cts=sum(!is.na(m3_done$d_770257102)) #COMPLETION TIME STAMP

#M4
m4_cf=sum(data_ccc$d_663265240==231311385) #COMPLETION FLAGS
m4_done= data_ccc %>% filter(d_663265240==231311385)
m4_sts=sum(!is.na(m4_done$d_452942800)) #START TIME STAMP
m4_cts=sum(!is.na(m4_done$d_264644252)) #COMPLETION TIME STAMP

#B.U.M.
bum_cf=sum(data_ccc$d_265193023==231311385) #COMPLETION FLAGS
bum_done= data_ccc %>% filter(d_265193023==231311385)
bum_sts=sum(!is.na(bum_done$d_822499427)) #START TIME STAMP
bum_cts=sum(!is.na(bum_done$d_222161762)) #COMPLETION TIME STAMP

```


```{r, echo=FALSE}
#ifelse(m1_cf==m1_sts & m1_sts==m1_cts, "BOH Section completion flags, start time stamps and completion time stamps are all equal as they should be", cat(m1_cf, "BOH Section Completion Flags", sep="\n", m1_sts,"BOH Section Start Time Stamps",  m1_cts, "BOH Section Completion Time Stamps"  ))
cat("\t","BOH Section Completion Flags:", m1_cf)
cat("\t","BOH Section Start Time Stamps:", m1_sts)
cat("\t","BOH Section Completion Time Stamps:", m1_cts)
cat("\t",if(m1_cf!=m1_sts | m1_cts!=m1_sts | m1_cf!=m1_cts){"Not equal!!"})
cat("\n")

cat("\t", "MRE Section Completion Flags:", m2_cf)
cat("\t", "MRE Section Start Time Stamps:", m2_sts)
cat("\t", "MRE Section Completion Time Stamps:", m2_cts)
cat("\t",if(m2_cf!=m2_sts | m2_cts!=m2_sts | m2_cf!=m2_cts){"Not equal!!"})
cat("\n")

cat("\t","SAS Section Completion Flags:", m3_cf)
cat("\t","SAS Section Start Time Stamps:", m3_sts)
cat("\t","SAS Section Completion Time Stamps:", m3_cts)
cat("\t",if(m3_cf!=m3_sts | m3_cts!=m3_sts | m3_cf!=m3_cts){"Not equal!!"})
cat("\n")

cat("\t","LAW Section Completion Flags:", m4_cf)
cat("\t","LAW Section Start Time Stamps:", m4_sts)
cat("\t","LAW Section Completion Time Stamps:", m4_cts)
cat("\t",if(m4_cf!=m4_sts | m4_cts!=m4_sts | m4_cf!=m4_cts){"Not equal!!"})
cat("\n")

cat("\t","Blood Urine Mouthwash Survey Completion Flags:", bum_cf)
cat("\t","Blood Urine Mouthwash Survey Start Time Stamps:", bum_sts)
cat("\t","Blood Urine Mouthwash Survey Completion Time Stamps:", bum_cts)
cat("\t",if(bum_cf!=bum_sts | bum_cts!=bum_sts | bum_cf!=bum_cts){"Not equal!!"})


```



# 8.  Menstrual Cycle Survey Completeness Among Sites for Eligible Participants
```{r, include=FALSE}


# mens_ccc <- "SELECT Connect_ID, D_112151599 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.bioSurvey_v1_JP`  where Connect_ID is not null"
# prts_ccc <- "SELECT Connect_ID,  d_265193023,  d_459098666, d_827220437, d_253883960 from `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP`  where Connect_ID is not null"
# bio_ccc <- "SELECT Connect_ID, d_650516960 FROM `nih-nci-dceg-connect-dev.Connect.biospecimen` where d_650516960 is not null"
# 
# 
# 
# mens_table_cc <- bq_project_query(project_cc, mens_ccc)
# prts_table_cc <- bq_project_query(project_cc, prts_ccc)
# bio_table_cc <- bq_project_query(project_cc, bio_ccc)
# 
# 
# mens_data_ccc <- bq_table_download(mens_table_cc, bigint = "integer64")
# prts_data_ccc <- bq_table_download(prts_table_cc, bigint = "integer64")
# bio_data_ccc <- bq_table_download(bio_table_cc, bigint = "integer64")
# 
# mens_data_ccc$Connect_ID <- as.numeric(mens_data_ccc$Connect_ID)
# prts_data_ccc$Connect_ID <- as.numeric(prts_data_ccc$Connect_ID)
# bio_data_ccc$Connect_ID <- as.numeric(bio_data_ccc$Connect_ID)
# 
# menstrual <- left_join(mens_data_ccc, prts_data_ccc , by="Connect_ID") %>%  left_join(bio_data_ccc, by="Connect_ID")

#menstrual <- menstrual %>% filter(D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)) #(d_289750687==353358909)
```



```{r, include=FALSE}
mensBUM_ccc <- "SELECT Connect_ID, D_112151599 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.bioSurvey_v1_JP`  where Connect_ID is not null and D_112151599='353358909'"
mensBU_ccc <- "SELECT Connect_ID, D_112151599 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.clinicalBioSurvey_v1_JP` where Connect_ID is not null and D_112151599='353358909'"
# prts_ccc <- "SELECT Connect_ID,  d_265193023,  d_459098666, d_827220437, d_253883960 from `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP`  where Connect_ID is not null"
prts_ccc <- "SELECT Connect_ID, d_827220437, d_253883960, d_265193023, d_253883960,  d_459098666 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP`  where (d_265193023='231311385' OR d_253883960='231311385')"
#bio_ccc <- "SELECT Connect_ID, d_650516960 FROM `nih-nci-dceg-connect-dev.Connect.biospecimen` where d_650516960 is not null"



mensBUM_table_cc <- bq_project_query(project_cc, mensBUM_ccc)
mensBU_table_cc <- bq_project_query(project_cc, mensBU_ccc)
prts_table_cc <- bq_project_query(project_cc, prts_ccc)
#bio_table_cc <- bq_project_query(project_cc, bio_ccc)


mensBUM_data_ccc <- bq_table_download(mensBUM_table_cc, bigint = "integer64")
mensBU_data_ccc <- bq_table_download(mensBU_table_cc, bigint = "integer64")
prts_data_ccc <- bq_table_download(prts_table_cc, bigint = "integer64")
#bio_data_ccc <- bq_table_download(bio_table_cc, bigint = "integer64")

mensBUM_data_ccc$Connect_ID <- as.numeric(mensBUM_data_ccc$Connect_ID)
mensBU_data_ccc$Connect_ID <- as.numeric(mensBU_data_ccc$Connect_ID)
prts_data_ccc$Connect_ID <- as.numeric(prts_data_ccc$Connect_ID)
#bio_data_ccc$Connect_ID <- as.numeric(bio_data_ccc$Connect_ID)

#mens <- merge(mensBUM_data_ccc, mensBU_data_ccc, by="Connect_ID")

menstrualBUM <- left_join(prts_data_ccc ,mensBUM_data_ccc, by="Connect_ID") 

menstrualBU <- left_join(prts_data_ccc ,mensBU_data_ccc, by="Connect_ID") 
```



```{r, echo=FALSE}

# table(menstrual$d_827220437)
# table(menstrual$d_265193023[menstrual$D_112151599==353358909])
# table(menstrual$d_253883960)
# table(menstrual$d_253883960[menstrual$D_112151599==353358909])
# table(menstrual$d_253883960)
# table(menstrual$D_112151599)



res_mens <- menstrualBUM %>%  filter( (d_827220437==531629870 | d_827220437==548392715 | d_827220437==303349821 | d_827220437==657167265 | d_827220437==809703864) &  (D_112151599=='353358909' &  d_265193023==231311385))    
 #dim(res_mens)
                                    
res_mens <- res_mens %>%  mutate(Site=case_when(d_827220437==531629870 ~ "HealthPartners",
                                                 d_827220437==548392715 ~ "Henry Ford ",
                                                 d_827220437==303349821 ~ "Marshfield ",
                                                 d_827220437==657167265 ~ "Sanford Health",
                                                 d_827220437==809703864 ~ "UChicago "),
                                 Status= case_when(d_459098666==972455046 ~ "Not Started",
                                                   d_459098666==615768760 ~ "Started",
                                                   d_459098666==231311385 ~ "Submitted"),
                                 Not_Started = case_when(d_459098666==972455046 ~ 1,
                                                         TRUE ~ 0),
                                 Started = case_when(d_459098666==615768760 ~ 1,
                                                         TRUE ~ 0),
                                 Submitted = case_when(d_459098666==231311385 ~ 1,
                                                         TRUE ~ 0))
                                 #Eligibilty = case_when((D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)) ~ 1,TRUE ~ 0))
#res_mens <- res_mens %>%  mutate(TotalC= sum(Not_Started, Started, Submitted))
#res_mens <- res_mens %>%  mutate(Response_Rate= (Submitted/TotalC))


  
clin_mens <- menstrualBU %>%  filter((d_827220437==125001209 | d_827220437==327912200 | d_827220437==300267574 | d_827220437==452412599) & (D_112151599=='353358909' & d_253883960==231311385))
 #dim(clin_mens)                                   
clin_mens <- clin_mens %>%  mutate(Site=case_when(d_827220437==125001209 ~ "Kaiser Permanente Colorado",
                                                 d_827220437==327912200 ~ "Kaiser Permanente Georgia",
                                                 d_827220437==300267574 ~ "Kaiser Permanente Hawaii",
                                                 d_827220437==452412599 ~ "Kaiser Permanente Northwest"),
                                 Status= case_when(d_459098666==972455046 ~ "Not Started",
                                                   d_459098666==615768760 ~ "Started",
                                                   d_459098666==231311385 ~ "Submitted"),
                                 Not_Started = case_when(d_459098666==972455046 ~ 1,
                                                         TRUE ~ 0),
                                 Started = case_when(d_459098666==615768760 ~ 1,
                                                         TRUE ~ 0),
                                 Submitted = case_when(d_459098666==231311385 ~ 1,
                                                         TRUE ~ 0))
                                 #Eligibilty = case_when((D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)) ~ 1,TRUE ~ 0))
#clin_mens <- clin_mens %>%  mutate(TotalC= sum(Not_Started, Started, Submitted))
#clin_mens <- clin_mens %>%  mutate(Response_Rate= (Submitted/TotalC))









RMens_summary <-res_mens %>%  group_by(Site)  %>% arrange(Site) %>%  summarize_at(c("Not_Started" , "Started" , "Submitted"), sum, na.rm = TRUE) 

RMens_summary$TotalC <- list(sum(RMens_summary$Started[1], RMens_summary$Not_Started[1], RMens_summary$Submitted[1]),  sum(RMens_summary$Started[2], RMens_summary$Not_Started[2], RMens_summary$Submitted[2]),  sum(RMens_summary$Started[3], RMens_summary$Not_Started[3], RMens_summary$Submitted[3]),  sum(RMens_summary$Started[4], RMens_summary$Not_Started[4], RMens_summary$Submitted[4]),  sum(RMens_summary$Started[5], RMens_summary$Not_Started[5], RMens_summary$Submitted[5]) )
RMens_summary$TotalC  <- as.numeric(RMens_summary$TotalC )


RMens_summ <- RMens_summary %>%  mutate(#Elg_Pct = round((Eligibilty/sum(Eligibilty))*100, digits=1),
                                           NS_Pct= paste0(Not_Started, " (", round((Not_Started/TotalC)*100, digits=1), "%)"),
                                           S_Pct= paste0(Started, " (", round((Started/TotalC)*100, digits=1), "%)"),
                                           Submitted_Pc= paste0(Submitted, " (", round((Submitted/TotalC)*100, digits=1), "%)"),
                                           Response_Rate_Pct= paste0(round((Submitted/TotalC)*100, digits=1), "%"))

 RMens_summ1 <- RMens_summ[, c(1,5, 6,7,8,9)]
# 
# 
# ## for now needing to manually add KP sites with blank data until clinical sites have eligible participants 
# RMens_summ1[6,] <- list("Kaiser Permanente Colorado", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[7,] <- list("Kaiser Permanente Georgia", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[8,] <- list("Kaiser Permanente Hawaii", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[9,] <- list("Kaiser Permanente Northwest", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# 
# 
# 
# #RMens_summ1[6,] <- list("Total", "100%", "100%", "100%", "100%", "100%")


RMens_summ1 %>%  gt(rowname_col = "row_lab") %>%  
  #fmt_number(columns = c("NS_Pct" , "S_Pct" , "Submitted_Pc", "Response_Rate_Pct"), decimals = 1) %>%
  fmt_number(columns = "TotalC", decimals = 0) %>%
  tab_header(title = html("Table 8a. Research Menstrual Cycle Survey Completeness \n and Response Rate by Site")) %>% 
  cols_label(NS_Pct = md("**Not Started**"), S_Pct = md("**Started**"), Submitted_Pc = md("**Submitted**"), TotalC = md("**Total Eligible**"), Response_Rate_Pct = md("**Response Rate**")) %>% 
  # summary_rows(
  #   #    groups= T,
  #   columns =  c(NS_Pct , S_Pct , Submitted_Pc,  TotalC, Response_Rate_Pct),
  #   fns= list(
  #     Total= ~sum(.)
  #   ), decimals=0) %>%
  # tab_style(
  #   style = list(
  #     cell_text(weight = "bold")
  #   ),
  #   locations = cells_body(
  #     columns = c( NS_Pct , S_Pct , Submitted_Pc, TotalC, Response_Rate_Pct),
  #   )
  # )  %>% 
  grand_summary_rows(columns=c(TotalC), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>  #NS_Pct , S_Pct , Submitted_Pc,  , Response_Rate_Pct
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  )
```




```{r, echo=FALSE}

CMens_summary <-clin_mens %>%  group_by(Site)  %>% arrange(Site) %>%  summarize_at(c("Not_Started" , "Started" , "Submitted"), sum, na.rm = TRUE) 

CMens_summary$TotalC <- list(sum(CMens_summary$Started[1], CMens_summary$Not_Started[1], CMens_summary$Submitted[1]),  sum(CMens_summary$Started[2], CMens_summary$Not_Started[2], CMens_summary$Submitted[2]),  sum(CMens_summary$Started[3], CMens_summary$Not_Started[3], CMens_summary$Submitted[3]),  sum(CMens_summary$Started[4], CMens_summary$Not_Started[4], CMens_summary$Submitted[4])) 
CMens_summary$TotalC  <- as.numeric(CMens_summary$TotalC )


CMens_summ <- CMens_summary %>%  mutate(#Elg_Pct = round((Eligibilty/sum(Eligibilty))*100, digits=1),
                                           NS_Pct= paste0(Not_Started, " (", round((Not_Started/TotalC)*100, digits=1), "%)"),
                                           S_Pct= paste0(Started, " (", round((Started/TotalC)*100, digits=1), "%)"),
                                           Submitted_Pc= paste0(Submitted, " (", round((Submitted/TotalC)*100, digits=1), "%)"),
                                           Response_Rate_Pct= paste0(round((Submitted/TotalC)*100, digits=1), "%"))

CMens_summ1 <- CMens_summ[, c(1,5, 6,7,8,9)]


CMens_summ1 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = c("NS_Pct" , "S_Pct" , "Submitted_Pc",  "Response_Rate_Pct"), decimals = 1) %>%
  fmt_number(columns = c("TotalC"), decimals = 0) %>%
  tab_header(title = html("Table 8b. Clinical Menstrual Cycle Survey Completness \n and Repsonse Rate by Site")) %>% 
  cols_label(NS_Pct = md("**Not Started**"), S_Pct = md("**Started**"), Submitted_Pc = md("**Submitted**"),  TotalC = md("**Total Eligible**"),Response_Rate_Pct = md("**Response Rate**")) %>% 
  # summary_rows(
  #       groups= F,
  #   columns =  c(NS_Pct , S_Pct , Submitted_Pc, TotalC, Response_Rate_Pct),
  #   fns= list(
  #     Total= ~sum(.)
  #   ), decimals=0) %>%
  # tab_style(
  #   style = list(
  #     cell_text(weight = "bold")
  #   ),
  #   locations = cells_body(
  #     columns = c(NS_Pct , S_Pct , Submitted_Pc, TotalC, Response_Rate_Pct),
  #   )
  # )  %>%
  grand_summary_rows(columns=c(TotalC), fns = ~sum(.,na.rm = T), formatter = fmt_number)|>  #NS_Pct , S_Pct , Submitted_Pc,  , Response_Rate_Pct
  tab_style(
    style= list(
      cell_text(
        align="center"
      )
    ),
    locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
  )



```















```{r, echo=FALSE}


# res_mens <- menstrual %>%  filter((d_827220437==531629870 | d_827220437==548392715 | d_827220437==303349821 | d_827220437==657167265 | d_827220437==809703864) & 
#                                     (D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)))
# res_mens <- res_mens %>%  mutate(Site=case_when(d_827220437==531629870 ~ "HealthPartners",
#                                                  d_827220437==548392715 ~ "Henry Ford Health System",
#                                                  d_827220437==303349821 ~ "Marshfield Clinical Health System",
#                                                  d_827220437==657167265 ~ "Sanford Health",
#                                                  d_827220437==809703864 ~ "University of Chicago Medicine"),
#                                  Status= case_when(d_459098666==972455046 ~ "Not Started",
#                                                    d_459098666==615768760 ~ "Started",
#                                                    d_459098666==231311385 ~ "Submitted"),
#                                  Not_Started = case_when(d_459098666==972455046 ~ 1,
#                                                          TRUE ~ 0),
#                                  Started = case_when(d_459098666==615768760 ~ 1,
#                                                          TRUE ~ 0),
#                                  Submitted = case_when(d_459098666==231311385 ~ 1,
#                                                          TRUE ~ 0))
#                                  #Eligibilty = case_when((D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)) ~ 1,TRUE ~ 0))
# #res_mens <- res_mens %>%  mutate(TotalC= sum(Not_Started, Started, Submitted))
# #res_mens <- res_mens %>%  mutate(Response_Rate= (Submitted/TotalC))
# 
# 
#   
# clin_mens <- menstrual %>%  filter((d_827220437==125001209 | d_827220437==327912200 | d_827220437==300267574 | d_827220437==452412599) & 
#   (D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)))
# clin_mens <- clin_mens %>%  mutate(Site=case_when(d_827220437==125001209 ~ "Kaiser Permanente Colorado",
#                                                  d_827220437==327912200 ~ "Kaiser Permanente Georgia",
#                                                  d_827220437==300267574 ~ "Kaiser Permanente Hawaii",
#                                                  d_827220437==452412599 ~ "Kaiser Permanente Northwest"),
#                                  Status= case_when(d_459098666==972455046 ~ "Not Started",
#                                                    d_459098666==615768760 ~ "Started",
#                                                    d_459098666==231311385 ~ "Submitted"),
#                                  Not_Started = case_when(d_459098666==972455046 ~ 1,
#                                                          TRUE ~ 0),
#                                  Started = case_when(d_459098666==615768760 ~ 1,
#                                                          TRUE ~ 0),
#                                  Submitted = case_when(d_459098666==231311385 ~ 1,
#                                                          TRUE ~ 0))
#                                  #Eligibilty = case_when((D_112151599=='353358909' & (d_265193023==231311385| d_253883960==231311385)) ~ 1,TRUE ~ 0))
# #clin_mens <- clin_mens %>%  mutate(TotalC= sum(Not_Started, Started, Submitted))
# #clin_mens <- clin_mens %>%  mutate(Response_Rate= (Submitted/TotalC))
# 
# 
# 
# 
# 
# 
# 
# 
# 
# RMens_summary <-res_mens %>%  group_by(Site)  %>% arrange(Site) %>%  summarize_at(c("Not_Started" , "Started" , "Submitted"), sum, na.rm = TRUE) 
# 
# RMens_summary$TotalC <- list(sum(RMens_summary$Started[1], RMens_summary$Not_Started[1], RMens_summary$Submitted[1]),  sum(RMens_summary$Started[2], RMens_summary$Not_Started[2], RMens_summary$Submitted[2]),  sum(RMens_summary$Started[3], RMens_summary$Not_Started[3], RMens_summary$Submitted[3]),  sum(RMens_summary$Started[4], RMens_summary$Not_Started[4], RMens_summary$Submitted[4]),  sum(RMens_summary$Started[5], RMens_summary$Not_Started[5], RMens_summary$Submitted[5]) )
# RMens_summary$TotalC  <- as.numeric(RMens_summary$TotalC )
# 
# 
# RMens_summ <- RMens_summary %>%  mutate(#Elg_Pct = round((Eligibilty/sum(Eligibilty))*100, digits=1),
#                                            NS_Pct= paste0(Not_Started, " (", round((Not_Started/TotalC)*100, digits=1), "%)"),
#                                            S_Pct= paste0(Started, " (", round((Started/TotalC)*100, digits=1), "%)"),
#                                            Submitted_Pc= paste0(Submitted, " (", round((Submitted/TotalC)*100, digits=1), "%)"),
#                                            Response_Rate_Pct= paste0(round((Submitted/TotalC)*100, digits=1), "%"))
# 
# 
# RMens_summ1 <- RMens_summ[, c(1, 6,7,8,5,9)]
# 
# 
# if(dim(clin_mens)[[1]]==0){
# ## for now needing to manually add KP sites with blank data until clinical sites have eligible participants 
# RMens_summ1[6,] <- list("Kaiser Permanente Colorado", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[7,] <- list("Kaiser Permanente Georgia", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[8,] <- list("Kaiser Permanente Hawaii", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")
# RMens_summ1[9,] <- list("Kaiser Permanente Northwest", "0 (0%)", "0 (0%)", "0 (0%)", 0, "0%")}
# 
# if(dim(clin_mens)[[1]]!=0){cat("KP must be added")}
# 
# 
# 
# #RMens_summ1[6,] <- list("Total", "100%", "100%", "100%", "100%", "100%")
# 
# RMens_summ1 %>%  gt() %>%  
#   #fmt_number(columns = c("NS_Pct" , "S_Pct" , "Submitted_Pc", "Response_Rate_Pct"), decimals = 1) %>%
#   tab_header(title = html("Menstrual Cycle Survey Completeness \n and Response Rate by Site")) %>% 
#   cols_label(NS_Pct = md("**Not Started**"), S_Pct = md("**Started**"), Submitted_Pc = md("**Submitted**"), TotalC = md("**Total Eligible**"), Response_Rate_Pct = md("**Response Rate**")) %>% 
#   #   summary_rows(     groups= FALSE,
#   #   #    groups= T,
#   #   columns =  c(NS_Pct , S_Pct , Submitted_Pc,  TotalC, Response_Rate_Pct),
#   #   fns= list(
#   #     Total= ~sum(.)
#   #   ), decimals=0) %>%
#   # tab_style(
#   #   style = list(
#   #     cell_text(weight = "bold")
#   #   ),
#   #   locations = cells_body(
#   #     columns = c( NS_Pct , S_Pct , Submitted_Pc, TotalC, Response_Rate_Pct),
#   #   )
#   # )  %>% 
#   tab_style(
#     style= list(
#       cell_text(
#         align="center"
#       )
#     ),
#     locations= cells_column_labels(columns=everything())  #<---- how to make all figures centered?
#   )
```
