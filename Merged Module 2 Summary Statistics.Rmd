---
title: "Merged Module 2 Summary Statistics"
author: "Kelsey Dowling"
date: "`r Sys.Date()`"
output: pdf_document
---

This report analysis the responses of all Module 2 questions and visualizes the distributions of answers (ex: age at diagnosis)
All libraries are listed up top; authentication for BQ will be necessary
Functions used included before the start of the analysis 

```{r, include=FALSE}
#rm(list = ls())


#update.packages("tinytex")
#require(devtools)
#install_version("ggplot2", version = "0.9.1", repos = "http://cran.us.r-project.org")
#tinytex::install_tinytex(version = "2020.10")
#tinytex::reinstall_tinytex(repository = "illinois")



library(bigrquery)
library(foreach)
library(stringr)
#library(plyr)
#library(expss) ###to add labels
library(epiDisplay) ##recommended applied here crosstable, tab1
library(gmodels) ##recommended
library(magrittr)
library(arsenal)
library(gtsummary)
library(rio)



library(ggplot2)
library(gridExtra)
library(scales)
library(gt)
#install(tinytex)
library(tinytex)
library(data.table) ###to write or read and data management 
# library(boxr) ###read or write data from/to box
library(tidyverse) ###for data management
library(dplyr) ###data management
library(reshape)  ###to work on transition from long to wide or wide to long data
library(listr) ###to work on a list of vector, files or..
library(sqldf) ##sql
library(lubridate) ###date time
library(stringr) ###to work on patterns, characters

options(tinytex.verbose = TRUE)

bq_auth()
```


```{r, include=FALSE, warning=FALSE}

dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')

dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")

project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" ##project and billing should be consistent
##517311251 Date/time Status of Completion of Background and Overall Health                         SrvBOH_TmComplete_v1r0
##949302066 Flag for Baseline Module Background and Overall Health                        SrvBOH_BaseStatus_v1r0
recr_M1 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379,
                            d_949302066 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935'")
recr_m1 <- bq_table_download(recr_M1,bigint = "integer64")
cnames <- names(recr_m1)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m1,varname)
  recr_m1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

sql_M1_1 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v1_JP` where Connect_ID is not null")
sql_M1_2 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v2_JP` where Connect_ID is not null")


M1_V1 <- bq_table_download(sql_M1_1,bigint = "integer64") #1436 #1436 vars: 1507 01112023 
M1_V2 <- bq_table_download(sql_M1_2,bigint = "integer64") #2333 #3033 01112023 var:1531 #6339 obs 1893 vars 05022023

mod1_v1 <- M1_V1
cnames <- names(M1_V1)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v1,varname)
  mod1_v1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}
mod1_v2 <- M1_V2
cnames <- names(M1_V2)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v2,varname)
  mod1_v2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

M1_V1.var <- colnames(M1_V1)
M1_V2.var <- colnames(M1_V2)
var.matched <- M1_V1.var[which(M1_V1.var %in% M1_V2.var)]
length(var.matched)  #1275 #1278 vars 01112023 #1348 vars 05022023

V1_only_vars <- colnames(M1_V1)[colnames(M1_V1) %nin% var.matched] #232 #229 01112023 #159 05022023
V2_only_vars <- colnames(M1_V2)[colnames(M1_V2) %nin% var.matched] #253 #253 01112023 #545 05022023

length(M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID])
#[1] 59 with the completion of two versions of Module1 
#[1] 62 with completing both versions of M1 ###double checked 03/28/2023
#68 double checked 05/02/2023

common.IDs <- M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID]
M1_V1_common <- mod1_v1[,var.matched]

M1_V2_common <- mod1_v2[,var.matched]
M1_V1_common$version <- 1
M1_V2_common$version <- 2

##to check the completion of M1 among these duplicates
partM1_dups <- recr_m1[which(recr_m1$Connect_ID %in% common.IDs),]
table(partM1_dups$d_949302066)

M1_common  <- rbind(M1_V1_common, M1_V2_common) #including 136 duplicates (version 1 and version 2) from 68 participants 05022023
#M1_response <- matrix(data=NA, nrow=118, ncol=967)

m1_v1_only <- mod1_v1[,c("Connect_ID", V1_only_vars)] #230 vars 03282023 #160 vars 05/02/2023
m1_v2_only <- mod1_v2[,c("Connect_ID", V2_only_vars)] #255 vars 03282023 #546 vars 05/02/2023
m1_v1_only$version <- 1
m1_v2_only$version <- 2
#for (i in 1:length)
##to check the completion in each version
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v1_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #1364 03282023 # 1370 05022023
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v2_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #4870 03282023 # 5731 05022023

#library(janitor)

m1_common <- rbind(M1_V1_common,M1_V2_common)
m1_common_v1 <- base::merge(m1_common, m1_v1_only, by=c("Connect_ID","version"),all.x=TRUE)
m1_combined_v1v2 <- base::merge(m1_common_v1,m1_v2_only,by=c("Connect_ID","version"),all.x=TRUE)
m1_complete <- m1_combined_v1v2[which(m1_combined_v1v2$Connect_ID %in% recr_m1$Connect_ID[which(recr_m1$d_949302066 ==231311385 )]),] #7289 including duplicates 05022023

m1_complete <- m1_complete %>% arrange(desc(version)) 


m1_complete_nodup <- m1_complete[!duplicated(m1_complete$Connect_ID),] 
table(m1_complete_nodup$version)




parts <- "SELECT Connect_ID, token, D_512820379, D_471593703, state_d_934298480, D_230663853,
D_335767902, D_982402227, D_919254129, D_699625233, D_564964481, D_795827569, D_544150384,
D_371067537, D_430551721, D_821247024, D_914594314,  state_d_725929722, d_126331570, d_536735468, 
d_663265240, d_878865966, d_684635302, d_167958071,
d_949302066 , D_517311251, D_205553981, D_117249500, d_976570371, d_914639140, d_311580100 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` 
where Connect_ID IS NOT NULL"
parts_table <- bq_project_query(project, parts)
parts_data <- bq_table_download(parts_table, bigint = "integer64")

parts_data$Connect_ID <- as.numeric(parts_data$Connect_ID)


merged= left_join(m1_complete_nodup, parts_data, by="Connect_ID") #%>%  left_join(m3_data, by="Connect_ID")
dim(merged)



```

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Has a recruitment flag
merged <- merged %>% filter(D_512820379==486306141 | D_512820379==854703046)


#User consent submitted
merged <- merged %>% filter(D_919254129==353358909)


#User profile submitted
merged <- merged %>% filter(D_699625233==353358909)


#Verified by site
#cat("Verified by site:", sum(merged$D_821247024==197316935, na.rm=TRUE))
merged <- merged %>% filter(D_821247024==197316935)


#Mod1 completed 
base_vars <- merged %>% filter(d_949302066==231311385) # & d_976570371==231311385 & d_536735468==231311385 & d_663265240 ==231311385)
#cat("Module 1 completed:", dim(base_vars)[[1]])


data_tib_base <- as_tibble(base_vars)

data_tib_merged <- as_tibble(merged)
#dim(base_vars)

knitr::opts_chunk$set(comment = NA)

```



```{r, warning=FALSE, include=FALSE}

#Histogram 
hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  data_tib_base %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}



#Boxplot
boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  data_tib_base %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)+
    theme(axis.text.y=element_blank(),  #remove y axis labels
        axis.ticks.y=element_blank()  #remove y axis ticks
        )
}



##GT TABLE: Questions that all participants asked, update dictionary as new answer options come up
dict <- list("104430631"="No", "353358909"="Yes", "589959753"="A little shorter", "623310018"="A lot shorter", "978204320"= "Grade School(Grades 1-8)", "935502060"="Some High School, No Diploma", "404564707"= "High School Graduate or GED", "432193665"="Some College, No Degree", "890756124"="Technical or Trade School After High School", "766964355"="Associate's Degree", "875342283"="Bachelor's Degree", "598242454"="Advanced Degree", "709650750"="Biological Child", "810290359"="Adopted Child", "509607548"="Step Child","784922042"="Related to me in some other way", "288105839"=" Yes, fraternal twins", "626558982"="Yes, triplets or higher multiple birth", "178420302"="Do not Know", "536341288"="Female", "576796184"="Intersex or Other", "654207589"="Male","555374628"="Full Sibling", "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", "274062548"="More than 3 months ago", "958538953"="In the past 3 months", "317567178"="In the past month", "484055234"="In the past year",  "802197176"="More than 1 year ago", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago","958538953"="In the past 3 months",  "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible", "764708931"="Very flexible","0"="No", "1"="Yes", "536341288"="Female", "218837028"="Woman (New Response)", "983318667"="Man (New Response)"  , "654207589"="Male","746038746"="Declined", "805712793"="Genderqueer","486192236"="Non-Binary", "807835037"="Other","873138103"="Transgender Woman","405267600"="Transgender Man", "220083334"="Very Feminine","541300533"="Mostly Feminine","878286618"="Somewhat Feminine","910745276"="Equally feminine and masculine","915528806"="Very masculine","265452386"="Mostly Masculine","510148951"="Somewhat Masculine","271882746"="Heterosexual", "903084185"="Homosexual", "999994434"="Bisexual")




```












```{r, include=FALSE}

library(data.table)

######## Merge Version 1 and Version 2 of Module 2 ##############

dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')

dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")

project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" ##project and billing should be consistent
##517311251 Date/time Status of Completion of Background and Overall Health                         SrvBOH_TmComplete_v1r0
##949302066 Flag for Baseline Module Background and Overall Health                        SrvBOH_BaseStatus_v1r0
recr_m2 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379, 
                            d_536735468 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935'")
recr_m2 <- bq_table_download(recr_m2,bigint = "integer64")
cnames <- names(recr_m2)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m2,varname)
  recr_m2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

sql_m2_1 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v1_JP` where Connect_ID is not null")
sql_m2_2 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v2_JP` where Connect_ID is not null")


M2_V1 <- bq_table_download(sql_m2_1,bigint = "integer64") #1436 #1436 vars: 1507 01112023 
M2_V2 <- bq_table_download(sql_m2_2,bigint = "integer64") #2333 #3033 01112023 var:1531 #6339 obs 1893 vars 05022023

mod2_v1 <- M2_V1
cnames <- names(M2_V1)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod2_v1,varname)
  mod2_v1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}
mod2_v2 <- M2_V2
cnames <- names(M2_V2)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod2_v2,varname)
  mod2_v2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

M2_V1.var <- colnames(M2_V1)
M2_V2.var <- colnames(M2_V2)
var.matched <- M2_V1.var[which(M2_V1.var %in% M2_V2.var)]
length(var.matched)  #1275 #1278 vars 01112023 #1348 vars 05022023

V1_only_vars <- colnames(M2_V1)[colnames(M2_V1) %nin% var.matched] #232 #229 01112023 #159 05022023
V2_only_vars <- colnames(M2_V2)[colnames(M2_V2) %nin% var.matched] #253 #253 01112023 #545 05022023

length(M2_V1$Connect_ID[M2_V1$Connect_ID %in% M2_V2$Connect_ID])
#[1] 59 with the completion of two versions of module2 
#[1] 62 with completing both versions of M1 ###double checked 03/28/2023
#68 double checked 05/02/2023

common.IDs <- M2_V1$Connect_ID[M2_V1$Connect_ID %in% M2_V2$Connect_ID]
M2_V1_common <- mod2_v1[,var.matched]

M2_V2_common <- mod2_v2[,var.matched]
M2_V1_common$version <- 1
M2_V2_common$version <- 2

##to check the completion of M1 among these duplicates
partM2_dups <- recr_m2[which(recr_m2$Connect_ID %in% common.IDs),]
table(partM2_dups$d_536735468)

M2_common  <- rbind(M2_V1_common, M2_V2_common) #including 136 duplicates (version 1 and version 2) from 68 participants 05022023
#M2_response <- matrix(data=NA, nrow=118, ncol=967)

M2_v1_only <- mod2_v1[,c("Connect_ID", V1_only_vars)] #230 vars 03282023 #160 vars 05/02/2023
M2_v2_only <- mod2_v2[,c("Connect_ID", V2_only_vars)] #255 vars 03282023 #546 vars 05/02/2023
M2_v1_only$version <- 1
M2_v2_only$version <- 2
#for (i in 1:length)
##to check the completion in each version
length(recr_m2$Connect_ID[which(recr_m2$Connect_ID %in% M2_v1_only$Connect_ID & recr_m2$d_536735468 ==231311385)]) #1364 03282023 # 1370 05022023
length(recr_m2$Connect_ID[which(recr_m2$Connect_ID %in% M2_v2_only$Connect_ID & recr_m2$d_536735468 ==231311385)]) #4870 03282023 # 5731 05022023

#library(janitor)

M2_common <- rbind(M2_V1_common,M2_V2_common)
M2_common_v1 <- base::merge(M2_common, M2_v1_only, by=c("Connect_ID","version"),all.x=TRUE)
M2_combined_v1v2 <- base::merge(M2_common_v1,M2_v2_only,by=c("Connect_ID","version"),all.x=TRUE)
M2_complete <- M2_combined_v1v2[which(M2_combined_v1v2$Connect_ID %in% recr_m2$Connect_ID[which(recr_m2$d_536735468 ==231311385 )]),] #7289 including duplicates 05022023

M2_complete <- M2_complete %>% arrange(desc(version)) 


M2_complete_nodup <- M2_complete[!duplicated(M2_complete$Connect_ID),] 
table(M2_complete_nodup$version)


M2_complete_nodup$Connect_ID <- as.numeric(M2_complete_nodup$Connect_ID)


merge_m2= left_join(merged, M2_complete_nodup, by="Connect_ID") #%>%  left_join(m3_data, by="Connect_ID")

```

```{r, warning=FALSE, echo=FALSE,  message=FALSE, collapse=TRUE}



#Mod1 completed
module2 <- merge_m2 %>% filter(d_949302066==231311385)
#cat("Module 1 completed:", dim(module2)[[1]])

#Mod2 completed
module2 <- module2 %>% filter(d_536735468==231311385)
cat("Module 2 Completed:", dim(module2)[[1]])

data_tib_m2 <- as_tibble(module2)
``` 


```{r, warning=FALSE, echo=FALSE,  message=FALSE, include=FALSE}

hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>% 
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) + 
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}



#Histogram for female at birth only questions
hist_funct_F <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% mutate(!!CID_SYM:=as.numeric(as.character(!!CID_SYM))) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+   ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}

hist_funct_D <- function(CID,Title, Xlab, Ylab) {
  #CID_SYM <- rlang::ensym(CID)
  module2 %>% ggplot(aes(x=CID))+ #, fill=as.factor(D_407056417)
    xlab(Xlab) + ylab(Ylab) + geom_histogram(binwidth = 0.5)+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(CID, na.rm=T)), colour="red", linetype="solid")
  
}



dict <- list(dict, "353358909"="Yes", "104430631"="No",  "178420302"="Do not Know", "536341288"="Female", "654207589"="Male","555374628"="Full Sibling", 
             "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", 
             "274062548"="More than 3 months ago", "958538953"="In the past 3 months",  "317567178"="In the past month", "484055234"="In the past year", 
             "802197176"="More than 1 year ago", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago",
             "958538953"="In the past 3 months", "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible",
             "764708931"="Very flexible", "211590917"="Often", "132099255"="Sometimes", "746038746"="Declined", "239152340"="Once a month or Less", "582006876"="2-3 days/month",
             "645894551"= "1-2 days/week","647504893"="Every day", "671267928"="5-6 days/week","996315715"= "3-4 days/week", "206020811"="31-44 min.", "248303092"="16-30 min.",
             "264163865"= "45-59 min.","428999623"= "0-15 min.","628177728"="2 hrs", "638092100"="1 hr","805918496"= "3+ hrs", "223216393"="Single Live Infant", "628445697"="Multiple Live Infants",
             "419220239"="Still birth","306890578"="Live Birth and Still Birth","858244199"="Miscariage","434041171"="Termination", "550615107"="Ectopic or tubal pregnancy", "201002865"="9+ hours",
             "258023209"="45 min.","464753847"="0-29 min.","503218834"="None","729681071"= "30 min.","755558825"= "5-6 hrs","919739344"= "3-4 hrs","949555271"= "7-8 hrs", "349122068"="1 Day per Week",
             "156095877"="2 Days per Week", "162668459"="3 Days per Week", "278139969"="4 Days per Week", "676824724"="5 Days per Week", "512144428"="6 Days per Week", "125674414"="7 Days per Week",
             "270994579"="5+ days/week", "284343405"="3-4 days/week","525779785"= "Less than Once/Week","565036180"= "1-2 days/week", "514068832"="No Chance","747099514"="Moderate chance",
             "774439579"= "Slight Chance","977681388"= "High Chance", "303095574"="Sound and Restful", "462478011"="Very Sound and Restful", "522143286"= "Restless","621370621"= "Very Restless",
             "838403733"= "Average Quality", "137254299"="As Loud as Talking","178420302"="Unknown","624808470"="Slightly Louder than Breathing","954318357"="Louder than Talking",
             "198347104"="1-2 times per week","471294296"="3-4 times per week","520089841"="0-1 times per month","632512449"="1-2 times per month","648960871"="Never","718687985"="Almost Every Day",
             "200323667"="In the past yes","249673703"="Currently yes", "310201523"="100 Units per ml", "290716491"="500 unit per ml")


#GT table for questions asked to all (no skip logic)
simple_funct2 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_m2 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt()  %>%  
    fmt_number(columns = "percentage", decimals = 2) %>% 
    tab_header(title = md(Title)) %>% 
    cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%  
    # summary_rows(
    #   columns = c(n,percentage),    
    #   fns= list(
    #     Sum= ~sum(.)
    #   ), decimals=0) %>%
    tab_options(
      stub.font.weight = "bold"
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold")
      ),
      locations = cells_body(
        columns = answer,
      )
    ) #%>% opt_row_striping()
}


#Error in `dplyr::mutate()`:
# ! Problem while computing `answer = recode(...)`.
# Caused by error in `FUN()`:
# ! 'recode': all recodings should be formula but: "(Whatever is the first entry into the dict)"
# Run `rlang::last_error()` to see where the error occurred.




#GT table with one filter/skip logic
one_logic_funct <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_m2 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt()  %>%  
    fmt_number(columns = "percentage", decimals = 2) %>% 
    tab_header(title = md(Title)) %>% 
    cols_label(n= md("**Number of Participants**"),  answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows(
    #   column = c(n,percentage),
    #   fns= list(
    #     Sum= ~sum(.)
    #   ), decimals=0) %>%
    tab_options(
      stub.font.weight = "bold"
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold")
      ),
      locations = cells_body(
        columns = answer,
      )
    ) %>% opt_row_striping()
}


#Bar-- attemting to replace failing histograms 
bar_rplc_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% filter(!is.na(!!CID_SYM)) %>% mutate(as.numeric(as.character(!!CID_SYM))) %>%  
    ggplot(aes(x=!!CID_SYM))+ ylab(Ylab) + xlab(Xlab) +
    geom_bar()+  ggtitle(Title)
}


bar_rplc_funct_F <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% filter(!is.na(!!CID_SYM)) %>% 
    ggplot(aes(x=!!CID_SYM))+ ylab(Ylab) + xlab(Xlab) +
    geom_bar()+  ggtitle(Title)
}


#Boxplot for female at birth only questions
boxp_funct_F <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)+
    scale_y_continuous(labels = scales::number_format(accuracy = 0.01))
}

``` 


\newpage

# Section 1: Medications
### All Pain Medication
```{r, include=FALSE}

mds= data_tib_m2 %>%  mutate(medications= case_when( D_399982309_D_469512398==1 ~ "Baby Aspirin",
                                                       D_399982309_D_194424439==1 ~ "Regular Aspirin",
                                                       D_399982309_D_422188606==1 ~ "Ibuprofen",
                                                       D_399982309_D_555555502==1 ~ "Acetaminophen",
                                                       D_399982309_D_800410166==1 ~ "Naproxen",
                                                       D_399982309_D_221645137==1 ~ "Celebrex",
                                                       D_399982309_D_974248369==1 ~ "Prescription pain relievers",
                                                       D_399982309_D_535003378==1 ~ "None",
                                                       TRUE  ~ "Skipped this question"))


pain_medications_summary <- mds %>% group_by(medications) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(medications, n, percentage)


# pain_medications_summary %>%  gt() %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>%
#   fmt_number(columns = "n", decimals = 0) %>%
#   tab_header(title = md("Pain Relievers Used 4x a Month for 6+ Months")) %>% 
#   cols_label(n= md("**Number of Participants**"), medications = md("**Product**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = medications,
#     )
#   ) %>% opt_row_striping()


painmeds<- data_tib_m2[, grepl("399982309", colnames(data_tib_m2))]
painmds <- painmeds[, c(4, 1, 3, 6, 7, 2, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Baby Aspirin","Regular Aspirin","Ibuprofen","Acetaminophen", "Naproxen", "Celebrex","Prescription pain relievers","None")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
mgr1 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(mds$medications=="Skipped this question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_m2)[[1]])*100,2))


dt_mgr1 <- mgr1 %>%  gt() %>%  
  tab_header(title = md("PAINREL1: Pain Relievers Used 4x a Month for 6+ Months")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```





## Pain Medications

### Baby Aspirin 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken 4x 6months+
#simple_funct(D_399982309_D_469512398, "PAINREL1: Ever used Baby aspirin 4x/month for 6+ Months")


#How often
#hist_funct(D_861838892_D_765748316, "PAINREL2: Days per Week Baby aspirin Taken", "Days", "Frequency")
bar_rplc_funct(D_861838892_D_765748316, "PAINREL2_1: Days per Week Baby aspirin Taken", "Days", "Frequency")

hist_funct(D_861838892_D_785412329, "PAINREL2_1: Days per Month Baby aspirin Taken", "Days", "Frequency")


#Pills per day baby aspirin
hist_funct(D_596961796_D_101310722, "PAINREL3: Pills per Day of Baby aspirin", "Pills", "Frequency")
  #later to be filtered by age range as well 

  #Pills per day: Don't know
#one_logic_funct(D_596961796_D_596961796, D_399982309_D_469512398, 1, "PAINREL3_1: Baby Aspirin Pills Per Day")
# 
# PAINREL3_1= data_tib_m2  %>%   filter(D_399982309_D_469512398==1)
# 
# bby_asp= PAINREL3_1 %>%  mutate(reasons= case_when(is.na(D_596961796_D_101310722) ~ "Answered with Age",
#                                              D_596961796_D_596961796=="[178420302]" ~ "Don't Know",
#                                              TRUE~ "Skipped this question"))
# bby_asp$reasons <- factor(bby_asp$reasons,levels=c("Answered with Age","Don't Know", "Skipped this question"))
# bby_asp <- bby_asp[c(2,3),]
# 
# PAINREL3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)
# 
# PAINREL3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("PAINREL3_1: Baby Aspirin Pills Per Day")) %>% 
#   cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#     grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = reasons,
#     )
#   ) %>% opt_row_striping()

#Yrs taken regular aspirin
hist_funct(D_113681507, "PAINREL4_1: Years of taking Regular aspirin", "Years", "Frequency")

#Last time taken baby aspirin
#one_logic_funct(D_177526169, D_399982309_D_469512398, 1, "PAINREL5_1: Last time baby aspirin was taken")
PAINREL5_1= data_tib_m2  %>%   filter(D_399982309_D_469512398==1)

bby_asp= PAINREL5_1 %>%  mutate(reasons= case_when(D_177526169==317567178 ~ "In the past month",
                                             D_177526169==484055234 ~ "More than a month, less than a year",
                                             D_177526169==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))
bby_asp$reasons <- factor(bby_asp$reasons,levels=c("In the past month","More than a month, less than a year","More than 1 year", "Skipped this question"))


PAINREL5_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_1: Last time baby aspirin was taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken   
hist_funct(D_564374538, "PAINREL6_1: Years Ago Baby aspirin Last Taken", "Years", "Frequency")



```


```{r, include=FALSE}

#Reasons taken
dt_reasons_P1= data_tib_m2  %>%   filter(D_399982309_D_469512398==1)

bby_asp= dt_reasons_P1 %>%  mutate(reasons= case_when(D_643807999_D_323106499==1 ~ "Arthritis",
                                             D_643807999_D_769901710==1 ~ "Back Pain",
                                             D_643807999_D_727773491==1 ~ "Menstrual Pain",
                                             D_643807999_D_283652434==1 ~ "Disease Prevention",
                                             D_643807999_D_243596698==1 ~ "Headaches",
                                             D_643807999_D_191656389==1 ~ "Illness or Fever",
                                             D_643807999_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_643807999_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P1[, grepl("643807999", colnames(dt_reasons_P1))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_1 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(bby_asp$reasons=="Skipped this question")[2])
pain7_1[as.numeric(dim(pain7_1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P1)[[1]])*100,2))


dt_pain7_1 <- pain7_1 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_1: Reasons for taking baby aspirin regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)


```

### Regular Aspirin
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##regular aspirin  
#Ever taken 4x 6months+
#simple_funct(D_399982309_D_194424439, "PAINREL1_2: Ever used Regular aspirin 4x/month for 6+ Months")


#How often taken
bar_rplc_funct(D_837412550_D_765748316, "PAINREL2_2: Days per Week of Regular aspirin", "Days", "Frequency") 

hist_funct(D_837412550_D_785412329, "PAINREL2_2: Days per Month of Regular aspirin", "Days", "Frequency")

#Pills per day regular aspirin
hist_funct(D_825189914_D_101310722, "PAINREL3_2: Pills per Day of Regular Aspirin", "Pills", "Frequency")

  #Pills per day: Don't know 
#one_logic_funct(D_825189914_D_825189914, D_399982309_D_194424439, 1, "PAINREL3_2: Regular Aspirin Pills Per Day")



#Yrs taken regular aspirin
hist_funct(D_615979584, "PAINREL4_2: Years of taking Regular aspirin", "Years", "Frequency")


#Last time taken regular aspirin
#one_logic_funct(D_814141708, D_399982309_D_194424439, 1, "PAINREL5_2: Last Time Regular aspirin Taken")
PAINREL5_2= data_tib_m2  %>%   filter(D_399982309_D_194424439==1)

bby_asp= PAINREL5_2 %>%  mutate(reasons= case_when(D_814141708==317567178 ~ "In the past month",
                                             D_814141708==484055234 ~ "More than a month, less than a year",
                                             D_814141708==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_2: Last Time Regular aspirin Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken
hist_funct(D_265428345, "PAINREL6_2: Years Ago Regular aspirin Last Taken", "Years", "Frequency")

#Reasons Taken
dt_reasons_P2= data_tib_m2 %>%  filter(D_399982309_D_194424439==1) 

reg_asp= dt_reasons_P2 %>%  mutate(reasons= case_when(D_275143071_D_323106499==1 ~ "Arthritis",
                                             D_275143071_D_769901710==1 ~ "Back Pain",
                                             D_275143071_D_727773491==1 ~ "Menstrual Pain",
                                             D_275143071_D_283652434==1 ~ "Disease Prevention",
                                             D_275143071_D_243596698==1 ~ "Headaches",
                                             D_275143071_D_191656389==1 ~ "Illness or Fever",
                                             D_275143071_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_275143071_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))



dt_reasons_P2_summary <- reg_asp %>% group_by(reasons) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

dt_reasons_P2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_2: Reasons for taking regular aspirin regularly")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


```

```{r, include=FALSE}

#Reasons taken
dt_reasons_P2= data_tib_m2 %>%  filter(D_399982309_D_194424439==1) 

reg_asp= dt_reasons_P2 %>%  filter(D_399982309_D_194424439==1) %>%  mutate(reasons= case_when(D_275143071_D_323106499==1 ~ "Arthritis",
                                             D_275143071_D_769901710==1 ~ "Back Pain",
                                             D_275143071_D_727773491==1 ~ "Menstrual Pain",
                                             D_275143071_D_283652434==1 ~ "Disease Prevention",
                                             D_275143071_D_243596698==1 ~ "Headaches",
                                             D_275143071_D_191656389==1 ~ "Illness or Fever",
                                             D_275143071_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_275143071_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P2[, grepl("275143071", colnames(dt_reasons_P2))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_2 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(reg_asp$reasons=="Skipped this question")[2])
pain7_2[as.numeric(dim(pain7_2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P2)[[1]])*100,2))


dt_pain7_2 <- pain7_2 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_2: Reasons for taking regular aspirin regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```

### Ibuprofen
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##ibuprofen 
#simple_funct(D_399982309_D_422188606, "PAINREL1_3: Ever used Ibuprofen 4x/month for 6+ Months")


#How often taken
bar_rplc_funct(D_388804810_D_765748316, "PAINREL2_3: Days per Week Ibuprofen Taken", "Days", "Frequency")

hist_funct(D_388804810_D_785412329, "PAINREL2_3: Days per Month Ibuprofen Taken", "Days", "Frequency")


#Pills per day ibuprofen 
module2$D_753416375_D_101310722 <- round(as.numeric(module2$D_753416375_D_101310722), digits=0)
hist_funct(D_753416375_D_101310722, "PAINREL3_3: Pills per Day of Ibuprofen", "Pills", "Frequency")

  #Pills per day: Don't know
#one_logic_funct(D_753416375_D_753416375, D_399982309_D_422188606, 1, "PAINREL3_3: Ibuprofen Pills Per Day")


#Yrs taken ibuprofen 
hist_funct(D_771526486 , "PAINREL4_3: Years of taking Ibuprofen", "Years", "Frequency")

#Last time taken ibuprofen
#one_logic_funct(D_292658699, D_399982309_D_422188606, 1, "PAINREL5_3: Last Time Ibuprofen Taken")
PAINREL5_3= data_tib_m2  %>%   filter(D_399982309_D_422188606==1)

bby_asp= PAINREL5_3 %>%  mutate(reasons= case_when(D_292658699==317567178 ~ "In the past month",
                                             D_292658699==484055234 ~ "More than a month, less than a year",
                                             D_292658699==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_3_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_3: Last Time Ibuprofen Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken
hist_funct(D_491549803 , "PAINREL6_3: Years Ago Ibuprofen Last Taken", "Years", "Frequency")



```

```{r, include=FALSE}

#Reasons taken
dt_reasons_P3= data_tib_m2  %>%  filter(D_399982309_D_422188606==1) 


ibu= dt_reasons_P3 %>%  mutate(reasons= case_when(D_152138929_D_323106499==1 ~ "Arthritis",
                                             D_152138929_D_769901710==1 ~ "Back Pain",
                                             D_152138929_D_727773491==1 ~ "Menstrual Pain",
                                             D_152138929_D_283652434==1 ~ "Disease Prevention",
                                             D_152138929_D_243596698==1 ~ "Headaches",
                                             D_152138929_D_191656389==1 ~ "Illness or Fever",
                                             D_152138929_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_152138929_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P3[, grepl("152138929", colnames(dt_reasons_P3))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_3 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(ibu$reasons=="Skipped this question")[2])
pain7_3[as.numeric(dim(pain7_3)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P3)[[1]])*100,2))


dt_pain7_3 <- pain7_3 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_3: Reasons for taking ibuprofen regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_3,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```

### Acetaminophen 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Tylenol 
#simple_funct(D_399982309_D_555555502, "PAINREL1_4: Ever used Tylenol 4x/month for 6+ Months")


#How often taken
bar_rplc_funct(D_614446276_D_765748316 , "PAINREL2_4: Days per Week Tylenol Taken", "Days", "Frequency")

hist_funct(D_614446276_D_785412329 , "PAINREL2_4: Days per Month Tylenol Taken", "Days", "Frequency")

#Pills per day Tylenol
hist_funct(D_646042915_D_101310722, "PAINREL3_4: Pills per Day of Tylenol", "Pills", "Frequency")
  
  #Pills per day: Don't know
#one_logic_funct(D_646042915_D_646042915, D_399982309_D_555555502, 1, "PAINREL3_4: Acetaminophen Pills Per Day")

#Yrs taken Tylenol 
module2$D_270254670 <- round(as.numeric(module2$D_270254670), digits=0)
hist_funct(D_270254670, "PAINREL4_4: Years of taking Tylenol", "Years", "Frequency")

#Last time taken Tylenol 
#one_logic_funct(D_861824298, D_399982309_D_555555502, 1, "PAINREL5_4: Last Time Tylenol Taken")
PAINREL5_4= data_tib_m2  %>%   filter(D_399982309_D_555555502==1)

bby_asp= PAINREL5_4 %>%  mutate(reasons= case_when(D_861824298==317567178 ~ "In the past month",
                                             D_861824298==484055234 ~ "More than a month, less than a year",
                                             D_861824298==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_4_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_4: Last Time Tylenol Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Yrs ago last taken
hist_funct(D_846227588, "PAINREL6_4: Years Ago Tylenol Taken", "Years", "Frequency")




```
```{r, include=FALSE}

#Reasons taken
dt_reasons_P4 <- data_tib_m2 %>%   filter(D_399982309_D_555555502==1)
acet= dt_reasons_P4 %>%  mutate(reasons= case_when(D_630231395_D_323106499==1 ~ "Arthritis",
                                             D_630231395_D_769901710==1 ~ "Back Pain",
                                             D_630231395_D_727773491==1 ~ "Menstrual Pain",
                                             D_630231395_D_283652434==1 ~ "Disease Prevention",
                                             D_630231395_D_243596698==1 ~ "Headaches",
                                             D_630231395_D_191656389==1 ~ "Illness or Fever",
                                             D_630231395_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_630231395_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P4[, grepl("630231395", colnames(dt_reasons_P4))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_4 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(acet$reasons=="Skipped this question")[2])
pain7_4[as.numeric(dim(pain7_4)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P4)[[1]])*100,2))


dt_pain7_4 <- pain7_4 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_4: Reasons for taking Acetaminophen regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_4,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


### Naproxen 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Aleve
#simple_funct(D_399982309_D_800410166, "PAINREL1_5: Ever used Aleve 4x/month for 6+ Months")


#How often taken
bar_rplc_funct(D_234177873_D_765748316, "PAINREL2_5: Days per Week Aleve Taken", "Days", "Frequency")
     
hist_funct(D_234177873_D_785412329, "PAINREL2_5: Days per Month Aleve Taken", "Days", "Frequency")

#Pills per day Aleve 
hist_funct(D_799338907_D_101310722, "PAINREL3_5: Pills per Day of Aleve", "Pills", "Frequency")

  #Pills per day: Don't know
#one_logic_funct(D_799338907_D_799338907, D_399982309_D_800410166, 1, "PAINREL3_5: Naproxen Pills Per Day")


#Yrs taken Aleve
hist_funct(D_376720409, "PAINREL4_5: Years of taking Aleve", "Years", "Frequency")

#Last time taken Aleve
#one_logic_funct(D_575646308, D_399982309_D_800410166, 1, "PAINREL5_5: Last Time Aleeve Taken")
PAINREL5_5= data_tib_m2  %>%   filter(D_399982309_D_800410166==1)

bby_asp= PAINREL5_5 %>%  mutate(reasons= case_when(D_575646308==317567178 ~ "In the past month",
                                             D_575646308==484055234 ~ "More than a month, less than a year",
                                             D_575646308==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_5_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_5: Last Time Naproxen Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken 
module2$D_798182168 <- round(as.numeric(module2$D_798182168), digits=0)
hist_funct(D_798182168, "PAINREL6_5: Years Ago Aleve Last Taken", "Years", "Frequency")





```
```{r, include=FALSE}

#Reasons taken
dt_reasons_P5 <- data_tib_m2 %>%   filter(D_399982309_D_800410166==1)
napx= dt_reasons_P5 %>%  mutate(reasons= case_when(D_655266993_D_323106499==1 ~ "Arthritis",
                                             D_655266993_D_769901710==1 ~ "Back Pain",
                                             D_655266993_D_727773491==1 ~ "Menstrual Pain",
                                             D_655266993_D_283652434==1 ~ "Disease Prevention",
                                             D_655266993_D_243596698==1 ~ "Headaches",
                                             D_655266993_D_191656389==1 ~ "Illness or Fever",
                                             D_655266993_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_655266993_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P5[, grepl("655266993", colnames(dt_reasons_P5))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_5 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(napx$reasons=="Skipped this question")[2])
pain7_5[as.numeric(dim(pain7_5)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P5)[[1]])*100,2))


dt_pain7_5 <- pain7_5 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_5: Reasons for taking Naproxen regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_5,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


### Celebrex 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Celebrex
#simple_funct(D_399982309_D_221645137, "PAINREL1_6: Ever used Celebrex 4x/month for 6+ Months")


#How often taken 
bar_rplc_funct(D_248599913_D_765748316, "PAINREL2_6: Days per Week Celebrex Taken", "Days", "Frequency")

hist_funct(D_248599913_D_785412329, "PAINREL2_6: Days per Month Celebrex Taken", "Days", "Frequency") 


#Pills per day celebrex 
hist_funct(D_893965588_D_101310722, "PAINREL3_6: Pills per Day of Aleve", "Pills", "Frequency")

 #Pills per day: don't know 
#one_logic_funct(D_893965588_D_893965588, D_399982309_D_221645137, 1, "PAINREL3_6: Celebrex Pills Per Day")


#Yrs taken celebrex
hist_funct(D_439072744, "PAINREL4_6: Years Celebrex Taken", "Years", "Frequency")

#Last time taken celebrex
#one_logic_funct(D_733861762, D_399982309_D_221645137, 1, "PAINREL5_6: Last Time Celbrex Taken")
PAINREL5_6= data_tib_m2  %>%   filter(D_399982309_D_221645137==1)

bby_asp= PAINREL5_6 %>%  mutate(reasons= case_when(D_733861762==317567178 ~ "In the past month",
                                             D_733861762==484055234 ~ "More than a month, less than a year",
                                             D_733861762==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_6_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_6_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL5_6: Last Time Celebrex Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken
hist_funct(D_322479862, "PAINREL6_6: Years Ago Celebrex Last Taken", "Years", "Frequency")



```
```{r, include=FALSE}

#Reasons taken
dt_reasons_P6 <- data_tib_m2 %>%   filter(D_399982309_D_221645137==1)
cbx= dt_reasons_P6 %>%  mutate(reasons= case_when(D_509383583_D_323106499==1 ~ "Arthritis",
                                             D_509383583_D_769901710==1 ~ "Back Pain",
                                             D_509383583_D_727773491==1 ~ "Menstrual Pain",
                                             D_509383583_D_283652434==1 ~ "Disease Prevention",
                                             D_509383583_D_243596698==1 ~ "Headaches",
                                             D_509383583_D_191656389==1 ~ "Illness or Fever",
                                             D_509383583_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_509383583_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))


 
painmeds<- dt_reasons_P6[, grepl("509383583", colnames(dt_reasons_P6))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_6 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(cbx$reasons=="Skipped this question")[2])
pain7_6[as.numeric(dim(pain7_6)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P6)[[1]])*100,2))


dt_pain7_6 <- pain7_6 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_6: Reasons for taking Celebrex regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  dt_pain7_6,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


### Prescription Pain Relivers Containing Opiods 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##prescription opiods
#simple_funct(D_399982309_D_974248369, "PAINREL1_7: Ever used Prescription Opiods 4x/month for 6+ Months")

#How often taken 
#hist_funct(D_697661603_D_765748316, "PAINREL2_7: How often Presc. Opiods Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_697661603_D_765748316, "PAINREL2_7: How often Presc. Opiods Taken (per week)", "Days", "Frequency")

hist_funct(D_697661603_D_785412329, "PAINREL2_7: How often Presc. Opiods Taken (per month)", "Days", "Frequency")

#Pills per day prescription opiods
hist_funct(D_438682764_D_101310722, "PAINREL3_7: Pills per Day of Presc. Opiods", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct(D_438682764_D_438682764, D_399982309_D_974248369, 1, "PAINREL3_7: Prescription Opiod Pills Per Day")


#Yrs taken prescription opiods 
hist_funct(D_445571225, "PAINREL4_7: Years Taking Prescription Opiods", "Years", "Frequency")


#Last time taken prescription opiods 
#one_logic_funct(D_761822652, D_399982309_D_974248369, 1, "PAINREL5_7: Last Time Prescription Opiods Taken")
PAINREL5_7= data_tib_m2  %>%   filter(D_399982309_D_974248369==1)

bby_asp= PAINREL5_7 %>%  mutate(reasons= case_when(D_761822652==317567178 ~ "In the past month",
                                             D_761822652==484055234 ~ "More than a month, less than a year",
                                             D_761822652==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



PAINREL5_7_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PAINREL5_7_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("PAINREL5_7: Last Time Prescription Opiods Taken")) %>%
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken
hist_funct(D_737490587, "PAINREL6_7: Years Ago Prescription Opiods Last Taken", "Years", "Frequency")




```
```{r, include=FALSE}

#Reasons taken
dt_reasons_P7= data_tib_m2 %>%  filter(D_399982309_D_974248369==1)


opd= dt_reasons_P7 %>%  mutate(reasons= case_when(D_887435355_D_323106499==1 ~ "Arthritis",
                                             D_887435355_D_769901710==1 ~ "Back Pain",
                                             D_887435355_D_727773491==1 ~ "Menstrual Pain",
                                             D_887435355_D_283652434==1 ~ "Disease Prevention",
                                             D_887435355_D_243596698==1 ~ "Headaches",
                                             D_887435355_D_191656389==1 ~ "Illness or Fever",
                                             D_887435355_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_887435355_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this question"))

 
painmeds<- dt_reasons_P7[, grepl("887435355", colnames(dt_reasons_P7))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_7 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(opd$reasons=="Skipped this question")[2])
pain7_7[as.numeric(dim(pain7_7)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P7)[[1]])*100,2))


pain7_7 <- pain7_7 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_7: Reasons for taking Opiods regularly")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  pain7_7,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```



### Ever taken non-prescription opiods 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken not prescr.  

#simple_funct(D_414005872, "PAINREL8: Taken Opioids Not Prescribed")
painr8= data_tib_m2 %>%  mutate(answer= case_when(D_414005872==104430631 ~ "No",
                                             D_414005872==132099255 ~ "Sometimes",
                                             D_414005872==211590917 ~ "Often",
                                             D_414005872==746038746 ~ "Declined",
                                             TRUE ~ "Skipped this question"))
painr8$answer <- factor(painr8$answer,levels=c("No", "Sometimes", "Often", "Declined", "Skipped this question"))

painr8_summary <- painr8 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

painr8_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL8: Ever Used painr8 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
#ggplot grid bar with comparison of other pain killers taken to taken non-prescription drugs
```

## Cholesterol and blood Pressure (Hypertension) Medications
```{r, warning=FALSE, echo=FALSE, message=FALSE}
chlot= data_tib_m2 %>%  mutate(answer= case_when(D_614123836_D_480724806==1 & D_614123836_D_819373917==1~ "Both",
                                                     D_614123836_D_480724806==1 ~ "Statins",
                                                     D_614123836_D_819373917==1 ~ "Anti-hypertensive medication",
                                                     D_614123836_D_535003378==1 ~ "None",
                                                   TRUE ~ "Skipped this question"))
chlot$answer <- factor(chlot$answer,levels=c("Statins", "Anti-hypertensive medication", "Both","None", "Skipped this question"))

chlot_summary <- chlot %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

chlot_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHOLHTN: Ever Used Any Cholesterol or Blood Pressure (Hypertension) \n Medications 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
```
### Statins 
```{r, warning=FALSE, echo=FALSE, message=FALSE}


#How Often
  #sum(table(module2$D_731790154_D_765748316)) #most answered
#hist_funct(D_731790154_D_765748316, "CHOLHTN2_1: How often Statins Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_731790154_D_765748316, "CHOLHTN2_1: How often Statins Taken (per week)", "Days", "Frequency")


hist_funct(D_731790154_D_785412329, "CHOLHTN2_1: How often Statins Taken (per month)", "Days", "Frequency")

#Pills per day
hist_funct(D_550092533_D_101310722, "CHOLHTN3_1: Pills per Day of Statins", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct(D_550092533_D_550092533, D_614123836_D_480724806, 1, "CHOLHTN3_1: Statin Pills Per Day")


#Yrs taken
module2$D_163057677 <- round(as.numeric(module2$D_163057677), digits=0)
hist_funct(D_163057677, "CHOLHTN4_1: Years Taking Statins", "Years", "Frequency")

#Last time taken
#one_logic_funct(D_225047594, D_614123836_D_480724806, 1, "CHOLHTN5_1: Last Time Taking Statins")

CHOLHTN5_1= data_tib_m2  %>%   filter(D_614123836_D_480724806==1)

bby_asp= CHOLHTN5_1 %>%  mutate(reasons= case_when(D_225047594==317567178 ~ "In the past month",
                                             D_225047594==484055234 ~ "More than a month, less than a year",
                                             D_225047594==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



CHOLHTN5_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

CHOLHTN5_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHOLHTN5_1: Last Time Taking Statins")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Yrs ago last taken
hist_funct(D_297084062, "CHOLHTN6_1: Years Ago Statins Last Taken", "Years", "Frequency")

```




### Anti-Hyertension 
```{r, warning=FALSE, echo=FALSE, message=FALSE}


#How often
#hist_funct(D_305292465_D_765748316, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per week)", "Years", "Frequency")
bar_rplc_funct(D_305292465_D_765748316, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per week)", "Days", "Frequency")


hist_funct(D_305292465_D_785412329, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per month)", "Years", "Frequency")

#Pills per day
module2$D_901498441_D_101310722 <- round(as.numeric(module2$D_901498441_D_101310722), digits=0)
hist_funct(D_901498441_D_101310722, "CHOLHTN3_2: Pills per Day of Anti-Hypertensive Meds", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct(D_901498441_D_901498441, D_614123836_D_819373917, 1, "CHOLHTN3_2: Anti-Hyertension Pills Per Day")


#Yrs taken
module2$D_147792229 <- round(as.numeric(module2$D_147792229), digits=0)
hist_funct(D_147792229, "CHOLHTN4_2: Years Anti-Hypertensive Meds Taken", "Years", "Frequency")

#Last time taken--why dowa this one nor work
#one_logic_funct(D_976052812, D_614123836_D_819373917, 1, "CHOLHTN5_2: Last Time Anti-Hypertensive Meds Taken")
CHOLHTN5_2= data_tib_m2  %>%   filter(D_614123836_D_819373917==1)

bby_asp= CHOLHTN5_2 %>%  mutate(reasons= case_when(D_976052812==317567178 ~ "In the past month",
                                             D_976052812==484055234 ~ "More than a month, less than a year",
                                             D_976052812==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



CHOLHTN5_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

CHOLHTN5_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHOLHTN5_2: Last Time Anti-Hypertensive Meds Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Yrs ago last taken
hist_funct(D_991427384, "CHOLHTN6_2: Years Ago Anti-Hypertensive Meds Last Taken", "Years", "Frequency")

```




## Metformin
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Metformin
#simple_funct(D_112024853, "METFOR: Ever Used Anti-Hypertensive Meds 4x/month for 6+ Months")
METFOR1= data_tib_m2 %>%  mutate(answer= case_when(D_112024853==353358909 ~ "Yes",
                                             D_112024853==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

METFOR1_summary <- METFOR1 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

METFOR1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("METFOR: Ever Used Anti-Hypertensive Meds 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Days per day/week/month
#hist_funct(D_694817520_D_765748316, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_694817520_D_765748316, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")

hist_funct(D_694817520_D_785412329, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")

#Milligrams per day
hist_funct(D_991622246_D_101310722, "METFOR3: Milligrams per Day", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct(D_991622246_D_991622246, D_112024853, 353358909, "METFOR3: Metformin Pills Per Day")


#Yrs taken Metformin
module2$D_450131058 <- round(as.numeric(module2$D_450131058), digits=0)
hist_funct(D_450131058, "METFOR4: Years Metformin Taken", "Years", "Frequency")


  #Last time Metformin taken
#one_logic_funct(D_976052812, D_112024853, 353358909, "METFOR5: Last Time Metformin Taken")
METFOR5= data_tib_m2  %>%   filter(D_112024853==353358909)

bby_asp= METFOR5 %>%  mutate(reasons= case_when(D_976052812==317567178 ~ "In the past month",
                                             D_976052812==484055234 ~ "More than a month, less than a year",
                                             D_976052812==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



METFOR5_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

METFOR5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("METFOR5: Last Time Metformin Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

  #Yrs ago last taken Metformin
hist_funct(D_371176229, "METFOR6: Years Ago Metformin Taken", "Years", "Frequency")

```

## Insulin 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Insulin
#simple_funct(D_982448213, "INSULIN1: Ever Used Insulin 4x/month for 6+ Months")
Insulin1= data_tib_m2 %>%  mutate(answer= case_when(D_982448213==353358909 ~ "Yes",
                                             D_982448213==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

Insulin1_summary <- Insulin1 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

Insulin1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("INSULIN1: Ever Used Insulin 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Days per day/week/month
#hist_funct(D_745223146_D_765748316,"INSULIN2A: How often Insulin Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_745223146_D_765748316, "INSULIN2A: How often Insulin Taken (per week)", "Days", "Frequency")

hist_funct(D_745223146_D_785412329,"INSULIN2B: How often Insulin Taken (per month)", "Days", "Frequency")


#Units per day
module2$D_273218182_D_101310722 <- round(as.numeric(module2$D_273218182_D_101310722), digits=0)
hist_funct(D_273218182_D_101310722,"INSULIN3: Units of Insulin per Day", "Units", "Frequency")

  #Units per day: don't remember
#one_logic_funct(D_273218182_D_273218182, D_982448213, 353358909, "INSULIN3: Metformin Pills Per Day")


#Concentration
#one_logic_funct(D_850202336_D_850202336, D_982448213, 353358909, "INSULIN4: Concetration of Insulin")

INSULIN4= data_tib_m2  %>%   filter(D_982448213==353358909)

bby_asp= INSULIN4 %>%  mutate(reasons= case_when(D_850202336_D_850202336==310201523 ~ "100 unit per ml",
                                             D_850202336_D_850202336==484055234 ~ "500 unit per ml",
                                            D_850202336_D_850202336==178420302 ~ "Unknown",
                                            D_850202336_D_850202336==807835037 ~ "Other",
                                             TRUE~ "Skipped this question"))



INSULIN4_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

INSULIN4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("INSULIN4: Concentration of Insulin")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Yrs taken
module2$D_799903478 <- round(as.numeric(module2$D_799903478), digits=0)
hist_funct(D_799903478,"INSULIN5: Years Insulin Taken", "Years", "Frequency")


#Last time taken
#one_logic_funct(D_465635548, D_982448213, 353358909, "INSULIN6: Last Time Insulin Taken")
INSULIN6= data_tib_m2  %>%   filter(D_982448213==353358909)

bby_asp= INSULIN6 %>%  mutate(reasons= case_when(D_465635548==317567178 ~ "In the past month",
                                             D_465635548==484055234 ~ "More than a month, less than a year",
                                             D_465635548==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



INSULIN6_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

INSULIN6_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("INSULIN6: Last Time Insulin Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



  #Yrs ago last taken 
hist_funct(D_556235252,"INSULIN7: Years Ago Insulin Last Taken", "Years", "Frequency")


```

## Acid Suppressive Drugs
```{r, warning=FALSE, echo=FALSE, message=FALSE}


brand= data_tib_m2  %>%  mutate(med= case_when(D_643361372_D_933374659==1 ~ "Prescription Proton Pump Inhibitors",
                                            D_643361372_D_920460744==1 ~ "Over the Counter Proton Pump Inhibitors",
                                            D_643361372_D_449861632==1 ~ "Over the Counter H2 reception Blockers",
                                            D_643361372_D_535003378==1 ~ "None of the Above",
                                             TRUE ~ "Skipped This Question"))

acid_sup_summary <- brand %>% group_by(med) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(med, n, percentage)

acid_sup_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ACIDSUP: Used Acid Suppressive Drugs 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**Number of Participants**"), med = md("**Type**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows(
    # column = c(n,percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = med,
    )
  ) %>% opt_row_striping()


# ##prescr./ pump inh
# module2 %>% filter(!is.na(module2$D_643361372_D_933374659)) %>% ggplot(aes(x=D_643361372_D_933374659, fill=D_407056417)) +
#   geom_bar()+ ggtitle("ACIDSUP1_1: Ever Used Prescription Proton Pump Inhibitors 4x/month for 6+ Months")+xlab("Frequency")+ylab("Count") +
#   scale_x_discrete(labels=c("104430631"="No", 
#                             "353358909"="Yes"))+ 
#   scale_fill_discrete(name = "Gender", labels=c("Female", "Male"))
# 
# 
# ##over-the-counter proton pump inhibitors
# module2 %>% filter(!is.na(module2$D_643361372_D_920460744)) %>% ggplot(aes(x=D_643361372_D_920460744, fill=D_407056417)) +
#   geom_bar()+ ggtitle("ACIDSUP1_2: Ever Used Over the Counter Proton Pump Inhibitors 4x/month for 6+ Months")+xlab("Frequency")+ylab("Count") +
#   scale_x_discrete(labels=c("104430631"="No", 
#                             "353358909"="Yes"))+ 
#   scale_fill_discrete(name = "Gender", labels=c("Female", "Male"))
# 
# 
# ##over-the-counter H2 Receptor Blockers
# module2 %>% filter(!is.na(module2$D_643361372_D_449861632)) %>% 
#   ggplot(aes(x=D_643361372_D_449861632, fill=D_407056417)) +
#   geom_bar()+ ggtitle("ACIDSUP1_3: Ever Used Over the Counter H2 reception Blockers 4x/month for 6+ Months")+xlab("Frequency")+ylab("Count") +
#   scale_x_discrete(labels=c("104430631"="No", 
#                             "353358909"="Yes"))+ 
#   scale_fill_discrete(name = "Gender", labels=c("Female", "Male"))
# 
# 
# #none of the above
# cat("ACIDSUP1: None of the above")
# table(module2$D_643361372_D_535003378)  #Ever taken 4x 6months

```


### Prescription Pump Proton Inhibitors
```{r, warning=FALSE, echo=FALSE, message=FALSE}


#How Often
#hist_funct(D_172234651_D_765748316,"ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_172234651_D_765748316, "ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")

hist_funct(D_172234651_D_785412329,"ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per month)", "Days", "Frequency")


#Pills per day
hist_funct(D_753610471_D_101310722,"ACIDSUP3_1: Pills of Prescription Proton Pump Inhibitors per Day", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct(D_753610471_D_753610471, D_643361372_D_933374659, 1, "ACIDSUP3_1: Prescription Pump Proton Inhibitors Pills Per Day")


#Yrs taken
module2$D_424183977 <- round(as.numeric(module2$D_424183977), digits=0)
hist_funct(D_424183977,"ACIDSUP4_1: Years Prescription Proton Pump Inhibitors Taken", "Years", "Frequency")


#Last time taken
#one_logic_funct(D_824287808, D_643361372_D_933374659, 1, "ACIDSUP3_1: Prescription Pump Proton Inhibitors Pills Per Day")
ACIDSUP5_1= data_tib_m2  %>%   filter(D_643361372_D_933374659==1)

bby_asp= ACIDSUP5_1 %>%  mutate(reasons= case_when(D_824287808==317567178 ~ "In the past month",
                                             D_824287808==484055234 ~ "More than a month, less than a year",
                                             D_824287808==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



ACIDSUP5_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ACIDSUP5_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ACIDSUP5_1: Last Time Prescription Pump Proton Inhibitors Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Yrs ago last taken
module2$D_889053435 <- round(as.numeric(module2$D_889053435), digits=0)
hist_funct(D_889053435, "ACIDSUP6_1: Years Ago Prescription Proton Pump Inhibitors Last Taken", "Years", "Frequency")

```

### Over the counter Proton Pump Inhibitors
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#How Often
#hist_funct(D_416865817_D_765748316,"ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_416865817_D_765748316, "ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")

hist_funct(D_416865817_D_785412329,"ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors Taken (per month)", "Days", "Frequency")

#Pills per day
hist_funct(D_803968511_D_101310722, "ACIDSUP3_2: Pills of Over the Counter Proton Pump Inhibitors per Day", "Pills", "Frequency")
  
  #Pills per day: don't know
#one_logic_funct(D_803968511_D_803968511, D_643361372_D_920460744, 1, "ACIDSUP3_2: Over the counter Proton Pump Inhibitors Pills Per Day")


#Yrs taken
module2$D_378572291 <- round(as.numeric(module2$D_378572291), digits=0)
hist_funct(D_378572291,"ACIDSUP4_2: Years Over-the-counter proton pump inhibitors Taken", "Years", "Frequency")


#Last time taken
#one_logic_funct(D_846978339, D_643361372_D_920460744, 1, "ACIDSUP5_2: Last Time Over-the-counter Proton Pump Inhibitors Taken")
ACIDSUP5_2= data_tib_m2  %>%   filter(D_643361372_D_920460744==1)

bby_asp= ACIDSUP5_2 %>%  mutate(reasons= case_when(D_846978339==317567178 ~ "In the past month",
                                             D_846978339==484055234 ~ "More than a month, less than a year",
                                             D_846978339==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



ACIDSUP5_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ACIDSUP5_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ACIDSUP5_2: Last Time Over-the-counter Proton Pump Inhibitors Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Yrs ago last taken
module2$D_497904005 <- round(as.numeric(module2$D_497904005), digits=0)
hist_funct(D_497904005,"ACIDSUP6_2: Years Ago over-the-counter proton pump inhibitors Last Taken", "Years", "Frequency")

```

### Over the counter H2 Receptor Blockers
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#How often 
#hist_funct(D_266752903_D_765748316,"ACIDSUP2_3: How often over-the-counter H2 receptor blockers Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_266752903_D_765748316, "ACIDSUP2_3: How often over-the-counter H2 receptor blockers Taken (per week)", "Days", "Frequency")

hist_funct(D_266752903_D_785412329,"ACIDSUP2_3: How often over-the-counter H2 receptor blockers Taken (per month)", "Days", "Frequency")


#Pills per day
hist_funct(D_618427836_D_101310722,"ACIDSUP3_3: Number of over-the-counter H2 receptor blockers Pills per Day", "Pills", "Frequency")

  #Pills per day:don't know
#one_logic_funct(D_618427836_D_618427836, D_643361372_D_449861632, 1, "ACIDSUP3_3: Over the counter H2 Receptor Blockers Pills Per Day")


#Yrs taken
hist_funct(D_774514900,"ACIDSUP4_3: Years over-the-counter H2 receptor blockers Taken", "Years", "Frequency")

#Last time taken
#one_logic_funct(D_368595692, D_643361372_D_449861632, 1, "ACIDSUP5_3: Last Time Prescription Proton Pump Inhibitors Taken")
ACIDSUP5_3= data_tib_m2  %>%   filter(D_643361372_D_449861632==1)

bby_asp= ACIDSUP5_3 %>%  mutate(reasons= case_when(D_368595692==317567178 ~ "In the past month",
                                             D_368595692==484055234 ~ "More than a month, less than a year",
                                            D_368595692==802197176 ~ "More than 1 year",
                                             TRUE~ "Skipped this question"))



ACIDSUP5_3_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ACIDSUP5_3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ACIDSUP5_3: Last Time Prescription Proton Pump Inhibitors Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Yrs ago last taken 
hist_funct(D_889053435,"ACIDSUP6_3: Years Ago over-the-counter H2 Receptor Blockers Last Taken", "Years", "Frequency")

```


# Section 2: Reproductive Health 
## Used Hormones to Reflect Gender
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Used hormones to reflect gender

#simple_funct2(D_798889867, "HORNONCISWOM: Used Hormones to Make Body Look More Feminine")

hormn <- data_tib_m2 %>%  filter((D_407056417==654207589 | D_407056417==576796184) & (D_289664241_D_289664241==536341288 | D_289664241_D_289664241==218837028 | D_289664241_D_289664241==873138103 | D_289664241_D_289664241==805712793 | D_289664241_D_289664241==486192236 | D_289664241_D_289664241==807835037))

agep <- hormn %>%  mutate(age= case_when(D_798889867=="200323667"~"In the past yes",
                                      D_798889867=="249673703"~"Currently yes",
                                      TRUE ~ "Skipped this Question"))

dt_agep_summary <- agep %>% group_by(age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(age, n, percentage)


dt_agep_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("HORNONCISWOM: Used Hormones to Make Body Look More Feminine")) %>% 
  cols_label(n= md("**Number of Participants**"), age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = age,
    )
  ) %>% opt_row_striping()
```

## Menstrual History 

```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Menstrual History

fem_birth <- module2 %>%  filter(module2$D_407056417==536341288)
fb <- as_tibble(fem_birth)
#| (module2$D_407056417==576796184 & (module2$D_750420077_D_57841615=1 | module2$D_750420077_D_434651539==1)))  #no intersex participants as of yet

#Age at first period 
module2$D_496539718_D_969451837 <- round(as.numeric(module2$D_496539718_D_969451837), digits=0)
hist_funct_F(D_496539718_D_969451837,"MENSHIS: Age at First Menstrual Period", "Age", "Frequency")

agep <- fb %>%  mutate(age= case_when(D_496539718_D_496539718_D_648960871==1 ~ "Never had a Period",
                                      !is.na(D_496539718_D_969451837)~"Answered with Age", 
                                      TRUE ~ "Skipped this Question"))

dt_agep_summary <- agep %>% group_by(age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(age, n, percentage)


dt_agep_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS: Age at First Menstrual Period, or Never Had It")) %>% 
  cols_label(n= md("**Number of Participants**"), age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = age,
    )
  ) %>% opt_row_striping()


#How long until regular
regt <- fb %>%  filter(!is.na(D_496539718_D_969451837)) #D_496539718_D_496539718_D_648960871!=1 &  
regt <- regt %>%  mutate(howlong= case_when(D_167997205=="178420302"~"Unknown", 
                                   D_167997205=="410083265"~"2-3+ yrs",
                                   D_167997205=="648960871"~"Never",
                                   D_167997205=="718537646"~"3-4+ yrs",
                                   D_167997205=="801142243"~"4+ yrs", 
                                   D_167997205=="868025301"~"Within 1 yr",
                                   D_167997205=="939110313"~"1-2 yrs",
                                   TRUE~"Skipped this Question"))
regt$howlong <- factor(regt$howlong,levels=c("Within 1 yr","1-2 yrs","2-3+ yrs","3-4+ yrs","4+ yrs","Never","Unknown","Skipped this Question"))

dt_regt_summary <- regt %>% group_by(howlong) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(howlong, n, percentage)


dt_regt_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS2: Length of Time Unitl Menstrual Cycle Regular")) %>% 
  cols_label(n= md("**Number of Participants**"), howlong = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = howlong,
    )
  ) %>% opt_row_striping()



# fem_birth %>% filter(!is.na(fem_birth$D_167997205)) %>% ggplot(aes(x=D_167997205)) +geom_bar()+ #, fill=D_407056417
#          ggtitle("MENSHIS2: How Long until Period Was Regular")+xlab("Used")+ylab("Frequency") +
#   theme(axis.text.x = element_text(angle = 90))+
#          scale_x_discrete(labels=c("178420302"="Unknown", 
#                                    "410083265"="2-3+ yrs",
#                                    "648960871"="Never",
#                                    "718537646"="3-4+ yrs",
#                                    "801142243"="4+ yrs", 
#                                    "868025301"="Within 1 yr",
#                                    "939110313"="1-2 yrs"))  #+ scale_fill_discrete(name = "Gender", labels=c("Female", "Male"))
       
#Length of Menstrual Cycle once regular

reg <- fb %>%  filter(D_167997205!=648960871 & !is.na(D_167997205))

mens_lgth= reg %>%  mutate(length= case_when(D_972593606=="471375042"~"21+ days",
                                         D_972593606=="549031911"~"Too iregular/HIUD used",
                                         D_972593606=="858427002"~"Less than 21 days",
                                         TRUE~ "Skipped this question"))
mens_lgth$length <- factor(mens_lgth$length,levels=c("Too iregular/HIUD used", "Less than 21 days","21+ days","Skipped this question"))


dt_mens_lgth_summary <- mens_lgth %>% group_by(length) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(length, n, percentage)


dt_mens_lgth_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS3: Length of Menstrual Cycle Once Regular")) %>% 
  cols_label(n= md("**Number of Participants**"), length = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = length,
    )
  ) %>% opt_row_striping()


#Length of cycle (days long)
hist_funct_F(D_791830593,"MENSHIS4: Days of menstrual Cycle", "Days", "Frequency")

  
#Length of cycle last 12 months

cycle12 <- fb %>%  filter(!is.na(D_496539718_D_969451837)) #D_496539718_D_496539718_D_648960871!=1 &  

mens_lgth= cycle12 %>%  mutate(length= case_when(D_164595895=="113064256"~"Frequency's changed",
                                                 D_164595895=="388370628"~"Too irregular to guess/IUD",
                                                 D_164595895=="471375042"~"21+ days",
                                                 D_164595895=="650420270"~"Haven't had one",
                                                 D_164595895=="859025516"~"Less than 21 days",
                                                 TRUE~ "Skipped this question"))
mens_lgth$length <- factor(mens_lgth$length,levels=c("Haven't had one","Frequency's changed","Too irregular to guess/IUD","Less than 21 days","21+ days","Skipped this question"))


dt_mens_lgt_summary <- mens_lgth %>% group_by(length) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(length, n, percentage)


dt_mens_lgt_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS5: Usual Length of Menstrual Cycle in the last 12 months")) %>% 
  cols_label(n= md("**Number of Participants**"), length = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = length,
    )
  ) %>% opt_row_striping()


#How many days for the last 12 months
hist_funct_F(D_263114971,"MENSHIS6: Days of menstrual Cycle in the last 12 months", "Days", "Frequency")


#Why haven't had one

nopd <- fb %>%  filter(D_164595895==650420270)

reasonpd= nopd %>%  mutate(length= case_when(D_614145455_D_614145455=="330745988"~"Premenopausal Hormones",
                                             D_614145455_D_614145455=="582425113"~"Menopause",
                                             D_614145455_D_614145455== "655309065"~"Hormonal Med/Devise",
                                             D_614145455_D_614145455=="868504994"~"Endometrial Ablation",
                                             D_614145455_D_614145455=="909774794"~"Rem. of uterus/ovaries",
                                             TRUE~ "Skipped this question"))



dt_reasonpd_summary <- reasonpd %>% group_by(length) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(length, n, percentage)


dt_reasonpd_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS7: Reason You Haven't Had Period")) %>% 
  cols_label(n= md("**Number of Participants**"), length = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = length,
    )
  ) %>% opt_row_striping()

#Age at last period
hist_funct_F(D_534920374,"MENSHIS8: Age at Last Period", "Age", "Frequency")

#Experienced the following


expr= fb %>%  mutate(symptoms= case_when(D_547633480_D_801183888==1 ~ "Spotting between Periods",
                                             D_547633480_D_825584471==1 ~ "Spotting after sex",
                                             D_547633480_D_503760666==1 ~ "Heavy bleeding during period",
                                             D_547633480_D_120016082==1 ~ "Irregular period",
                                             D_547633480_D_386152189==1 ~ "Bleeding after menopause",
                                             D_547633480_D_535003378==1 ~ "None of the Above",
                                             TRUE~ "Skipped this question"))



dt_symptoms__summary <- expr %>% group_by(symptoms) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(symptoms, n, percentage)


dt_symptoms__summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS9: Experienced the following")) %>% 
  cols_label(n= md("**Number of Participants**"), symptoms = md("**Symptoms**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = symptoms,
    )
  ) %>% opt_row_striping()


```

## Pregnancies
### All pregnancies
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Currently pregnant

PREG= data_tib_m2  %>%   filter(D_407056417==536341288)

bby_asp= PREG %>%  mutate(reasons= case_when(D_849945160==104430631 ~ "No",
                                             D_849945160==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



PREG_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PREG_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG: Currently Pregnant")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Ever been pregnant 
PREG2= data_tib_m2  %>%   filter(D_849945160==104430631)

bby_asp= PREG2 %>%  mutate(reasons= case_when(D_996243083==104430631 ~ "No",
                                             D_996243083==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



PREG2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PREG2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG22: Ever Pregnant")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#How many times
hist_funct_F(D_405571048,"PREG3: Times You've been Pregnant", "Times", "Frequency")

#Age at each pregnancy    #histogram vs ascending box plot?   #will need to add more eventually
preg1=boxp_funct_F(D_968816827_1_1,"PREG4_1: Age at First Pregnancy", "Age")
preg2=boxp_funct_F(D_968816827_2_2,"PREG4_2: Age at Second Pregnancy", "Age")
preg3=boxp_funct_F(D_968816827_3_3,"PREG4_3: Age at Third Pregnancy", "Age")
preg4=boxp_funct_F(D_968816827_4_4,"PREG4_4: Age at Fourth Pregnancy", "Age")
grid.arrange(preg1, preg2, preg3, preg4, nrow=2)







```



```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Outcome of each pregnancy #remove NA column

##1
out_preg1=fem_birth %>% filter(as.numeric(D_405571048)>0)
out_preg1= out_preg1 %>%  mutate(outcome= case_when(D_391951010_1_1=="223216393"~"Single Live Infant",
                                                     D_391951010_1_1=="628445697"~"Multiple Live Infants",
                                                     D_391951010_1_1=="419220239"~"Still birth",
                                                     D_391951010_1_1=="306890578"~"Live Birth and Still Birth",
                                                     D_391951010_1_1=="858244199"~"Miscariage",
                                                     D_391951010_1_1=="434041171"~"Termination", 
                                                     D_391951010_1_1=="550615107"~"Ectopic or tubal pregnancy",
                                                     D_391951010_1_1=="746038746"~"Declined",
                                                     TRUE~ "Skipped this question"))



dt_out_preg1_summary <- out_preg1 %>% group_by(outcome) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(outcome, n, percentage)


dt_out_preg1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("PREG5_1: Outcome of First Pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), outcome = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = outcome,
    )
  ) %>% opt_row_striping()


##2
out_preg2=fem_birth %>% filter(as.numeric(D_405571048)>1)
out_preg2= out_preg2 %>%  mutate(outcome= case_when(D_391951010_3_3=="223216393"~"Single Live Infant",
                                                     D_391951010_3_3=="628445697"~"Multiple Live Infants",
                                                     D_391951010_3_3=="419220239"~"Still birth",
                                                     D_391951010_3_3=="306890578"~"Live Birth and Still Birth",
                                                     D_391951010_3_3=="858244199"~"Miscariage",
                                                     D_391951010_3_3=="434041171"~"Termination", 
                                                     D_391951010_3_3=="550615107"~"Ectopic or tubal pregnancy",
                                                     D_391951010_3_3=="746038746"~"Declined",
                                                     TRUE~ "Skipped this question"))



dt_out_preg2_summary <- out_preg2 %>% group_by(outcome) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(outcome, n, percentage)


dt_out_preg2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("PREG5_2: Outcome of Second Pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), outcome = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = outcome,
    )
  ) %>% opt_row_striping()



##3
out_preg3=fem_birth %>% filter(as.numeric(D_405571048)>2)
out_preg3= out_preg3 %>%  mutate(outcome= case_when(D_391951010_3_3=="223216393"~"Single Live Infant",
                                                     D_391951010_3_3=="628445697"~"Multiple Live Infants",
                                                     D_391951010_3_3=="419220239"~"Still birth",
                                                     D_391951010_3_3=="306890578"~"Live Birth and Still Birth",
                                                     D_391951010_3_3=="858244199"~"Miscariage",
                                                     D_391951010_3_3=="434041171"~"Termination", 
                                                     D_391951010_3_3=="550615107"~"Ectopic or tubal pregnancy",
                                                     D_391951010_3_3=="746038746"~"Declined",
                                                     TRUE~ "Skipped this question"))



dt_out_preg3_summary <- out_preg3 %>% group_by(outcome) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(outcome, n, percentage)


dt_out_preg3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("PREG5_3: Outcome of Third Pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), outcome = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = outcome,
    )
  ) %>% opt_row_striping()


##4
out_preg4=fem_birth %>% filter(as.numeric(D_405571048)>3)
out_preg4= out_preg4 %>%  mutate(outcome= case_when(D_391951010_4_4=="223216393"~"Single Live Infant",
                                                     D_391951010_4_4=="628445697"~"Multiple Live Infants",
                                                     D_391951010_4_4=="419220239"~"Still birth",
                                                     D_391951010_4_4=="306890578"~"Live Birth and Still Birth",
                                                     D_391951010_4_4=="858244199"~"Miscariage",
                                                     D_391951010_4_4=="434041171"~"Termination", 
                                                     D_391951010_4_4=="550615107"~"Ectopic or tubal pregnancy",
                                                     D_391951010_4_4=="746038746"~"Declined",
                                                     TRUE~ "Skipped this question"))



dt_out_preg4_summary <- out_preg4 %>% group_by(outcome) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(outcome, n, percentage)


dt_out_preg4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("PREG5_4: Outcome of Fourth Pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), outcome = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = outcome,
    )
  ) %>% opt_row_striping()



```

```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Infants delivered

    #fb %>%  mutate(date_finished= case_when(D_832139544 > as.Date("")))-- skip logic change in preg section, will affect skipping percentage

#First pregnancy
fb_preg6_1 <- fb %>%  filter(fb$D_391951010_1_1==628445697 | fb$D_391951010_1_1==419220239)
preg6_1_ans= fb_preg6_1 %>%  mutate(answer= case_when(D_281494550_1_1==582602017 ~ "Twins",
                                             D_281494550_1_1==105727261 ~ "Triplets",
                                             D_281494550_1_1==720288326 ~ "Four or More",
                                             TRUE ~ "Skipped this question"))

dtpreg6_1_summary <- preg6_1_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg6_1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG6_1: Infants delivered during first pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#Second pregnancy
fb_preg6_2 <- fb %>%  filter(fb$D_391951010_2_2==628445697 | fb$D_391951010_2_2==419220239)


preg6_2_ans= fb_preg6_2  %>%  mutate(answer= case_when(D_281494550_2_2==582602017 ~ "Twins",
                                             D_281494550_2_2==105727261 ~ "Triplets",
                                             D_281494550_2_2==720288326 ~ "Four or More",
                                             TRUE ~ "Skipped this question"))

dtpreg6_2_summary <- preg6_2_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)
#gtm3_print

dtpreg6_2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG6_2: Infants delivered during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#Third Pregnancy
fb_preg6_3 <- fb %>%  filter(fb$D_391951010_3_3==628445697 | fb$D_391951010_3_3==419220239)


preg6_3_ans= fb_preg6_3 %>%  mutate(answer= case_when(D_281494550_3_3==582602017 ~ "Twins",
                                             D_281494550_3_3==105727261 ~ "Triplets",
                                             D_281494550_3_3==720288326 ~ "Four or More",
                                             TRUE ~ "Skipped this question"))

dtpreg6_3_summary <- preg6_3_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)
dtpreg6_3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG6_3: Infants delivered during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Fourth Pregnancy
fb_preg6_4 <- fb %>%  filter(fb$D_391951010_4_4==628445697 | fb$D_391951010_4_4==419220239)


preg6_4_ans= fb_preg6_4 %>%  mutate(answer= case_when(D_281494550_4_4==582602017 ~ "Twins",
                                             D_281494550_4_4==105727261 ~ "Triplets",
                                             D_281494550_4_4==720288326 ~ "Four or More",
                                             TRUE ~ "Skipped this question"))

dtpreg6_4_summary <- preg6_4_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg6_4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG6_4: Infants delivered during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##Method 

#First Pregnancy 
fb_preg7_1 <- fb %>%  filter(fb$D_391951010_1_1==628445697 | fb$D_391951010_1_1==419220239 | fb$D_391951010_1_1==223216393)

preg7_1_ans= fb_preg7_1 %>%  mutate(answer= case_when(D_771528780_1_1==660308254 ~ "Cesarean",
                                             D_771528780_1_1==936573532 ~ "Vaginal",
                                             TRUE ~ "Skipped this question"))

dtpreg7_1_summary <- preg7_1_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg7_1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREG7_1: Method of delivery during first pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Second Pregnancy 
fb_preg7_2 <- fb %>%  filter(fb$D_391951010_2_2==628445697 | fb$D_391951010_2_2==419220239 | fb$D_391951010_2_2==223216393)

preg7_2_ans= fb_preg7_2 %>%  mutate(answer= case_when(D_771528780_2_2==660308254 ~ "Cesarean",
                                             D_771528780_2_2==936573532 ~ "Vaginal",
                                             TRUE ~ "Skipped this question"))

dtpreg7_2_summary <- preg7_2_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg7_2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg7_2: Method of delivery during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#Third Pregnancy 
fb_preg7_3 <- fb %>%  filter(fb$D_391951010_3_3==628445697 | fb$D_391951010_3_3==419220239 | fb$D_391951010_3_3==223216393)


preg7_3_ans= fb_preg7_3 %>%  mutate(answer= case_when(D_771528780_3_3==660308254 ~ "Cesarean",
                                             D_771528780_3_3==936573532 ~ "Vaginal",
                                             TRUE ~ "Skipped this question"))

dtpreg7_3_summary <- preg7_3_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg7_3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg7_3: Method of delivery during third pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Fourth Pregnancy 
fb_preg7_4 <- fb %>%  filter(fb$D_391951010_4_4==628445697 | fb$D_391951010_4_4==419220239 | fb$D_391951010_4_4==223216393)

preg7_4_ans= fb_preg7_4 %>%  mutate(answer= case_when(D_771528780_4_4==660308254 ~ "Cesarean",
                                             D_771528780_4_4==936573532 ~ "Vaginal",
                                             TRUE ~ "Skipped this question"))

dtpreg7_4_summary <- preg7_4_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg7_4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg7_4: Method of delivery during fourth pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##Did you/are you breast feeding 

#First Pregnancy 
fb_preg8_1 <- fb %>%  filter(fb$D_391951010_1_1==628445697 | fb$D_391951010_1_1==419220239 | fb$D_391951010_1_1==223216393)


preg8_1_ans= fb_preg8_1 %>%  mutate(answer= case_when(D_486574018_1_1==353358909 ~ "Yes",
                                             D_486574018_1_1==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg8_1_summary <- preg8_1_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg8_1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg8_1: Breast fed during first pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#Second Pregnancy 
fb_preg8_2 <- fb %>%  filter(fb$D_391951010_2_2==628445697 | fb$D_391951010_2_2==419220239 | fb$D_391951010_2_2==223216393)


preg8_2_ans= fb_preg8_2  %>%  mutate(answer= case_when(D_486574018_2_2==353358909 ~ "Yes",
                                             D_486574018_2_2==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg8_2_summary <- preg8_2_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg8_2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg8_2: Breast fed during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Third Pregnancy 
fb_preg8_3 <- fb %>%  filter(fb$D_391951010_3_3==628445697 | fb$D_391951010_3_3==419220239 | fb$D_391951010_3_3==223216393)


preg8_3_ans= fb_preg8_3 %>%  mutate(answer= case_when(D_486574018_3_3==353358909 ~ "Yes",
                                             D_486574018_3_3==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg8_3_summary <- preg8_3_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg8_3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg8_3: Breast fed during third pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Fourth Pregnancy
fb_preg8_4 <- fb %>%  filter(fb$D_391951010_4_4==628445697 | fb$D_391951010_4_4==419220239 | fb$D_391951010_4_4==223216393)


preg8_4_ans= fb_preg8_4 %>%  mutate(answer= case_when(D_486574018_4_4==353358909 ~ "Yes",
                                             D_486574018_4_4==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg8_4_summary <- preg8_4_ans %>% group_by(answer) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg8_4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg8_4: Breast fed during fourth pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#For how many months
module2$D_278277373_1_1 <- round(as.numeric(module2$D_278277373_1_1), digits=0)
module2$D_278277373_2_2 <- round(as.numeric(module2$D_278277373_2_2), digits=0)
module2$D_278277373_3_3 <- round(as.numeric(module2$D_278277373_3_3), digits=0)
module2$D_278277373_4_4 <- round(as.numeric(module2$D_278277373_4_4), digits=0)


fem_birth$D_278277373_1_1 <- as.numeric(fem_birth$D_278277373_1_1)
breastfed1=hist_funct_F(D_278277373_1_1,"PREG9_1: Months of Breast Feeding First Child", "Months", "Frequency")
breastfed2=hist_funct_F(D_278277373_2_2,"PREG9_2: Months of Breast Feeding Second Child", "Months", "Frequency")
breastfed3=hist_funct_F(D_278277373_3_3,"PREG9_3: Months of Breast Feeding Third Child", "Months", "Frequency")
breastfed4=hist_funct_F(D_278277373_4_4,"PREG9_4: Months of Breast Feeding Fourth Child", "Months", "Frequency")
grid.arrange(breastfed1, breastfed2, breastfed3, breastfed4, nrow=2)


#Diagnosed with gestational diabetes during preg 
#First Pregnancy
  #fb_preg10_1 <- fb %>%  filter((fb$D_391951010_1_1!=746038746 | fb$D_391951010_1_1!=306890578) & fb$D_405571048 >=1) <-- why unequal??
fb_preg10_1 <- fb %>%  filter(fb$D_391951010_1_1==628445697 | fb$D_391951010_1_1==419220239 | 
                              fb$D_391951010_1_1==223216393 |  fb$D_391951010_1_1==858244199)


preg10_1_ans= fb_preg10_1 %>%  mutate(answer= case_when(D_779052408_1_1==353358909 ~ "Yes",
                                             D_779052408_1_1==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg10_1_summary <- preg10_1_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg10_1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg10_1: Diagnosed with gestational diabetes during first pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Second Pregnancy 
fb_preg10_2 <- fb %>%  filter(fb$D_391951010_2_2==628445697 | fb$D_391951010_2_2==419220239 | 
                              fb$D_391951010_2_2==223216393 |  fb$D_391951010_2_2==858244199)


preg10_2_ans= fb_preg10_2 %>%  mutate(answer= case_when(D_779052408_2_2==353358909 ~ "Yes",
                                             D_779052408_2_2==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg10_2_summary <- preg10_2_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg10_2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg10_2: Diagnosed with gestational diabetes during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#Third Pregnancy 
fb_preg10_3 <- fb %>%  filter(fb$D_391951010_3_3==628445697 | fb$D_391951010_3_3==419220239 | 
                              fb$D_391951010_3_3==223216393 |  fb$D_391951010_3_3==858244199)

preg10_3_ans= fb_preg10_3 %>%  mutate(answer= case_when(D_779052408_3_3==353358909 ~ "Yes",
                                             D_779052408_3_3==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg10_3_summary <- preg10_3_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg10_3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg10_3: Diagnosed with gestational diabetes during third pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#Fourth Pregnancy
fb_preg10_4 <- fb %>%  filter(fb$D_391951010_4_4==628445697 | fb$D_391951010_4_4==419220239 | 
                              fb$D_391951010_4_4==223216393 |  fb$D_391951010_4_4==858244199)

preg10_4_ans= fb_preg10_4 %>%  mutate(answer= case_when(D_779052408_4_4==353358909 ~ "Yes",
                                             D_779052408_4_4==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg10_4_summary <- preg10_4_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg10_4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg10_4: Diagnosed with gestational diabetes during fourth pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



##Diagnosed with eclampsia during preg
#First Pregnancy 
fb_preg11_1 <- fb %>%  filter(fb$D_391951010_1_1==628445697 | fb$D_391951010_1_1==419220239 | 
                              fb$D_391951010_1_1==223216393 |  fb$D_391951010_1_1==858244199)


preg11_1_ans= fb_preg11_1 %>%  mutate(answer= case_when(D_133297530_1_1==353358909 ~ "Yes",
                                             D_133297530_1_1==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg11_1_summary <- preg11_1_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg11_1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg11_1: Diagnosed with eclampsia or pre-eclampsia during first pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Second Pregnancy
fb_preg11_2 <- fb %>%  filter(fb$D_391951010_2_2==628445697 | fb$D_391951010_2_2==419220239 | 
                              fb$D_391951010_2_2==223216393 |  fb$D_391951010_2_2==858244199)

preg11_2_ans= fb_preg11_2 %>%  mutate(answer= case_when(D_133297530_2_2==353358909 ~ "Yes",
                                             D_133297530_2_2==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg11_2_summary <- preg11_2_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)
gtm3_print <- gt(dtpreg11_2_summary)
#gtm3_print

dtpreg11_2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg11_2: Diagnosed with eclampsia or pre-eclampsia during second pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#Third Pregnancy 
fb_preg11_3 <- fb %>%  filter(fb$D_391951010_3_3==628445697 | fb$D_391951010_3_3==419220239 | 
                              fb$D_391951010_3_3==223216393 |  fb$D_391951010_3_3==858244199)


preg11_3_ans= fb_preg11_3 %>%  mutate(answer= case_when(D_133297530_3_3==353358909 ~ "Yes",
                                             D_133297530_3_3==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg11_3_summary <- preg11_3_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)
gtm3_print <- gt(dtpreg11_3_summary)
#gtm3_print

dtpreg11_3_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg11_3: Diagnosed with eclampsia or pre-eclampsia during third pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#Fourth Pregnancy 
fb_preg11_4 <- fb %>%  filter(fb$D_391951010_4_4==628445697 | fb$D_391951010_4_4==419220239 | 
                              fb$D_391951010_4_4==223216393 |  fb$D_391951010_4_4==858244199)


preg11_4_ans= fb_preg11_4 %>%  mutate(answer= case_when(D_133297530_4_4==353358909 ~ "Yes",
                                             D_133297530_4_4==104430631 ~ "No",
                                             TRUE ~ "Skipped this question"))

dtpreg11_4_summary <- preg11_4_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtpreg11_4_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Preg11_4: Diagnosed with eclampsia or pre-eclampsia during fourth pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


```

## Fertility 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever tried to get pregnant for over a year but did not
#one_logic_funct(D_939897560, D_407056417, 536341288, "FERT1: Tried to get pregant for over a year but did not")
FERT1= data_tib_m2  %>%   filter(D_407056417==536341288)

bby_asp= FERT1 %>%  mutate(reasons= case_when(D_939897560==104430631 ~ "No",
                                             D_939897560==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



FERT1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

FERT1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("FERT1: Tried to get pregant for over a year but did not")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#How old when first tried
boxp_funct_F(D_760801131,"FERT2: Age you First Tried to get Pregnant for Over 1 Year", "Age")


#Sought medical advise
#one_logic_funct(D_424047361, D_939897560, 353358909, "FERT3: Sought medical advise for pregnancy")
FERT3= data_tib_m2  %>%   filter(D_939897560==353358909)

bby_asp= FERT3 %>%  mutate(reasons= case_when(D_996243083==104430631 ~ "No",
                                             D_996243083==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



FERT3_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

FERT3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("FERT3: Sought medical advise for pregnancy")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



```


```{r, include=FALSE}

dtfert4= fb %>% filter(D_424047361==353358909) 


preg_iss= dtfert4 %>%  mutate(issue= case_when(D_548355426_D_548355426_D_342735868==1 ~ "Tubal blockage",
                                             D_548355426_D_548355426_D_990599372==1 ~ "Ovary or hormone problem",
                                             D_548355426_D_548355426_D_863286658==1 ~ "Endometriosis",
                                             D_548355426_D_548355426_D_202355614==1 ~ "Cervical mucus",
                                             D_548355426_D_548355426_D_201434907==1 ~ "Partner's infertility",
                                             D_548355426_D_548355426_D_570171052==1 ~ "Not looked into",
                                             D_548355426_D_548355426_D_498799217==1 ~ "No cause found",
                                             D_548355426_D_548355426_D_807835037==1 ~ "Other",
                                             TRUE~ "Skipped this question"))

 
preg_issues<- dtfert4[, grepl("548355426", colnames(dtfert4))]
painmds <- preg_issues[, c(3,9,8,2,1,5,4,6 )]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Tubal blockage","Ovary or hormone problem","Endometriosis","Cervical mucus","Partner's infertility","Not looked into","No cause found","Other")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
fert4 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(preg_iss$issue=="Skipped this question")[2])
fert4[as.numeric(dim(fert4)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtfert4)[[1]])*100,2))


fert4 <- fert4 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("FERT4: Issue preventing pregnancy")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  fert4,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



#Used fertility meds
#one_logic_funct(D_224681201, D_407056417, 536341288, "FERT5: Ever used fertility medication")
FERT5= data_tib_m2  %>%   filter(D_407056417==536341288)

bby_asp= FERT5 %>%  mutate(reasons= case_when(D_224681201==104430631 ~ "No",
                                             D_224681201==353358909 ~ "Yes",
                                             D_224681201==746038746 ~ "Declined",
                                             TRUE~"Skipped this question"))



FERT5_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

FERT5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("FERT5: Ever used fertility medication")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

```



```{r, include=FALSE}

dtFERT6= fb %>% filter(D_224681201==353358909)


fert_med= dtFERT6 %>%  mutate(meds= case_when(D_881200765_D_881200765_D_619799524==1 ~ "Chlomid",
                                             D_881200765_D_881200765_D_663814928==1 ~ "Injectables",
                                             D_881200765_D_881200765_D_642004888==1 ~ "Danazol",
                                             D_881200765_D_881200765_D_454641975==1 ~ "Danocrine",
                                             D_881200765_D_881200765_D_256131117==1 ~ "Hcg",
                                             D_881200765_D_881200765_D_532607252==1 ~ "Milophene",
                                             D_881200765_D_881200765_D_459188493==1 ~ "Lupron depot",
                                             D_881200765_D_881200765_D_304927036==1 ~ "Nolyadex",
                                             D_881200765_D_881200765_D_100181644==1 ~ "Pergonal",
                                             D_881200765_D_881200765_D_372219003==1 ~ "Serophene",
                                             D_881200765_D_881200765_D_743731422==1 ~ "Synarel",
                                             D_881200765_D_881200765_D_807835037==1 ~ "Other",
                                             D_881200765_D_881200765_D_535003378==1 ~ "None of the above",
                                             TRUE  ~ "Skipped this question"))

 
preg_issues<- dtFERT6[, grepl("881200765", colnames(dtFERT6))]
painmds <- preg_issues[, c(10,12,11,6,3,8,7,4,2,5,13,11,9)]

medsp_dx <- NULL
for (i in 1:13){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Chlomid","Injectables","Danazol","Danocrine", "Hcg","Milophene","Lupron depot","Nolyadex","Pergonal","Serophene","Synarel","Other","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
fert6 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(fert_med$meds=="Skipped this question")[2])
fert6[as.numeric(dim(fert6)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtFERT6)[[1]])*100,2))


fert6 <- fert6 %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("FERT6: Used these fertility medications")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  fert6,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)
```

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#how many months/cycles taken     
  #table(fem_birth$D_139673389) #chlomid 
hist_funct_F(D_139673389,"FERT17_1: Months/Cycles taking Chlomid", "Months", "Frequency")

  #table(fem_birth$D_943996164) #injectables
hist_funct_F(D_943996164,"FERT17_2: Months/Cycles taking Injectables", "Months", "Frequency")

  #table(fem_birth$D_994899398) #danazol-1
hist_funct_F(D_994899398,"FERT17_3: Months/Cycles taking Danazol", "Months", "Frequency")

  #table(fem_birth$D_198719822) #danocrine-0 #<------- missing
hist_funct_F(D_198719822,"FERT17_4: Months/Cycles taking Danocrine", "Months", "Frequency") #not enough answers?

  #table(fem_birth$D_628137243) #hcg 
hist_funct_F(D_628137243,"FERT17_5: Months/Cycles taking HCG", "Months", "Frequency")

  #table(fem_birth$D_399078599) #milophene-0
hist_funct_F(D_399078599,"FERT17_6: Months/Cycles taking Milophene", "Months", "Frequency") #don't know why this wont run

  #table(fem_birth$D_560711355) #lupron depot
hist_funct_F(D_560711355,"FERT17_7: Months/Cycles taking Lupron Depot", "Months", "Frequency")

  #table(fem_birth$D_309710463) #nolvadex-0
hist_funct_F(D_309710463,"FERT17_8: Months/Cycles taking Nolvadex", "Months", "Frequency") #don't know why this wont run

  #table(fem_birth$D_167207966) #pergonal
hist_funct_F(D_167207966,"FERT17_9: Months/Cycles taking Pergonal", "Months", "Frequency")

  #table(fem_birth$D_538349354) #serophene 
hist_funct_F(D_538349354,"FERT17_10: Months/Cycles taking Serophene", "Months", "Frequency")

  #table(fem_birth$D_767785846) #synarel -0 #<------------ missing
hist_funct_F(D_767785846,"FERT17_11: Months/Cycles taking Synarel", "Months", "Frequency")

  #table(fem_birth$D_466346054) #other 
hist_funct_F(D_466346054,"FERT17_12: Months/Cycles taking Other Medications", "Months", "Frequency")


```


```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Tried IVF
#one_logic_funct(D_111082535, D_407056417, 536341288, "FERT8: Ever had IVF")
FERT8= data_tib_m2  %>%   filter(D_407056417==536341288)

bby_asp= FERT8 %>%  mutate(reasons= case_when(D_111082535==104430631 ~ "No",
                                             D_111082535==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



FERT8_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

FERT8_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("FERT8: Ever had IVF")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#How many cycles of IVF   
hist_funct_F(D_875135634,"FERT9: Cycles of IVF", "Cycles", "Frequency")
```

## Hormone Medications and/or Contraceptive Devices
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#Used any hormone meds/contraceptives----- can't do regular select all code because of the two different versions of the variable


dtHORMED= fb %>%  mutate(multb2 = ifelse((D_543780863_D_441493408==1 | D_543780863_D_543780863_D_441493408==1), 1, 0) + ifelse((D_543780863_D_612012325==1 | D_543780863_D_543780863_D_612012325==1), 1, 0) + ifelse((D_543780863_D_100752105==1 | D_543780863_D_543780863_D_100752105==1), 1, 0) + ifelse((D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1), 1, 0) + ifelse((D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1), 1, 0) + ifelse((D_543780863_D_863920008==1 | D_543780863_D_543780863_D_863920008==1), 1, 0) + ifelse((D_543780863_D_787142499==1 | D_543780863_D_543780863_D_787142499==1), 1, 0) + ifelse((D_543780863_D_205223932==1 | D_543780863_D_543780863_D_205223932==1), 1, 0) + ifelse((D_543780863_D_817131019==1 | D_543780863_D_543780863_D_817131019==1), 1, 0) + ifelse((D_543780863_D_807835037==1 | D_543780863_D_543780863_D_807835037==1), 1, 0) + ifelse((D_543780863_D_535003378==1 | D_543780863_D_543780863_D_535003378==1), 1, 0))


HORMED_med= dtHORMED %>%  mutate(meds= case_when( (as.numeric(multb2)>1) ~ "Multiple Medications",
                                                  (D_543780863_D_441493408==1 | D_543780863_D_543780863_D_441493408==1) ~ "Oral contraceptives (the pill)",
                                                  (D_543780863_D_612012325==1 | D_543780863_D_543780863_D_612012325==1) ~ "Progesterone pills (mini-pill)",
                                                  (D_543780863_D_100752105==1 | D_543780863_D_543780863_D_100752105==1) ~ "Norplant",
                                                  (D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1) ~ "Depo-provera (shot)",
                                                  (D_543780863_D_863920008==1 | D_543780863_D_543780863_D_863920008==1) ~ "Vaginal ring",
                                                  (D_543780863_D_787142499==1 | D_543780863_D_543780863_D_787142499==1) ~ "Birth Control Patch",
                                                  (D_543780863_D_205223932==1 | D_543780863_D_543780863_D_205223932==1) ~ "Copper IUD",
                                                  (D_543780863_D_817131019==1 | D_543780863_D_543780863_D_817131019==1) ~ "Hormonal IUD",
                                                  (D_543780863_D_807835037==1 | D_543780863_D_543780863_D_807835037==1) ~ "Other",
                                                  (D_543780863_D_535003378==1 | D_543780863_D_543780863_D_535003378==1) ~ "None of the above",
                                                  TRUE~ "Skipped this question"))


dtHORMED_summary <- HORMED_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtHORMED_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HORMED: Ever used these hormone medications")) %>%
  cols_label(n= md("**Number of Participants**"), meds = md("**Medications**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```


```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#How old when first used
HORMED2_1 <- boxp_funct_F(D_880331901,"HORMED2_1: Age when 'The Pill' First Used", "Age")

HORMED2_2 <- boxp_funct_F(D_809735528,"HORMED2_2: Age when 'The Mini-Pill' First Used", "Age")

HORMED2_3 <- boxp_funct_F(D_220105997,"HORMED2_3: Age when Norplant First Used", "Age")

HORMED2_4 <- boxp_funct_F(D_938969985,"HORMED2_4: Age when 'The Shot' First Used", "Age")

HORMED2_5 <- boxp_funct_F(D_902999015,"HORMED2_5: Age when 'The Ring' First Used", "Age")
grid.arrange(HORMED2_1, HORMED2_2, HORMED2_3, HORMED2_4, HORMED2_5, nrow=3)


HORMED2_6 <- boxp_funct_F(D_807214881,"HORMED2_6: Age when 'The Patch' First Used", "Age")

HORMED2_7 <- boxp_funct_F(D_901154649,"HORMED2_7: Age when a CIUD First Used", "Age")

HORMED2_8 <- boxp_funct_F(D_404596261,"HORMED2_8: Age when an HIUD First Used", "Age")

HORMED2_9 <- boxp_funct_F(D_583012139,"HORMED2_9: Age when Other Hormonal Meds First Used", "Age")
grid.arrange(HORMED2_6, HORMED2_7, HORMED2_8, HORMED2_9, nrow=2)


```


```{r, warning=FALSE, echo=FALSE, message=FALSE}
## MAY NEED TO LOOK INTO--- D_543780863_ VS D_543780863_D_543780863_
#Currently using
#Oral Contraceptive Pill
#one_logic_funct(D_301052397, D_543780863_D_543780863_D_441493408, 1, "HORMED3_1: Currently Taking Oral Contraceptive Pill")
HORMED3_1= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_441493408==1 | D_543780863_D_441493408==1)

bby_asp= HORMED3_1 %>%  mutate(reasons= case_when(D_301052397==104430631 ~ "No",
                                             D_301052397==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_1: Currently Taking Oral Contraceptive Pill")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Progestin only Contraceptive Pill
#one_logic_funct(D_958009220, D_543780863_D_543780863_D_612012325, 1, "HORMED3_2: Currently Taking Progestin only Contraceptive Pill")
HORMED3_2= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_612012325==1 | D_543780863_D_612012325==1)

bby_asp= HORMED3_2 %>%  mutate(reasons= case_when(D_958009220==104430631 ~ "No",
                                             D_958009220==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_2: Currently Taking Progestin only Contraceptive Pill")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Norplant
#one_logic_funct(D_806253825, D_543780863_D_543780863_D_100752105, 1, "HORMED3_3: Currently Taking Norplant")
HORMED3_3= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_100752105==1 | D_543780863_D_100752105==1)

bby_asp= HORMED3_3 %>%  mutate(reasons= case_when(D_806253825==104430631 ~ "No",
                                             D_806253825==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_3_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_3: Currently Taking Norplant")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

#Depo-Provera
#one_logic_funct(D_876683805, D_543780863_D_543780863_D_207913198, 1, "HORMED3_4: Currently Taking Depo-Provera")
HORMED3_4= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_207913198==1 | D_543780863_D_207913198==1)

bby_asp= HORMED3_4 %>%  mutate(reasons= case_when(D_876683805==104430631 ~ "No",
                                             D_876683805==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_4_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_4: Currently Taking Depo-Provera")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Vaginal Ring
#one_logic_funct(D_484006644, D_543780863_D_543780863_D_863920008, 1, "HORMED3_5: Currently Using a Vaginal Ring")
HORMED3_5= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_863920008==1 | D_543780863_D_863920008==1)

bby_asp= HORMED3_5 %>%  mutate(reasons= case_when(D_484006644==104430631 ~ "No",
                                             D_484006644==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_5_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_5: Currently Using a Vaginal Ring")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Birth Control Patch
#one_logic_funct(D_344573484, D_543780863_D_787142499, 1, "HORMED3_6: Currently Using a Birth Control Patch")
HORMED3_6= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_787142499==1 | D_543780863_D_787142499==1)

bby_asp= HORMED3_6 %>%  mutate(reasons= case_when(D_344573484==104430631 ~ "No",
                                             D_344573484==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_6_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_6_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_6: Currently Using a Birth Control Patch")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#CIUD
#one_logic_funct(D_100937200, D_543780863_D_543780863_D_205223932, 1, "HORMED3_7: Currently Using a CIUD")
HORMED3_7= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_205223932==1 | D_543780863_D_205223932==1)

bby_asp= HORMED3_7 %>%  mutate(reasons= case_when(D_100937200==104430631 ~ "No",
                                             D_100937200==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_7_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_7_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_7: Currently Using a CIUD")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#HIUD
#one_logic_funct(D_465017353, D_543780863_D_543780863_D_817131019, 1, "HORMED3_8: Currently Using an HIUD")
HORMED3_8= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_817131019==1 | D_543780863_D_817131019==1)

bby_asp= HORMED3_8 %>%  mutate(reasons= case_when(D_465017353==104430631 ~ "No",
                                             D_465017353==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_8_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_8_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_8: Currently Using an HIUD")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Other
#one_logic_funct(D_991330361, D_543780863_D_543780863_D_807835037, 1, "HORMED3_9: Currently Taking Other Hormone Medications")
HORMED3_9= data_tib_m2  %>%   filter(D_543780863_D_543780863_D_807835037==1 | D_543780863_D_807835037==1)

bby_asp= HORMED3_9 %>%  mutate(reasons= case_when(D_991330361==104430631 ~ "No",
                                             D_991330361==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



HORMED3_9_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

HORMED3_9_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("HORMED3_9: Currently Taking Other Hormone Medications")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


```


```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Age last used
boxp_funct_F(D_734836192,"HORMED4_1: Age when 'The Pill' Last Used", "Age")

boxp_funct_F(D_946211808,"HORMED4_2: Age when 'The Mini-Pill' Last Used", "Age") 

boxp_funct_F(D_819957363,"HORMED4_3: Age when Norplant Last Used", "Age") 

boxp_funct_F(D_118237712,"HORMED4_4: Age when 'The Shot' Last Used", "Age") 

boxp_funct_F(D_190721176,"HORMED4_5: Age when 'The Ring' Last Used", "Age") 

boxp_funct_F(D_708921303,"HORMED4_6: Age when 'The Patch' Last Used", "Age") 

boxp_funct_F(D_452984435,"HORMED4_7: Age when a CIUD Last Used", "Age") 

boxp_funct_F(D_370798456,"HORMED4_8: Age when an HIUD Last Used", "Age")

boxp_funct_F(D_184692605,"HORMED4_9: Age when Other Hormonal Med Last Used", "Age")



#Months/Years of total use
hist_funct_F(D_215455305_D_434243220,"HORMED5_1: Months The Pill was Used", "Months", "Frequency")
hist_funct_F(D_215455305_D_970604592,"HORMED5_1: Years The Pill was Used", "Years", "Frequency")

hist_funct_F(D_654271781_D_434243220,"HORMED5_2: Months The Mini-Pill was Used", "Months", "Frequency")
hist_funct_F(D_654271781_D_970604592,"HORMED5_2: Years The Mini-Pill was Used", "Years", "Frequency")


hist_funct_F(D_604086099_D_434243220,"HORMED5_3: Months The Norplant was Used", "Months", "Frequency")
module2$D_604086099_D_970604592 <- round(as.numeric(module2$D_604086099_D_970604592), digits=0)
hist_funct_F(D_604086099_D_970604592,"HORMED5_3: Years The Norplant was Used", "Years", "Frequency")

hist_funct_F(D_899455852_D_434243220,"HORMED5_4: Months The Shot was Used", "Months", "Frequency")
hist_funct_F(D_899455852_D_970604592,"HORMED5_4: Years The Shot was Used", "Years", "Frequency")

hist_funct_F(D_358011592_D_434243220,"HORMED5_5: Months The Ring was Used", "Months", "Frequency")
hist_funct_F(D_358011592_D_970604592,"HORMED5_5: Years The Ring was Used", "Years", "Frequency")


hist_funct_F(D_535533643_D_434243220,"HORMED5_6: Months The Patch was Used", "Months", "Frequency")
hist_funct_F(D_535533643_D_970604592,"HORMED5_6: Years The Patch was Used", "Years", "Frequency")


hist_funct_F(D_129924389_D_434243220,"HORMED5_7: Months a CIUD was Used", "Months", "Frequency")
hist_funct_F(D_129924389_D_970604592,"HORMED5_7: Years a CIUD was Used", "Years", "Frequency")


hist_funct_F(D_101144925_D_434243220,"HORMED5_8: Months an HIUD was Used", "Months", "Frequency")
module2$D_101144925_D_970604592 <- round(as.numeric(module2$D_101144925_D_970604592), digits=0)
hist_funct_F(D_101144925_D_970604592,"HORMED5_8: Years an HIUD was Used", "Years", "Frequency")

hist_funct_F(D_139348254_D_434243220,"HORMED5_9: Months an Other Medication was Used", "Months", "Frequency")
hist_funct_F(D_139348254_D_970604592,"HORMED5_9: Years an Other Medication was Used", "Years", "Frequency")

```

## Horomone Therapy

```{r, warning=FALSE, echo=FALSE, message=FALSE }
#Used prescribed hormone
#one_logic_funct(D_621744463, D_407056417, 536341288, "MENOHOR: Used Prescribed Hormones")
MENOHOR= data_tib_m2  %>%   filter(D_407056417==536341288)

bby_asp= MENOHOR %>%  mutate(reasons= case_when(D_621744463==104430631 ~ "No",
                                             D_621744463==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



MENOHOR_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

MENOHOR_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MENOHOR: Used Prescribed Hormones")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

```

### Estrogen-only Prescription Hormones
```{r, include=FALSE}

dtESTROHOR= fb  %>% filter(D_621744463==353358909)


est_med= dtESTROHOR %>%  mutate(meds= case_when(D_668834883_D_668834883_D_246843973==1 ~ "Oral Estrogen",
                                             D_668834883_D_668834883_D_854184254==1 ~ "Patch Estrgen",
                                             D_668834883_D_668834883_D_515434780==1 ~ "Vaginal Ring/Vaginal Cream/Tablet Estrogen",
                                             D_668834883_D_668834883_D_674148137==1 ~ "Estrogen only Skin Gel/Cream/Spray-on",
                                             D_668834883_D_668834883_D_807835037==1 ~ "Other",
                                             D_668834883_D_668834883_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this question"))

 
painmeds<- dtESTROHOR[, grepl("668834883", colnames(dtESTROHOR))]
painmds <- painmeds[, c(2,8, 3,6, 7,4)]

medsp_dx <- NULL
for (i in 1:6){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Oral Estrogen","Patch Estrgen", "Vaginal Ring/Vaginal Cream/Tablet Estrogen","Estrogen only Skin Gel/Cream/Spray-on","Other","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
estro <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(est_med$meds=="Skipped this question")[2])
estro[as.numeric(dim(estro)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtESTROHOR)[[1]])*100,2))


estro <- estro %>%  gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR: Ever used these hormone medications")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Answer**"), Percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# %>% opt_row_striping()

tab_footnote(
  estro,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```



```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#How old when first used
boxp_funct_F(D_856627601,"ESTROHOR2_1: Age When Oral Hormone Therapy First Used", "Age")


boxp_funct_F(D_564185028,"ESTROHOR2_2: Age When Patch Hormone Therapy First Used", "Age")


boxp_funct_F(D_648678282,"ESTROHOR2_3: Age When Ring Hormone Therapy First Used", "Age")


boxp_funct_F(D_291707744,"ESTROHOR2_4: Age When Gel/Cream Hormone Therapy First Used", "Age")


boxp_funct_F(D_872509317,"ESTROHOR2_5: Age When Other Hormone Therapy First Used", "Age")

```


```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Currently using

#Oral Estrogen --gt table not runner well for these either
#one_logic_funct(D_801749224, D_668834883_D_668834883_D_246843973, 1, "ESTROHOR3_1: Currently Using Oral Estrogen")
ESTROHOR3_1= data_tib_m2  %>%   filter(D_668834883_D_668834883_D_246843973==1)

bby_asp= ESTROHOR3_1 %>%  mutate(reasons= case_when(D_801749224==104430631 ~ "No",
                                             D_801749224==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



ESTROHOR3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ESTROHOR3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR3_1: Currently Using Oral Estrogen")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Patch Estrogen  
#one_logic_funct(D_560845692, D_668834883_D_668834883_D_854184254, 1, "ESTROHOR3_2: Currently Using Patch Estrogen")
ESTROHOR3_2= data_tib_m2  %>%   filter(D_668834883_D_668834883_D_854184254==1)

bby_asp= ESTROHOR3_2 %>%  mutate(reasons= case_when(D_560845692==104430631 ~ "No",
                                             D_560845692==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



ESTROHOR3_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ESTROHOR3_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR3_2: Currently Using Patch Estrogen")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Vaginal Ring/Cream/Tablet Estrogen 
#one_logic_funct(D_850536692, D_668834883_D_668834883_D_515434780, 1, "ESTROHOR3_3: Currently Using Vaginal Ring/Cream/Tablet Estrogen")
ESTROHOR3_3= data_tib_m2  %>%   filter(D_668834883_D_668834883_D_515434780==1)

bby_asp= ESTROHOR3_3 %>%  mutate(reasons= case_when(D_850536692==104430631 ~ "No",
                                             D_850536692==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



ESTROHOR3_3_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ESTROHOR3_3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR3_3: Currently Using Vaginal Ring/Cream/Tablet Estrogen")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()




#Skin Gel/Cream/Spray-on Estrogen 
#one_logic_funct(D_792792066, D_668834883_D_668834883_D_674148137, 1, "ESTROHOR3_4: Currently Using Skin Gel/Cream/Spray-on Estrogen")
ESTROHOR3_4= data_tib_m2  %>%   filter(D_668834883_D_668834883_D_674148137==1)

bby_asp= ESTROHOR3_4 %>%  mutate(reasons= case_when(D_792792066==104430631 ~ "No",
                                             D_792792066==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



ESTROHOR3_4_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ESTROHOR3_4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR3_4: Currently Using Skin Gel/Cream/Spray-on Estrogen")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Other Estrogen 
#one_logic_funct(D_378921620, D_668834883_D_668834883_D_807835037, 1, "ESTROHOR3_5: Currently Using Vaginal Other Estrogen")
ESTROHOR3_5= data_tib_m2  %>%   filter(D_668834883_D_668834883_D_807835037==1)

bby_asp= ESTROHOR3_5 %>%  mutate(reasons= case_when(D_378921620==104430631 ~ "No",
                                             D_378921620==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



ESTROHOR3_5_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

ESTROHOR3_5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR3_5: Currently Using Vaginal Other Estrogen")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

```


```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Age last used 
boxp_funct_F(D_799382711,"ESTROHOR4_1: Age Oral Homrone Therapy Last Used", "Age")


boxp_funct_F(D_779165920,"ESTROHOR4_2: Age Patch Homrone Therapy Last Used", "Age")


boxp_funct_F(D_774992239,"ESTROHOR4_3: Age Ring Homrone Therapy Last Used", "Age")


boxp_funct_F(D_894363067,"ESTROHOR4_4: Age Gel/Cream Homrone Therapy Last Used", "Age")


boxp_funct_F(D_854078473,"ESTROHOR4_5: Age Other Homrone Therapy Last Used", "Age")


#Months/Years of total use
module2$D_623759247_D_434243220 <- round(as.numeric(module2$D_623759247_D_434243220), digits=0)
hist_funct_F(D_623759247_D_434243220, "ESTROHOR5_1: Months Oral Hormone Therapy was Used", "Months", "Frequency")
hist_funct_F(D_623759247_D_970604592, "ESTROHOR5_1: Years Oral Hormone Therapy was Used", "Years", "Frequency")


hist_funct_F(D_745775718_D_434243220, "ESTROHOR5_2: Months Patch Hormone Therapy was Used", "Months", "Frequency")
hist_funct_F(D_745775718_D_970604592, "ESTROHOR5_2: Years Patch Hormone Therapy was Used", "Years", "Frequency")


hist_funct_F(D_695206943_D_434243220, "ESTROHOR5_3: Months Ring Hormone Therapy was Used", "Months", "Frequency")
hist_funct_F(D_695206943_D_970604592, "ESTROHOR5_3: Years Ring Hormone Therapy was Used", "Years", "Frequency")


hist_funct_F(D_984901301_D_434243220, "ESTROHOR5_4: Months Gel/Cream Hormone Therapy was Used", "Months", "Frequency")
hist_funct_F(D_984901301_D_970604592, "ESTROHOR5_4: Years Gel/Cream Hormone Therapy was Used", "Years", "Frequency")


hist_funct_F(D_268372217_D_434243220, "ESTROHOR5_5: Months Other Hormone Therapy was Used", "Months", "Frequency")
module2$D_268372217_D_970604592 <- round(as.numeric(module2$D_268372217_D_970604592), digits=0)
hist_funct_F(D_268372217_D_970604592, "ESTROHOR5_5: Years Other Hormone Therapy was Used", "Years", "Frequency")


```


### Progestin-only Prescription Hormones 

```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken

dtPROGHOR= fb  %>% filter(D_621744463==353358909)


prog_med= dtPROGHOR %>%  mutate(meds= case_when(D_800943768_D_800943768_D_687050279==1 & D_800943768_D_800943768_D_807835037==1 ~ "Both",
                                                D_800943768_D_800943768_D_687050279==1 ~ "Oral Progestin",
                                             D_800943768_D_800943768_D_807835037==1 ~ "Other Progestin",
                                             D_800943768_D_800943768_D_535003378==1 ~ "None of the Above",
                                             TRUE ~ "Skipped this question"))
prog_med$meds <- factor(prog_med$meds,levels=c("Oral Progestin", "Other Progestin", "Both","None of the Above", "Skipped this question"))


dtPROGHOR_summary <- prog_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtPROGHOR_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR: Ever used these hormone medications")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Age first used
boxp_funct_F(D_590329439,"PROGHOR2_1: Age Oral Progestin First Used", "Age")

boxp_funct_F(D_356969766,"PROGHOR2_2: Age Other Progestin First Used", "Age")

##Currently using
#Oral
#one_logic_funct(D_906459952, D_800943768_D_800943768_D_687050279, 1, "PROGHOR3_1: Currently Using Oral Progestin")
PROGHOR3_1= data_tib_m2  %>%   filter(D_800943768_D_800943768_D_687050279==1)

bby_asp= PROGHOR3_1 %>%  mutate(reasons= case_when(D_906459952==104430631 ~ "No",
                                             D_906459952==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



PROGHOR3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PROGHOR3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR3_1: Currently Using Oral Progestin")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Other
#one_logic_funct(D_453820991, D_800943768_D_800943768_D_807835037, 1, "PROGHOR3_2: Currently Using Other Progestin")
PROGHOR3_2= data_tib_m2  %>%   filter(D_800943768_D_800943768_D_807835037==1)

bby_asp= PROGHOR3_2 %>%  mutate(reasons= case_when(D_453820991==104430631 ~ "No",
                                             D_453820991==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



PROGHOR3_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

PROGHOR3_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR3_2: Currently Using Other Progestin")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()


#Age last used
boxp_funct_F(D_747629521,"PROGHOR4_1: Age Oral Progestin Last Used", "Age")

boxp_funct_F(D_111271067,"PROGHOR4_2: Age Other Progestin Last Used", "Age")

#Months/years of total use
hist_funct_F(D_556129044_D_434243220,"PROGHOR5_1: Months Oral Progestin was Used", "Years", "Frequency")
hist_funct_F(D_556129044_D_970604592,"PROGHOR5_1: Years Oral Progestin was Used", "Years", "Frequency")


hist_funct_F(D_597869478_D_434243220,"PROGHOR5_2: Months Other Progestin was Used", "Years", "Frequency")
hist_funct_F(D_597869478_D_970604592,"PROGHOR5_2: Years Other Progestin was Used", "Years", "Frequency")

#Days per cycle used (oral)

dtCOMBHOR= fb  %>%   filter(D_800943768_D_800943768_D_687050279==1)
prog_med= dtCOMBHOR %>%  mutate(meds= case_when(D_563663099=="647504893"~"Everyday",
                                                D_563663099=="862918284"~"0-9 per month",
                                                D_563663099=="275059825"~"10-14 per month",
                                                D_563663099=="481217808"~"15-19 per month",
                                                D_563663099=="565450397"~"20-25 per month",
                                                TRUE  ~ "Skipped this question"))


dtCOMBHOR_summary <- prog_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtCOMBHOR_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR6_1: Days per Cycle Oral Progestin Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Days per cycle used (prescription)


dtCOMBHOR= fb  %>%   filter(D_800943768_D_800943768_D_807835037==1)
prog_med= dtCOMBHOR %>%  mutate(meds= case_when(D_949663397=="647504893"~"Everyday",
                                         D_949663397=="862918284"~"0-9 per month",
                                         D_949663397=="275059825"~"10-14 per month",
                                         D_949663397=="481217808"~"15-19 per month",
                                         D_949663397=="565450397"~"20-25 per month",
                                             TRUE  ~ "Skipped this question"))


dtCOMBHOR_summary <- prog_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtCOMBHOR_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR6_2: Days per Cycle Other Progestin Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()


```


### Combined estrogen and progestin

```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken
dtCOMBHOR= fb  %>%   filter(D_621744463==353358909)


est_med= dtCOMBHOR %>%  mutate(meds= case_when(D_263785082_D_263785082_D_837393880==1 ~ "Combined oral estrogen plus progestin pill",
                                             D_263785082_D_263785082_D_944874693==1 ~ "Two separate pills",
                                             D_263785082_D_263785082_D_837393880==1 & D_263785082_D_263785082_D_944874693==1 ~ "Both",
                                             D_263785082_D_263785082_D_807835037==1 ~ "Other combined estrogen plus progestin hormones",
                                             D_263785082_D_263785082_D_535003378==1 ~ "None of the above",
                                             TRUE  ~ "Skipped this question"))
est_med$meds <- factor(est_med$meds,levels=c("Combined oral estrogen plus progestin pill", "Two separate pills", "Both","Other combined estrogen plus progestin hormones","None of the above","Skipped this question"))


dtCOMBHOR_summary <- est_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtCOMBHOR_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR: Ever Use Combined Estrogen and Progestin Medications")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Age first used
boxp_funct_F(D_824165133,"COMBHOR2_1: Age Combined Estrogen & Progestin First Used", "Age")

boxp_funct_F(D_922903688,"COMBHOR2_2: Age Separate Pill Estrogen & Progestin First Used", "Age")

boxp_funct_F(D_219538082,"COMBHOR2_3: Age Other Estrogen & Progestin First Used", "Age")


##Currently using
#Combined
#one_logic_funct(D_295472931, D_263785082_D_263785082_D_837393880, 1, "COMBHOR3_1: Currently Using Combined Estrogen and Progestin")
COMBHOR3_1= data_tib_m2  %>%   filter(D_263785082_D_263785082_D_837393880==1)

bby_asp= COMBHOR3_1 %>%  mutate(reasons= case_when(D_295472931==104430631 ~ "No",
                                             D_295472931==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



COMBHOR3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

COMBHOR3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR3_1: Currently Using Combined Estrogen and Progestin")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#2 Separate Pills
#one_logic_funct(D_963284259, D_263785082_D_263785082_D_944874693, 1, "COMBHOR3_2: Currently Using Spearated Estrogen and Progestin Pills")
COMBHOR3_2= data_tib_m2  %>%   filter(D_263785082_D_263785082_D_944874693==1)

bby_asp= COMBHOR3_2 %>%  mutate(reasons= case_when(D_963284259==104430631 ~ "No",
                                             D_963284259==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



COMBHOR3_2_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

COMBHOR3_2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR3_2: Currently Using Combined Spearated Estrogen and Progestin Pills")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()



#Other
#one_logic_funct(D_583111732, D_263785082_D_263785082_D_807835037, 1, "COMBHOR3_3: Currently Using Other Estrogen and Progestin Medication")
COMBHOR3_1= data_tib_m2  %>%   filter(D_263785082_D_263785082_D_807835037==1)

bby_asp= COMBHOR3_1 %>%  mutate(reasons= case_when(D_583111732==104430631 ~ "No",
                                             D_583111732==353358909 ~ "Yes",
                                             TRUE~"Skipped this question"))



COMBHOR3_1_summary <- bby_asp %>% group_by(reasons) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(reasons, n, percentage)

COMBHOR3_1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR3_1: Currently Using Other Estrogen and Progestin Medication")) %>% 
  cols_label(n= md("**Number of Participants**"), reasons = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = reasons,
    )
  ) %>% opt_row_striping()

##Age last used
boxp_funct_F(D_728437398,"COMBHOR4_1: Age Combined Estrogen & Progestin Last Used", "Age")

boxp_funct_F(D_615905904,"COMBHOR4_2: Age Separate Pill Estrogen & Progestin Last Used", "Age")

boxp_funct_F(D_603209609,"COMBHOR4_3: Age Other Estrogen & Progestin Last Used", "Age")

#Months/years of total use
hist_funct_F(D_578176688_D_434243220,"COMBHOR5_1: Total Months Combined Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_578176688_D_970604592,"COMBHOR5_1: Total Years Combined Estrogen & Progestin Used", "Years", "Frequency")

hist_funct_F(D_946710366_D_434243220,"COMBHOR5_2: Total Months Separate Pill Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_946710366_D_970604592,"COMBHOR5_2: Total Years Separate Pill Estrogen & Progestin Used", "Years", "Frequency")

#Other
hist_funct_F(D_824251330_D_434243220,"COMBHOR5_3: Total Months Other Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_824251330_D_970604592,"COMBHOR5_3: Total Years Other Estrogen & Progestin Used", "Years", "Frequency")


#Days per cycle used (combined pill)
dtCOMBHOR= fb  %>%   filter(D_263785082_D_263785082_D_837393880==1)
prog_med= dtCOMBHOR %>%  mutate(meds= case_when(D_912818075=="647504893"~"Everyday",
                                         D_912818075=="862918284"~"0-9 per month",
                                         D_912818075=="275059825"~"10-14 per month",
                                         D_912818075=="481217808"~"15-19 per month",
                                         D_912818075=="565450397"~"20-25 per month",
                                             TRUE  ~ "Skipped this question"))


dtCOMBHOR_summary <- prog_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtCOMBHOR_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR6_1: Days per Cycle Separate Pill Estrogen & Progestin Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Days per cycle used (separate pills)
dtCOMBHOR= fb  %>%   filter(D_263785082_D_263785082_D_944874693==1)
seph_med= dtCOMBHOR %>%  mutate(meds= case_when(D_138836502=="647504893"~"Everyday",
                                         D_138836502=="862918284"~"0-9 per month",
                                         D_138836502=="275059825"~"10-14 per month",
                                         D_138836502=="481217808"~"15-19 per month",
                                         D_138836502=="565450397"~"20-25 per month",
                                             TRUE  ~ "Skipped this question"))


dtseph_summary <- seph_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtseph_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SEPHOR: Days per Cycle Separate Pill Estrogen & Progestin Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Days per cycle used (other)
dtCOMBHOR= fb  %>%   filter(D_263785082_D_263785082_D_807835037==1)
seph2_med= dtCOMBHOR %>%  mutate(meds= case_when(D_290126991=="647504893"~"Everyday",
                                         D_290126991=="862918284"~"0-9 per month",
                                         D_290126991=="275059825"~"10-14 per month",
                                         D_290126991=="481217808"~"15-19 per month",
                                         D_290126991=="565450397"~"20-25 per month",
                                             TRUE  ~ "Skipped this question"))


dtseph2_summary <- seph2_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtseph2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SEPHOR2: Days per Cycle Other Estrogen & Progestin Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```


## Testosterone & Other Hormone Therapy 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Ever used
#one_logic_funct(D_111235606, D_621744463, 353358909, "TESTTHER1: Used Testosterone Therapy")
testt1= data_tib_m2 %>% filter(D_621744463==353358909) %>%  mutate(answer= case_when(D_111235606==104430631 ~ "No",
                                             D_111235606==132099255 ~ "Yes",
                                             TRUE ~ "Skipped this question"))

testt1_summary <- testt1 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

testt1_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("TESTTHER1: Used Testosterone Therapy")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

```
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

dtTESTTHER2= data_tib_m2  %>% filter(D_111235606==353358909)


est_med= dtTESTTHER2 %>%  mutate(meds= case_when(D_946849196_D_729863969==1 ~ "Gel/Cream Testosterone",
                                             D_946849196_D_108104748==1 ~ "Testosterone Injection",
                                             D_946849196_D_717308596==1 ~ "Testosterone Skin Patch",
                                             D_946849196_D_746788766==1 ~ "Testosterone Pills",
                                             D_946849196_D_158214723==1 ~ "Gum or Inner-cheek Patch Testosterone",
                                             D_946849196_D_658810736==1 ~ "Slow Release Implant Testosterone",
                                             TRUE ~ "Skipped this question"))

 
tmp_1<- dtTESTTHER2[, grepl("946849196", colnames(dtTESTTHER2))]
tmp1 <- tmp_1[, c(5,1,4,6,2,3)]
testtr2_dx <- NULL
for (i in 1:6){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$testtr2_dx <- colnames(tmp1)[i]
  testtr2_dx <- rbind(testtr2_dx,dt[2,])
  
}
testtr2_dx$testtr2_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

testtr2_dx$testtr2_dx <- c("Gel/Cream Testosterone","Testosterone Injection","Testosterone Skin Patch","Testosterone Pills","Gum or Inner-cheek Patch Testosterone","Slow Release Implant Testosterone")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- testtr2_dx[, c(4,1,2)]
# 
# colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- testtr2_dx[, c(4,1,2)]

colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
testt2 <- testtr2_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(est_med$meds=="Skipped this question")[2])
testt2[as.numeric(dim(testt2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtTESTTHER2)[[1]])*100,2))


dt_testt2 <- testt2 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("TESTTHER2: Testosterone Medication Forms")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_testt2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```

```{r, warning=FALSE, echo=FALSE, message=FALSE}



#Which forms
# 
# dtTESTTHER2= data_tib_m2  %>% filter(D_111235606==353358909)
# 
# 
# est_med= dtTESTTHER2 %>%  mutate(meds= case_when(D_946849196_D_729863969==1 ~ "Gel/Cream Testosterone",
#                                              D_946849196_D_108104748==1 ~ "Testosterone Injection",
#                                              D_946849196_D_717308596==1 ~ "Testosterone Skin Patch",
#                                              D_946849196_D_746788766==1 ~ "Testosterone Pills",
#                                              D_946849196_D_158214723==1 ~ "Gum or Inner-cheek Patch Testosterone",
#                                              D_946849196_D_658810736==1 ~ "Slow Release Implant Testosterone",
#                                              TRUE ~ "Skipped this question"))
# 
# 
# dtTESTTHER2_summary <- est_med %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)
# 
# 
# dtTESTTHER2_summary %>%  gt() %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("TESTTHER2: Testosterone Medication Forms")) %>% 
#   cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = meds,
#     )
#   ) %>% opt_row_striping()


#Age first used 
module2$D_797076693 <- round(as.numeric(module2$D_797076693), digits=0)
#boxp_funct(D_797076693,"TESTTHER3: Age Testosterone First Used", "Age")
hist_funct(D_797076693,"TESTTHER3: Age Testosterone First Used", "Age", "Number of Participants")

#How often

dtTESTTHER2= data_tib_m2  %>% filter(D_111235606==353358909)
test_med= dtTESTTHER2 %>%  mutate(meds= case_when(D_984514646=="729363341"~"Daily(2+ times)",
                                              D_984514646=="181786871"~"Daily",
                                              D_984514646=="626911538"~"Every few days",
                                              D_984514646=="522395860"~"Once per Week",
                                              D_984514646=="814242010"~"Few times per",
                                              D_984514646=="235613392"~"Rarely",
                                             TRUE ~ "Skipped this question"))


dtTESTTHER2_summary <- test_med %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtTESTTHER2_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("TESTTHER4: How often Testosterone Used")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Age last used
#boxp_funct(D_414663452,"TESTTHER5: Age Testosterone Last Used", "Age")
hist_funct(D_414663452,"TESTTHER5: Age Testosterone Last Used", "Age", "Number of Participants")

#Taken other types
#one_logic_funct(D_570187182, D_621744463, 353358909, "PRESHOR: Ever taken Other Prescription Medication")
testt1= data_tib_m2 %>% filter(D_621744463==353358909) %>%  mutate(answer= case_when(D_570187182==104430631 ~ "No",
                                                                                     D_570187182==132099255 ~ "Yes",
                                                                                     TRUE ~ "Skipped this question"))

testt1_summary <- testt1 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

testt1_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("PRESHOR: Ever taken Other Prescription Medication")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#What other kind
test_oth_yes= module2 %>%  filter(D_570187182==132099255)
teso_oth= module2 %>%  select(D_557526470) %>% filter(!is.na(D_557526470))
#list(teso_oth)
cat(dim(teso_oth)[[1]], " out of ", dim(test_oth_yes)[[1]], " provided a response for what other presciption medication was taken.")

#Age first used other kind
#boxp_funct(D_492822047,"PRESHOR3: Age Other Testosterone First Used", "Age")
hist_funct(D_797076693,"PRESHOR3: Age Other Testosterone First Used", "Age", "Number of Participants")

#Currently using other kind
#one_logic_funct(D_466727144, D_570187182, 353358909, "PRESHOR4: Currently Using Other Prescription Medication")
testt1= data_tib_m2 %>% filter(D_492822047!=353358909) %>%  mutate(answer= case_when(D_466727144==104430631 ~ "No",
                                                                                     D_466727144==132099255 ~ "Yes",
                                                                                     TRUE ~ "Skipped this question"))

testt1_summary <- testt1 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

testt1_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("PRESHOR4: Currently Using Other Prescription Medication")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Age last used other kind
#boxp_funct(D_307736999,"PRESHOR5: Age Other Testosterone Last Used", "Age")
hist_funct(D_797076693,"PRESHOR5: Age Other Testosterone Last Used", "Age", "Number of Participants")

#Months or years of other kind
hist_funct(D_305195766_D_434243220,"PRESHOR6: Total Months Other Testosterone Used", "Months", "Frequency")
hist_funct(D_305195766_D_970604592,"PRESHOR6: Total Years Other Testosterone Used", "Years", "Frequency")


```


# Section 3: Physical Activity 
## Physical Activity at Work 
```{r, warning=FALSE, echo=FALSE,  message=FALSE}


#Work over last 12 months: sitting, arm movements
##one_logic_funct(D_392658845_D_699101535, D_613744428, 353358909, "WORKACTA: Work over last 12 months: Sitting with Arm Movements")
fb_WORKACTA <- data_tib_m2 %>%  filter(D_613744428==353358909)


WORKACTA_ans= fb_WORKACTA %>%  mutate(answer= case_when(D_392658845_D_699101535==503218834 ~ "None",
                                                        D_392658845_D_699101535==464753847 ~ "Less than 30 minutes",
                                                        D_392658845_D_699101535==729681071 ~ "30 minutes",
                                                        D_392658845_D_699101535==258023209 ~ "45 minutes",
                                                        D_392658845_D_699101535==638092100 ~ "1 hour",
                                                        D_392658845_D_699101535==628177728 ~ "2 hour",
                                                        D_392658845_D_699101535==919739344 ~ "3 to 4 hours",
                                                        D_392658845_D_699101535==755558825 ~ "5 to 6 hours",
                                                        D_392658845_D_699101535==949555271 ~ "7 to 8 hours",
                                                        D_392658845_D_699101535==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

WORKACTA_ans$answer <- factor(WORKACTA_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtWORKACTA_summary <- WORKACTA_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtWORKACTA_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WORKACTA: Work over last 12 months: Sitting with Arm Movements")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




##one_logic_funct(D_392658845_D_652561589, D_613744428, 353358909,"WORKACTB: Work over last 12 months: Standing with Walking")
fb_WORKACTB <- data_tib_m2 %>%  filter(D_613744428==353358909)


WORKACTB_ans= fb_WORKACTB %>%  mutate(answer= case_when(D_392658845_D_652561589==503218834 ~ "None",
                                                        D_392658845_D_652561589==464753847 ~ "Less than 30 minutes",
                                                        D_392658845_D_652561589==729681071 ~ "30 minutes",
                                                        D_392658845_D_652561589==258023209 ~ "45 minutes",
                                                        D_392658845_D_652561589==638092100 ~ "1 hour",
                                                        D_392658845_D_652561589==628177728 ~ "2 hour",
                                                        D_392658845_D_652561589==919739344 ~ "3 to 4 hours",
                                                        D_392658845_D_652561589==755558825 ~ "5 to 6 hours",
                                                        D_392658845_D_652561589==949555271 ~ "7 to 8 hours",
                                                        D_392658845_D_652561589==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

WORKACTB_ans$answer <- factor(WORKACTB_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtWORKACTB_summary <- WORKACTB_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtWORKACTB_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WORKACTB: Work over last 12 months: Standing with Walking")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




##one_logic_funct(D_392658845_D_589522790, D_613744428, 353358909,"WORKACTC: Work over last 12 months: Walking and Carrying Materials")
fb_WORKACTC <- data_tib_m2 %>%  filter(D_613744428==353358909)


WORKACTC_ans= fb_WORKACTC %>%  mutate(answer= case_when(D_392658845_D_652561589==503218834 ~ "None",
                                                        D_392658845_D_652561589==464753847 ~ "Less than 30 minutes",
                                                        D_392658845_D_652561589==729681071 ~ "30 minutes",
                                                        D_392658845_D_652561589==258023209 ~ "45 minutes",
                                                        D_392658845_D_652561589==638092100 ~ "1 hour",
                                                        D_392658845_D_652561589==628177728 ~ "2 hour",
                                                        D_392658845_D_652561589==919739344 ~ "3 to 4 hours",
                                                        D_392658845_D_652561589==755558825 ~ "5 to 6 hours",
                                                        D_392658845_D_652561589==949555271 ~ "7 to 8 hours",
                                                        D_392658845_D_652561589==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

WORKACTC_ans$answer <- factor(WORKACTC_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtWORKACTC_summary <- WORKACTC_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtWORKACTC_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WORKACTC: Work over last 12 months: Walking and Carrying Materials")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##one_logic_funct(D_392658845_D_239572239, D_613744428, 353358909,"WORKACTD: Work over last 12 months: Walking and Heavy Manual Labor")
fb_WORKACTD <- data_tib_m2 %>%  filter(D_613744428==353358909)


WORKACTD_ans= fb_WORKACTD %>%  mutate(answer= case_when(D_392658845_D_239572239==503218834 ~ "None",
                                                        D_392658845_D_239572239==464753847 ~ "Less than 30 minutes",
                                                        D_392658845_D_239572239==729681071 ~ "30 minutes",
                                                        D_392658845_D_239572239==258023209 ~ "45 minutes",
                                                        D_392658845_D_239572239==638092100 ~ "1 hour",
                                                        D_392658845_D_239572239==628177728 ~ "2 hour",
                                                        D_392658845_D_239572239==919739344 ~ "3 to 4 hours",
                                                        D_392658845_D_239572239==755558825 ~ "5 to 6 hours",
                                                        D_392658845_D_239572239==949555271 ~ "7 to 8 hours",
                                                        D_392658845_D_239572239==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

WORKACTD_ans$answer <- factor(WORKACTD_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtWORKACTD_summary <- WORKACTD_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtWORKACTD_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WORKACTD: Work over last 12 months: Walking and Heavy Manual Labor")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



```


## Sitting
```{r, warning=FALSE, echo=FALSE,  message=FALSE}

##simple_funct(D_649352910_D_654385712, "SITTINGA: Driving or Sitting in a Car, Bus, or Train")


SITTINGA_ans= data_tib_m2 %>%  mutate(answer= case_when(D_649352910_D_654385712==503218834 ~ "None",
                                                        D_649352910_D_654385712==464753847 ~ "Less than 30 minutes",
                                                        D_649352910_D_654385712==729681071 ~ "30 minutes",
                                                        D_649352910_D_654385712==258023209 ~ "45 minutes",
                                                        D_649352910_D_654385712==638092100 ~ "1 hour",
                                                        D_649352910_D_654385712==628177728 ~ "2 hour",
                                                        D_649352910_D_654385712==919739344 ~ "3 to 4 hours",
                                                        D_649352910_D_654385712==755558825 ~ "5 to 6 hours",
                                                        D_649352910_D_654385712==949555271 ~ "7 to 8 hours",
                                                        D_649352910_D_654385712==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

SITTINGA_ans$answer <- factor(SITTINGA_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtSITTINGA_summary <- SITTINGA_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSITTINGA_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("SITTINGA: Driving or Sitting in a Car, Bus, or Train")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_649352910_D_263483736, "SittingB: Watching TV or other Video Content")
SITTINGB_ans= data_tib_m2 %>%  mutate(answer= case_when(D_649352910_D_263483736==503218834 ~ "None",
                                                        D_649352910_D_263483736==464753847 ~ "Less than 30 minutes",
                                                        D_649352910_D_263483736==729681071 ~ "30 minutes",
                                                        D_649352910_D_263483736==258023209 ~ "45 minutes",
                                                        D_649352910_D_263483736==638092100 ~ "1 hour",
                                                        D_649352910_D_263483736==628177728 ~ "2 hour",
                                                        D_649352910_D_263483736==919739344 ~ "3 to 4 hours",
                                                        D_649352910_D_263483736==755558825 ~ "5 to 6 hours",
                                                        D_649352910_D_263483736==949555271 ~ "7 to 8 hours",
                                                        D_649352910_D_263483736==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

SITTINGB_ans$answer <- factor(SITTINGB_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

SITTINGB_summary <- SITTINGB_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

SITTINGB_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("SITTINGB: Watching TV or other Video Content")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_649352910_D_806746224, "SittingC: Browsing or Playing Games")
SITTINGC_ans= data_tib_m2 %>%  mutate(answer= case_when(D_649352910_D_806746224==503218834 ~ "None",
                                                        D_649352910_D_806746224==464753847 ~ "Less than 30 minutes",
                                                        D_649352910_D_806746224==729681071 ~ "30 minutes",
                                                        D_649352910_D_806746224==258023209 ~ "45 minutes",
                                                        D_649352910_D_806746224==638092100 ~ "1 hour",
                                                        D_649352910_D_806746224==628177728 ~ "2 hour",
                                                        D_649352910_D_806746224==919739344 ~ "3 to 4 hours",
                                                        D_649352910_D_806746224==755558825 ~ "5 to 6 hours",
                                                        D_649352910_D_806746224==949555271 ~ "7 to 8 hours",
                                                        D_649352910_D_806746224==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

SITTINGC_ans$answer <- factor(SITTINGC_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtSITTINGC_summary <- SITTINGC_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSITTINGC_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("SITTINGC: Browsing or Playing Games")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_649352910_D_396649512, "SittingD: Other Activity")
SITTINGD_ans= data_tib_m2 %>%  mutate(answer= case_when(D_649352910_D_396649512==503218834 ~ "None",
                                                        D_649352910_D_396649512==464753847 ~ "Less than 30 minutes",
                                                        D_649352910_D_396649512==729681071 ~ "30 minutes",
                                                        D_649352910_D_396649512==258023209 ~ "45 minutes",
                                                        D_649352910_D_396649512==638092100 ~ "1 hour",
                                                        D_649352910_D_396649512==628177728 ~ "2 hour",
                                                        D_649352910_D_396649512==919739344 ~ "3 to 4 hours",
                                                        D_649352910_D_396649512==755558825 ~ "5 to 6 hours",
                                                        D_649352910_D_396649512==949555271 ~ "7 to 8 hours",
                                                        D_649352910_D_396649512==201002865 ~ "9 hours or more",
                                                        TRUE ~ "Skipped this question"))

SITTINGD_ans$answer <- factor(SITTINGD_ans$answer,levels=c("None", "Less than 30 minutes", "30 minutes", "45 minutes", "1 hour", "2 hour" , "3 to 4 hours", "5 to 6 hours", "7 to 8 hours", "9 hours or more", "Skipped this question"))

dtSITTINGD_summary <- SITTINGD_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSITTINGD_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("SITTINGD: Other Activity")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




```

## Household Chores, Caring for Others, and Shopping

```{r, warning=FALSE, echo=FALSE,  message=FALSE}

##simple_funct(D_733547268_D_980120253, "HOUSE1A: Frequency of Light Household Chores")
HOUSE1A_ans= data_tib_m2 %>%  mutate(answer= case_when(D_733547268_D_980120253==648960871 ~ "Never",
                                                        D_733547268_D_980120253==239152340 ~ "Once a month or less",
                                                        D_733547268_D_980120253==582006876 ~ "2 to 3 days per month",
                                                        D_733547268_D_980120253==645894551 ~ "1 to 2 days per week",
                                                        D_733547268_D_980120253==996315715 ~ "3 to 4 days per week",
                                                        D_733547268_D_980120253==671267928 ~ "5 to 6 days per week",
                                                        D_733547268_D_980120253==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

HOUSE1A_ans$answer <- factor(HOUSE1A_ans$answer,levels=c("Never", "Once a month or less", "2 to 3 days per month", "1 to 2 days per week", "3 to 4 days per week", "5 to 6 days per week" , "Every day", "Skipped this question"))

dtHOUSE1A_summary <- HOUSE1A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtHOUSE1A_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE1A: Frequency of Light Household Chores")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_733547268_D_993029890, "HOUSE1B: Frequency of Moderate to Vigorous Household Chores")
HOUSE1B_ans= data_tib_m2 %>%  mutate(answer= case_when(D_733547268_D_993029890==648960871 ~ "Never",
                                                        D_733547268_D_993029890==239152340 ~ "Once a month or less",
                                                        D_733547268_D_993029890==582006876 ~ "2 to 3 days per month",
                                                        D_733547268_D_993029890==645894551 ~ "1 to 2 days per week",
                                                        D_733547268_D_993029890==996315715 ~ "3 to 4 days per week",
                                                        D_733547268_D_993029890==671267928 ~ "5 to 6 days per week",
                                                        D_733547268_D_993029890==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

HOUSE1B_ans$answer <- factor(HOUSE1B_ans$answer,levels=c("Never", "Once a month or less", "2 to 3 days per month", "1 to 2 days per week", "3 to 4 days per week", "5 to 6 days per week" , "Every day", "Skipped this question"))

dtHOUSE1B_summary <- HOUSE1B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtHOUSE1B_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE1B: Frequency of Moderate to Vigorous Household Chores")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_733547268_D_980196073, "HOUSE1C: Frequency of Caring for Pets")
HOUSE1C_ans= data_tib_m2 %>%  mutate(answer= case_when(D_733547268_D_980196073==648960871 ~ "Never",
                                                        D_733547268_D_980196073==239152340 ~ "Once a month or less",
                                                        D_733547268_D_980196073==582006876 ~ "2 to 3 days per month",
                                                        D_733547268_D_980196073==645894551 ~ "1 to 2 days per week",
                                                        D_733547268_D_980196073==996315715 ~ "3 to 4 days per week",
                                                        D_733547268_D_980196073==671267928 ~ "5 to 6 days per week",
                                                        D_733547268_D_980196073==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

HOUSE1C_ans$answer <- factor(HOUSE1C_ans$answer,levels=c("Never", "Once a month or less", "2 to 3 days per month", "1 to 2 days per week", "3 to 4 days per week", "5 to 6 days per week" , "Every day", "Skipped this question"))

dtHOUSE1C_summary <- HOUSE1C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtHOUSE1C_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE1C: Frequency of Caring for Pets")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##simple_funct(D_733547268_D_115422925, "HOUSE1D: Frequency of Caring for Kids/Adults")
HOUSE1D_ans= data_tib_m2 %>%  mutate(answer= case_when(D_733547268_D_115422925==648960871 ~ "Never",
                                                        D_733547268_D_115422925==239152340 ~ "Once a month or less",
                                                        D_733547268_D_115422925==582006876 ~ "2 to 3 days per month",
                                                        D_733547268_D_115422925==645894551 ~ "1 to 2 days per week",
                                                        D_733547268_D_115422925==996315715 ~ "3 to 4 days per week",
                                                        D_733547268_D_115422925==671267928 ~ "5 to 6 days per week",
                                                        D_733547268_D_115422925==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

HOUSE1D_ans$answer <- factor(HOUSE1D_ans$answer,levels=c("Never", "Once a month or less", "2 to 3 days per month", "1 to 2 days per week", "3 to 4 days per week", "5 to 6 days per week" , "Every day", "Skipped this question"))

dtHOUSE1D_summary <- HOUSE1D_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtHOUSE1D_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE1D: Frequency of Caring for Kids/Adults")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



##simple_funct(D_733547268_D_151161693, "HOUSE1E: Frequency of Walking while Shopping")
HOUSE1E_ans= data_tib_m2 %>%  mutate(answer= case_when(D_733547268_D_151161693==648960871 ~ "Never",
                                                        D_733547268_D_151161693==239152340 ~ "Once a month or less",
                                                        D_733547268_D_151161693==582006876 ~ "2 to 3 days per month",
                                                        D_733547268_D_151161693==645894551 ~ "1 to 2 days per week",
                                                        D_733547268_D_151161693==996315715 ~ "3 to 4 days per week",
                                                        D_733547268_D_151161693==671267928 ~ "5 to 6 days per week",
                                                        D_733547268_D_151161693==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

HOUSE1E_ans$answer <- factor(HOUSE1E_ans$answer,levels=c("Never", "Once a month or less", "2 to 3 days per month", "1 to 2 days per week", "3 to 4 days per week", "5 to 6 days per week" , "Every day", "Skipped this question"))

dtHOUSE1E_summary <- HOUSE1E_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtHOUSE1E_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE1E: Frequency of Walking while Shopping")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




house2a <- data_tib_m2  %>% filter(D_733547268_D_980120253!=648960871) 
h2a <- house2a %>%  mutate(time= case_when(D_128705365_D_607323377=="206020811" ~"31-44 min.",
                                            D_128705365_D_607323377=="248303092" ~"16-30 min.",
                                            D_128705365_D_607323377=="264163865" ~ "45-59 min.",
                                            D_128705365_D_607323377=="428999623" ~ "0-15 min.",
                                            D_128705365_D_607323377=="628177728" ~ "2 hrs",
                                            D_128705365_D_607323377=="638092100" ~ "1 hr",
                                            D_128705365_D_607323377=="805918496" ~ "3+ hrs",
                                            TRUE~ "Skipped this question"))


dt_house2a_summary <- h2a %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage)


dt_house2a_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE2A: Time Spent doing Light Household Chores")) %>%
  cols_label(n= md("**Number of Participants**"), time = md("**Time Spent**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time,
    )
  ) %>% opt_row_striping()




house2b <- data_tib_m2  %>% filter(D_733547268_D_993029890!=648960871) 
h2b <- house2b %>%  mutate(time= case_when(D_128705365_D_491484323=="206020811" ~"31-44 min.",
                                            D_128705365_D_491484323=="248303092" ~"16-30 min.",
                                            D_128705365_D_491484323=="264163865" ~ "45-59 min.",
                                            D_128705365_D_491484323=="428999623" ~ "0-15 min.",
                                            D_128705365_D_491484323=="628177728" ~ "2 hrs",
                                            D_128705365_D_491484323=="638092100" ~ "1 hr",
                                            D_128705365_D_491484323=="805918496" ~ "3+ hrs",
                                            TRUE~ "Skipped this question"))


dt_house2b_summary <- h2b %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage)


dt_house2b_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE2B: Time Spent doing Moderate to Vigorous Household Chores")) %>%
  cols_label(n= md("**Number of Participants**"), time = md("**Time Spent**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time,
    )
  ) %>% opt_row_striping()




house2c <- data_tib_m2  %>% filter(D_733547268_D_980196073!=648960871) 
h2c <- house2c %>%  mutate(time= case_when(D_128705365_D_588637585=="206020811" ~"31-44 min.",
                                            D_128705365_D_588637585=="248303092" ~"16-30 min.",
                                            D_128705365_D_588637585=="264163865" ~ "45-59 min.",
                                            D_128705365_D_588637585=="428999623" ~ "0-15 min.",
                                            D_128705365_D_588637585=="628177728" ~ "2 hrs",
                                            D_128705365_D_588637585=="638092100" ~ "1 hr",
                                            D_128705365_D_588637585=="805918496" ~ "3+ hrs",
                                            TRUE~ "Skipped this question"))


dt_house2c_summary <- h2c %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage)


dt_house2c_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE2C: Time Spent Caring for Pets")) %>%
  cols_label(n= md("**Number of Participants**"), time = md("**Time Spent**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time,
    )
  ) %>% opt_row_striping()




house2d <- data_tib_m2  %>% filter(D_733547268_D_115422925!=648960871) 
h2d <- house2d %>%  mutate(time= case_when(D_128705365_D_199039940=="206020811" ~"31-44 min.",
                                            D_128705365_D_199039940=="248303092" ~"16-30 min.",
                                            D_128705365_D_199039940=="264163865" ~ "45-59 min.",
                                            D_128705365_D_199039940=="428999623" ~ "0-15 min.",
                                            D_128705365_D_199039940=="628177728" ~ "2 hrs",
                                            D_128705365_D_199039940=="638092100" ~ "1 hr",
                                            D_128705365_D_199039940=="805918496" ~ "3+ hrs",
                                            TRUE~ "Skipped this question"))


dt_house2d_summary <- h2d %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage)


dt_house2d_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE2D: Time Spent Caring for Kids/Adults")) %>%
  cols_label(n= md("**Number of Participants**"), time = md("**Time Spent**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time,
    )
  ) %>% opt_row_striping()




house2e <- data_tib_m2  %>% filter(D_733547268_D_151161693!=648960871) 
h2e <- house2e %>%  mutate(time= case_when(D_128705365_D_986476579=="206020811" ~"31-44 min.",
                                            D_128705365_D_986476579=="248303092" ~"16-30 min.",
                                            D_128705365_D_986476579=="264163865" ~ "45-59 min.",
                                            D_128705365_D_986476579=="428999623" ~ "0-15 min.",
                                            D_128705365_D_986476579=="628177728" ~ "2 hrs",
                                            D_128705365_D_986476579=="638092100" ~ "1 hr",
                                            D_128705365_D_986476579=="805918496" ~ "3+ hrs",
                                            TRUE~ "Skipped this question"))


dt_house2e_summary <- h2e %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage)


dt_house2e_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HOUSE2E: Time Spent Walking while Shopping")) %>%
  cols_label(n= md("**Number of Participants**"), time = md("**Time Spent**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = time,
    )
  ) %>% opt_row_striping()




```

## Exercise and Recreation 
```{r, include=FALSE}

#What type?
ex_type= data_tib_m2 %>%  mutate(ex= case_when(D_517976064_D_904954920==1 ~ "Walk",
                                             D_517976064_D_619501806==1 ~ "Run",
                                             D_517976064_D_203192394==1 ~ "Play Tennis",
                                             D_517976064_D_261267696==1 ~ "Play Golf",
                                             D_517976064_D_926584500==1 ~ "Swim",
                                             D_517976064_D_420058896==1 ~ "Bike",
                                             D_517976064_D_868685663==1 ~ "Strength Training",
                                             D_517976064_D_760484278==1 ~ "Yoga",
                                             D_517976064_D_345916806==1 ~ "Martial Arts",
                                             D_517976064_D_936042582==1 ~ "Dance",
                                             D_517976064_D_182827107==1 ~ "Ski",
                                             D_517976064_D_734860227==1 ~ "Cross Country",
                                             D_517976064_D_371531887==1 ~ "Surfing",
                                             D_517976064_D_423631576==1 ~ "Circuit",
                                             D_517976064_D_181769837==1 ~ "Other",
                                             D_517976064_D_535003378==1 ~ "None of the Above",
                                             TRUE~ "Skipped this question"))



tmp_hr2<- ex_type[, grepl("517976064", colnames(ex_type))]


tmpM2 <- tmp_hr2[, c(14,10, 3, 4, 15, 7, 13, 12, 5, 16, 2, 11, 6, 8, 1, 9)] 
dt_exercise_dx <- NULL
for (i in 1:16){
  dt <- as.data.frame(tab1(tmpM2[,i])$output.table)
  dt$dt_exercise_dx <- colnames(tmpM2)[i]
  dt_exercise_dx <- rbind(dt_exercise_dx,dt[2,])

}


dt_exercise_dx$dt_exercise_dx <- c("Walk","Run","Play Tennis","Play Golf","Swim","Bike", "Strength Training","Yoga","Martial Arts", "Dance", "Ski","Cross Country","Surfing","Circuit", "Other","None of the Above")
```

```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(dt_exercise_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
dt_exercise <- dt_exercise_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(ex_type$season=="Skipped this question")[2])
dt_exercise[as.numeric(dim(dt_exercise)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(ex_type)[[1]])*100,2))


dt_exercise_summary <- dt_exercise %>%  gt() %>%
  fmt_number(columns = "Percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC1: Done any of these Exercises or Recreational Activities in the Past Year")) %>%
  cols_label(Frequency= md("**Number of Participants**"), Condition = md("**Activity**"), Percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_exercise_summary,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)


```




```{r, warning=FALSE, echo=FALSE}

#which season-walk
dt_walk= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_904954920==1)


ex_type= dt_walk %>%  mutate(ex= case_when(((D_894610280_D_917302906==1 & (D_894610280_D_152773041==1 | D_894610280_D_249341444==1  |D_894610280_D_690018400==1)) | 
                                            (D_894610280_D_152773041==1 & (D_894610280_D_917302906==1 | D_894610280_D_249341444==1  |D_894610280_D_690018400==1)) |
                                              (D_894610280_D_249341444==1 & (D_894610280_D_152773041==1 | D_894610280_D_917302906==1  |D_894610280_D_690018400==1)) |
                                              (D_894610280_D_690018400==1 & (D_894610280_D_152773041==1 | D_894610280_D_249341444==1  |D_894610280_D_917302906==1)) &
                                              !(D_894610280_D_917302906==1 & D_894610280_D_152773041==1 & 
                                                D_894610280_D_249341444==1 & D_894610280_D_690018400==1))~ 
                                             "Multiple Seasons", #at least two but not all four
                                             (D_894610280_D_917302906==1 & D_894610280_D_152773041==1 & 
                                                D_894610280_D_249341444==1 & D_894610280_D_690018400==1) ~ "All Four Seasons",
                                           D_894610280_D_917302906==1 ~ "Winter",
                                             D_894610280_D_152773041==1 ~ "Spring",
                                             D_894610280_D_249341444==1 ~ "Summer",
                                             D_894610280_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))
ex_type$ex <- factor(ex_type$ex,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_walk_summary <- ex_type %>% group_by(ex) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ex, n, percentage)


dt_walk_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2A: Seasons Walking or Hiking for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), ex = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ex,
    )
  ) #%>% opt_row_striping()


#how often-walk
##one_logic_funct(D_267122668, D_517976064_D_904954920, 1, "EXEREC3A: Frequency of Walking for Exercise")
EXEREC3A <- data_tib_m2 %>%  filter(D_517976064_D_904954920==1)
EXEREC3A_ans= EXEREC3A %>%  mutate(answer= case_when(D_267122668==239152340 ~ "Once a month or less",
                                                        D_267122668==582006876 ~ "2-3 days per month",
                                                        D_267122668==645894551 ~ "1-2 days per week",
                                                        D_267122668==996315715 ~ "3-4 days per week",
                                                        D_267122668==671267928 ~ "5-6 days per week",
                                                        D_267122668==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3A_ans$answer <- factor(EXEREC3A_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3A_summary <- EXEREC3A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3A_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3A: Frequency of Walking for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#time-walk
##one_logic_funct(D_901660173, D_517976064_D_904954920, 1, "Time Spent per day Walking for Exercise")
EXEREC4A <- data_tib_m2 %>%  filter(D_517976064_D_904954920==1)
EXEREC4A_ans= EXEREC4A %>%  mutate(answer= case_when(D_901660173==428999623 ~ "15 minutes or less",
                                                        D_901660173==248303092 ~ "16 to 30 minutes",
                                                        D_901660173==206020811 ~ "31 to 44 minutes",
                                                        D_901660173==264163865 ~ "45 to 59 minutes",
                                                        D_901660173==638092100 ~ "1 hour",
                                                 D_901660173==628177728 ~ "2 hours",
                                                 D_901660173==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4A_ans$answer <- factor(EXEREC4A_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4A_summary <- EXEREC4A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4A_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4A: Time Spent per day Walking for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#which season-run
dt_run= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_619501806==1)


ex_type= dt_run %>%  mutate(season= case_when(((D_222110888_D_917302906==1 & (D_222110888_D_152773041==1 | D_222110888_D_249341444==1  |D_222110888_D_690018400==1)) | 
                                            (D_222110888_D_152773041==1 & (D_222110888_D_917302906==1 | D_222110888_D_249341444==1  |D_222110888_D_690018400==1)) |
                                              (D_222110888_D_249341444==1 & (D_222110888_D_152773041==1 | D_222110888_D_917302906==1  |D_222110888_D_690018400==1)) |
                                              (D_222110888_D_690018400==1 & (D_222110888_D_152773041==1 | D_222110888_D_249341444==1  |D_222110888_D_917302906==1)) &
                                              !(D_222110888_D_917302906==1 & D_222110888_D_152773041==1 & 
                                                D_222110888_D_249341444==1 & D_222110888_D_690018400==1))~ 
                                             "Multiple Seasons", #at least two but not all four
                                             (D_222110888_D_917302906==1 & D_222110888_D_152773041==1 & 
                                                D_222110888_D_249341444==1 & D_222110888_D_690018400==1) ~ "All Four Seasons",
                                            D_222110888_D_917302906==1 ~ "Winter",
                                             D_222110888_D_152773041==1 ~ "Spring",
                                             D_222110888_D_249341444==1 ~ "Summer",
                                             D_222110888_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))



dt_run_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_run_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2B: Seasons Running or Jogging for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-run
##one_logic_funct(D_953510929, D_517976064_D_619501806, 1, "EXEREC3B:Frequency of Running for Exercise")
EXEREC3B <- data_tib_m2 %>%  filter(D_517976064_D_619501806==1)
EXEREC3B_ans= EXEREC3B %>%  mutate(answer= case_when(D_953510929==239152340 ~ "Once a month or less",
                                                        D_953510929==582006876 ~ "2-3 days per month",
                                                        D_953510929==645894551 ~ "1-2 days per week",
                                                        D_953510929==996315715 ~ "3-4 days per week",
                                                        D_953510929==671267928 ~ "5-6 days per week",
                                                        D_953510929==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3B_ans$answer <- factor(EXEREC3B_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3B_summary <- EXEREC3B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3B_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3B: Frequency of Running for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-run
##one_logic_funct(D_422260069, D_517976064_D_619501806, 1, "Time Spent on Running for Exercise")
EXEREC4B <- data_tib_m2 %>%  filter(D_517976064_D_619501806==1)
EXEREC4B_ans= EXEREC4B %>%  mutate(answer= case_when(D_422260069==428999623 ~ "15 minutes or less",
                                                        D_422260069==248303092 ~ "16 to 30 minutes",
                                                        D_422260069==206020811 ~ "31 to 44 minutes",
                                                        D_422260069==264163865 ~ "45 to 59 minutes",
                                                        D_422260069==638092100 ~ "1 hour",
                                                 D_422260069==628177728 ~ "2 hours",
                                                 D_422260069==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4B_ans$answer <- factor(EXEREC4B_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4B_summary <- EXEREC4B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4B_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4B: Time Spent per Day Running for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





#which season-tennis 
dt_tennis= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_203192394==1)


ex_type= dt_tennis %>%  mutate(season= case_when(((D_564242877_D_917302906==1 & (D_564242877_D_152773041==1 | D_564242877_D_249341444==1  |D_564242877_D_690018400==1)) | 
    (D_564242877_D_152773041==1 & (D_564242877_D_917302906==1 | D_564242877_D_249341444==1  |D_564242877_D_690018400==1)) |
    (D_564242877_D_249341444==1 & (D_564242877_D_152773041==1 | D_564242877_D_917302906==1  |D_564242877_D_690018400==1)) |
    (D_564242877_D_690018400==1 & (D_564242877_D_152773041==1 | D_564242877_D_249341444==1  |D_564242877_D_917302906==1)) &
    !(D_564242877_D_917302906==1 & D_564242877_D_152773041==1 & 
          D_564242877_D_249341444==1 & D_564242877_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
    (D_564242877_D_917302906==1 & D_564242877_D_152773041==1 & 
       D_564242877_D_249341444==1 & D_564242877_D_690018400==1) ~ "All Four Seasons",
    D_564242877_D_917302906==1 ~ "Winter",
    D_564242877_D_152773041==1 ~ "Spring",
    D_564242877_D_249341444==1 ~ "Summer",
    D_564242877_D_690018400==1 ~ "Fall",
    TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_tennis_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_tennis_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2C: Seasons Playing Tennis for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-tennis
##one_logic_funct(D_411788467, D_517976064_D_203192394, 1, "EXEREC4C: Frequency of Playing Tennis for Exercise")
EXEREC4C <- data_tib_m2 %>%  filter(D_517976064_D_203192394==1)
EXEREC4C_ans= EXEREC4C %>%  mutate(answer= case_when(D_411788467==239152340 ~ "Once a month or less",
                                                        D_411788467==582006876 ~ "2-3 days per month",
                                                        D_411788467==645894551 ~ "1-2 days per week",
                                                        D_411788467==996315715 ~ "3-4 days per week",
                                                        D_411788467==671267928 ~ "5-6 days per week",
                                                        D_411788467==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC4C_ans$answer <- factor(EXEREC4C_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC4C_summary <- EXEREC4C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4C_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4C: Frequency of Playing Tennis for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-tennis
##one_logic_funct(D_141251197, D_517976064_D_203192394, 1, "Time Spent Playing Tennis for Exercise")
EXEREC4C <- data_tib_m2 %>%  filter(D_517976064_D_203192394==1)
EXEREC4C_ans= EXEREC4C %>%  mutate(answer= case_when(D_141251197==428999623 ~ "15 minutes or less",
                                                        D_141251197==248303092 ~ "16 to 30 minutes",
                                                        D_141251197==206020811 ~ "31 to 44 minutes",
                                                        D_141251197==264163865 ~ "45 to 59 minutes",
                                                        D_141251197==638092100 ~ "1 hour",
                                                 D_141251197==628177728 ~ "2 hours",
                                                 D_141251197==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4C_ans$answer <- factor(EXEREC4C_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4C_summary <- EXEREC4C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4C_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4C: Time Spent per Day Playing Tennis for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


# 



##Golf
dt_golf= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_261267696==1)


ex_type= dt_golf %>%  mutate(season= case_when(((D_635874413_D_917302906==1 & (D_635874413_D_152773041==1 | D_635874413_D_249341444==1  |D_635874413_D_690018400==1)) | 
    (D_635874413_D_152773041==1 & (D_635874413_D_917302906==1 | D_635874413_D_249341444==1  |D_635874413_D_690018400==1)) |
    (D_635874413_D_249341444==1 & (D_635874413_D_152773041==1 | D_635874413_D_917302906==1  |D_635874413_D_690018400==1)) |
    (D_635874413_D_690018400==1 & (D_635874413_D_152773041==1 | D_635874413_D_249341444==1  |D_635874413_D_917302906==1)) &
    !(D_635874413_D_917302906==1 & D_635874413_D_152773041==1 & 
          D_635874413_D_249341444==1 & D_635874413_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
    D_635874413_D_917302906==1 ~ "Winter",
    (D_635874413_D_917302906==1 & D_635874413_D_152773041==1 & 
       D_635874413_D_249341444==1 & D_635874413_D_690018400==1) ~ "All Four Seasons",
    D_635874413_D_152773041==1 ~ "Spring",
    D_635874413_D_249341444==1 ~ "Summer",
    D_635874413_D_690018400==1 ~ "Fall",
    TRUE~ "Skipped this question"))
ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_golf_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_golf_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2D: Seasons Playing Golf for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-golf
##one_logic_funct(D_184448791, D_517976064_D_261267696, 1, "EXEREC3D: Frequency of Playing Golf for Exercise")
EXEREC3D <- data_tib_m2 %>%  filter(D_517976064_D_261267696==1)
EXEREC3D_ans= EXEREC3D %>%  mutate(answer= case_when(D_184448791==239152340 ~ "Once a month or less",
                                                        D_184448791==582006876 ~ "2-3 days per month",
                                                        D_184448791==645894551 ~ "1-2 days per week",
                                                        D_184448791==996315715 ~ "3-4 days per week",
                                                        D_184448791==671267928 ~ "5-6 days per week",
                                                        D_184448791==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3D_ans$answer <- factor(EXEREC3D_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3D_summary <- EXEREC3D_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3D_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3D: Frequency of Playing Golf for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-golf
##one_logic_funct(D_768302347, D_517976064_D_261267696, 1, "Time Spent on Playing Golf for Exercise")
EXEREC4D <- data_tib_m2 %>%  filter(D_517976064_D_261267696==1)
EXEREC4D_ans= EXEREC4D %>%  mutate(answer= case_when(D_768302347==428999623 ~ "15 minutes or less",
                                                        D_768302347==248303092 ~ "16 to 30 minutes",
                                                        D_768302347==206020811 ~ "31 to 44 minutes",
                                                        D_768302347==264163865 ~ "45 to 59 minutes",
                                                        D_768302347==638092100 ~ "1 hour",
                                                 D_768302347==628177728 ~ "2 hours",
                                                 D_768302347==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4D_ans$answer <- factor(EXEREC4D_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4D_summary <- EXEREC4D_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4D_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4D: Time Spent per Day Playing Golf for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





##Swim
#which season-swim
dt_swim= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_926584500==1)


ex_type= dt_swim %>%  mutate(season= case_when(((D_371748514_D_917302906==1 & (D_371748514_D_152773041==1 | D_371748514_D_249341444==1  |D_371748514_D_690018400==1)) | 
    (D_371748514_D_152773041==1 & (D_371748514_D_917302906==1 | D_371748514_D_249341444==1  |D_371748514_D_690018400==1)) |
    (D_371748514_D_249341444==1 & (D_371748514_D_152773041==1 | D_371748514_D_917302906==1  |D_371748514_D_690018400==1)) |
    (D_371748514_D_690018400==1 & (D_371748514_D_152773041==1 | D_371748514_D_249341444==1  |D_371748514_D_917302906==1)) &
    !(D_371748514_D_917302906==1 & D_371748514_D_152773041==1 & 
          D_371748514_D_249341444==1 & D_371748514_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
    (D_371748514_D_917302906==1 & D_371748514_D_152773041==1 & 
                                                D_371748514_D_249341444==1 & D_371748514_D_690018400==1) ~ "All Four Seasons",
                                               D_371748514_D_917302906==1 ~ "Winter",
                                             D_371748514_D_152773041==1 ~ "Spring",
                                             D_371748514_D_249341444==1 ~ "Summer",
                                             D_371748514_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))
ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_swim_summary <- ex_type %>% group_by(season) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_swim_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2E: Seasons Swimming Laps for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-swim
##one_logic_funct(D_944699052, D_517976064_D_926584500, 1, "EXEREC3E: Frequency of Swimming for Exercise")
EXEREC3E <- data_tib_m2 %>%  filter(D_517976064_D_926584500==1)
EXEREC3E_ans= EXEREC3E %>%  mutate(answer= case_when(D_944699052==239152340 ~ "Once a month or less",
                                                        D_944699052==582006876 ~ "2-3 days per month",
                                                        D_944699052==645894551 ~ "1-2 days per week",
                                                        D_944699052==996315715 ~ "3-4 days per week",
                                                        D_944699052==671267928 ~ "5-6 days per week",
                                                        D_944699052==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3E_ans$answer <- factor(EXEREC3E_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3E_summary <- EXEREC3E_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3E_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3E: Frequency of Swimming for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#time-swim
##one_logic_funct(D_658018390, D_517976064_D_926584500, 1, "Time Spent on Swimming for Exercise")
EXEREC4E <- data_tib_m2 %>%  filter(D_517976064_D_926584500==1)
EXEREC4E_ans= EXEREC4E %>%  mutate(answer= case_when(D_658018390==428999623 ~ "15 minutes or less",
                                                        D_658018390==248303092 ~ "16 to 30 minutes",
                                                        D_658018390==206020811 ~ "31 to 44 minutes",
                                                        D_658018390==264163865 ~ "45 to 59 minutes",
                                                        D_658018390==638092100 ~ "1 hour",
                                                 D_658018390==628177728 ~ "2 hours",
                                                 D_658018390==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4E_ans$answer <- factor(EXEREC4E_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4E_summary <- EXEREC4E_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4E_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4E: Time Spent per Day Swimming for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



##Bike
#which season-bike
dt_bike= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_420058896==1)


ex_type= dt_bike %>%  mutate(season= case_when(((D_858525957_D_917302906==1 & (D_858525957_D_152773041==1 | D_858525957_D_249341444==1  |D_858525957_D_690018400==1)) | 
    (D_858525957_D_152773041==1 & (D_858525957_D_917302906==1 | D_858525957_D_249341444==1  |D_858525957_D_690018400==1)) |
    (D_858525957_D_249341444==1 & (D_858525957_D_152773041==1 | D_858525957_D_917302906==1  |D_858525957_D_690018400==1)) |
    (D_858525957_D_690018400==1 & (D_858525957_D_152773041==1 | D_858525957_D_249341444==1  |D_858525957_D_917302906==1)) &
    !(D_858525957_D_917302906==1 & D_858525957_D_152773041==1 & 
          D_858525957_D_249341444==1 & D_858525957_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
    D_858525957_D_917302906==1 ~ "Winter",
    (D_858525957_D_917302906==1 & D_858525957_D_152773041==1 & 
       D_858525957_D_249341444==1 & D_858525957_D_690018400==1) ~ "All Four Seasons",
    D_858525957_D_152773041==1 ~ "Spring",
    D_858525957_D_249341444==1 ~ "Summer",
    D_858525957_D_690018400==1 ~ "Fall",
    TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_bike_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_bike_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2F: Seasons Riding a Bike for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-bike
##one_logic_funct(D_849399881, D_517976064_D_420058896, 1, "EXEREC3F: Frequency of Riding a Bike for Exercise")
EXEREC3F <- data_tib_m2 %>%  filter(D_517976064_D_420058896==1)
EXEREC3F_ans= EXEREC3F %>%  mutate(answer= case_when(D_849399881==239152340 ~ "Once a month or less",
                                                        D_849399881==582006876 ~ "2-3 days per month",
                                                        D_849399881==645894551 ~ "1-2 days per week",
                                                        D_849399881==996315715 ~ "3-4 days per week",
                                                        D_849399881==671267928 ~ "5-6 days per week",
                                                        D_849399881==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3F_ans$answer <- factor(EXEREC3F_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3F_summary <- EXEREC3F_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3F_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3F: Frequency of Riding a Bike for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-bike
##one_logic_funct(D_406846149, D_517976064_D_420058896, 1, "Time Spent Riding a Bike for Exercise")
EXEREC4F <- data_tib_m2 %>%  filter(D_517976064_D_420058896==1)
EXEREC4F_ans= EXEREC4F %>%  mutate(answer= case_when(D_406846149==428999623 ~ "15 minutes or less",
                                                        D_406846149==248303092 ~ "16 to 30 minutes",
                                                        D_406846149==206020811 ~ "31 to 44 minutes",
                                                        D_406846149==264163865 ~ "45 to 59 minutes",
                                                        D_406846149==638092100 ~ "1 hour",
                                                 D_406846149==628177728 ~ "2 hours",
                                                 D_406846149==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4F_ans$answer <- factor(EXEREC4F_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4F_summary <- EXEREC4F_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4F_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4F: Time Spent per Day Riding a Bike for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





##Strength Training
dt_strength= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_868685663==1)


ex_type= dt_strength %>%  mutate(season= case_when(((D_787591805_D_917302906==1 & (D_787591805_D_152773041==1 | D_787591805_D_249341444==1  |D_787591805_D_690018400==1)) | 
    (D_787591805_D_152773041==1 & (D_787591805_D_917302906==1 | D_787591805_D_249341444==1  |D_787591805_D_690018400==1)) |
    (D_787591805_D_249341444==1 & (D_787591805_D_152773041==1 | D_787591805_D_917302906==1  |D_787591805_D_690018400==1)) |
    (D_787591805_D_690018400==1 & (D_787591805_D_152773041==1 | D_787591805_D_249341444==1  |D_787591805_D_917302906==1)) &
    !(D_787591805_D_917302906==1 & D_787591805_D_152773041==1 & 
          D_787591805_D_249341444==1 & D_787591805_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_787591805_D_917302906==1 & D_787591805_D_152773041==1 & 
                                                D_787591805_D_249341444==1 & D_787591805_D_690018400==1) ~ "All Four Seasons",
                                             D_787591805_D_917302906==1 ~ "Winter",
                                             D_787591805_D_152773041==1 ~ "Spring",
                                             D_787591805_D_249341444==1 ~ "Summer",
                                             D_787591805_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_strength_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_strength_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2G: Seasons Stregth Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-strength
##one_logic_funct(D_689956879, D_517976064_D_868685663, 1, "EXEREC3G: Frequency of Strength Training for Exercise")
EXEREC3G <- data_tib_m2 %>%  filter(D_517976064_D_868685663==1)
EXEREC3G_ans= EXEREC3G %>%  mutate(answer= case_when(D_689956879==239152340 ~ "Once a month or less",
                                                        D_689956879==582006876 ~ "2-3 days per month",
                                                        D_689956879==645894551 ~ "1-2 days per week",
                                                        D_689956879==996315715 ~ "3-4 days per week",
                                                        D_689956879==671267928 ~ "5-6 days per week",
                                                        D_689956879==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3G_ans$answer <- factor(EXEREC3G_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3G_summary <- EXEREC3G_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3G_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3G: Frequency of Strength Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#time-strength
##one_logic_funct(D_725713485, D_517976064_D_868685663, 1, "Time Spent Strength Training for Exercise")
EXEREC4G <- data_tib_m2 %>%  filter(D_517976064_D_868685663==1)
EXEREC4G_ans= EXEREC4G %>%  mutate(answer= case_when(D_725713485==428999623 ~ "15 minutes or less",
                                                        D_725713485==248303092 ~ "16 to 30 minutes",
                                                        D_725713485==206020811 ~ "31 to 44 minutes",
                                                        D_725713485==264163865 ~ "45 to 59 minutes",
                                                        D_725713485==638092100 ~ "1 hour",
                                                 D_725713485==628177728 ~ "2 hours",
                                                 D_725713485==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4G_ans$answer <- factor(EXEREC4G_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4G_summary <- EXEREC4G_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4G_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4G: Time Spent per Day Strength Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





##Yoga
#which season-yoga
dt_yoga= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_760484278==1)


ex_type= dt_yoga %>%  mutate(season= case_when(((D_900299856_D_917302906==1 & (D_900299856_D_152773041==1 | D_900299856_D_249341444==1  |D_900299856_D_690018400==1)) | 
    (D_900299856_D_152773041==1 & (D_900299856_D_917302906==1 | D_900299856_D_249341444==1  |D_900299856_D_690018400==1)) |
    (D_900299856_D_249341444==1 & (D_900299856_D_152773041==1 | D_900299856_D_917302906==1  |D_900299856_D_690018400==1)) |
    (D_900299856_D_690018400==1 & (D_900299856_D_152773041==1 | D_900299856_D_249341444==1  |D_900299856_D_917302906==1)) &
    !(D_900299856_D_917302906==1 & D_900299856_D_152773041==1 & 
          D_900299856_D_249341444==1 & D_900299856_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_900299856_D_917302906==1 & D_900299856_D_152773041==1 & 
                                                D_900299856_D_249341444==1 & D_900299856_D_690018400==1) ~ "All Four Seasons",D_900299856_D_917302906==1 ~ "Winter",
                                             D_900299856_D_152773041==1 ~ "Spring",
                                             D_900299856_D_249341444==1 ~ "Summer",
                                             D_900299856_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_yoga_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_yoga_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2H: Seasons Practicing Yoga for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#how often-yoga
##one_logic_funct(D_255761998, D_517976064_D_760484278, 1, "EXEREC3H: Frequency of Practicing Yoga for Exercise")
EXEREC3H <- data_tib_m2 %>%  filter(D_517976064_D_760484278==1)
EXEREC3H_ans= EXEREC3H %>%  mutate(answer= case_when(D_255761998==239152340 ~ "Once a month or less",
                                                        D_255761998==582006876 ~ "2-3 days per month",
                                                        D_255761998==645894551 ~ "1-2 days per week",
                                                        D_255761998==996315715 ~ "3-4 days per week",
                                                        D_255761998==671267928 ~ "5-6 days per week",
                                                        D_255761998==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3H_ans$answer <- factor(EXEREC3H_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3H_summary <- EXEREC3H_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3H_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3H: Frequency of Practicing Yoga for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#time-yoga
##one_logic_funct(D_571361258, D_517976064_D_760484278, 1, "Time Spent Practicing Yoga for Exercise")
EXEREC4H <- data_tib_m2 %>%  filter(D_517976064_D_760484278==1)
EXEREC4H_ans= EXEREC4H %>%  mutate(answer= case_when(D_571361258==428999623 ~ "15 minutes or less",
                                                        D_571361258==248303092 ~ "16 to 30 minutes",
                                                        D_571361258==206020811 ~ "31 to 44 minutes",
                                                        D_571361258==264163865 ~ "45 to 59 minutes",
                                                        D_571361258==638092100 ~ "1 hour",
                                                 D_571361258==628177728 ~ "2 hours",
                                                 D_571361258==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4H_ans$answer <- factor(EXEREC4H_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4H_summary <- EXEREC4H_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4H_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4H: Time Spent per Day Practicing Yoga for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



##Martial Arts
#which season-MA 
dt_martial= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_345916806==1)


ex_type= dt_martial %>%  mutate(season= case_when(((D_149884127_D_917302906==1 & (D_149884127_D_152773041==1 | D_149884127_D_249341444==1  |D_149884127_D_690018400==1)) | 
    (D_149884127_D_152773041==1 & (D_149884127_D_917302906==1 | D_149884127_D_249341444==1  |D_149884127_D_690018400==1)) |
    (D_149884127_D_249341444==1 & (D_149884127_D_152773041==1 | D_149884127_D_917302906==1  |D_149884127_D_690018400==1)) |
    (D_149884127_D_690018400==1 & (D_149884127_D_152773041==1 | D_149884127_D_249341444==1  |D_149884127_D_917302906==1)) &
    !(D_149884127_D_917302906==1 & D_149884127_D_152773041==1 & 
          D_149884127_D_249341444==1 & D_149884127_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_149884127_D_917302906==1 & D_149884127_D_152773041==1 & 
                                                D_149884127_D_249341444==1 & D_149884127_D_690018400==1) ~ "All Four Seasons",D_149884127_D_917302906==1 ~ "Winter",
                                             D_149884127_D_152773041==1 ~ "Spring",
                                             D_149884127_D_249341444==1 ~ "Summer",
                                             D_149884127_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_martial_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_martial_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2I: Seasons Practicing Martial Arts for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-MA
##one_logic_funct(D_167966775, D_517976064_D_345916806, 1, "EXEREC3I: Frequency of Practicing Martial Arts for Exercise")
EXEREC3I <- data_tib_m2 %>%  filter(D_517976064_D_345916806==1)
EXEREC3I_ans= EXEREC3I %>%  mutate(answer= case_when(D_167966775==239152340 ~ "Once a month or less",
                                                        D_167966775==582006876 ~ "2-3 days per month",
                                                        D_167966775==645894551 ~ "1-2 days per week",
                                                        D_167966775==996315715 ~ "3-4 days per week",
                                                        D_167966775==671267928 ~ "5-6 days per week",
                                                        D_167966775==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3I_ans$answer <- factor(EXEREC3I_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3I_summary <- EXEREC3I_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3I_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3I: Frequency of Practicing Martial Arts for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-MA
##one_logic_funct(D_904844824, D_517976064_D_345916806, 1, "Time Spent Practicing Martial Arts for Exercise")
EXEREC4I <- data_tib_m2 %>%  filter(D_517976064_D_345916806==1)
EXEREC4I_ans= EXEREC4I %>%  mutate(answer= case_when(D_904844824==428999623 ~ "15 minutes or less",
                                                        D_904844824==248303092 ~ "16 to 30 minutes",
                                                        D_904844824==206020811 ~ "31 to 44 minutes",
                                                        D_904844824==264163865 ~ "45 to 59 minutes",
                                                        D_904844824==638092100 ~ "1 hour",
                                                 D_904844824==628177728 ~ "2 hours",
                                                 D_904844824==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4I_ans$answer <- factor(EXEREC4I_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4I_summary <- EXEREC4I_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4I_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4I: Time Spent per Day Practicing Martial Arts for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




#Dance
#which season-dance
dt_dance= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_936042582==1)


ex_type= dt_dance %>%  mutate(season= case_when(((D_845164425_D_917302906==1 & (D_845164425_D_152773041==1 | D_845164425_D_249341444==1  |D_845164425_D_690018400==1)) | 
    (D_845164425_D_152773041==1 & (D_845164425_D_917302906==1 | D_845164425_D_249341444==1  |D_845164425_D_690018400==1)) |
    (D_845164425_D_249341444==1 & (D_845164425_D_152773041==1 | D_845164425_D_917302906==1  |D_845164425_D_690018400==1)) |
    (D_845164425_D_690018400==1 & (D_845164425_D_152773041==1 | D_845164425_D_249341444==1  |D_845164425_D_917302906==1)) &
    !(D_845164425_D_917302906==1 & D_845164425_D_152773041==1 & 
          D_845164425_D_249341444==1 & D_845164425_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_845164425_D_917302906==1 & D_845164425_D_152773041==1 & 
                                                D_845164425_D_249341444==1 & D_845164425_D_690018400==1) ~ "All Four Seasons",
                                            D_845164425_D_917302906==1 ~ "Winter",
                                             D_845164425_D_152773041==1 ~ "Spring",
                                             D_845164425_D_249341444==1 ~ "Summer",
                                             D_845164425_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))
ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))


dt_dance_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_dance_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2J: Seasons Dancing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-dance
##one_logic_funct(D_612068433, D_517976064_D_936042582, 1, "EXEREC3J: Frequency of Dancing for Exercise")
EXEREC3J <- data_tib_m2 %>%  filter(D_517976064_D_936042582==1)
EXEREC3J_ans= EXEREC3J %>%  mutate(answer= case_when(D_612068433==239152340 ~ "Once a month or less",
                                                        D_612068433==582006876 ~ "2-3 days per month",
                                                        D_612068433==645894551 ~ "1-2 days per week",
                                                        D_612068433==996315715 ~ "3-4 days per week",
                                                        D_612068433==671267928 ~ "5-6 days per week",
                                                        D_612068433==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3J_ans$answer <- factor(EXEREC3J_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3J_summary <- EXEREC3J_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3J_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3J: Frequency of Dancing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-dance
##one_logic_funct(D_650405110, D_517976064_D_936042582, 1, "Time Spent Dancing for Exercise")
EXEREC4J <- data_tib_m2 %>%  filter(D_517976064_D_936042582==1)
EXEREC4J_ans= EXEREC4J %>%  mutate(answer= case_when(D_650405110==428999623 ~ "15 minutes or less",
                                                        D_650405110==248303092 ~ "16 to 30 minutes",
                                                        D_650405110==206020811 ~ "31 to 44 minutes",
                                                        D_650405110==264163865 ~ "45 to 59 minutes",
                                                        D_650405110==638092100 ~ "1 hour",
                                                 D_650405110==628177728 ~ "2 hours",
                                                 D_650405110==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4J_ans$answer <- factor(EXEREC4J_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4J_summary <- EXEREC4J_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4J_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4J: Time Spent per Day Dancing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




##Ski
#which season-ski
dt_ski= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_182827107==1)


ex_type= dt_ski %>%  mutate(season= case_when(((D_187772368_D_917302906==1 & (D_187772368_D_152773041==1 | D_187772368_D_249341444==1  |D_187772368_D_690018400==1)) | 
    (D_187772368_D_152773041==1 & (D_187772368_D_917302906==1 | D_187772368_D_249341444==1  |D_187772368_D_690018400==1)) |
    (D_187772368_D_249341444==1 & (D_187772368_D_152773041==1 | D_187772368_D_917302906==1  |D_187772368_D_690018400==1)) |
    (D_187772368_D_690018400==1 & (D_187772368_D_152773041==1 | D_187772368_D_249341444==1  |D_187772368_D_917302906==1)) &
    !(D_187772368_D_917302906==1 & D_187772368_D_152773041==1 & 
          D_187772368_D_249341444==1 & D_187772368_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_187772368_D_917302906==1 & D_187772368_D_152773041==1 & 
                                                D_187772368_D_249341444==1 & D_187772368_D_690018400==1) ~ "All Four Seasons",
                                             D_187772368_D_917302906==1 ~ "Winter",
                                             D_187772368_D_152773041==1 ~ "Spring",
                                             D_187772368_D_249341444==1 ~ "Summer",
                                             D_187772368_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_ski_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_ski_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2K: Seasons Skiing/Snowboarding for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-ski
##one_logic_funct(D_865200503, D_517976064_D_182827107, 1, "EXEREC3K: Frequency of Skiing for Exercise")
EXEREC3K <- data_tib_m2 %>%  filter(D_517976064_D_182827107==1)
EXEREC3K_ans= EXEREC3K %>%  mutate(answer= case_when(D_865200503==239152340 ~ "Once a month or less",
                                                        D_865200503==582006876 ~ "2-3 days per month",
                                                        D_865200503==645894551 ~ "1-2 days per week",
                                                        D_865200503==996315715 ~ "3-4 days per week",
                                                        D_865200503==671267928 ~ "5-6 days per week",
                                                        D_865200503==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3K_ans$answer <- factor(EXEREC3K_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3K_summary <- EXEREC3K_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3K_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3K: Frequency of Skiing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-ski
##one_logic_funct(D_831643763, D_517976064_D_182827107, 1, "Time Spent Skiing for Exercise")
EXEREC4K <- data_tib_m2 %>%  filter(D_517976064_D_182827107==1)
EXEREC4K_ans= EXEREC4K %>%  mutate(answer= case_when(D_831643763==428999623 ~ "15 minutes or less",
                                                        D_831643763==248303092 ~ "16 to 30 minutes",
                                                        D_831643763==206020811 ~ "31 to 44 minutes",
                                                        D_831643763==264163865 ~ "45 to 59 minutes",
                                                        D_831643763==638092100 ~ "1 hour",
                                                 D_831643763==628177728 ~ "2 hours",
                                                 D_831643763==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4K_ans$answer <- factor(EXEREC4K_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4K_summary <- EXEREC4K_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4K_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4K: Time Spent per Day Skiing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()






##Cross-country 
#which season-cross
dt_crossc= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_734860227==1)


ex_type= dt_crossc %>%  mutate(season= case_when(((D_815229596_D_917302906==1 & (D_815229596_D_152773041==1 | D_815229596_D_249341444==1  |D_815229596_D_690018400==1)) | 
    (D_815229596_D_152773041==1 & (D_815229596_D_917302906==1 | D_815229596_D_249341444==1  |D_815229596_D_690018400==1)) |
    (D_815229596_D_249341444==1 & (D_815229596_D_152773041==1 | D_815229596_D_917302906==1  |D_815229596_D_690018400==1)) |
    (D_815229596_D_690018400==1 & (D_815229596_D_152773041==1 | D_815229596_D_249341444==1  |D_815229596_D_917302906==1)) &
    !(D_815229596_D_917302906==1 & D_815229596_D_152773041==1 & 
          D_815229596_D_249341444==1 & D_815229596_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_815229596_D_917302906==1 & D_815229596_D_152773041==1 & 
                                                D_815229596_D_249341444==1 & D_815229596_D_690018400==1) ~ "All Four Seasons",D_815229596_D_917302906==1 ~ "Winter",
                                             D_815229596_D_152773041==1 ~ "Spring",
                                             D_815229596_D_249341444==1 ~ "Summer",
                                             D_815229596_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_crossc_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_crossc_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2L: Seasons Cross-Country Skiing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-cross
##one_logic_funct(D_981509686, D_517976064_D_734860227, 1, "EXEREC3L: Frequency of Cross-Country Skiing for Exercise")
EXEREC3L <- data_tib_m2 %>%  filter(D_517976064_D_734860227==1)
EXEREC3L_ans= EXEREC3L %>%  mutate(answer= case_when(D_981509686==239152340 ~ "Once a month or less",
                                                        D_981509686==582006876 ~ "2-3 days per month",
                                                        D_981509686==645894551 ~ "1-2 days per week",
                                                        D_981509686==996315715 ~ "3-4 days per week",
                                                        D_981509686==671267928 ~ "5-6 days per week",
                                                        D_981509686==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3L_ans$answer <- factor(EXEREC3L_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3L_summary <- EXEREC3L_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3L_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3L: Frequency of Cross-Country Skiing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-cross
##one_logic_funct(D_921220809, D_517976064_D_734860227, 1, "Time Spent Cross-Country Skiing for Exercise")
EXEREC4L <- data_tib_m2 %>%  filter(D_517976064_D_734860227==1)
EXEREC4L_ans= EXEREC4L %>%  mutate(answer= case_when(D_921220809==428999623 ~ "15 minutes or less",
                                                        D_921220809==248303092 ~ "16 to 30 minutes",
                                                        D_921220809==206020811 ~ "31 to 44 minutes",
                                                        D_921220809==264163865 ~ "45 to 59 minutes",
                                                        D_921220809==638092100 ~ "1 hour",
                                                 D_921220809==628177728 ~ "2 hours",
                                                 D_921220809==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4L_ans$answer <- factor(EXEREC4L_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4L_summary <- EXEREC4L_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4L_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4L: Time Spent per Day Cross-Country Skiing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





##Surf
#which season-surf 
dt_surf= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_371531887==1)


ex_type= dt_surf %>%  mutate(season= case_when(((D_262305264_D_917302906==1 & (D_262305264_D_152773041==1 | D_262305264_D_249341444==1  |D_262305264_D_690018400==1)) | 
    (D_262305264_D_152773041==1 & (D_262305264_D_917302906==1 | D_262305264_D_249341444==1  |D_262305264_D_690018400==1)) |
    (D_262305264_D_249341444==1 & (D_262305264_D_152773041==1 | D_262305264_D_917302906==1  |D_262305264_D_690018400==1)) |
    (D_262305264_D_690018400==1 & (D_262305264_D_152773041==1 | D_262305264_D_249341444==1  |D_262305264_D_917302906==1)) &
    !(D_262305264_D_917302906==1 & D_262305264_D_152773041==1 & 
          D_262305264_D_249341444==1 & D_262305264_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_262305264_D_917302906==1 & D_262305264_D_152773041==1 & 
                                                D_262305264_D_249341444==1 & D_262305264_D_690018400==1) ~ "All Four Seasons",
                                             D_262305264_D_917302906==1 ~ "Winter",
                                             D_262305264_D_152773041==1 ~ "Spring",
                                             D_262305264_D_249341444==1 ~ "Summer",
                                             D_262305264_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_surf_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_surf_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2M: Seasons Surfing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-surf
##one_logic_funct(D_214750556, D_517976064_D_371531887, 1, "EXEREC3M: Frequency of Surfing for Exercise")
EXEREC3M <- data_tib_m2 %>%  filter(D_517976064_D_371531887==1)
EXEREC3M_ans= EXEREC3M %>%  mutate(answer= case_when(D_214750556==239152340 ~ "Once a month or less",
                                                        D_214750556==582006876 ~ "2-3 days per month",
                                                        D_214750556==645894551 ~ "1-2 days per week",
                                                        D_214750556==996315715 ~ "3-4 days per week",
                                                        D_214750556==671267928 ~ "5-6 days per week",
                                                        D_214750556==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3M_ans$answer <- factor(EXEREC3M_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3M_summary <- EXEREC3M_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3M_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3M: Frequency of Surfing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-surf
##one_logic_funct(D_621878019, D_517976064_D_371531887, 1, "Time Spent of Surfing for Exercise")
EXEREC4M <- data_tib_m2 %>%  filter(D_517976064_D_371531887==1)
EXEREC4M_ans= EXEREC4M %>%  mutate(answer= case_when(D_621878019==428999623 ~ "15 minutes or less",
                                                        D_621878019==248303092 ~ "16 to 30 minutes",
                                                        D_621878019==206020811 ~ "31 to 44 minutes",
                                                        D_621878019==264163865 ~ "45 to 59 minutes",
                                                        D_621878019==638092100 ~ "1 hour",
                                                 D_621878019==628177728 ~ "2 hours",
                                                 D_621878019==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4M_ans$answer <- factor(EXEREC4M_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4M_summary <- EXEREC4M_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4M_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4M: Time Spent per Day Surfing for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()




##Circuit Training
#which season-circuit  
dt_circ= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_423631576==1)

ex_type= dt_circ %>%  mutate(season= case_when(((D_409324592_D_917302906==1 & (D_409324592_D_152773041==1 | D_409324592_D_249341444==1  |D_409324592_D_690018400==1)) | 
    (D_409324592_D_152773041==1 & (D_409324592_D_917302906==1 | D_409324592_D_249341444==1  |D_409324592_D_690018400==1)) |
    (D_409324592_D_249341444==1 & (D_409324592_D_152773041==1 | D_409324592_D_917302906==1  |D_409324592_D_690018400==1)) |
    (D_409324592_D_690018400==1 & (D_409324592_D_152773041==1 | D_409324592_D_249341444==1  |D_409324592_D_917302906==1)) &
    !(D_409324592_D_917302906==1 & D_409324592_D_152773041==1 & 
          D_409324592_D_249341444==1 & D_409324592_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_409324592_D_917302906==1 & D_409324592_D_152773041==1 & 
                                                D_409324592_D_249341444==1 & D_409324592_D_690018400==1) ~ "All Four Seasons",
                                             D_409324592_D_917302906==1 ~ "Winter",
                                             D_409324592_D_152773041==1 ~ "Spring",
                                             D_409324592_D_249341444==1 ~ "Summer",
                                             D_409324592_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_circ_summary <- ex_type %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_circ_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2N: Seasons Circuit Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-circuit
##one_logic_funct(D_775324618, D_517976064_D_423631576, 1, "EXEREC3N: Frequency of Circuit Training for Exercise")
EXEREC3N <- data_tib_m2 %>%  filter(D_517976064_D_423631576==1)
EXEREC3N_ans= EXEREC3N %>%  mutate(answer= case_when(D_775324618==239152340 ~ "Once a month or less",
                                                        D_775324618==582006876 ~ "2-3 days per month",
                                                        D_775324618==645894551 ~ "1-2 days per week",
                                                        D_775324618==996315715 ~ "3-4 days per week",
                                                        D_775324618==671267928 ~ "5-6 days per week",
                                                        D_775324618==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3N_ans$answer <- factor(EXEREC3N_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3N_summary <- EXEREC3N_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3N_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3N: Frequency of Circuit Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-circuit
##one_logic_funct(D_305312165, D_517976064_D_423631576, 1, "Time Spent Circuit Training for Exercise")
EXEREC4N <- data_tib_m2 %>%  filter(D_517976064_D_423631576==1)
EXEREC4N_ans= EXEREC4N %>%  mutate(answer= case_when(D_305312165==428999623 ~ "15 minutes or less",
                                                        D_305312165==248303092 ~ "16 to 30 minutes",
                                                        D_305312165==206020811 ~ "31 to 44 minutes",
                                                        D_305312165==264163865 ~ "45 to 59 minutes",
                                                        D_305312165==638092100 ~ "1 hour",
                                                 D_305312165==628177728 ~ "2 hours",
                                                 D_305312165==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4N_ans$answer <- factor(EXEREC4N_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4N_summary <- EXEREC4N_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4N_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4N: Time Spent per Day Circuit Training for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()





#Other
#which season-other  
dt_oth_ex= data_tib_m2 %>%  filter(data_tib_m2$D_517976064_D_181769837==1)


ex_type= dt_oth_ex %>%  mutate(season= case_when(((D_895837106_D_917302906==1 & (D_895837106_D_152773041==1 | D_895837106_D_249341444==1  |D_895837106_D_690018400==1)) | 
    (D_895837106_D_152773041==1 & (D_895837106_D_917302906==1 | D_895837106_D_249341444==1  |D_895837106_D_690018400==1)) |
    (D_895837106_D_249341444==1 & (D_895837106_D_152773041==1 | D_895837106_D_917302906==1  |D_895837106_D_690018400==1)) |
    (D_895837106_D_690018400==1 & (D_895837106_D_152773041==1 | D_895837106_D_249341444==1  |D_895837106_D_917302906==1)) &
    !(D_895837106_D_917302906==1 & D_895837106_D_152773041==1 & 
          D_895837106_D_249341444==1 & D_895837106_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
                                             (D_895837106_D_917302906==1 & D_895837106_D_152773041==1 & 
                                                D_895837106_D_249341444==1 & D_895837106_D_690018400==1) ~ "All Four Seasons",
                                             D_895837106_D_917302906==1 ~ "Winter",
                                             D_895837106_D_152773041==1 ~ "Spring",
                                             D_895837106_D_249341444==1 ~ "Summer",
                                             D_895837106_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

ex_type$season <- factor(ex_type$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dt_oth_ex_summary <- ex_type %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dt_oth_ex_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC2O: Seasons Doing Other Activity for Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#how often-other
##one_logic_funct(D_522949496, D_517976064_D_181769837, 1, "EXEREC3O: Frequency of Other Exercise")
EXEREC3O <- data_tib_m2 %>%  filter(D_517976064_D_181769837==1)
EXEREC3O_ans= EXEREC3O %>%  mutate(answer= case_when(D_522949496==239152340 ~ "Once a month or less",
                                                        D_522949496==582006876 ~ "2-3 days per month",
                                                        D_522949496==645894551 ~ "1-2 days per week",
                                                        D_522949496==996315715 ~ "3-4 days per week",
                                                        D_522949496==671267928 ~ "5-6 days per week",
                                                        D_522949496==647504893 ~ "Every day",
                                                        TRUE ~ "Skipped this question"))

EXEREC3O_ans$answer <- factor(EXEREC3O_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtEXEREC3O_summary <- EXEREC3O_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC3O_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC3O: Frequency of Other Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#time-other
##one_logic_funct(D_272119228, D_517976064_D_181769837, 1, "Time Spent Doing Other Forms of Exercise")
EXEREC4O <- data_tib_m2 %>%  filter(D_517976064_D_181769837==1)
EXEREC4O_ans= EXEREC4O %>%  mutate(answer= case_when(D_272119228==428999623 ~ "15 minutes or less",
                                                        D_272119228==248303092 ~ "16 to 30 minutes",
                                                        D_272119228==206020811 ~ "31 to 44 minutes",
                                                        D_272119228==264163865 ~ "45 to 59 minutes",
                                                        D_272119228==638092100 ~ "1 hour",
                                                 D_272119228==628177728 ~ "2 hours",
                                                 D_272119228==805918496 ~ "3 hours or more",
                                                        TRUE ~ "Skipped this question"))

EXEREC4O_ans$answer <- factor(EXEREC4O_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this question" ))

dtEXEREC4O_summary <- EXEREC4O_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtEXEREC4O_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("EXEREC4O: Time Spent per Day Doing Other Forms of Exercise")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


```

## Lawn, Garden, and Home Repair
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Outside of work --why are these not in a tibble? May need barplot instead


chore_type= data_tib_m2 %>%  mutate(chore= case_when(D_204421360_D_797221287==1 ~ "Moderate Chores",
                                             D_204421360_D_500744195==1 ~ "Vigorous Chores",
                                             D_204421360_D_383015037==1 ~ "Home Repair",
                                             D_204421360_D_535003378==1 ~ "None of the Above",
                                             TRUE~ "Skipped this question"))


dtLAWN1_summary <- chore_type %>% group_by(chore) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(chore, n, percentage)


dtLAWN1_summary %>%  gt() %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("LAWN1: Lawn, Garden and Home Repair Activities")) %>%
  cols_label(n= md("**Number of Participants**"), chore = md("**Chores**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = chore,
    )
  ) %>% opt_row_striping()



```


### Moderate chores
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#Seasons- moderate


dtLAWN2A= data_tib_m2 %>% filter(D_204421360_D_797221287==1)


mod_ss= dtLAWN2A %>%  mutate(season= case_when(((D_442059084_D_917302906==1 & (D_442059084_D_152773041==1 | D_442059084_D_249341444==1  |D_442059084_D_690018400==1)) | 
    (D_442059084_D_152773041==1 & (D_442059084_D_917302906==1 | D_442059084_D_249341444==1  |D_442059084_D_690018400==1)) |
    (D_442059084_D_249341444==1 & (D_442059084_D_152773041==1 | D_442059084_D_917302906==1  |D_442059084_D_690018400==1)) |
    (D_442059084_D_690018400==1 & (D_442059084_D_152773041==1 | D_442059084_D_249341444==1  |D_442059084_D_917302906==1)) &
    !(D_442059084_D_917302906==1 & D_442059084_D_152773041==1 & 
          D_442059084_D_249341444==1 & D_442059084_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
(D_442059084_D_917302906==1 & D_442059084_D_152773041==1 & 
     D_442059084_D_249341444==1 & D_442059084_D_690018400==1) ~ "All Four Seasons",
D_442059084_D_917302906==1 ~ "Winter",
                                             D_442059084_D_152773041==1 ~ "Spring",
                                             D_442059084_D_249341444==1 ~ "Summer",
                                             #D_442059084_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

mod_ss$season <- factor(mod_ss$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dtLAWN2A_summary <- mod_ss %>% group_by(season) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)

dtLAWN2A_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN2A: Seasons Moderate Chores Done (Can be more than one)")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()
```



```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#How often- moderate
#one_logic_funct(D_992022740,D_204421360_D_797221287,1,"LAWN3A: Frequency of Moderate Outdoor Chores")

dtLAWN2B= data_tib_m2 %>%  filter(D_204421360_D_797221287==1)
vig_ss= dtLAWN2B %>%  mutate(season= case_when(D_992022740==239152340 ~ "0-1 day per month",
                                             D_992022740==582006876 ~ "2-3 days per month",
                                             D_992022740==645894551 ~ "1-2 days per week",
                                             D_992022740==996315715 ~ "3-4 days per week",
                                             D_992022740==671267928 ~ "5-6 days per week",
                                             D_992022740==647504893 ~ "Every day",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-1 day per month", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtLAWN2B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dtLAWN2B_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN3A: Frequency of Moderate Outdoor Chores")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()



#Time per day- moderate
#one_logic_funct(D_429531329,D_204421360_D_797221287,1,"LAWN4A: Time Spent on Moderate Outdoor Chores")
LAWN4A= data_tib_m2 %>%  filter(D_204421360_D_797221287==1)
vig_ss= LAWN4A %>%  mutate(season= case_when(D_429531329==428999623 ~ "0-15 minutes",
                                             D_429531329==248303092 ~ "16-30 minutes",
                                             D_429531329==206020811 ~ "31-44 minutes",
                                             D_429531329==264163865 ~ "45-59 minutes",
                                             D_429531329==264163865 ~ "1 hour",
                                             D_429531329==628177728 ~ "2 hours",
                                             D_429531329==805918496 ~ "3+ hours",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-15 minutes", "16-30 minutes", "31-44 minutes", "45-59 minutes", "1 hour", "2 hours", "3+ hours", "Skipped this question"))

LAWN4A_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


LAWN4A_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN4A: Time Spent on Moderate Outdoor Chores")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


```


### Vigorous chores
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Seasons- vigorous


dtLAWN2B= data_tib_m2 %>%  filter(D_204421360_D_500744195==1)


vig_ss= dtLAWN2B %>%  mutate(season= case_when(((D_829749579_D_917302906==1 & (D_829749579_D_152773041==1 | D_829749579_D_249341444==1  |D_829749579_D_690018400==1)) | 
    (D_829749579_D_152773041==1 & (D_829749579_D_917302906==1 | D_829749579_D_249341444==1  |D_829749579_D_690018400==1)) |
    (D_829749579_D_249341444==1 & (D_829749579_D_152773041==1 | D_829749579_D_917302906==1  |D_829749579_D_690018400==1)) |
    (D_829749579_D_690018400==1 & (D_829749579_D_152773041==1 | D_829749579_D_249341444==1  |D_829749579_D_917302906==1)) &
    !(D_829749579_D_917302906==1 & D_829749579_D_152773041==1 & 
          D_829749579_D_249341444==1 & D_829749579_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
(D_829749579_D_917302906==1 & D_829749579_D_152773041==1 & 
     D_829749579_D_249341444==1 & D_829749579_D_690018400==1) ~ "All Four Seasons",
D_829749579_D_917302906==1 ~ "Winter",
                                             D_829749579_D_152773041==1 ~ "Spring",
                                             D_829749579_D_249341444==1 ~ "Summer",
                                             D_829749579_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

vig_ss$season <- factor(vig_ss$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dtLAWN2B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dtLAWN2B_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN2B: Seasons Vigorous Chores Done (Can be more than one)")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()
```



```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#How often- vigorous
#one_logic_funct(D_888313306,D_204421360_D_500744195,1,"LAWN3B: Frequency of Vigorous Outdoor Chores")
dtLAWN3B= data_tib_m2 %>%  filter(D_204421360_D_500744195==1)
vig_ss= dtLAWN3B %>%  mutate(season= case_when(D_888313306==239152340 ~ "0-1 day per month",
                                             D_888313306==582006876 ~ "2-3 days per month",
                                             D_888313306==645894551 ~ "1-2 days per week",
                                             D_888313306==996315715 ~ "3-4 days per week",
                                             D_888313306==671267928 ~ "5-6 days per week",
                                             D_888313306==647504893 ~ "Every day",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-1 day per month", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtLAWN3B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dtLAWN3B_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN3A: Frequency of Vigorous Outdoor Chores")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#Time per day- vigorous
#one_logic_funct(D_644018981,D_204421360_D_500744195,1,"LAWN4B: Time Spent on Vigorous Outdoor Chores")
LAWN4B= data_tib_m2 %>%  filter(D_204421360_D_500744195==1)
vig_ss= LAWN4B %>%  mutate(season= case_when(D_644018981==428999623 ~ "0-15 minutes",
                                             D_644018981==248303092 ~ "16-30 minutes",
                                             D_644018981==206020811 ~ "31-44 minutes",
                                             D_644018981==264163865 ~ "45-59 minutes",
                                             D_644018981==264163865 ~ "1 hour",
                                             D_644018981==628177728 ~ "2 hours",
                                             D_644018981==805918496 ~ "3+ hours",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-15 minutes", "16-30 minutes", "31-44 minutes", "45-59 minutes", "1 hour", "2 hours", "3+ hours", "Skipped this question"))

LAWN4B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


LAWN4B_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN4B: Time Spent on Vigorous Outdoor Chores")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()




```


### Home Repair
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Seasons- home repair   


dtLAWN2C= data_tib_m2 %>% filter(D_204421360_D_383015037==1)


home_ss= dtLAWN2C %>%  mutate(season= case_when(((D_618482103_D_917302906==1 & (D_618482103_D_152773041==1 | D_618482103_D_249341444==1  |D_618482103_D_690018400==1)) | 
    (D_618482103_D_152773041==1 & (D_618482103_D_917302906==1 | D_618482103_D_249341444==1  |D_618482103_D_690018400==1)) |
    (D_618482103_D_249341444==1 & (D_618482103_D_152773041==1 | D_618482103_D_917302906==1  |D_618482103_D_690018400==1)) |
    (D_618482103_D_690018400==1 & (D_618482103_D_152773041==1 | D_618482103_D_249341444==1  |D_618482103_D_917302906==1)) &
    !(D_618482103_D_917302906==1 & D_618482103_D_152773041==1 & 
          D_618482103_D_249341444==1 & D_618482103_D_690018400==1))~ 
    "Multiple Seasons", #at least two but not all four
(D_618482103_D_917302906==1 & D_618482103_D_152773041==1 & 
     D_618482103_D_249341444==1 & D_618482103_D_690018400==1) ~ "All Four Seasons",
D_618482103_D_917302906==1 ~ "Winter",
                                             D_618482103_D_152773041==1 ~ "Spring",
                                             D_618482103_D_249341444==1 ~ "Summer",
                                             D_618482103_D_690018400==1 ~ "Fall",
                                             TRUE~ "Skipped this question"))

home_ss$season <- factor(home_ss$season,levels=c("All Four Seasons", "Multiple Seasons", "Winter","Spring","Summer","Fall","Skipped this question"))

dtLAWN2C_summary <- home_ss %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dtLAWN2C_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN2C: Seasons Vigorous Chores Done (Can be more than one)")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()
```



```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#How often- home repair
#one_logic_funct(D_352531133,D_204421360_D_383015037,1,"LAWN3C: Frequency of Home Repair")
dtLAWN3B= data_tib_m2 %>%  filter(D_204421360_D_383015037==1)
vig_ss= dtLAWN3B %>%  mutate(season= case_when(D_352531133==239152340 ~ "0-1 day per month",
                                             D_352531133==582006876 ~ "2-3 days per month",
                                             D_352531133==645894551 ~ "1-2 days per week",
                                             D_352531133==996315715 ~ "3-4 days per week",
                                             D_352531133==671267928 ~ "5-6 days per week",
                                             D_352531133==647504893 ~ "Every day",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-1 day per month", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this question" ))

dtLAWN3B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


dtLAWN3B_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN3A: Frequency of Home Repair")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#Time per day- home repair
#one_logic_funct(D_2672615581,D_204421360_D_383015037,1,"LAWN4C: Time Spent on Home Repair")
LAWN4C= data_tib_m2 %>%  filter(D_204421360_D_383015037==1)
vig_ss= LAWN4C %>%  mutate(season= case_when(D_267261558==428999623 ~ "0-15 minutes",
                                             D_267261558==248303092 ~ "16-30 minutes",
                                             D_267261558==206020811 ~ "31-44 minutes",
                                             D_267261558==264163865 ~ "45-59 minutes",
                                             D_267261558==264163865 ~ "1 hour",
                                             D_267261558==628177728 ~ "2 hours",
                                             D_267261558==805918496 ~ "3+ hours",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("0-15 minutes", "16-30 minutes", "31-44 minutes", "45-59 minutes", "1 hour", "2 hours", "3+ hours", "Skipped this question"))

LAWN4C_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


LAWN4C_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LAWN4C: Time Spent on Home Repair")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


```




# Section 4: Sleep 
## Sleep Schedule

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Determined by job/school
#simple_funct(D_591723682,"SLEEPSCHA: Is Sleep Schedule Determined by School/Work/Ect.")
vig_ss= data_tib_m2 %>%  mutate(season= case_when(D_591723682==353358909 ~ "Yes",
                                             D_591723682==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEPSCHA_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEPSCHA_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEPSCHA: Is Sleep Schedule Determined by School/Work/Ect.")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#Days per week 
#one_logic_funct(D_168431681,D_591723682,"353358909","SLEEPSCHB: Days per Week Sleep Determined by Job or School")
SLEEPSCHB= data_tib_m2 %>%  filter(D_591723682==353358909)
vig_ss= SLEEPSCHB %>%  mutate(season= case_when(D_168431681==349122068 ~ "1",
                                             D_168431681==156095877 ~ "2",
                                             D_168431681==162668459 ~ "3",
                                             D_168431681==278139969 ~ "4",
                                             D_168431681==676824724 ~ "5",
                                             D_168431681==512144428 ~ "6",
                                             D_168431681==125674414 ~ "7",
                                             TRUE~ "Skipped this question"))
vig_ss$season <- factor(vig_ss$season,levels=c("1", "2", "3", "4", "5", "6", "7", "Skipped this question"))

SLEEPSCHB_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEPSCHB_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEPSCHB: Days per Week Sleep Determined by Job or School")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

```


## Usual Sleep Schedule on Workdays
```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Time you go to bed workdays/most days   #DO NOT CHANGE TO AS NUMERIC
module2 %>% filter(!is.na(module2$D_636757313)) %>% ggplot(aes(x=D_636757313))+ ylab("Count") + 
  xlab("Time (Military Time)") +geom_bar()+  ggtitle("SLEEP1A: Time You go to Bed") +theme(axis.text.x = element_text(angle = 90))


#Time to fall asleep workdays/most days      
module2$D_653906464_D_707805344 <- as.numeric(module2$D_653906464_D_707805344) #hours
module2$D_653906464_D_850393641 <- as.numeric(module2$D_653906464_D_850393641) #minutes
in_minutes= round(((module2$D_653906464_D_707805344*60)+module2$D_653906464_D_850393641), digits=0)
hist_funct_D(in_minutes,"SLEEP1D: Length of Time to Fall asleep", "Minutes", "Frequency")
#mean(in_minutes,na.rm=T) 

# female= module2 %>% select(module2$D_407056417==)
# aggregate(in_minutes, list(module2$D_407056417), FUN=mean) #why is this not working??
# module2 %>%group_by(D_407056417) %>%summarise_at(vars(in_minutes), list(name = mean)) #why is this not working??


#Time you wake up workdays/most days      #DO NOT CHANGE TO AS NUMERIC
module2 %>% filter(!is.na(module2$D_580367946)) %>% ggplot(aes(x=D_580367946, fill=D_407056417))+ ylab("Count") + 
  xlab("Time (Military Time)") +geom_bar()+  ggtitle("SLEEP1F: Time you Wake Up") + theme(axis.text.x = element_text(angle = 90))+
  scale_fill_discrete(name = "Gender",  labels=c("Female", "Male"))


#How long do you lie in bed workdays/most days   
module2$D_358259099_D_707805344 <- as.numeric(module2$D_358259099_D_707805344) #hours
module2$D_358259099_D_850393641 <- as.numeric(module2$D_358259099_D_850393641) #minutes
in_mins= round(((module2$D_358259099_D_707805344*60)+module2$D_358259099_D_850393641), digits=0)
hist_funct_D(in_mins,"SLEEP1I: Length of Lying in Bed After Waking Up", "Minutes", "Frequency")
#mean(in_mins,na.rm=T) 

#Use alarm clock workdays/most days
#simple_funct(D_392629868, "SLEEP1K: Using an Alarm Clock on Most Days")

vig_ss= data_tib_m2 %>%  mutate(season= case_when(D_392629868==353358909 ~ "Yes",
                                             D_392629868==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEP1K_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEP1K_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEP1K: Using an Alarm Clock on Most Days")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#Wake up before alarm workdays/most days
#one_logic_funct(D_354980163, D_392629868,353358909 , "SLEEP1L: Wake up before Alarm Clock on Wordays")
SLEEPSCHB= data_tib_m2 %>%  filter(D_392629868==353358909)
vig_ss= SLEEPSCHB %>%  mutate(season= case_when(D_354980163==353358909 ~ "Yes",
                                             D_354980163==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEPSCHB_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEPSCHB_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEP1L: Wake up before Alarm Clock on Wordays")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()


#Time in sun workdays/most days
module2$D_424807655_D_707805344 <- as.numeric(module2$D_424807655_D_707805344) #hours
module2$D_424807655_D_850393641 <-as.numeric(module2$D_424807655_D_850393641) #minutes
in_sun_mins= round(((module2$D_424807655_D_707805344*60)+module2$D_424807655_D_850393641), digits=0)
hist_funct_D(in_sun_mins,"SLEEP1M: Time in the Sun", "Minutes", "Frequency")
#mean(in_sun_mins, na.rm=T)
```


## Usual Sleep Schedule on Non-Workdays
```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Time you go to bed non-workdays
module2 %>% filter(D_591723682==353358909) %>% ggplot(aes(x=D_823919522, fill=D_407056417))+ ylab("Count") + 
  xlab("Time (Military Time)") +geom_bar()+  ggtitle("SLEEP2A: Time you Go to Bed on Non-Workdays") +theme(axis.text.x = element_text(angle = 90))+ 
  scale_fill_discrete(name = "Gender",  labels=c("Female", "Male"))

#Time to fall asleep non-workdays
  #sum(table(module2$D_532767229_D_707805344))
module2$D_532767229_D_707805344 <- as.numeric(module2$D_532767229_D_707805344) #hours
module2$D_532767229_D_850393641 <- as.numeric(module2$D_532767229_D_850393641) #minutes
fall_mins= round(((module2$D_532767229_D_707805344*60) + module2$D_532767229_D_850393641), digits=0)
hist_funct_D(fall_mins,"SLEEP2D: Time Needed to Fall Asleep on Non-Workdays", "Minutes", "Frequency")


#Time you wake up non-workdays
module2 %>% filter(!is.na(module2$D_698673038)) %>% ggplot(aes(x=D_698673038, fill=D_407056417))+ ylab("Count") + 
  xlab("Time (Military Time)") + geom_bar()+  ggtitle("SLEEP2F: Time you Wake Up on Non-Workdays")+ 
  scale_fill_discrete(name = "Gender",  labels=c("Female", "Male"))+ theme(axis.text.x = element_text(angle = 90))+
  geom_vline(aes(xintercept=mean(D_698673038, na.rm=T)), colour="red", linetype="solid")

#How long do you lie in bed non-workdays
module2$D_711365027_D_707805344 <- as.numeric(module2$D_711365027_D_707805344) #hours 
module2$D_711365027_D_850393641 <-as.numeric(module2$D_711365027_D_850393641) #minutes
lieN_mins= round(((module2$D_711365027_D_850393641 +(module2$D_711365027_D_707805344*60))), digits=0)
hist_funct_D(lieN_mins,"SLEEPI: Length of Lying in Bed After Waking Up on Non-Workdays", "Minutes", "Frequency")



#Use alarm clock non-workdays
#one_logic_funct(D_874262904, D_591723682,353358909, "SLEEP2K: Using an Alarm Clock on Non-Workdays")
SLEEP2K= data_tib_m2 %>%  filter(D_591723682==353358909)
vig_ss= SLEEP2K %>%  mutate(season= case_when(D_874262904==353358909 ~ "Yes",
                                             D_874262904==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEP2K_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEP2K_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEP2K: Using an Alarm Clock on Non-Workdays")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#Wake up before alarm non-workdays
#one_logic_funct(D_820694957,  D_874262904,"353358909" , "SLEEP1L: Wake up before Alarm Clock on Most Days")
SLEEP1L= data_tib_m2 %>%  filter(D_874262904==353358909)
vig_ss= SLEEP1L %>%  mutate(season= case_when(D_820694957==353358909 ~ "Yes",
                                             D_820694957==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEP1L_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEP1L_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEP1L: Wake up before Alarm Clock on Wordays")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#Choose when you wake up
#one_logic_funct(D_823541843, D_591723682,353358909, "SLEEP2M: Ability to Choose when you Wake up on Non-Workdays")
SLEEP2M= data_tib_m2 %>%  filter(D_591723682==353358909)
vig_ss= SLEEP2M %>%  mutate(season= case_when(D_823541843==353358909 ~ "Yes",
                                             D_823541843==104430631 ~ "No",
                                             TRUE~ "Skipped this question"))

SLEEP2M_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SLEEP2M_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLEEP2M: Ability to Choose when you Wake up on Non-Workdays")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#Time in sun non-workdays   #try in prod
module2$D_825227968_D_707805344 <- as.numeric(module2$D_825227968_D_707805344) #hours
module2$D_825227968_D_850393641 <- as.numeric(module2$D_825227968_D_850393641) #minutes 
in_sunNW_mins= round(((module2$D_825227968_D_707805344*60) + module2$D_825227968_D_850393641), digits=0)
hist_funct_D(in_sunNW_mins,"SLEEPN: Time in the Sun on Non-Workdays", "Minutes", "Frequency")


```


## Sleeping Habits

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
##simple_funct(D_421859821_D_220238240, "SLHABIT1A: Having Trouble Falling Asleep")
SLHABIT1A_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1A_ans$answer <- factor(SLHABIT1A_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question"))

dtSLHABIT1A_summary <- SLHABIT1A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1A_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1A: Having Trouble Falling Asleep")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Wake up several times
##simple_funct(D_421859821_D_151006826, "SLHABIT1B: Waking up Several Times per Night")
SLHABIT1B_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1B_ans$answer <- factor(SLHABIT1B_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1B_summary <- SLHABIT1B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1B_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1B: Waking up Several Times per Night")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Wake up early
##simple_funct(D_421859821_D_965290070, "SLHABIT1C: Waking up Too early")
SLHABIT1C_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1C_ans$answer <- factor(SLHABIT1C_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1C_summary <- SLHABIT1C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1C_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1C: Waking up Too early")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Getting back to sleep
##simple_funct(D_421859821_D_781115321, "SLHABIT1D: Trouble Falling Back Asleep")
SLHABIT1D_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1D_ans$answer <- factor(SLHABIT1D_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1D_summary <- SLHABIT1D_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1D_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1D: Trouble Falling Back Asleep")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#sleeping pills
##simple_funct(D_421859821_D_453071098, "SLHABIT1E: Prescription Sleep Medication Taken")
SLHABIT1E_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1E_ans$answer <- factor(SLHABIT1E_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1E_summary <- SLHABIT1E_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1E_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1E: Prescription Sleep Medication Taken")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Irritable
##simple_funct(D_421859821_D_513065503, "SLHABIT1F: Sleep Problems causing Irritability")
SLHABIT1F_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1F_ans$answer <- factor(SLHABIT1F_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1F_summary <- SLHABIT1F_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1F_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1F: Sleep Problems causing Irritability")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Tired during the day
##simple_funct(D_421859821_D_257137378, "SLHABIT1G: Feeling Tired Throughout the day")
SLHABIT1G_ans= data_tib_m2 %>%  mutate(answer= case_when(D_421859821_D_220238240==104430631 ~ "No",
                                                     D_421859821_D_220238240==525779785 ~ "Yes, less than once per week",
                                                     D_421859821_D_220238240==565036180 ~ "Yes, 1 or 2 times per week",
                                                     D_421859821_D_220238240==284343405 ~ "Yes, 3 or 4 times per week",
                                                     D_421859821_D_220238240==270994579 ~ "Yes, 5 or more times per week",
                                                        TRUE ~ "Skipped this question"))

SLHABIT1G_ans$answer <- factor(SLHABIT1G_ans$answer,levels=c("No", "Yes, less than once per week", "Yes, 1 or 2 times per week", "Yes, 3 or 4 times per week", "Yes, 5 or more times per week", "Skipped this question" ))

dtSLHABIT1G_summary <- SLHABIT1G_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT1G_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT1G: Feeling Tired Throughout the day")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Sleep last 4 weeks
#simple_funct(D_910856756, "SLHABIT2: Sleep Quality in the Last Four Weeks")
SLHABIT2_ans= data_tib_m2 %>%  mutate(answer= case_when(D_910856756==462478011 ~ "Very sound or restful",
                                                     D_910856756==303095574 ~ "Sound and restful",
                                                     D_910856756==838403733 ~ "Average quality",
                                                     D_910856756==522143286 ~ "Restless",
                                                     D_910856756==621370621 ~ "Very restless",
                                                        TRUE ~ "Skipped this question"))

SLHABIT2_ans$answer <- factor(SLHABIT2_ans$answer,levels=c("Very sound or restful", "Sound and restful", "Average quality", "Restless", "Very restless", "Skipped this question" ))

dtSLHABIT2_summary <- SLHABIT2_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT2: Sleep Quality in the Last Four Weeks")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


##Chance of Falling asleep while:
##simple_funct(D_981441822_D_403155173, "SLHABIT3A: Chance of Falling Asleep while Sitting and Reading")
SLHABIT3A_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3A_ans$answer <- factor(SLHABIT3A_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3A_summary <- SLHABIT3A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3A_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3A: Chance of Falling Asleep while Sitting and Reading")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#watch tv
##simple_funct(D_981441822_D_576621769, "SLHABIT3B: Chance of Falling Asleep while Watching TV")
SLHABIT3B_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3B_ans$answer <- factor(SLHABIT3B_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3B_summary <- SLHABIT3B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3B_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3B: Chance of Falling Asleep while Watching TV")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#sitting inactive
##simple_funct(D_981441822_D_988508028, "SLHABIT3C: Chance of Falling Asleep while Sitting Inactive")
SLHABIT3C_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3C_ans$answer <- factor(SLHABIT3C_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3C_summary <- SLHABIT3C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3C_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3C: Chance of Falling Asleep while Sitting Inactive")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#riding passenger
##simple_funct(D_981441822_D_186488870, "SLHABIT3D: Chance of Falling Asleep while Sitting as a Passenger in the Car")
SLHABIT3D_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3D_ans$answer <- factor(SLHABIT3D_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3D_summary <- SLHABIT3D_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3D_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3D: Chance of Falling Asleep while Sitting as a Passenger in the Car")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#lying in the afternoon
##simple_funct(D_981441822_D_922388461, "SLHABIT3E: Chance of Falling Asleep while Lying Resting in the Afternoon")
SLHABIT3E_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3E_ans$answer <- factor(SLHABIT3E_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3E_summary <- SLHABIT3E_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3E_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3E: Chance of Falling Asleep while Lying Resting in the Afternoon")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#sitting talking
##simple_funct(D_981441822_D_760686611, "SLHABIT3F: Chance of Falling Asleep while Sitting and Talking")
SLHABIT3F_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3F_ans$answer <- factor(SLHABIT3F_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3F_summary <- SLHABIT3F_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3F_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3F: Chance of Falling Asleep while Sitting and Talking")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#siting after lunch w/o alc
##simple_funct(D_981441822_D_354550061, "SLHABIT3G: Chance of Falling Asleep while Sitting after Lunch w/o Alcohol")
SLHABIT3G_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3G_ans$answer <- factor(SLHABIT3G_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3G_summary <- SLHABIT3G_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3G_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3G: Chance of Falling Asleep while Sitting after Lunch w/o Alcohol")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#traffic light
##simple_funct(D_981441822_D_179705366, "SLHABIT3H: Chance of Falling Asleep while Stopped at a Traffic Light")
SLHABIT3H_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3H_ans$answer <- factor(SLHABIT3H_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3H_summary <- SLHABIT3H_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3H_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3H: Chance of Falling Asleep while Stopped at a Traffic Light")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#dinner table
##simple_funct(D_981441822_D_955609858, "SLHABIT3I: Chance of Falling Asleep while at the Dinner Table")
SLHABIT3I_ans= data_tib_m2 %>%  mutate(answer= case_when(D_981441822_D_403155173==514068832 ~ "No chance",
                                                     D_981441822_D_403155173==774439579 ~ "Slight chance",
                                                     D_981441822_D_403155173==747099514 ~ "Moderate chance",
                                                     D_981441822_D_403155173==977681388 ~ "High Chance",
                                                        TRUE ~ "Skipped this question"))

SLHABIT3I_ans$answer <- factor(SLHABIT3I_ans$answer,levels=c("No chance", "Slight chance", "Moderate chance", "High Chance", "Skipped this question" ))

dtSLHABIT3I_summary <- SLHABIT3I_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT3I_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT3I: Chance of Falling Asleep while at the Dinner Table")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



#Fallen asleep while driving
##simple_funct(D_471018082, "SLHABIT4: Ever Fallen Asleep while Driving")
SLHABIT4_ans= data_tib_m2 %>%  mutate(answer= case_when(D_471018082==104430631 ~ "No",
                                                     D_471018082==353358909 ~ "Yes",
                                                        TRUE ~ "Skipped this question"))

dtSLHABIT4_summary <- SLHABIT4_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSLHABIT4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SLHABIT4: Ever Fallen Asleep while Driving")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
```


## Snoring

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Do you snore
#simple_funct(D_940733450, "SNORING1: Do you Snore?")
vig_ss= data_tib_m2 %>%  mutate(season= case_when(D_940733450==353358909 ~ "Yes",
                                             D_940733450==104430631 ~ "No",
                                             D_940733450==178420302 ~ "Do Not Know",
                                             TRUE~ "Skipped this question"))

SNORING1_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage)


SNORING1_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SNORING1: Do you Snore?")) %>% 
  cols_label(n= md("**Number of Participants**"), season = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = season,
    )
  ) %>% opt_row_striping()

#Describe snoring
#one_logic_funct(D_406137786, D_940733450, 353358909, "SNORING2: Describe your Snoring")
##one_logic_funct(D_406137786, D_940733450, 353358909, "SNORING2: Describe your Snoring")
SNORING2 <- data_tib_m2 %>%  filter(D_940733450==353358909)
SNORING2_ans= SNORING2 %>%  mutate(answer= case_when(D_406137786==624808470 ~ "Slightly Louder Than Breathing",
                                                       D_406137786==137254299 ~ "As Loud As Talking",
                                                     D_406137786==954318357 ~ "Louder Than Talking",
                                                     D_406137786==178420302 ~ "Unknown",
                                                        TRUE ~ "Skipped this question"))

SNORING2_ans$answer <- factor(SNORING2_ans$answer,levels=c("Slightly Louder Than Breathing", "As Loud As Talking", "Louder Than Talking", "Unknown", "Skipped this question" ))

dtSNORING2_summary <- SNORING2_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSNORING2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SNORING2: Describe your Snoring")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#How often
##one_logic_funct(D_631303960, D_940733450, 353358909, "SNORING3: Frequency of Snoring")
SNORING3 <- data_tib_m2 %>%  filter(D_940733450==353358909)
SNORING3_ans= SNORING3 %>%  mutate(answer= case_when(D_631303960==718687985 ~ "Almost every day",
                                                     D_631303960==471294296 ~ "3 to 4 times per week",
                                                     D_631303960==198347104 ~ "1 to 2 times per week",
                                                     D_631303960==632512449 ~ "1 to 2 times per month",
                                                     D_631303960==520089841 ~ "Less than 1 to 2 times per month",
                                                     D_631303960==178420302 ~ "Unknown",
                                                        TRUE ~ "Skipped this question"))

SNORING3_ans$answer <- factor(SNORING3_ans$answer,levels=c("Almost every day", "3 to 4 times per week", "1 to 2 times per week", "1 to 2 times per month", "Less than 1 to 2 times per month","Unknown", "Skipped this question" ))

dtSNORING3_summary <- SNORING3_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSNORING3_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SNORING3: Frequency of Snoring")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

#Bothers others
##one_logic_funct(D_876846761, D_940733450, 353358909, "SNORING4: Snoring Bothers Others")
SNORING4 <- data_tib_m2 %>%  filter(D_940733450==353358909)
SNORING4_ans= SNORING4 %>%  mutate(answer= case_when(D_876846761==353358909 ~ "Yes",
                                                     D_876846761==104430631 ~ "No",
                                                     D_876846761==178420302 ~ "Unknown",
                                                        TRUE ~ "Skipped this question"))

dtSNORING4_summary <- SNORING4_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSNORING4_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SNORING4: Snoring Bothers Others")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#Stop breathing
##one_logic_funct(D_756521698, D_940733450, 353358909, "SNORING5: Frequency you Stop Breathing while Sleeping")
SNORING5 <- data_tib_m2 %>%  filter(D_940733450==353358909)
SNORING5_ans= SNORING5 %>%  mutate(answer= case_when(D_756521698==718687985 ~ "Almost every day",
                                                     D_756521698==471294296 ~ "3 to 4 times per week",
                                                     D_756521698==198347104 ~ "1 to 2 times per week",
                                                     D_756521698==632512449 ~ "1 to 2 times per month",
                                                     D_756521698==520089841 ~ "Less than 1 to 2 times per month",
                                                     D_756521698==178420302 ~ "Unknown",
                                                        TRUE ~ "Skipped this question"))

SNORING5_ans$answer <- factor(SNORING5_ans$answer,levels=c("Almost every day", "3 to 4 times per week", "1 to 2 times per week", "1 to 2 times per month", "Less than 1 to 2 times per month","Unknown", "Skipped this question" ))

dtSNORING5_summary <- SNORING5_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtSNORING5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SNORING5: Frequency you Stop Breathing while Sleeping")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

```

## Sleep Problems
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

slp_cond= data_tib_m2 %>%  mutate(cond= case_when(D_479628567_D_370923702==1 ~ "Sleep Apnea",
                                             D_479628567_D_495144424==1 ~ "Insomnia",
                                             D_479628567_D_728393970==1 ~ "Restless Legs",
                                             D_479628567_D_531811052==1 ~ "Narcolepsy",
                                             D_479628567_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this question"))

 
tmp_1<- slp_cond[, grepl("479628567", colnames(slp_cond))]
tmp1 <- tmp_1[, c(1,2,5,3,4)]
sleep_prob1 <- NULL
for (i in 1:5){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$sleep_prob1 <- colnames(tmp1)[i]
  sleep_prob1 <- rbind(sleep_prob1,dt[2,])
  
}
sleep_prob1$sleep_prob1 ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

sleep_prob1$sleep_prob1 <- c("Sleep Apnea","Insomnia","Restless Legs", "Narcolepsy","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- sleep_prob1[, c(4,1,2)]
# 
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- sleep_prob1[, c(4,1,2)]

colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
slprob1 <- sleep_prob1[, c(4,1,2)]

skipped_mhg1 <- sum(table(slp_cond$cond=="Skipped this question")[2])
slprob1[as.numeric(dim(slprob1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(slp_cond)[[1]])*100,2))


dt_slprob1 <- slprob1 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("SLPROB1: Diagnosed with Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_slprob1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```

```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

dtSLPROB2= data_tib_m2 %>% filter(D_479628567_D_370923702==1) 


slp_tmnt= dtSLPROB2 %>%  mutate(tmnt= case_when(D_629010195_D_629010195_D_417201414==1 ~ "CPAP Machine",
                                             D_629010195_D_629010195_D_959572576==1 ~ "Dental Devise",
                                             D_629010195_D_629010195_D_576852249==1 ~ "Throat/Uvula Surgery",
                                             D_629010195_D_629010195_D_807835037==1 ~ "Other",
                                             D_629010195_D_629010195_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this question"))

 
tmp_1<- dtSLPROB2[, grepl("629010195", colnames(dtSLPROB2))]
tmp1 <- tmp_1[, c(1,5,3,4,2)]
sleep_prob1 <- NULL
for (i in 1:5){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$sleep_prob1 <- colnames(tmp1)[i]
  sleep_prob1 <- rbind(sleep_prob1,dt[2,])
  
}
sleep_prob1$sleep_prob1 ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

sleep_prob1$sleep_prob1 <- c("Sleep Apnea","Insomnia","Restless Legs", "Narcolepsy","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- sleep_prob1[, c(4,1,2)]
# 
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- sleep_prob1[, c(4,1,2)]

colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
slprob2 <- sleep_prob1[, c(4,1,2)]

skipped_mhg1 <- sum(table(slp_tmnt$tmnt=="Skipped this question")[2])
slprob2[as.numeric(dim(slprob2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtSLPROB2)[[1]])*100,2))


dt_slprob2 <- slprob2 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("SLPROB2: Treatments Used for Sleep Apnea")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_slprob2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```





## Shift Work

```{r, warning=FALSE, echo=FALSE,  message=FALSE}
##Shift work
#Ever
#simple_funct(D_674976924, "SHIFTWORK: Worked as a Shift Worker")
shiftw1= data_tib_m2 %>%  mutate(meds= case_when(D_674976924== 958538953 ~ "Yes, in Last 3 months",
                                                   D_674976924== 958538953 ~ "Yes, Over 3 months Ago",
                                                     D_674976924== 104430631 ~ "No",
                                                     TRUE ~ "Skipped this question"))

shiftw1$meds <- factor(shiftw1$meds,levels=c("Yes, in Last 3 months","Yes, Over 3 months Ago","No","Skipped this question"))

shiftw1_summary <- shiftw1 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


shiftw1_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SHIFTWORK: Worked as a Shift Worker")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Time started
module2 %>% filter(!is.na(module2$D_195662769)) %>% ggplot(aes(x=D_195662769, fill=D_407056417))+ ylab("Count") + 
  xlab("Time (Military Time)") + geom_bar()+  ggtitle("SHIFTWORK2: Time Usual Shift Started")+ 
  scale_fill_discrete(name = "Gender",  labels=c("Female", "Male"))+ 
  theme(axis.text.x = element_text(angle = 90))

#Time ended
module2 %>% filter(!is.na(module2$D_214870856)) %>% ggplot(aes(x=D_214870856, fill=D_407056417))+ ylab("Count") + 
  xlab("Time (Military Time)") + geom_bar()+  ggtitle("SHIFTWORK5: Time Usual Shift Ended")+ 
  scale_fill_discrete(name = "Gender",  labels=c("Female", "Male"))+ 
  theme(axis.text.x = element_text(angle = 90))

#Flexibility
flexible= data_tib_m2 %>% filter(D_674976924!=104430631) 


shftfl= flexible %>%  mutate(flex= case_when(D_680730257==719954633 ~ "Extremely flexible",
                                             D_680730257==764708931 ~ "Very flexible",
                                             D_680730257==988873962 ~ "Somewhat flexible",
                                             D_680730257==929148006 ~ "A little flexible",
                                             D_680730257==490796638 ~ "Not at all flexible",
                                             TRUE ~ "Skipped this question"))
shftfl$flex <- factor(shftfl$flex,levels=c("Extremely flexible","Very flexible","Somewhat flexible","A little flexible","Not at all flexible","Skipped this question"))

dtSLPROB2_flexible <- shftfl %>% group_by(flex) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(flex, n, percentage)


dtSLPROB2_flexible %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SHIFTWORK8: Work Shift Flexibility")) %>% 
  cols_label(n= md("**Number of Participants**"), flex = md("**Flexibility**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>   tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = flex,
    )
  ) %>% opt_row_striping()


#Total years
module2$D_392874924 <- round(as.numeric(module2$D_392874924), digits=0)
hist_funct(D_392874924,"SHIFTWOR9: Total Years as a Shift Worker", "Years", "Frequency")


#Age/Year last worked 
hist_funct(D_199254974_D_863007380,"SHIFTWORK10: Age When You were Last a Shift Worker", "Years", "Frequency")

hist_funct(D_199254974_D_120485458,"SHIFTWORK10: Year When You were Last a Shift Worker", "Years", "Frequency")

```

