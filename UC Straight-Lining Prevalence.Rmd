
---
title: "UC Straight-Lining Prevalence"
author: "Kelsey Sanchez"
date: "`r Sys.Date()`"
header-includes:  
    \usepackage{placeins}
    \usepackage{booktabs}
    \usepackage{pdflscape}
    \usepackage{titlesec}
    \titlespacing*{\section}{0pt}{\dimexpr -20pt}{10pt}

output:
  pdf_document:
    extra_dependencies: ["float"]
    fig_width: 7
    fig_height: 5
    fig_caption: true
    latex_engine: xelatex
    df_print: paged 
---




```{r alt_intro, include=FALSE}
# #Alternative intro to get the R HTML so no tables are cutoff
# ---
# title: "UC Straightlining"
# author: "Kelsey Dowling"
# date: "`r Sys.Date()`"
# ---
# output: 
#   pdf_document:
#     fig_caption: yes
#     latex_engine: xelatex
#     orientation: landscape
# ---


      

#tried removing
    #toc: false
    #keep_tex: yes
    #    \usepackage[labelformat=empty]{caption}

```


```{r libraries, include=FALSE}

#All libraries are listed up top; authentication for BQ will be necessary.
#Functions used included before the start of the analysis .
#Currently filtered by gender, and will eventually be done by age groups as well (D_117249500).



rm(list = ls())
library(bigrquery)
library(foreach)
library(stringr)
#library(plyr)
#library(expss) ###to add labels
library(epiDisplay) ##recommended applied here crosstable, tab1
library(gmodels) ##recommended
library(magrittr)
library(arsenal)
library(gtsummary)
library(rio)



library(ggplot2)
library(gridExtra)
library(scales)
library(gt)
#install(tinytex)
library(tinytex)
library(data.table) ###to write or read and data management 
library(tidyverse) ###for data management
library(dplyr) ###data management
library(reshape)  ###to work on transition from long to wide or wide to long data
library(listr) ###to work on a list of vector, files or..
library(sqldf) ##sql
library(lubridate) ###date time
library(stringr) ###to work on patterns, charaters
library(knitr)
library(kableExtra)


options(tinytex.verbose = TRUE)

bq_auth()
```

```{r M1merge, include=FALSE}
dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')

dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")

project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" ##project and billing should be consistent
##517311251 Date/time Status of Completion of Background and Overall Health                         SrvBOH_TmComplete_v1r0
##949302066 Flag for Baseline Module Background and Overall Health                        SrvBOH_BaseStatus_v1r0
recr_M1 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379,
                            d_949302066 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935' and d_949302066 ='231311385'")
recr_m1 <- bq_table_download(recr_M1,bigint = "integer64")
cnames <- names(recr_m1)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m1,varname)
  recr_m1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

sql_M1_1 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v1_JP` where Connect_ID is not null")
sql_M1_2 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v2_JP` where Connect_ID is not null")


M1_V1 <- bq_table_download(sql_M1_1,bigint = "integer64") #1436 #1436 vars: 1507 01112023 
M1_V2 <- bq_table_download(sql_M1_2,bigint = "integer64") #2333 #3033 01112023 var:1531 #6339 obs 1893 vars 05022023

mod1_v1 <- M1_V1
cnames <- names(M1_V1)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v1,varname)
  mod1_v1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}
mod1_v2 <- M1_V2
cnames <- names(M1_V2)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v2,varname)
  mod1_v2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

M1_V1.var <- colnames(M1_V1)
M1_V2.var <- colnames(M1_V2)
var.matched <- M1_V1.var[which(M1_V1.var %in% M1_V2.var)]
length(var.matched)  #1275 #1278 vars 01112023 #1348 vars 05022023

V1_only_vars <- colnames(M1_V1)[colnames(M1_V1) %nin% var.matched] #232 #229 01112023 #159 05022023
V2_only_vars <- colnames(M1_V2)[colnames(M1_V2) %nin% var.matched] #253 #253 01112023 #545 05022023

length(M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID])
#[1] 59 with the completion of two versions of Module1 
#[1] 62 with completing both versions of M1 ###double checked 03/28/2023
#68 double checked 05/02/2023

common.IDs <- M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID]
M1_V1_common <- mod1_v1[,var.matched]

M1_V2_common <- mod1_v2[,var.matched]
M1_V1_common$version <- 1
M1_V2_common$version <- 2

##to check the completion of M1 among these duplicates
partM1_dups <- recr_m1[which(recr_m1$Connect_ID %in% common.IDs),]
table(partM1_dups$d_949302066)

M1_common  <- rbind(M1_V1_common, M1_V2_common) #including 136 duplicates (version 1 and version 2) from 68 participants 05022023
#M1_response <- matrix(data=NA, nrow=118, ncol=967)

m1_v1_only <- mod1_v1[,c("Connect_ID", V1_only_vars)] #230 vars 03282023 #160 vars 05/02/2023
m1_v2_only <- mod1_v2[,c("Connect_ID", V2_only_vars)] #255 vars 03282023 #546 vars 05/02/2023
m1_v1_only$version <- 1
m1_v2_only$version <- 2
#for (i in 1:length)
##to check the completion in each version
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v1_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #1364 03282023 # 1370 05022023
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v2_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #4870 03282023 # 5731 05022023

#library(janitor)

m1_common <- rbind(M1_V1_common,M1_V2_common)
m1_common_v1 <- base::merge(m1_common, m1_v1_only, by=c("Connect_ID","version"),all.x=TRUE)
m1_combined_v1v2 <- base::merge(m1_common_v1,m1_v2_only,by=c("Connect_ID","version"),all.x=TRUE)
m1_complete <- m1_combined_v1v2[which(m1_combined_v1v2$Connect_ID %in% recr_m1$Connect_ID[which(recr_m1$d_949302066 ==231311385 )]),] #7289 including duplicates 05022023

m1_complete <- m1_complete %>% arrange(desc(version)) 


m1_complete_nodup <- m1_complete[!duplicated(m1_complete$Connect_ID),] 
table(m1_complete_nodup$version)



parts <- "SELECT Connect_ID, token, D_512820379, D_471593703, state_d_934298480, D_230663853,
D_335767902, D_982402227, D_919254129, D_699625233, D_564964481, D_795827569, D_544150384,
D_371067537, D_430551721, D_821247024, D_914594314,  state_d_725929722, d_827220437, 
D_949302066 , D_517311251, D_205553981, D_117249500, d_430551721, d_517311251, d_544150384, d_564964481, d_117249500 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` 
where Connect_ID IS NOT NULL and (d_512820379='486306141' OR d_512820379='854703046') and (D_919254129='353358909') and (D_699625233='353358909') and (d_949302066='231311385')"
parts_table <- bq_project_query(project, parts)
parts_data <- bq_table_download(parts_table, bigint = "integer64")

parts_data$Connect_ID <- as.numeric(parts_data$Connect_ID) ###need to convert type- m1... is double and parts is character

module1= left_join(m1_complete_nodup, parts_data, by="Connect_ID") 
dim(module1)



data_tib_m1 <- as_tibble(module1)
#dim(module1)

knitr::opts_chunk$set(comment = NA)



```
\newpage

# Section 1a. Distribution of participant education, by site

\FloatBarrier

```{r edu, warning=FALSE, echo=FALSE, message=FALSE}
# Table 1a. Distribution of participant education, by site
#\FloatBarrier

## EDUCATION
# Distrubution of participant demographics, by Site

edu= data_tib_m1  %>%  mutate(edlevel= case_when(D_367803647_D_367803647==978204320 ~ "Grade School(Grades 1-8)",
                                                  D_367803647_D_367803647==935502060 ~ "Some High School, No Diploma",
                                                  D_367803647_D_367803647==404564707 ~ "High School Graduate or GED",
                                                  D_367803647_D_367803647==432193665 ~ "Some College, No Degree",
                                                  D_367803647_D_367803647==890756124 ~ "Technical or Trade School After High School",
                                                  D_367803647_D_367803647==766964355 ~ "Associate's Degree",
                                                  D_367803647_D_367803647==875342283 ~ "Bachelor's Degree",
                                                  D_367803647_D_367803647==598242454 ~ "Advanced Degree",
                                                  D_367803647_D_367803647==807835037 ~ "Other",
                                                  TRUE ~ "Skipped This Question"))

edu$edlevel <- factor(edu$edlevel,levels=c("Grade School(Grades 1-8)", "Some High School, No Diploma", "High School Graduate or GED","Some College, No Degree","Technical or Trade School After High School","Associate's Degree","Bachelor's Degree","Advanced Degree", "Other", "Skipped This Question"))

dt_edu_summary <- edu %>% dplyr::group_by(edlevel) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(edlevel, n, percentage)

dt_edu_summary_gt <- dt_edu_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 1) %>% 
  tab_header(title = md("EDU: Highest Level of School Completed")) %>% 
  cols_label(n= md("**Number of Participants**"), edlevel = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
    #summary_rows( groups=F,column = c(n,percentage), fns= list( Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = edlevel,)) %>% opt_row_striping()

edu_crostab <- module1 %>%  mutate(Site=case_when(d_827220437 == 531629870 ~ "HealthPartners", 
                                                            d_827220437 == 548392715 ~"Henry Ford",
                                                             d_827220437 == 303349821 ~ "Marshfield",
                                                             d_827220437 == 657167265 ~ "Sanford", 
                                                             d_827220437 == 809703864 ~ "UChicago",
                                                             d_827220437 == 125001209 ~ "KPCO",
                                                             d_827220437 == 327912200 ~ "KPGA",
                                                             d_827220437 == 300267574 ~ "KPHI",
                                                             d_827220437 == 452412599 ~ "KPNW",
                                                             d_827220437 == 517700004 ~ "NCI",
                                                             d_827220437 == 181769837 ~"Other"),
                               edlevel= case_when(D_367803647_D_367803647==978204320 | D_367803647_D_367803647==935502060 ~ "<HS",
                                                  D_367803647_D_367803647==404564707 ~ "HS or GED",
                                                  D_367803647_D_367803647==432193665 | D_367803647_D_367803647==890756124 | D_367803647_D_367803647==807835037 ~ "Some college, technical school/other",
                                                  D_367803647_D_367803647==766964355 | D_367803647_D_367803647==875342283 ~ "Associates/Bachelors Degree",
                                                  D_367803647_D_367803647==598242454 ~ "Advanced Degree",
                                                  TRUE ~ "Skipped This Question"),
                               cardiov= case_when(D_167101091_D_698944820==1 ~ "B-12 Deficiency",
                                             D_167101091_D_838744325==1 ~ "Coronary Artery",
                                             D_167101091_D_769790179==1 ~ "Congestive Heart Failure",
                                             D_167101091_D_699553344==1 ~ "High Cholesterol",
                                             D_167101091_D_700811160==1 ~ "Heart Attack",
                                             D_167101091_D_336505365==1 ~ "Abnormal Heart Rhythm",
                                             D_167101091_D_132548932==1 ~ "Chest Pain",
                                             D_167101091_D_747787163==1 ~ "Heart Valve Problems",
                                             D_167101091_D_693851465==1 ~ "High Blood Pressure",
                                             D_167101091_D_512012656==1 ~ "Blood Clots",
                                             D_167101091_D_619337095==1 ~ "Stroke",
                                             D_167101091_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               kidn= case_when(D_874046190_D_827542780==1 ~ "Kidney Stones", 
                                             D_874046190_D_167238688==1 ~ "Chronic Kindey Disease",
                                             D_874046190_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               resp= case_when(D_894259747_D_359025642==1 ~ "Chronic Lung Disease",
                                               D_894259747_D_407340134==1 ~ "Asthma",
                                               D_894259747_D_427219143==1 ~ "Hay Fever",
                                               D_894259747_D_535003378==1 ~ "None",
                                               TRUE ~ "Skipped this question"),
                               digest= case_when(D_180961306_D_406890409==1 ~ "Esophageal Acid Reflex",
                                             D_180961306_D_704544306==1 ~ "Barrett's Esophagus",
                                             D_180961306_D_691766591==1 ~ "Irritable Bowel Syndrome",
                                             D_180961306_D_308645635==1 ~ "Inflammatory Bowel Disease",
                                             D_180961306_D_731115613==1 ~ "Diverticulitis or Diverticulosis",
                                             D_180961306_D_567284980==1 ~ "Ulcerative Colitis",
                                             D_180961306_D_986548173==1 ~ "Crohn's Disease",
                                             D_180961306_D_285995100==1 ~ "Celiac Disease",
                                             D_180961306_D_545628561==1 ~ "Gallstones",
                                             D_180961306_D_709786039==1 ~ "Liver Cirrhosis",
                                             D_180961306_D_984479578==1 ~ "Pancreatitis",
                                             D_180961306_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               thy_d_g= case_when(D_900541533_D_726539692==1 ~ "Thyroid Disorder", 
                                             D_900541533_D_158044532==1 ~ "Diabetes",
                                             D_900541533_D_943054522==1 ~ "Graves' Disease",
                                             D_900541533_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                              sysoth= case_when(D_543728565_D_636030086==1 ~ "Rheumatoid Arthritis", 
                                             D_543728565_D_239687183==1 ~ "Lupus",
                                             D_543728565_D_134592375==1 ~ "Gout",
                                             D_543728565_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               sti_std= case_when(D_874709643_D_164910211==1 ~ "Mono",
                                             D_874709643_D_796616844==1 ~ "Shingles",
                                             D_874709643_D_436689514==1 ~ "Chronic Hepatitus B or C",
                                             D_874709643_D_296357383==1 ~ "Gonorrhea",
                                             D_874709643_D_901077233==1 ~ "Chlamydia",
                                             D_874709643_D_136956596==1 ~ "Trich",
                                             D_874709643_D_455776698==1 ~ "Syphilis",
                                             D_874709643_D_155874194==1 ~ "Genital Warts",
                                             D_874709643_D_880962432==1 ~ "HPV",
                                             D_874709643_D_691450854==1 ~ "HIV/AIDS",
                                             D_874709643_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               urn_repro= case_when(D_725626004_D_509721537==1 ~ "Uterine Fibroids",
                                             D_725626004_D_863286658==1 ~ "Endometriosis",
                                             D_725626004_D_386524148==1 ~ "Polycystic Ovary System",
                                             D_725626004_D_937208760==1 ~ "Enlarged Prostate",
                                             D_725626004_D_746542057==1 ~ "Fibrocystic Breast or Benign Breast isease",
                                             D_725626004_D_854945381==1 ~ "Ductal Carcinoma in situ",
                                             D_725626004_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               surgery= case_when(D_624179836_D_797189152==1 ~ "Tonsillectomy",
                                             D_624179836_D_633546100==1 ~ "Cholecystectomy",
                                             D_624179836_D_866002271==1 ~ "Appendectomy",
                                             D_624179836_D_118789503==1 ~ "Liposuction",
                                             D_624179836_D_715563991==1 ~ "Gastric Bypass",
                                             D_624179836_D_533491176==1 ~ "Breast Surgery",
                                             D_624179836_D_220755749==1 ~ "Hysterectomy", 
                                             D_624179836_D_465318416==1 ~ "Tubal Ligation",
                                             D_624179836_D_630100221==1 ~ "Oophorectomy",
                                             D_624179836_D_692881833==1 ~ "Salpingectomy",
                                             D_624179836_D_654450030==1 ~ "Vasectomy",
                                             D_624179836_D_532603425==1 ~ "Orchiectomy or Orchidectomy",
                                             D_624179836_D_733236542==1 ~ "Prostatectomy",
                                             D_624179836_D_961987554==1 ~ "Penectomy",
                                             D_624179836_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))



edu_crostab$edlevel <- factor(edu_crostab$edlevel,levels=c("<HS", "HS or GED","Some college, technical school/other", "Associates/Bachelors Degree", "Advanced Degree","Skipped This Question"))
edu_crostab$Site <- factor(edu_crostab$Site,levels=c("UChicago","HealthPartners","Marshfield","Sanford","Henry Ford","KPCO","KPGA","KPHI", "KPNW", "NCI", "Other"))

edu_crostab$kidn <- factor(edu_crostab$kidn,levels=c("Kidney Stones", "Chronic Kindey Disease","None","Skipped this question"))
                              
edu_crostab$resp <- factor(edu_crostab$resp,levels=c("Chronic Lung Disease","Asthma","Hay Fever","None","Skipped this question"))
                                                            
edu_crostab$digest <- factor(edu_crostab$digest,levels=c("Esophageal Acid Reflex", "Barrett's Esophagus","Irritable Bowel Syndrome","Inflammatory Bowel Disease","Diverticulitis or Diverticulosis", "Ulcerative Colitis","Crohn's Disease", "Celiac Disease","Gallstones","Liver Cirrhosis", "Pancreatitis", "None","Skipped this question"))
                                                                                          
edu_crostab$thy_d_g <- factor(edu_crostab$thy_d_g,levels=c("Thyroid Disorder","Diabetes","Graves' Disease","None","Skipped this question"))
                              
edu_crostab$sysoth <- factor(edu_crostab$sysoth,levels=c("Rheumatoid Arthritis",  "Lupus","Gout","None","Skipped this question"))

edu_crostab$sti_std <- factor(edu_crostab$sti_std,levels=c("Mono", "Shingles","Chronic Hepatitus B or C","Gonorrhea","Chlamydia","Trich", "Syphilis","Genital Warts", "HPV","HIV/AIDS","None","Skipped this question"))

edu_crostab$urn_repro <- factor(edu_crostab$urn_repro,levels=c("Uterine Fibroids","Endometriosis","Polycystic Ovary System","Enlarged Prostate", "Fibrocystic Breast or Benign Breast isease", "Ductal Carcinoma in situ","None","Skipped this question"))

edu_crostab$surgery <- factor(edu_crostab$surgery,levels=c("Tonsillectomy","Cholecystectomy","Appendectomy", "Liposuction", "Gastric Bypass", "Breast Surgery", "Hysterectomy",  "Tubal Ligation", "Oophorectomy","Salpingectomy","Vasectomy","Orchiectomy or Orchidectomy", "Prostatectomy","Penectomy", "None","Skipped this question"))
                              
edu_crostab <- edu_crostab %>%  filter(Site!="Unknown")

edu_crostabs1 <- edu_crostab %>% dplyr::select(edlevel, Site ) %>% tbl_cross(
    row = edlevel, 
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(Site="Site",
                edlevel = " "),
    missing="ifany",
    margin_text="Total")

edu_crostabs__1 <- edu_crostabs1 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Distribution of self-reported Education, by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__1 %>% kable_styling(latex_options = "scale_down")
#knitr::kable(edu_crostabs, booktabs = TRUE)  %>% kable_styling(latex_options = "scale_down") %>% landscape() 
```

\FloatBarrier
```{r edu_barplot1, warning=FALSE, echo=FALSE, message=FALSE}


#Bar Plot
edu_crostab_bar <- edu_crostab %>%  filter(Site!="NCI" & Site!="Other") %>%  mutate(Site=droplevels(Site))
cross_tab <- table(edu_crostab_bar$Site, edu_crostab_bar$edlevel)

# Convert the crosstab to a data frame
cross_tab_df <- as.data.frame.matrix(cross_tab)
#cross_tab_df$edlevel <- factor(cross_tab_df$edlevel,levels=c("<HS", "HS or GED","Some college, technical school/other", "Associates/Bachelors Degree", "Advanced Degree","Skipped This Question"))


cross_tab_df$Site <- rownames(cross_tab_df)
cross_tab_df_long <- tidyr::gather(cross_tab_df, key = "edlevel", value = "Count", -Site)

education_order <- c("Skipped This Question", "<HS", "HS or GED","Some college, technical school/other", "Associates/Bachelors Degree", "Advanced Degree")
cross_tab_df_long$edlevel <- factor(cross_tab_df_long$edlevel, levels=education_order)

# Calculate percentages
cross_tab_df_long <- transform(cross_tab_df_long, Percentage = (Count / tapply(Count, Site, sum)[Site]) * 100)

# Create a stacked barplot
edu_bplot <- ggplot(cross_tab_df_long, aes(x = edlevel, y = Percentage, fill = Site)) +
  geom_bar(position="dodge",stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of Education Levels by Site",
       x = "Education Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
edu_bplot + guides(fill = guide_legend(title = "Site"))

```


\newpage

# Section 1b. Distribution of participant income, by site

\FloatBarrier
```{r income, warning=FALSE, echo=FALSE, message=FALSE}
# Table 1b. Distribution of participant income, by site. 
#\FloatBarrier

# Distribution of self-reported Income, by Site

## Income

inc= data_tib_m1  %>%  mutate(status= case_when(D_759004335==209571450 ~ "35,000-49,000",
                                                  D_759004335==212249150 ~ "50,000-74,000",
                                                  D_759004335==374508062 ~ "0-9,000",
                                                  #D_759004335==530094502 ~ "Error- Unlisted Response Selected", 
                                                  D_759004335==742032816 ~ "200,000+", 
                                                  D_759004335==745561936 ~ "25,000-34,000",
                                                  D_759004335==746038746 ~ "Prefer not to Answer",
                                                  D_759004335==777814771 ~ "75,000-99,000", 
                                                  D_759004335==913602274 ~ "150,000-199,000", 
                                                  D_759004335==922395188 ~ "100,000-149,000",
                                                  D_759004335==976555124 ~ "10,000-24,000",
                                                  D_759004335==178420302 ~ "Unknown",
                                                  TRUE ~ "Skipped This Question"))

inc$status <- factor(inc$status,levels=c("0-9,000","10,000-24,000","25,000-34,000","35,000-49,000","50,000-74,000","75,000-99,000","100,000-149,000","150,000-199,000",
                                         "200,000+","Prefer not to Answer","Unknown","Skipped This Question"))

dt_income_summary <- inc %>% group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage)

gt_income_summary <- dt_income_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 1) %>% 
  tab_header(title = md("INCOME: Total Family Income")) %>% 
  cols_label(n= md("**Number of Participants**"), status = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows( groups=F,column = c(n,percentage), fns= list( Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = status,)) %>% opt_row_striping()





inc_crostab <- inc %>%  mutate(Site= case_when(d_827220437 == 531629870 ~ "HealthPartners", 
                                                            d_827220437 == 548392715 ~"Henry Ford",
                                                             d_827220437 == 303349821 ~ "Marshfield",
                                                             d_827220437 == 657167265 ~ "Sanford", 
                                                             d_827220437 == 809703864 ~ "UChicago",
                                                             d_827220437 == 125001209 ~ "KPCO",
                                                             d_827220437 == 327912200 ~ "KPGA",
                                                             d_827220437 == 300267574 ~ "KPHI",
                                                             d_827220437 == 452412599 ~ "KPNW",
                                                             d_827220437 == 517700004 ~ "NCI",
                                                             d_827220437 == 181769837 ~"Other"),
                              cardiov= case_when(D_167101091_D_698944820==1 ~ "B-12 Deficiency",
                                             D_167101091_D_838744325==1 ~ "Coronary Artery",
                                             D_167101091_D_769790179==1 ~ "Congestive Heart Failure",
                                             D_167101091_D_699553344==1 ~ "High Cholesterol",
                                             D_167101091_D_700811160==1 ~ "Heart Attack",
                                             D_167101091_D_336505365==1 ~ "Abnormal Heart Rhythm",
                                             D_167101091_D_132548932==1 ~ "Chest Pain",
                                             D_167101091_D_747787163==1 ~ "Heart Valve Problems",
                                             D_167101091_D_693851465==1 ~ "High Blood Pressure",
                                             D_167101091_D_512012656==1 ~ "Blood Clots",
                                             D_167101091_D_619337095==1 ~ "Stroke",
                                             D_167101091_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               kidn= case_when(D_874046190_D_827542780==1 ~ "Kidney Stones", 
                                             D_874046190_D_167238688==1 ~ "Chronic Kindey Disease",
                                             D_874046190_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               resp= case_when(D_894259747_D_359025642==1 ~ "Chronic Lung Disease",
                                               D_894259747_D_407340134==1 ~ "Asthma",
                                               D_894259747_D_427219143==1 ~ "Hay Fever",
                                               D_894259747_D_535003378==1 ~ "None",
                                               TRUE ~ "Skipped this question"),
                               digest= case_when(D_180961306_D_406890409==1 ~ "Esophageal Acid Reflex",
                                             D_180961306_D_704544306==1 ~ "Barrett's Esophagus",
                                             D_180961306_D_691766591==1 ~ "Irritable Bowel Syndrome",
                                             D_180961306_D_308645635==1 ~ "Inflammatory Bowel Disease",
                                             D_180961306_D_731115613==1 ~ "Diverticulitis or Diverticulosis",
                                             D_180961306_D_567284980==1 ~ "Ulcerative Colitis",
                                             D_180961306_D_986548173==1 ~ "Crohn's Disease",
                                             D_180961306_D_285995100==1 ~ "Celiac Disease",
                                             D_180961306_D_545628561==1 ~ "Gallstones",
                                             D_180961306_D_709786039==1 ~ "Liver Cirrhosis",
                                             D_180961306_D_984479578==1 ~ "Pancreatitis",
                                             D_180961306_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               thy_d_g= case_when(D_900541533_D_726539692==1 ~ "Thyroid Disorder", 
                                             D_900541533_D_158044532==1 ~ "Diabetes",
                                             D_900541533_D_943054522==1 ~ "Graves' Disease",
                                             D_900541533_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                              sysoth= case_when(D_543728565_D_636030086==1 ~ "Rheumatoid Arthritis", 
                                             D_543728565_D_239687183==1 ~ "Lupus",
                                             D_543728565_D_134592375==1 ~ "Gout",
                                             D_543728565_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               sti_std= case_when(D_874709643_D_164910211==1 ~ "Mono",
                                             D_874709643_D_796616844==1 ~ "Shingles",
                                             D_874709643_D_436689514==1 ~ "Chronic Hepatitus B or C",
                                             D_874709643_D_296357383==1 ~ "Gonorrhea",
                                             D_874709643_D_901077233==1 ~ "Chlamydia",
                                             D_874709643_D_136956596==1 ~ "Trich",
                                             D_874709643_D_455776698==1 ~ "Syphilis",
                                             D_874709643_D_155874194==1 ~ "Genital Warts",
                                             D_874709643_D_880962432==1 ~ "HPV",
                                             D_874709643_D_691450854==1 ~ "HIV/AIDS",
                                             D_874709643_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               urn_repro= case_when(D_725626004_D_509721537==1 ~ "Uterine Fibroids",
                                             D_725626004_D_863286658==1 ~ "Endometriosis",
                                             D_725626004_D_386524148==1 ~ "Polycystic Ovary System",
                                             D_725626004_D_937208760==1 ~ "Enlarged Prostate",
                                             D_725626004_D_746542057==1 ~ "Fibrocystic Breast or Benign Breast isease",
                                             D_725626004_D_854945381==1 ~ "Ductal Carcinoma in situ",
                                             D_725626004_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               surgery= case_when(D_624179836_D_797189152==1 ~ "Tonsillectomy",
                                             D_624179836_D_633546100==1 ~ "Cholecystectomy",
                                             D_624179836_D_866002271==1 ~ "Appendectomy",
                                             D_624179836_D_118789503==1 ~ "Liposuction",
                                             D_624179836_D_715563991==1 ~ "Gastric Bypass",
                                             D_624179836_D_533491176==1 ~ "Breast Surgery",
                                             D_624179836_D_220755749==1 ~ "Hysterectomy", 
                                             D_624179836_D_465318416==1 ~ "Tubal Ligation",
                                             D_624179836_D_630100221==1 ~ "Oophorectomy",
                                             D_624179836_D_692881833==1 ~ "Salpingectomy",
                                             D_624179836_D_654450030==1 ~ "Vasectomy",
                                             D_624179836_D_532603425==1 ~ "Orchiectomy or Orchidectomy",
                                             D_624179836_D_733236542==1 ~ "Prostatectomy",
                                             D_624179836_D_961987554==1 ~ "Penectomy",
                                             D_624179836_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))
inc_crostab$Site <- factor(inc_crostab$Site,levels=c("UChicago","HealthPartners","Marshfield","Sanford","Henry Ford","KPCO","KPGA","KPHI", "KPNW", "NCI", "Other"))
inc_crostab$status <- factor(inc_crostab$status, levels = c("0-9,000","10,000-24,000","25,000-34,000","35,000-49,000","50,000-74,000","75,000-99,000","100,000-149,000","150,000-199,000",
                                         "200,000+","Prefer not to Answer","Unknown","Skipped This Question"))

inc_crostab$kidn <- factor(inc_crostab$kidn,levels=c("Kidney Stones", "Chronic Kindey Disease","None","Skipped this question"))

inc_crostab$resp <- factor(inc_crostab$resp,levels=c("Chronic Lung Disease","Asthma","Hay Fever","None","Skipped this question"))

inc_crostab$digest <- factor(inc_crostab$digest,levels=c("Esophageal Acid Reflex", "Barrett's Esophagus","Irritable Bowel Syndrome","Inflammatory Bowel Disease","Diverticulitis or Diverticulosis", "Ulcerative Colitis","Crohn's Disease", "Celiac Disease","Gallstones","Liver Cirrhosis", "Pancreatitis", "None","Skipped this question"))

inc_crostab$thy_d_g <- factor(inc_crostab$thy_d_g,levels=c("Thyroid Disorder","Diabetes","Graves' Disease","None","Skipped this question"))

inc_crostab$sysoth <- factor(inc_crostab$sysoth,levels=c("Rheumatoid Arthritis",  "Lupus","Gout","None","Skipped this question"))

inc_crostab$sti_std <- factor(inc_crostab$sti_std,levels=c("Mono", "Shingles","Chronic Hepatitus B or C","Gonorrhea","Chlamydia","Trich", "Syphilis","Genital Warts", "HPV","HIV/AIDS","None","Skipped this question"))

inc_crostab$urn_repro <- factor(inc_crostab$urn_repro,levels=c("Uterine Fibroids","Endometriosis","Polycystic Ovary System","Enlarged Prostate", "Fibrocystic Breast or Benign Breast isease", "Ductal Carcinoma in situ","None","Skipped this question"))

inc_crostab$surgery <- factor(inc_crostab$surgery,levels=c("Tonsillectomy","Cholecystectomy","Appendectomy", "Liposuction", "Gastric Bypass", "Breast Surgery", "Hysterectomy",  "Tubal Ligation", "Oophorectomy","Salpingectomy","Vasectomy","Orchiectomy or Orchidectomy", "Prostatectomy","Penectomy", "None","Skipped this question"))

inc_crostabs <- inc_crostab %>% tbl_cross(
    col = Site,
    row = status,
    digits=c(0,1),
    percent = "col",
    label=list(Site="Site",
                status = " "),
    missing="ifany",
    margin_text="Total")

inc_crostabs <- inc_crostabs %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Income Levels Across Sites") %>%
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)

inc_crostabs %>% kable_styling(latex_options = "scale_down")
#knitr::kable(inc_crostabs, booktabs = TRUE)  %>% kable_styling(latex_options = "scale_down") %>% landscape() 
```


\FloatBarrier
```{r income_barplot1, warning=FALSE, echo=FALSE, message=FALSE}
#Bar plot
inc_crostab_bar <- inc_crostab %>%  filter(Site!="NCI" & Site!="Other") %>%  mutate(Site=droplevels(Site))
cross_tab <- table(inc_crostab_bar$Site, inc_crostab_bar$status)

# Convert the crosstab to a data frame
cross_tab_df <- as.data.frame.matrix(cross_tab)


cross_tab_df$Site <- rownames(cross_tab_df)
cross_tab_df_long <- tidyr::gather(cross_tab_df, key = "status", value = "Count", -Site)

income_order <- c("Prefer not to Answer","Unknown","Skipped This Question","0-9,000","10,000-24,000","25,000-34,000","35,000-49,000","50,000-74,000","75,000-99,000","100,000-149,000","150,000-199,000",
                                         "200,000+")
cross_tab_df_long$status <- factor(cross_tab_df_long$status, levels=income_order)

# Calculate percentages
cross_tab_df_long <- transform(cross_tab_df_long, Percentage = (Count / tapply(Count, Site, sum)[Site]) * 100)

# Create a stacked barplot
inc_bplot <- ggplot(cross_tab_df_long, aes(x = status, y = Percentage, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of Income Levels by Site",
       x = "Income Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
inc_bplot + guides(fill = guide_legend(title = "Site")) 


```


\newpage

# Section 1c. Distribution of participant race, by site. 

\FloatBarrier
```{r race, warning=FALSE, echo=FALSE, message=FALSE}
# Table 1c. Distribution of participant race, by site. 
#\FloatBarrier

# RACE

multi_race=0    
for (i in 1:length(module1$Connect_ID)){
  AI=ifelse((module1$D_384191091_D_384191091_D_583826374[[i]]==1 & (module1$D_384191091_D_384191091_D_636411467[[i]]==1 | module1$D_384191091_D_384191091_D_458435048[[i]]==1|
                                               module1$D_384191091_D_384191091_D_706998638[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                               module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                               module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  As=ifelse((module1$D_384191091_D_384191091_D_636411467[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_458435048[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_706998638[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Bl=ifelse((module1$D_384191091_D_384191091_D_458435048[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_706998638[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Hs=ifelse((module1$D_384191091_D_384191091_D_706998638[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_458435048[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Me=ifelse((module1$D_384191091_D_384191091_D_973565052[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_458435048[[i]]==1 | module1$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Hw=ifelse((module1$D_384191091_D_384191091_D_586825330[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_458435048[[i]]==1 | module1$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_973565052[[i]]==1 | module1$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Wh=ifelse((module1$D_384191091_D_384191091_D_412790539[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_458435048[[i]]==1 | module1$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Ot=ifelse((module1$D_384191091_D_384191091_D_807835037[[i]]==1 & (module1$D_384191091_D_384191091_D_583826374[[i]]==1 | module1$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        module1$D_384191091_D_384191091_D_458435048[[i]]==1 | module1$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_586825330[[i]]==1 | module1$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        module1$D_384191091_D_384191091_D_412790539[[i]]==1)), 1, 0)
  multi_race= multi_race + sum(AI+As+Bl+Hs+Me+Hw+Wh+Ot, na.rm=T)

}

  

data_tib_m1$multi_racial <- c(rep(1, times=multi_race), rep(0, times=(dim(data_tib_m1)[1]- multi_race)))



## RACE

race= data_tib_m1 %>%  mutate(race_eth= case_when(multi_racial==1 ~ "Multi-Racial",
                                                     D_384191091_D_384191091_D_583826374==1 ~ "American Indian or Native American",
                                                     D_384191091_D_384191091_D_636411467==1 ~ "Asian/Asian American",
                                                     D_384191091_D_384191091_D_458435048==1 ~ "Black, African American, or African",
                                                     D_384191091_D_384191091_D_706998638==1 ~ "Hispanic, Latino, or Spanish",
                                                     D_384191091_D_384191091_D_973565052==1 ~ "Middle Eastern or North African",
                                                     D_384191091_D_384191091_D_586825330==1 ~ "Hawaiian or Pacific Islander",
                                                     D_384191091_D_384191091_D_412790539==1 ~ "White",
                                                     (D_384191091_D_384191091_D_807835037==1 | !is.na(D_384191091_D_747350323)) ~ "Other",
                                                     D_384191091_D_384191091_D_746038746==1 ~ "Prefer Not to Answer",
                                                     TRUE  ~ "Skipped this question "))

race$race_eth <- factor(race$race_eth,levels=c("Multi-Racial","American Indian or Native American","Asian/Asian American","Black, African American, or African","Hispanic, Latino, or Spanish","Middle Eastern or North African","Hawaiian or Pacific Islander","White","Other","Prefer Not to Answer","Skipped this question "))





race_crosstab <- race %>%  mutate(Site= case_when(d_827220437 == 531629870 ~ "HealthPartners", 
                                                            d_827220437 == 548392715 ~"Henry Ford",
                                                             d_827220437 == 303349821 ~ "Marshfield",
                                                             d_827220437 == 657167265 ~ "Sanford", 
                                                             d_827220437 == 809703864 ~ "UChicago",
                                                             d_827220437 == 125001209 ~ "KPCO",
                                                             d_827220437 == 327912200 ~ "KPGA",
                                                             d_827220437 == 300267574 ~ "KPHI",
                                                             d_827220437 == 452412599 ~ "KPNW",
                                                             d_827220437 == 517700004 ~ "NCI",
                                                             d_827220437 == 181769837 ~"Other"),
                              cardiov= case_when(D_167101091_D_698944820==1 ~ "B-12 Deficiency",
                                             D_167101091_D_838744325==1 ~ "Coronary Artery",
                                             D_167101091_D_769790179==1 ~ "Congestive Heart Failure",
                                             D_167101091_D_699553344==1 ~ "High Cholesterol",
                                             D_167101091_D_700811160==1 ~ "Heart Attack",
                                             D_167101091_D_336505365==1 ~ "Abnormal Heart Rhythm",
                                             D_167101091_D_132548932==1 ~ "Chest Pain",
                                             D_167101091_D_747787163==1 ~ "Heart Valve Problems",
                                             D_167101091_D_693851465==1 ~ "High Blood Pressure",
                                             D_167101091_D_512012656==1 ~ "Blood Clots",
                                             D_167101091_D_619337095==1 ~ "Stroke",
                                             D_167101091_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               kidn= case_when(D_874046190_D_827542780==1 ~ "Kidney Stones", 
                                             D_874046190_D_167238688==1 ~ "Chronic Kindey Disease",
                                             D_874046190_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               resp= case_when(D_894259747_D_359025642==1 ~ "Chronic Lung Disease",
                                               D_894259747_D_407340134==1 ~ "Asthma",
                                               D_894259747_D_427219143==1 ~ "Hay Fever",
                                               D_894259747_D_535003378==1 ~ "None",
                                               TRUE ~ "Skipped this question"),
                               digest= case_when(D_180961306_D_406890409==1 ~ "Esophageal Acid Reflex",
                                             D_180961306_D_704544306==1 ~ "Barrett's Esophagus",
                                             D_180961306_D_691766591==1 ~ "Irritable Bowel Syndrome",
                                             D_180961306_D_308645635==1 ~ "Inflammatory Bowel Disease",
                                             D_180961306_D_731115613==1 ~ "Diverticulitis or Diverticulosis",
                                             D_180961306_D_567284980==1 ~ "Ulcerative Colitis",
                                             D_180961306_D_986548173==1 ~ "Crohn's Disease",
                                             D_180961306_D_285995100==1 ~ "Celiac Disease",
                                             D_180961306_D_545628561==1 ~ "Gallstones",
                                             D_180961306_D_709786039==1 ~ "Liver Cirrhosis",
                                             D_180961306_D_984479578==1 ~ "Pancreatitis",
                                             D_180961306_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               thy_d_g= case_when(D_900541533_D_726539692==1 ~ "Thyroid Disorder", 
                                             D_900541533_D_158044532==1 ~ "Diabetes",
                                             D_900541533_D_943054522==1 ~ "Graves' Disease",
                                             D_900541533_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                              sysoth= case_when(D_543728565_D_636030086==1 ~ "Rheumatoid Arthritis", 
                                             D_543728565_D_239687183==1 ~ "Lupus",
                                             D_543728565_D_134592375==1 ~ "Gout",
                                             D_543728565_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               sti_std= case_when(D_874709643_D_164910211==1 ~ "Mono",
                                             D_874709643_D_796616844==1 ~ "Shingles",
                                             D_874709643_D_436689514==1 ~ "Chronic Hepatitus B or C",
                                             D_874709643_D_296357383==1 ~ "Gonorrhea",
                                             D_874709643_D_901077233==1 ~ "Chlamydia",
                                             D_874709643_D_136956596==1 ~ "Trich",
                                             D_874709643_D_455776698==1 ~ "Syphilis",
                                             D_874709643_D_155874194==1 ~ "Genital Warts",
                                             D_874709643_D_880962432==1 ~ "HPV",
                                             D_874709643_D_691450854==1 ~ "HIV/AIDS",
                                             D_874709643_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               urn_repro= case_when(D_725626004_D_509721537==1 ~ "Uterine Fibroids",
                                             D_725626004_D_863286658==1 ~ "Endometriosis",
                                             D_725626004_D_386524148==1 ~ "Polycystic Ovary System",
                                             D_725626004_D_937208760==1 ~ "Enlarged Prostate",
                                             D_725626004_D_746542057==1 ~ "Fibrocystic Breast or Benign Breast isease",
                                             D_725626004_D_854945381==1 ~ "Ductal Carcinoma in situ",
                                             D_725626004_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"),
                               surgery= case_when(D_624179836_D_797189152==1 ~ "Tonsillectomy",
                                             D_624179836_D_633546100==1 ~ "Cholecystectomy",
                                             D_624179836_D_866002271==1 ~ "Appendectomy",
                                             D_624179836_D_118789503==1 ~ "Liposuction",
                                             D_624179836_D_715563991==1 ~ "Gastric Bypass",
                                             D_624179836_D_533491176==1 ~ "Breast Surgery",
                                             D_624179836_D_220755749==1 ~ "Hysterectomy", 
                                             D_624179836_D_465318416==1 ~ "Tubal Ligation",
                                             D_624179836_D_630100221==1 ~ "Oophorectomy",
                                             D_624179836_D_692881833==1 ~ "Salpingectomy",
                                             D_624179836_D_654450030==1 ~ "Vasectomy",
                                             D_624179836_D_532603425==1 ~ "Orchiectomy or Orchidectomy",
                                             D_624179836_D_733236542==1 ~ "Prostatectomy",
                                             D_624179836_D_961987554==1 ~ "Penectomy",
                                             D_624179836_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))
race_crosstab$Site <- factor(race_crosstab$Site,levels=c("UChicago","HealthPartners","Marshfield","Sanford","Henry Ford","KPCO","KPGA","KPHI", "KPNW", "NCI", "Other"))


race_crosstab$kidn <- factor(race_crosstab$kidn,levels=c("Kidney Stones", "Chronic Kindey Disease","None","Skipped this question"))

race_crosstab$resp <- factor(race_crosstab$resp,levels=c("Chronic Lung Disease","Asthma","Hay Fever","None","Skipped this question"))

race_crosstab$digest <- factor(race_crosstab$digest,levels=c("Esophageal Acid Reflex", "Barrett's Esophagus","Irritable Bowel Syndrome","Inflammatory Bowel Disease","Diverticulitis or Diverticulosis", "Ulcerative Colitis","Crohn's Disease", "Celiac Disease","Gallstones","Liver Cirrhosis", "Pancreatitis", "None","Skipped this question"))

race_crosstab$thy_d_g <- factor(race_crosstab$thy_d_g,levels=c("Thyroid Disorder","Diabetes","Graves' Disease","None","Skipped this question"))

race_crosstab$sysoth <- factor(race_crosstab$sysoth,levels=c("Rheumatoid Arthritis",  "Lupus","Gout","None","Skipped this question"))

race_crosstab$sti_std <- factor(race_crosstab$sti_std,levels=c("Mono", "Shingles","Chronic Hepatitus B or C","Gonorrhea","Chlamydia","Trich", "Syphilis","Genital Warts", "HPV","HIV/AIDS","None","Skipped this question"))

race_crosstab$urn_repro <- factor(race_crosstab$urn_repro,levels=c("Uterine Fibroids","Endometriosis","Polycystic Ovary System","Enlarged Prostate", "Fibrocystic Breast or Benign Breast isease", "Ductal Carcinoma in situ","None","Skipped this question"))

race_crosstab$surgery <- factor(race_crosstab$surgery,levels=c("Tonsillectomy","Cholecystectomy","Appendectomy", "Liposuction", "Gastric Bypass", "Breast Surgery", "Hysterectomy",  "Tubal Ligation", "Oophorectomy","Salpingectomy","Vasectomy","Orchiectomy or Orchidectomy", "Prostatectomy","Penectomy", "None","Skipped this question"))

race_crosstabs <- race_crosstab %>% tbl_cross(
    col = Site,
    row = race_eth,
    digits=c(0,1),
    percent = "col",
    label=list(Site="Site",
                race_eth = " "),
    missing="ifany",
    margin_text="Total")

race_crosstabs <- race_crosstabs %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Races Across Sites") %>%
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)

race_crosstabs %>% kable_styling(latex_options = "scale_down")
#knitr::kable(race_crosstabs, booktabs = TRUE)  %>% kable_styling(latex_options = "scale_down") %>% landscape() 
```

\FloatBarrier
```{r race_barplot1, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
race_crosstab_bar <- race_crosstab %>%  filter(Site!="NCI" & Site!="Other") %>%  mutate(Site=droplevels(Site))
cross_tab <- table(race_crosstab_bar$Site, race_crosstab_bar$race_eth)

# Convert the crosstab to a data frame
cross_tab_df <- as.data.frame.matrix(cross_tab)
#cross_tab_df$race_eth <- factor(cross_tab_df$race_eth,levels=c("<HS", "HS or GED","Some college, technical school/other", "Associates/Bachelors Degree", "Advanced Degree","Skipped This Question"))


cross_tab_df$Site <- rownames(cross_tab_df)
cross_tab_df_long <- tidyr::gather(cross_tab_df, key = "race_eth", value = "Count", -Site)

race_order <- c("Skipped this question ", "Prefer Not to Answer", "Multi-Racial","American Indian or Native American","Asian/Asian American","Black, African American, or African","Hispanic, Latino, or Spanish","Middle Eastern or North African","Hawaiian or Pacific Islander","White","Other")
cross_tab_df_long$race_eth <- factor(cross_tab_df_long$race_eth, levels=race_order)

# Calculate percentages
cross_tab_df_long <- transform(cross_tab_df_long, Percentage = (Count / tapply(Count, Site, sum)[Site]) * 100)

# Create a stacked barplot
race_bplot <- ggplot(cross_tab_df_long, aes(x = race_eth, y = Percentage, fill = Site)) +
  geom_bar(position="dodge",stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of Race by Site",
       x = "Race/Ethnicity", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
race_bplot + guides(fill = guide_legend(title = "Site")) 

```




\newpage

# Section 2. Distribution of the prevalence of no self-reported health conditions, by site 

\FloatBarrier
```{r, overall_prevalance_none, warning=FALSE, echo=FALSE, message=FALSE}
# Table 2. Distribution of the prevalence of no self-reported health conditions, by site 
#\FloatBarrier

prev_crostab <- module1 %>%  filter(!is.na(d_827220437)) %>% mutate(Site=case_when(d_827220437 == 531629870 ~ "HealthPartners", 
                                                            d_827220437 == 548392715 ~"Henry Ford",
                                                             d_827220437 == 303349821 ~ "Marshfield",
                                                             d_827220437 == 657167265 ~ "Sanford", 
                                                             d_827220437 == 809703864 ~ "UChicago",
                                                             d_827220437 == 125001209 ~ "KPCO",
                                                             d_827220437 == 327912200 ~ "KPGA",
                                                             d_827220437 == 300267574 ~ "KPHI",
                                                             d_827220437 == 452412599 ~ "KPNW",
                                                             d_827220437 == 517700004 ~ "NCI",
                                                             d_827220437 == 181769837 ~"Other"),
                               cardiov= case_when(D_167101091_D_535003378==1 ~ "None",
                                                  is.na(D_167101091_D_698944820) & is.na(D_167101091_D_838744325) & is.na(D_167101091_D_769790179) & is.na(D_167101091_D_699553344) & 
                                                    is.na(D_167101091_D_700811160)& is.na(D_167101091_D_336505365) & is.na(D_167101091_D_132548932) & is.na(D_167101091_D_747787163) & 
                                                    is.na(D_167101091_D_693851465)  & is.na(D_167101091_D_512012656)  & is.na(D_167101091_D_619337095)  & is.na(D_167101091_D_535003378)  ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               kidn= case_when(D_874046190_D_535003378==1 ~ "None",
                                               is.na(D_874046190_D_827542780) & is.na(D_874046190_D_167238688) & is.na(D_874046190_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               resp= case_when(D_894259747_D_535003378==1 ~ "None",
                                               is.na(D_894259747_D_359025642) & is.na(D_894259747_D_407340134) & is.na(D_894259747_D_427219143) & is.na(D_894259747_D_535003378) ~ "Skipped this Question",
                                               TRUE ~ "Reported One or More Health Conditions"),
                               digest= case_when(D_180961306_D_535003378==1 ~ "None",
                                                 is.na(D_180961306_D_406890409) & is.na(D_180961306_D_704544306) & is.na(D_180961306_D_691766591) & is.na(D_180961306_D_308645635) & 
                                                   is.na(D_180961306_D_731115613) & is.na(D_180961306_D_567284980) & is.na(D_180961306_D_986548173) & is.na(D_180961306_D_285995100) & 
                                                   is.na(D_180961306_D_545628561) & is.na(D_180961306_D_709786039) & is.na(D_180961306_D_984479578) & is.na(D_180961306_D_535003378)~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               thy_d_g= case_when(D_900541533_D_535003378==1 ~ "None",
                                                  is.na(D_900541533_D_726539692) & is.na(D_900541533_D_158044532) & is.na(D_900541533_D_943054522) & is.na(D_900541533_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                              sysoth= case_when(D_543728565_D_535003378==1 ~ "None",
                                                is.na(D_543728565_D_636030086) & is.na(D_543728565_D_239687183)  & is.na(D_543728565_D_134592375)  & is.na(D_543728565_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               sti_std= case_when(D_874709643_D_535003378==1 ~ "None",
                                                  is.na(D_874709643_D_164910211) & is.na(D_874709643_D_796616844) & is.na(D_874709643_D_436689514) & is.na(D_874709643_D_296357383) & 
                                                    is.na(D_874709643_D_901077233) & is.na(D_874709643_D_136956596) & is.na(D_874709643_D_455776698) & is.na(D_874709643_D_155874194) & 
                                                    is.na(D_874709643_D_880962432) & is.na(D_874709643_D_691450854) & is.na(D_874709643_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               urn_repro= case_when(D_725626004_D_535003378==1 ~ "None",
                                                    is.na(D_725626004_D_509721537) & is.na(D_725626004_D_863286658) & is.na(D_725626004_D_386524148) & 
                                                    is.na(D_725626004_D_937208760) & is.na(D_725626004_D_746542057) & is.na(D_725626004_D_854945381) & 
                                                      is.na(D_725626004_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"),
                               surgery= case_when(D_624179836_D_535003378==1 ~ "None",
                                                  is.na(D_624179836_D_797189152) &  is.na(D_624179836_D_633546100) & is.na(D_624179836_D_866002271) &  is.na(D_624179836_D_118789503) & 
                                                    is.na(D_624179836_D_715563991) & is.na(D_624179836_D_533491176) & is.na(D_624179836_D_220755749) & is.na(D_624179836_D_465318416) & 
                                                    is.na(D_624179836_D_630100221) & is.na(D_624179836_D_692881833) & is.na(D_624179836_D_654450030) & is.na(D_624179836_D_532603425) & 
                                                    is.na(D_624179836_D_733236542) & is.na(D_624179836_D_961987554) & is.na(D_624179836_D_535003378) ~ "Skipped this Question",
                                             TRUE ~ "Reported One or More Health Conditions"))

edu_crostabs2 <- prev_crostab  %>% dplyr::select(Site, cardiov ) %>% tbl_cross(
    row = cardiov,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(cardiov="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__2 <- edu_crostabs2 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Cardiovascular Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)

edu_crostabs__2  %>% kable_styling(latex_options = "scale_down")

```

\FloatBarrier
```{r, prevbar2, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
ggplot(prev_crostab, aes(x = cardiov,  fill=Site)) +
  geom_bar(position="dodge", stat="count") +
  scale_y_continuous() +
  labs(title = "Distribution of No Self-Reported Cardiovascular Diseases by Site",
       x = "Education Level", y = "Count") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
```



```{r, prev3, warning=FALSE, echo=FALSE, message=FALSE}
edu_crostabs3 <- prev_crostab  %>% dplyr::select(Site, kidn ) %>% tbl_cross(
    row = kidn,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(kidn="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__3 <- edu_crostabs3 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Kindey Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__3  %>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r, prevbar3, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
ggplot(prev_crostab, aes(x = kidn,  fill=Site)) +
  geom_bar(position="dodge", stat="count") +
  scale_y_continuous() +
  labs(title = "Distribution of No Self-Reported Kidney Diseases by Site",
       x = "Education Level", y = "Count") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
```


```{r, prev4, warning=FALSE, echo=FALSE, message=FALSE}
edu_crostabs4 <- prev_crostab  %>% dplyr::select(Site, resp ) %>% tbl_cross(
    row = resp,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(resp="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__4 <- edu_crostabs4 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Respiratory Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__4  %>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r, prevbar4, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
ggplot(prev_crostab, aes(x = resp,  fill=Site)) +
  geom_bar(position="dodge", stat="count") +
  scale_y_continuous() +
  labs(title = "Distribution of No Self-Reported Respiratory Diseases by Site",
       x = "Education Level", y = "Count") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )
```


```{r, prev5_8, warning=FALSE, echo=FALSE, message=FALSE}

edu_crostabs5 <- prev_crostab  %>% dplyr::select(Site, digest ) %>% tbl_cross(
    row = digest,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(digest="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__5 <- edu_crostabs5 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Digestive Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__5  %>% kable_styling(latex_options = "scale_down")

edu_crostabs6 <- prev_crostab  %>% dplyr::select(Site, thy_d_g ) %>% tbl_cross(
    row = thy_d_g,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(thy_d_g="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__6 <- edu_crostabs6 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Thyroid, Diabetes, or Graves Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__6  %>% kable_styling(latex_options = "scale_down")

edu_crostabs7 <- prev_crostab  %>% dplyr::select(Site, sysoth ) %>% tbl_cross(
    row = sysoth,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(sysoth="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__7 <- edu_crostabs7 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Systemic or Other Disease= 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__7  %>% kable_styling(latex_options = "scale_down")

edu_crostabs8 <- prev_crostab  %>% dplyr::select(Site, sti_std ) %>% tbl_cross(
    row = sti_std,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(sti_std="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__8 <- edu_crostabs8 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of STIs or STDs or Other Infectious Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__8  %>% kable_styling(latex_options = "scale_down")
```
\FloatBarrier
```{r, prev9_10, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
ggplot(prev_crostab, aes(x = sti_std,  fill=Site)) +
  geom_bar(position="dodge", stat="count") +
  scale_y_continuous() +
  labs(title = "Distribution of No Self-Reported STD, STIs, or Other Infectious Diseases \n by Site",
       x = "Education Level", y = "Count") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_crostabs9 <- prev_crostab  %>% dplyr::select(Site, urn_repro ) %>% tbl_cross(
    row = urn_repro,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(urn_repro="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__9 <- edu_crostabs9 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Urinary or Reproductive Disease = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__9  %>% kable_styling(latex_options = "scale_down")

edu_crostabs10 <- prev_crostab  %>% dplyr::select(Site, surgery ) %>% tbl_cross(
    row = surgery,
    col = Site,
    digits=c(0,1),
    percent = "col",
    label=list(surgery="Response",
                Site = "Site"),
    missing="ifany",
    margin_text="Total")

edu_crostabs__10 <- edu_crostabs10 %>%
  #bold_labels() %>%
  #italicize_levels() %>% 
  modify_header(stat_0 = "Total") %>%
  modify_caption("Prevalence of Surgerical Procedures = 'None' by Site")  %>% 
  as_kable_extra(escape = FALSE, addtl_fmt = TRUE)


edu_crostabs__10  %>% kable_styling(latex_options = "scale_down")




```

\newpage
\newpage


# Section 3. Distribution of the prevalence of no self-reported health conditions, by education level and site

\FloatBarrier
```{r edu_cardio_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Table 3. Distribution of the prevalence of no self-reported health conditions, by education level and site
#\FloatBarrier


## Prevalence (%) of self-reported medical condition= “NONE” in Background and Overall Health (module 1) across participant demographics, by Site


# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(cardiov == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"


knitr::kable(combined_df_pivot,caption='No Cardiovascular Disease by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```

\FloatBarrier
```{r edu_cardio_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = edlevel, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Cardiovascular Diseases by Education and Site",
       x = "Education Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))

```


```{r edu_kidn_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(kidn == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Kidney Disease by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r edu_kidn_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = edlevel, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Kidney Diseases by Education and Site",
       x = "Education Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))


```


```{r edu_resp_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(resp == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Respiratory Disease by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r edu_resp_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = edlevel, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Respiratory Diseases by Education and Site",
       x = "Education Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))


```


```{r edu_digest_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(digest == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Digestive Disease by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```


```{r edu_thy_d_g_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(thy_d_g == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Thyroid, Diabetes, or Graves Disease \n by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")



```


```{r edu_sysoth_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(sysoth == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Systemic or Other Disease \n by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```



```{r edu_sti_std_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(sti_std == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No STDs, STIs, or Other Infectious Diseases \n by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r edu_sti_std_bar, warning=FALSE, echo=FALSE, message=FALSE}
#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = edlevel, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported STDs, STIs, or Other Infectious Diseases \n by Education and Site",
       x = "Education Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))

```


```{r edu_urn_repro_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(urn_repro == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"


knitr::kable(combined_df_pivot,caption='No Urinary or Reproductive Diseases \n by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")



```


```{r edu_surgery_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(surgery == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

knitr::kable(combined_df_pivot,caption='No Surgical Procedures \n by Education Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```


```{r edu_ALLMHGROUPS_knit, warning=FALSE, echo=FALSE, message=FALSE}



# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(edlevel) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(cardiov == "None" & kidn == "None" & resp == "None" & digest == "None" &
           thy_d_g == "None" & sysoth == "None" & sti_std == "None" & urn_repro == "None" & surgery == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(edlevel, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", edu_crostab)
HP_summary <- calculate_summary("HealthPartners", edu_crostab)
MF_summary <- calculate_summary("Marshfield", edu_crostab)
SF_summary <- calculate_summary("Sanford", edu_crostab)
HF_summary <- calculate_summary("Henry Ford", edu_crostab)
kpco_summary <- calculate_summary("KPCO", edu_crostab)
kpga_summary <- calculate_summary("KPGA", edu_crostab)
kphi_summary <- calculate_summary("KPHI", edu_crostab)
kpnw_summary <- calculate_summary("KPNW", edu_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Education Level"

tab5 <- knitr::kable(combined_df_pivot,caption="Response of 'None' for All MH Groups \n by Education Level and Site",row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
add_footnote(tab5, "All MH Groups is defined here as 'MH Groups' from the BOH Module: Cardiovasular Disease, Respiratory Problems, Digestive System Probelms, Thyroid/Diabetes?Graves Disease, Kidney Disease, Systemic and Other Problems, STDs and STIs, Urinary and Reproductive Problems, and Surgical Procedures", notation = "none")




```




\newpage
\newpage

# Section 4. Distribution of the prevalence of no self-reported health conditions, by income level and site 

\FloatBarrier
```{r inc_cardiov_none, warning=FALSE, echo=FALSE, message=FALSE}
# Table 4. Distribution of the prevalence of no self-reported health conditions, by income level and site 
#\FloatBarrier

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(cardiov == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Cradiovascular Diseases by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```


```{r inc_kidn_none, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(kidn == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Kidney Diseases by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```


```{r inc_resp_none, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(resp == "None" ),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Respiratory Diseases by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```

```{r inc_digest_none, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(digest == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Digestive Diseases by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```

```{r inc_thy_d_g_none, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(thy_d_g == "None" ),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Thyroid, Diabetes, or Graves Diseases \n by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```


```{r inc_sysoth_none, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum( sysoth == "None" ),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Systemic or Other Diseases \n by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```

```{r inc_stistd_none, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(sti_std == "None" ),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No STDs, STIs, or Other Infectious Diseases \n by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```


```{r inc_urn_repro_none, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(urn_repro == "None" ),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"

knitr::kable(combined_df_pivot,caption='No Urinary or Reproductive Diseases \n by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r inc_urn_repro_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = status, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Urinary or Reproductive Diseases by \n Income and Site",
       x = "Income Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))

```

```{r inc_surgery_none, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(status) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(surgery == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(status, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", inc_crostab)
HP_summary <- calculate_summary("HealthPartners", inc_crostab)
MF_summary <- calculate_summary("Marshfield", inc_crostab)
SF_summary <- calculate_summary("Sanford", inc_crostab)
HF_summary <- calculate_summary("Henry Ford", inc_crostab)
kpco_summary <- calculate_summary("KPCO", inc_crostab)
kpga_summary <- calculate_summary("KPGA", inc_crostab)
kphi_summary <- calculate_summary("KPHI", inc_crostab)
kpnw_summary <- calculate_summary("KPNW", inc_crostab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Income"


knitr::kable(combined_df_pivot,caption='No Surgical Procedures \n by Income Level and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r inc_surgery_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = status, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Surgical Procedures by Income and Site",
       x = "Income Level", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))


```


\newpage

# Section 5. Distribution of the prevalence of no self-reported health conditions, by race and site 

\FloatBarrier
```{r race_cardio_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Table 5. Distribution of the prevalence of no self-reported health conditions, by race and site 
#\FloatBarrier

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(cardiov == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"


knitr::kable(combined_df_pivot,caption='No Cardiovascular Disease by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```

\FloatBarrier
```{r race_cardio_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = race_eth, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Cardiovascular Diseases by Race and Site",
       x = "Race/Ethnicity", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))


```




```{r race_kidn_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(kidn == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Kidney Disease by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```



```{r race_resp_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(resp == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Respiratory Disease by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```

\FloatBarrier

```{r race_resp_bar, warning=FALSE, echo=FALSE, message=FALSE}

#Bar Plot
combined_df_bar <- combined_df %>% mutate(cardio_count_pct = as.numeric(gsub(".*\\((\\d+(\\.\\d+)?)%\\)", "\\1", cardio_count)))

# Create a stacked barplot
edu_bplot <- ggplot(combined_df_bar, aes(x = race_eth, y = cardio_count_pct, fill = Site)) +
  geom_bar(position="dodge", stat = "identity") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = "Distribution of No Self-Reported Respiratory Diseases by Race and Site",
       x = "Race/Ethnicity", y = "Percentage") +
  theme(panel.background = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text()
        )

edu_bplot + guides(fill = guide_legend(title = "Site"))



```



```{r race_digest_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(digest == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Digestive Disease by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```




```{r race_thy_d_g_knit, warning=FALSE, echo=FALSE, message=FALSE}
# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(thy_d_g == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Thyriod, Diabetes, or Graves Disease \n by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```



```{r race_sysoth_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(sysoth == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Systemic or Other Disease \n by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
```



```{r race_sti_std_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(sti_std == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No STIs, STDs, or Other Infectious Disease \n by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")


```



```{r race_urn_repro_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(urn_repro == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Urinary or Reproductive Disease \n by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```



```{r race_surgery_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(surgery == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

knitr::kable(combined_df_pivot,caption='No Surgical Procedures \n by Race and Site',row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")

```



```{r race_ALLMHGROUPS_knit, warning=FALSE, echo=FALSE, message=FALSE}

# Create a function to calculate counts and percentages
calculate_summary <- function(site, data) {
  summary <- data %>%
    filter(Site == site) %>%
    group_by(race_eth) %>%
    summarize(
      total_count = n(),
      cardio_count = sum(cardiov == "None" & resp == "None" & digest == "None" & thy_d_g == "None" & sysoth == "None" &
           sti_std == "None" & urn_repro == "None" & surgery == "None"),
      percentage = ifelse(total_count != 0, 100 * cardio_count / total_count, 0)
    ) %>%
    mutate(
      cardio_count = paste0(cardio_count, " (", round(percentage, digits = 1), "%)")
    ) %>%
    select(race_eth, cardio_count)
  
  return(summary)
}

# Calculate summaries for all sites
UC_summary <- calculate_summary("UChicago", race_crosstab)
HP_summary <- calculate_summary("HealthPartners", race_crosstab)
MF_summary <- calculate_summary("Marshfield", race_crosstab)
SF_summary <- calculate_summary("Sanford", race_crosstab)
HF_summary <- calculate_summary("Henry Ford", race_crosstab)
kpco_summary <- calculate_summary("KPCO", race_crosstab)
kpga_summary <- calculate_summary("KPGA", race_crosstab)
kphi_summary <- calculate_summary("KPHI", race_crosstab)
kpnw_summary <- calculate_summary("KPNW", race_crosstab)

# Combine all summaries
combined_df <- bind_rows(
  UC_summary %>% mutate(Site = "UChicago"),
  HP_summary %>% mutate(Site = "HealthPartners"),
  MF_summary %>% mutate(Site = "Marshfield"),
  SF_summary %>% mutate(Site = "Sanford"),
  HF_summary %>% mutate(Site = "Henry Ford"),
  kpco_summary %>% mutate(Site = "KPCO"),
  kpga_summary %>% mutate(Site = "KPGA"),
  kphi_summary %>% mutate(Site = "KPHI"),
  kpnw_summary %>% mutate(Site = "KPNW")
)

# Pivot the data for better presentation
combined_df_pivot <- combined_df %>%
  pivot_wider(names_from = Site, values_from = cardio_count, values_fill = "0")
colnames(combined_df_pivot)[1] <- "Race/Ethnicity"

tab5 <- knitr::kable(combined_df_pivot,caption="Respone of 'None' Selected for All MH Groups \n by Race and Site",row.names=FALSE, align=c("l","c","c","c","c","c","c","c","c","c"),digits=1, booktabs = TRUE)%>% kable_styling(latex_options = "scale_down")
add_footnote(tab5, "All MH Groups is defined here as 'MH Groups' from the BOH Module: Cardiovasular Disease, Respiratory Problems, Digestive System Probelms, Thyroid/Diabetes?Graves Disease, Kidney Disease, Systemic and Other Problems, STDs and STIs, Urinary and Reproductive Problems, and Surgical Procedures.", notation = "none")




```


