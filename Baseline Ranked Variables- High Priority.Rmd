---
title: "Baseline Ranked Variables- High Priority"
author: "Kelsey Dowling"
date: "`r Sys.Date()`"

output:
  pdf_document:
    latex_engine: xelatex
    df_print: paged 
---




```{r, include=FALSE}


#  pdf-engine: xelatex
#tinytex::install_tinytex()

library(bigrquery)
library(foreach)
library(stringr)
#library(plyr)
#library(expss) ###to add labels
library(epiDisplay) ##recommended applied here crosstable, tab1
library(gmodels) ##recommended
library(magrittr)
library(arsenal)
library(gtsummary)
library(rio)



library(ggplot2)
library(gridExtra)
library(scales)
library(gt)
#install(tinytex)
library(tinytex)
library(data.table) ###to write or read and data management 
library(tidyverse) ###for data management
library(dplyr) ###data management
library(reshape)  ###to work on transition from long to wide or wide to long data
library(listr) ###to work on a list of vector, files or..
library(sqldf) ##sql
library(lubridate) ###date time
library(stringr) ###to work on patterns, charaters

# Libraries for Map of US
library(ggmap)
library(maps)
library(mapdata)
# library(Rcpp)
# library(rgdal)
library(sf)
library(zipcodeR)
library(viridis)
library(ggthemes)
#library(albersusa)

options(tinytex.verbose = TRUE)

bq_auth()
```


```{r, include=FALSE, warning=FALSE}

## MERGE MOD1V1, MOD1V2

dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')

dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")

project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" ##project and billing should be consistent
##517311251 Date/time Status of Completion of Background and Overall Health                         SrvBOH_TmComplete_v1r0
##949302066 Flag for Baseline Module Background and Overall Health                        SrvBOH_BaseStatus_v1r0
recr_M1 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379,
                            d_949302066 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935'")
recr_m1 <- bq_table_download(recr_M1,bigint = "integer64")
cnames <- names(recr_m1)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m1,varname)
  recr_m1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

sql_M1_1 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v1_JP` where Connect_ID is not null")
sql_M1_2 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v2_JP` where Connect_ID is not null")


M1_V1 <- bq_table_download(sql_M1_1,bigint = "integer64") #1436 #1436 vars: 1507 01112023 
M1_V2 <- bq_table_download(sql_M1_2,bigint = "integer64") #2333 #3033 01112023 var:1531 #6339 obs 1893 vars 05022023

mod1_v1 <- M1_V1
cnames <- names(M1_V1)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v1,varname)
  mod1_v1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}
mod1_v2 <- M1_V2
cnames <- names(M1_V2)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod1_v2,varname)
  mod1_v2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

M1_V1.var <- colnames(M1_V1)
M1_V2.var <- colnames(M1_V2)
var.matched <- M1_V1.var[which(M1_V1.var %in% M1_V2.var)]
length(var.matched)  #1275 #1278 vars 01112023 #1348 vars 05022023

V1_only_vars <- colnames(M1_V1)[colnames(M1_V1) %nin% var.matched] #232 #229 01112023 #159 05022023
V2_only_vars <- colnames(M1_V2)[colnames(M1_V2) %nin% var.matched] #253 #253 01112023 #545 05022023

length(M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID])
#[1] 59 with the completion of two versions of Module1 
#[1] 62 with completing both versions of M1 ###double checked 03/28/2023
#68 double checked 05/02/2023

common.IDs <- M1_V1$Connect_ID[M1_V1$Connect_ID %in% M1_V2$Connect_ID]
M1_V1_common <- mod1_v1[,var.matched]

M1_V2_common <- mod1_v2[,var.matched]
M1_V1_common$version <- 1
M1_V2_common$version <- 2

##to check the completion of M1 among these duplicates
partM1_dups <- recr_m1[which(recr_m1$Connect_ID %in% common.IDs),]
table(partM1_dups$d_949302066)

M1_common  <- rbind(M1_V1_common, M1_V2_common) #including 136 duplicates (version 1 and version 2) from 68 participants 05022023
#M1_response <- matrix(data=NA, nrow=118, ncol=967)

m1_v1_only <- mod1_v1[,c("Connect_ID", V1_only_vars)] #230 vars 03282023 #160 vars 05/02/2023
m1_v2_only <- mod1_v2[,c("Connect_ID", V2_only_vars)] #255 vars 03282023 #546 vars 05/02/2023
m1_v1_only$version <- 1
m1_v2_only$version <- 2
#for (i in 1:length)
##to check the completion in each version
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v1_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #1364 03282023 # 1370 05022023
length(recr_m1$Connect_ID[which(recr_m1$Connect_ID %in% m1_v2_only$Connect_ID & recr_m1$d_949302066 ==231311385)]) #4870 03282023 # 5731 05022023

#library(janitor)

m1_common <- rbind(M1_V1_common,M1_V2_common)
m1_common_v1 <- base::merge(m1_common, m1_v1_only, by=c("Connect_ID","version"),all.x=TRUE)
m1_combined_v1v2 <- base::merge(m1_common_v1,m1_v2_only,by=c("Connect_ID","version"),all.x=TRUE)
m1_complete <- m1_combined_v1v2[which(m1_combined_v1v2$Connect_ID %in% recr_m1$Connect_ID[which(recr_m1$d_949302066 ==231311385 )]),] #7289 including duplicates 05022023

m1_complete <- m1_complete %>% arrange(desc(version)) 


m1_complete_nodup <- m1_complete[!duplicated(m1_complete$Connect_ID),] 
table(m1_complete_nodup$version)




parts <- "SELECT Connect_ID, token, D_512820379, D_471593703, state_d_934298480, D_230663853,
D_335767902, D_982402227, D_919254129, D_699625233, D_564964481, D_795827569, D_544150384,
D_371067537, D_430551721, D_821247024, D_914594314,  state_d_725929722, d_126331570, d_536735468, 
d_663265240, d_878865966, d_684635302, d_167958071,
d_949302066 , D_517311251, D_205553981, D_117249500, d_976570371, d_914639140, d_311580100, d_371067537 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` 
where Connect_ID IS NOT NULL"
parts_table <- bq_project_query(project, parts)
parts_data <- bq_table_download(parts_table, bigint = "integer64")

parts_data$Connect_ID <- as.numeric(parts_data$Connect_ID)


merged= left_join(m1_complete_nodup, parts_data, by="Connect_ID") #%>%  left_join(m3_data, by="Connect_ID")
dim(merged)



# m3 <- "SELECT Connect_ID, D_947205597_D_712653855, D_947205597_D_706254326, D_947205597_D_198133418, D_947205597_D_817381897, D_947205597_D_539648641, 
# D_947205597_D_686310465, D_448968121  FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module3_v1_JP`
# where Connect_ID IS NOT NULL"
# m3_table <- bq_project_query(project, m3)
# m3_data <- bq_table_download(m3_table, bigint = "integer64")
# 
# m3_data$Connect_ID <- as.numeric(m3_data$Connect_ID)

```




```{r, warning=FALSE, echo=FALSE,  message=FALSE}
#Has a recruitment flag[poi90]
merged <- merged %>% filter(D_512820379==486306141 | D_512820379==854703046)


#User consent submitted
merged <- merged %>% filter(D_919254129==353358909)


#User profile submitted
merged <- merged %>% filter(D_699625233==353358909)


#Verified by site
#cat("Verified by site:", sum(merged$D_821247024==197316935, na.rm=TRUE))
merged <- merged %>% filter(D_821247024==197316935)


#Mod1 completed and M3 completed- this way N throughout stays the same 
base_vars <- merged %>% filter(d_949302066==231311385) # & d_976570371==231311385 & d_536735468==231311385 & d_663265240 ==231311385)
#cat("Module 1 completed:", dim(base_vars)[[1]])


data_tib_base <- as_tibble(base_vars)

data_tib_merged <- as_tibble(merged)
#dim(base_vars)

knitr::opts_chunk$set(comment = NA)


```




```{r, warning=FALSE, include=FALSE}

#Boxplot
boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  data_tib_base %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)+
    theme(axis.text.y=element_blank(),  #remove y axis labels
        axis.ticks.y=element_blank()  #remove y axis ticks
        )
}


##GT TABLE: Questions that all participants asked, update dictionary as new answer options come up
dict <- list("104430631"="No", "353358909"="Yes", "589959753"="A little shorter", "623310018"="A lot shorter", "978204320"= "Grade School(Grades 1-8)", "935502060"="Some High School, No Diploma", "404564707"= "High School Graduate or GED", "432193665"="Some College, No Degree", "890756124"="Technical or Trade School After High School", "766964355"="Associate's Degree", "875342283"="Bachelor's Degree", "598242454"="Advanced Degree", "709650750"="Biological Child", "810290359"="Adopted Child", "509607548"="Step Child","784922042"="Related to me in some other way", "288105839"=" Yes, fraternal twins", "626558982"="Yes, triplets or higher multiple birth", "178420302"="Do not Know", "536341288"="Female", "576796184"="Intersex or Other", "654207589"="Male","555374628"="Full Sibling", "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", "274062548"="More than 3 months ago", "958538953"="In the past 3 months", "317567178"="In the past month", "484055234"="In the past year",  "802197176"="More than 1 year ago", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago","958538953"="In the past 3 months",  "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible", "764708931"="Very flexible","0"="No", "1"="Yes", "536341288"="Female", "218837028"="Woman (New Response)", "983318667"="Man (New Response)"  , "654207589"="Male","746038746"="Declined", "805712793"="Genderqueer","486192236"="Non-Binary", "807835037"="Other","873138103"="Transgender Woman","405267600"="Transgender Man", "220083334"="Very Feminine","541300533"="Mostly Feminine","878286618"="Somewhat Feminine","910745276"="Equally feminine and masculine","915528806"="Very masculine","265452386"="Mostly Masculine","510148951"="Somewhat Masculine","271882746"="Straight or heterosexual", "903084185"="Lesbian, gay, or homosexual", "999994434"="Bisexual")

simple_funct1 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_base %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%  
  # summary_rows(
  #   columns = c(n,percentage),    
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}


#GT table with one filter/skip logic
one_logic_funct <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_base %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"),  answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}


boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  base_vars %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM, fill=as.character(D_407056417)))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)+
    scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male")) + 
    scale_y_continuous(labels = scales::number_format(accuracy = 0.01))
}


#GT table for siblings
sib_logic_funct <- function(CID, Sib_Num, Title){  
  CID_SYM <- rlang::ensym(CID)
  data_tib_base$D_694265648 <- as.numeric(data_tib_base$D_694265648)
  dt_select <- data_tib_base %>%  filter(D_694265648 >= Sib_Num) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"),  answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}


#GT table for children
child_logic_funct <- function(CID, Child_Num, Title){  
  CID_SYM <- rlang::ensym(CID)
  data_tib_base$D_446999144 <- as.numeric(data_tib_base$D_446999144)
  dt_select <- data_tib_base %>%  filter(D_446999144 >= Child_Num) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"),  answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}



```

\newpage
# Stakeholder Metrics
Objectives of Stakeholder Metrics: Quantify representativeness of self-reported demographics, distribution of co-morbidities and key exposures from baseline surveys, compared to other US cohorts and the US general population.


## RACE
```{r, warning=FALSE, echo=FALSE, message=FALSE}


## Multi-racial

multi_race=0    
for (i in 1:length(data_tib_base$Connect_ID)){
  AI=ifelse((data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1|
                                               data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                               data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                               data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  As=ifelse((data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Bl=ifelse((data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Hs=ifelse((data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Me=ifelse((data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Hw=ifelse((data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Wh=ifelse((data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1)), 1, 0)
  Ot=ifelse((data_tib_base$D_384191091_D_384191091_D_807835037[[i]]==1 & (data_tib_base$D_384191091_D_384191091_D_583826374[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_636411467[[i]]==1|
                                                        data_tib_base$D_384191091_D_384191091_D_458435048[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_706998638[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_586825330[[i]]==1 | data_tib_base$D_384191091_D_384191091_D_973565052[[i]]==1 |
                                                        data_tib_base$D_384191091_D_384191091_D_412790539[[i]]==1)), 1, 0)
  multi_race= multi_race + sum(AI+As+Bl+Hs+Me+Hw+Wh+Ot, na.rm=T)

}

#cat("Percentage of multirace participants:", (multi_race/(dim(data_tib_base)[1]))*100)
   
   

data_tib_base$multi_racial <- c(rep(1, times=multi_race), rep(0, times=(dim(data_tib_base)[1]- multi_race)))



## RACE

which_race= data_tib_base %>%  mutate(race= case_when(multi_racial==1 ~ "Multi-Racial",
                                                     D_384191091_D_384191091_D_583826374==1 ~ "American Indian or Native American",
                                                     D_384191091_D_384191091_D_636411467==1 ~ "Asian/Asian American",
                                                     D_384191091_D_384191091_D_458435048==1 ~ "Black, African American, or African",
                                                     D_384191091_D_384191091_D_706998638==1 ~ "Hispanic, Latino, or Spanish",
                                                     D_384191091_D_384191091_D_973565052==1 ~ "Middle Eastern or North African",
                                                     D_384191091_D_384191091_D_586825330==1 ~ "Hawaiian or Pacific Islander",
                                                     D_384191091_D_384191091_D_412790539==1 ~ "White",
                                                     (D_384191091_D_384191091_D_807835037==1 | !is.na(D_384191091_D_747350323)) ~ "Other",
                                                     D_384191091_D_384191091_D_746038746==1 ~ "Prefer Not to Answer",
                                                     TRUE  ~ "Skipped this question"))

dt_all_races_summary <- which_race  %>% dplyr::group_by(race) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup()  %>%  dplyr::select(race, n, percentage)

dt_all_races_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Race/Ethnicity of Participants Who Completed BOH Section of First Survey")) %>% 
  cols_label(n= md("**Number of Participants**"), race = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = race,
    )
  )

```



## RACEETH2-8 (Ethnicity)
```{r, warning=FALSE, echo=FALSE, message=FALSE}


#American Indian/Native American
dt_am_ind_ethn= data_tib_base %>%  filter(data_tib_base$D_384191091_D_384191091_D_583826374==1)  


dt_am_ind_ethn= dt_am_ind_ethn %>%  mutate(multb2 = ifelse(D_362270886_D_362270886_D_249603425==1, 1, 0) + ifelse(D_362270886_D_362270886_D_530063091==1, 1, 0) + ifelse(D_362270886_D_362270886_D_643489668==1, 1, 0) + 
                                             ifelse(D_362270886_D_362270886_D_807835037==1, 1, 0) + ifelse(D_362270886_D_362270886_D_746038746==1, 1, 0))


amer_eth= dt_am_ind_ethn %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                          D_362270886_D_362270886_D_249603425==1 ~ "American Indian",
                                             D_362270886_D_362270886_D_530063091==1 ~ "Alaska Native",
                                             D_362270886_D_362270886_D_643489668==1 ~ "Central or South American Indian",
                                             (D_362270886_D_362270886_D_807835037==1 | !is.na(D_362270886_D_650100414)) ~ "Other",
                                             D_362270886_D_362270886_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE ~ "Skipped this question"))

dt_am_ind_ethn_summary <- amer_eth %>% group_by(ethnicity) %>%    dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage) 
gtm3_print <- gt(dt_am_ind_ethn_summary)


dt_ethnic1 <- dt_am_ind_ethn_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("Ethnicity of American Indian/Native American Participants")) %>%
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic1,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic1,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#Asian/Asian American
dt_asian= data_tib_base %>% filter(data_tib_base$D_384191091_D_384191091_D_636411467==1)  

dt_asian= dt_asian %>%  mutate(multb2 = ifelse(D_525535977_D_525535977_D_773844957==1, 1, 0) + ifelse(D_525535977_D_525535977_D_901439277==1, 1, 0) + ifelse(D_525535977_D_525535977_D_750168061==1, 1, 0) + 
                                             ifelse(D_525535977_D_525535977_D_326604981==1, 1, 0) + ifelse(D_525535977_D_525535977_D_469918550==1, 1, 0) + ifelse(D_525535977_D_525535977_D_288079668==1, 1, 0) + ifelse(D_525535977_D_525535977_D_240721579==1, 1, 0) + ifelse(D_525535977_D_525535977_D_571633051==1, 1, 0) + ifelse(D_525535977_D_525535977_D_964924704==1, 1, 0) + ifelse(D_525535977_D_525535977_D_807835037==1, 1, 0) + ifelse(D_525535977_D_525535977_D_746038746==1, 1, 0))


                                                          
which_eth= dt_asian %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                     D_525535977_D_525535977_D_773844957==1 ~ "Asian indian",
                                             D_525535977_D_525535977_D_901439277==1 ~ "Cambodian",
                                             D_525535977_D_525535977_D_750168061==1 ~ "Chinese",
                                             D_525535977_D_525535977_D_326604981==1 ~ "Filipino",
                                             D_525535977_D_525535977_D_469918550==1 ~ "Hmong",
                                             D_525535977_D_525535977_D_288079668==1 ~ "Japanese",
                                             D_525535977_D_525535977_D_240721579==1 ~ "Korean",
                                             D_525535977_D_525535977_D_571633051==1 ~ "Pakastani",
                                             D_525535977_D_525535977_D_964924704==1 ~ "Vietnamese",
                                             (D_525535977_D_525535977_D_807835037==1 | !is.na(D_525535977_D_396618548)) ~ "Other",
                                             D_525535977_D_525535977_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE ~ "Skipped this question"))

dt_asian_summary <- which_eth %>% group_by(ethnicity) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage) 

dt_ethnic2 <- dt_asian_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of Asian and Asian American Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic2,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic2,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#Black/African/African American 
dt_black= data_tib_base %>% filter(data_tib_base$D_384191091_D_384191091_D_458435048==1)  

dt_black= dt_black %>%  mutate(multb2 = ifelse(D_976808005_D_976808005_D_704774349==1, 1, 0) + ifelse(D_976808005_D_976808005_D_240854115==1, 1, 0) + ifelse(D_976808005_D_976808005_D_280957170==1, 1, 0) + 
                                             ifelse(D_976808005_D_976808005_D_533776046==1, 1, 0) + ifelse(D_976808005_D_976808005_D_647105074==1, 1, 0) + ifelse(D_976808005_D_976808005_D_618222258==1, 1, 0) + ifelse(D_976808005_D_976808005_D_487027241==1, 1, 0) + ifelse(D_976808005_D_976808005_D_900838463==1, 1, 0) + ifelse(D_976808005_D_976808005_D_379093069==1, 1, 0) + ifelse(D_976808005_D_976808005_D_304643362==1, 1, 0) + ifelse(D_976808005_D_976808005_D_151821009==1, 1, 0) + ifelse(D_976808005_D_976808005_D_807835037==1, 1, 0) + ifelse(D_976808005_D_976808005_D_746038746==1, 1, 0))



which_eth= dt_black %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                     D_976808005_D_976808005_D_704774349==1 ~ "African American",
                                             D_976808005_D_976808005_D_240854115==1 ~ "Barbadian",
                                             D_976808005_D_976808005_D_280957170==1 ~ "Caribbean",
                                             D_976808005_D_976808005_D_533776046==1 ~ "Ethiopian",
                                             D_976808005_D_976808005_D_647105074==1 ~ "Ghanauin",
                                             D_976808005_D_976808005_D_618222258==1 ~ "Haitian",
                                             D_976808005_D_976808005_D_487027241==1 ~ "Jamaican",
                                             D_976808005_D_976808005_D_900838463==1 ~ "Liberian",
                                             D_976808005_D_976808005_D_379093069==1 ~ "Nigerian",
                                             D_976808005_D_976808005_D_304643362==1 ~ "Somali",
                                             D_976808005_D_976808005_D_151821009==1 ~ "South African",
                                             (D_976808005_D_976808005_D_807835037==1 | !is.na(D_976808005_D_852296096)) ~ "Other",
                                             D_976808005_D_976808005_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE   ~ "Skipped this question"))



dt_black_summary <- which_eth %>% group_by(ethnicity) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage)
dt_ethnic3 <- dt_black_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of Black/African/African American Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic3,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic3,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#Hispanic/Latino/Spanish
dt_hisp= data_tib_base  %>% filter(data_tib_base$D_384191091_D_384191091_D_706998638==1) 

dt_hisp= dt_hisp %>%  mutate(multb2 = ifelse(D_308014437_D_308014437_D_810637250==1, 1, 0) + ifelse(D_308014437_D_308014437_D_248444252==1, 1, 0) + ifelse(D_308014437_D_308014437_D_764331628==1, 1, 0) + 
                                             ifelse(D_308014437_D_308014437_D_412757551==1, 1, 0) + ifelse(D_308014437_D_308014437_D_981774939==1, 1, 0) + ifelse(D_308014437_D_308014437_D_432305109==1, 1, 0) + ifelse(D_308014437_D_308014437_D_862718552==1, 1, 0) + ifelse(D_308014437_D_308014437_D_988121468==1, 1, 0) + ifelse(D_308014437_D_308014437_D_773342525==1, 1, 0) + ifelse(D_308014437_D_308014437_D_807835037==1, 1, 0) + ifelse(D_308014437_D_308014437_D_746038746==1, 1, 0))



which_eth= dt_hisp %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                    D_308014437_D_308014437_D_810637250==1 ~ "Columbian",
                                             D_308014437_D_308014437_D_248444252==1 ~ "Cuban",
                                             D_308014437_D_308014437_D_764331628==1 ~ "Dominican",
                                             D_308014437_D_308014437_D_412757551==1 ~ "Ecuadorian",
                                             D_308014437_D_308014437_D_981774939==1 ~ "Hondurian",
                                             D_308014437_D_308014437_D_432305109==1 ~ "Mexican or Mexican American",
                                             D_308014437_D_308014437_D_862718552==1 ~ "Puerto Rican",
                                             D_308014437_D_308014437_D_988121468==1 ~ "Salvadorian",
                                             D_308014437_D_308014437_D_773342525==1 ~ "Spanish",
                                             (D_308014437_D_308014437_D_807835037==1 | !is.na(D_308014437_D_440307926)) ~ "Other",
                                             D_308014437_D_308014437_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE   ~ "Skipped this question"))

dt_hisp_summary <- which_eth %>% group_by(ethnicity) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage)

dt_ethnic4 <- dt_hisp_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of Hispanic/Latino/Spanish Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic4,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic4,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#Middle Eastern or North African
dt_mideast= data_tib_base %>%  filter(data_tib_base$D_384191091_D_384191091_D_973565052==1)  

dt_mideast= dt_mideast %>%  mutate(multb2 = ifelse(D_351657815_D_351657815_D_190152384==1, 1, 0) + ifelse(D_351657815_D_351657815_D_119632587==1, 1, 0) + ifelse(D_351657815_D_351657815_D_578616917==1, 1, 0) + 
                                             ifelse(D_351657815_D_351657815_D_834030167==1, 1, 0) + ifelse(D_351657815_D_351657815_D_680575651==1, 1, 0) + ifelse(D_351657815_D_351657815_D_144320785==1, 1, 0) + ifelse(D_351657815_D_351657815_D_214951746==1, 1, 0) + ifelse(D_351657815_D_351657815_D_932563284==1, 1, 0) + ifelse(D_351657815_D_351657815_D_336596477==1, 1, 0) + ifelse(D_351657815_D_351657815_D_380583570==1, 1, 0) + ifelse(D_351657815_D_351657815_D_807835037==1, 1, 0) + ifelse(D_351657815_D_351657815_D_746038746==1, 1, 0))


                                                    
which_eth= dt_mideast %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                       D_351657815_D_351657815_D_190152384==1 ~ "Afghan",
                                             D_351657815_D_351657815_D_119632587==1 ~ "Algerian",
                                             D_351657815_D_351657815_D_578616917==1 ~ "Egyptian",
                                             D_351657815_D_351657815_D_834030167==1 ~ "Iranian",
                                             D_351657815_D_351657815_D_680575651==1 ~ "Iraqi",
                                             D_351657815_D_351657815_D_144320785==1 ~ "Israeli",
                                             D_351657815_D_351657815_D_214951746==1 ~ "Lebanese",
                                             D_351657815_D_351657815_D_932563284==1 ~ "Moroccan",
                                             D_351657815_D_351657815_D_336596477==1 ~ "Syrian",
                                             D_351657815_D_351657815_D_380583570==1 ~ "Tunisian",
                                             (D_351657815_D_351657815_D_807835037==1 | !is.na(D_351657815_D_576646485)) ~ "Other",
                                             D_351657815_D_351657815_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE   ~ "Skipped this question"))

dt_mideast_summary <- which_eth %>% group_by(ethnicity) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage)

dt_ethnic5 <- dt_mideast_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of Middle Eastern or North African Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic5,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic5,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#Hawaiian/ Pacific Islander
dt_hawi= data_tib_base %>%  filter(data_tib_base$D_384191091_D_384191091_D_586825330==1)  

dt_hawi= dt_hawi %>%  mutate(multb2 = ifelse(D_115616118_D_115616118_D_664730658==1, 1, 0) + ifelse(D_115616118_D_115616118_D_949727109==1, 1, 0) + ifelse(D_115616118_D_115616118_D_496132363==1, 1, 0) + 
                                             ifelse(D_115616118_D_115616118_D_453456270==1, 1, 0) + ifelse(D_115616118_D_115616118_D_819018322==1, 1, 0) + ifelse(D_115616118_D_115616118_D_685406566==1, 1, 0) + ifelse(D_115616118_D_115616118_D_786290435==1, 1, 0) + ifelse(D_115616118_D_115616118_D_167028305==1, 1, 0) + ifelse(D_115616118_D_115616118_D_345861266==1, 1, 0) +  ifelse(D_115616118_D_115616118_D_807835037==1, 1, 0) + ifelse(D_115616118_D_115616118_D_746038746==1, 1, 0))

                                                       
which_eth= dt_hawi %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                    D_115616118_D_115616118_D_664730658==1 ~ "Chamorro",
                                             D_115616118_D_115616118_D_949727109==1 ~ "Chuukese",
                                             D_115616118_D_115616118_D_496132363==1 ~ "Fijian",
                                             D_115616118_D_115616118_D_453456270==1 ~ "Marshallese",
                                             D_115616118_D_115616118_D_819018322==1 ~ "Hawaiian",
                                             D_115616118_D_115616118_D_685406566==1 ~ "Palauan",
                                             D_115616118_D_115616118_D_786290435==1 ~ "Samoan",
                                             D_115616118_D_115616118_D_167028305==1 ~ "Tahitian",
                                             D_115616118_D_115616118_D_345861266==1 ~ "Tongan",
                                             (D_115616118_D_115616118_D_807835037==1 | !is.na(D_115616118_D_403180970)) ~ "Other",
                                             D_115616118_D_115616118_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE   ~ "Skipped this question"))

dt_hawi_summary <- which_eth %>% group_by(ethnicity) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage)

dt_ethnic6 <- dt_hawi_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of Hawaiian or Pacific Islander Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic6,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic6,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)


#White
dt_white= data_tib_base %>% filter(data_tib_base$D_384191091_D_384191091_D_412790539==1) 

dt_white= dt_white %>%  mutate(multb2 = ifelse(D_797626610_D_797626610_D_664571574==1, 1, 0) + ifelse(D_797626610_D_797626610_D_163149180==1, 1, 0) + ifelse(D_797626610_D_797626610_D_192776753==1, 1, 0) + 
                                             ifelse(D_797626610_D_797626610_D_733789220==1, 1, 0) + ifelse(D_797626610_D_797626610_D_418464677==1, 1, 0) + ifelse(D_797626610_D_797626610_D_859329001==1, 1, 0) + ifelse(D_797626610_D_797626610_D_267472307==1, 1, 0) + ifelse(D_797626610_D_797626610_D_918190932==1, 1, 0) + ifelse(D_797626610_D_797626610_D_381749264==1, 1, 0) + ifelse(D_797626610_D_797626610_D_704661219==1, 1, 0) + ifelse(D_797626610_D_797626610_D_773342525==1, 1, 0) +  ifelse(D_797626610_D_797626610_D_807835037==1, 1, 0) + ifelse(D_797626610_D_797626610_D_746038746==1, 1, 0))


which_eth= dt_white %>%  mutate(ethnicity= case_when(as.numeric(multb2)>1 ~ "Multi-Ethnic",
                                                     D_797626610_D_797626610_D_664571574==1 ~ "Ducth",
                                             D_797626610_D_797626610_D_163149180==1 ~ "English",
                                             D_797626610_D_797626610_D_192776753==1 ~ "European",
                                             D_797626610_D_797626610_D_733789220==1 ~ "French",
                                             D_797626610_D_797626610_D_418464677==1 ~ "German",
                                             D_797626610_D_797626610_D_859329001==1 ~ "Irish",
                                             D_797626610_D_797626610_D_267472307==1 ~ "Italian",
                                             D_797626610_D_797626610_D_918190932==1 ~ "Norwegian",
                                             D_797626610_D_797626610_D_381749264==1 ~ "Polish",
                                             D_797626610_D_797626610_D_704661219==1 ~ "Scottish",
                                             D_797626610_D_797626610_D_773342525==1 ~ "Spanish",
                                             (D_797626610_D_797626610_D_807835037==1 | !is.na(D_797626610_D_774928994)) ~ "Other",
                                             D_797626610_D_797626610_D_746038746==1 ~ "Prefer Not to Answer",
                                             TRUE   ~ "Skipped this question"))

dt_white_summary <- which_eth %>% group_by(ethnicity) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(ethnicity, n, percentage)
gtm3_print <- gt(dt_white_summary)

dt_ethnic7 <- dt_white_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Ethnicity of White Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), ethnicity = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = ethnicity,
    )
  ) %>% opt_row_striping()
tab_footnote(
  dt_ethnic7,
  md("The denomination of this table is all participants who selected this race/etnicity only, as well as multi-racial participants that selected this race/ethnicity as well as other race/ethnicities."),
  locations = cells_column_labels(columns = n),
  placement = c("left")
)
tab_footnote(
  dt_ethnic7,
  md("Multi-ethnic in this table is defined as participants that selected multiple ethnicity responses."),
  locations = cells_column_labels(columns = ethnicity),
  placement = c("left")
)

```


## SEX/ SEX2/ GENDER/ SEXORIENT
```{r, warning=FALSE,echo=FALSE}

simple_funct1(D_407056417, "Sex at birth")


#simple_funct1(D_289664241_D_289664241, "Gender")

style= data_tib_base  %>%  mutate(descr= case_when(D_289664241_D_289664241==536341288 | D_289664241_D_289664241==218837028 ~ "Woman",
                                               D_289664241_D_289664241==654207589 | D_289664241_D_289664241==983318667 ~ "Man",
                                               D_289664241_D_289664241==405267600 ~ "Transgender Man",
                                               D_289664241_D_289664241==873138103 ~ "Transgender Woman",
                                               D_289664241_D_289664241==805712793 ~ "Genderqueer",
                                               D_289664241_D_289664241==486192236 ~ "Non-binary",
                                               D_289664241_D_289664241==807835037 ~ "Other",
                                               D_289664241_D_289664241==746038746 ~ "Declined",
                                               TRUE ~ "Skipped this question"))

style$descr <- factor(style$descr,levels=c("Woman", "Man", "Transgender Man", "Transgender Woman", "Genderqueer", "Non-binary", "Other", "Declined", "Skipped this question"))

dt_appearence_summary <- style  %>% dplyr::group_by(descr) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(descr, n, percentage) 


dtgender <- dt_appearence_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("Gender")) %>%
  cols_label(n= md("**Number of Participants**"),descr = md("**Description**"), percentage = md("**Percentage of Participants**")) %>%
    # summary_rows( groups=F,
    # column = c(participants,percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = descr,
    )
   ) %>% opt_row_striping()
tab_footnote(
  dtgender,
  md("These response options are mutually exclusive categories; only one response may be selected."),
  locations = cells_column_labels(columns = descr),
  placement = c("left")
)


# SEX2

dt_sex2= data_tib_base %>% filter(D_407056417==576796184) 

dt_sex2= dt_sex2 %>%  mutate(multb2 = ifelse(D_750420077_D_846483618==1, 1, 0) + ifelse(D_750420077_D_505282171==1, 1, 0) + ifelse(D_750420077_D_578416151==1, 1, 0) + 
                               ifelse(D_750420077_D_434651539==1, 1, 0) + ifelse(D_750420077_D_108025529==1, 1, 0) + ifelse(D_750420077_D_582784267==1, 1, 0) + ifelse(D_750420077_D_751402477==1, 1, 0) +
                               ifelse(D_750420077_D_700100953==1, 1, 0) )


which_sex2= dt_sex2 %>%  mutate(body_part= case_when(as.numeric(multb2)>1 ~ "Multiple Body Parts",
                                                     D_750420077_D_582784267==1 ~ "Penis",
                                             D_750420077_D_751402477==1 ~ "Testes",
                                             D_750420077_D_700100953==1 ~ "Prostate Gland",
                                             D_750420077_D_846483618==1 ~ "Vagina",
                                             D_750420077_D_505282171==1 ~ "Cervix",
                                             D_750420077_D_578416151==1 ~ "Uterus",
                                             D_750420077_D_434651539==1 ~ "Ovaries",
                                             D_750420077_D_108025529==1 ~ "Fallopian Tubes",
                                             TRUE   ~ "Skipped this question"))

dt_sex2_summary <- which_sex2 %>% group_by(body_part) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(body_part, n, percentage)
gtm3_print <- gt(dt_white_summary)

dt_sex2_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Body Part of Intersex Participants")) %>% 
  cols_label(n= md("**Number of Participants**"), body_part = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = body_part,
    )
  ) %>% opt_row_striping()





#Appearance/Style

style= data_tib_base  %>%  mutate(descr= case_when(D_987107433==220083334 ~ "Very Feminine",
                                               D_987107433==541300533 ~ "Mostly Feminine",
                                               D_987107433==878286618 ~ "Somewhat Feminine",
                                               D_987107433==910745276 ~ "Equally Feminine and Masculine",
                                               D_987107433==915528806 ~ "Very Masculine",
                                               D_987107433==265452386 ~ "Mostly Masculine",
                                               D_987107433==510148951 ~ "Somewhat Masculine",
                                               TRUE ~ "Skipped this question"))

style$descr <- factor(style$descr,levels=c("Very Feminine", "Mostly Feminine", "Somewhat Feminine", "Equally feminine and masculine", "Very masculine", "Mostly Masculine", "Somewhat Masculine", "Skipped this question"))

dt_appearence_summary <- style  %>% dplyr::group_by(descr) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(descr, n, percentage) 


dt_appearence_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("STYLE: Appearence, Style, Dress, Mannerisms")) %>%
  cols_label(n= md("**Number of Participants**"),descr = md("**Description**"), percentage = md("**Percentage of Participants**")) %>%
    # summary_rows( groups=F,
    # column = c(participants,percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = descr,
    )
   ) %>% opt_row_striping()




simple_funct1(D_555481393_D_555481393, "SEXORIETNT: Sexual Orienation")




```



## LANG
```{r, include=FALSE}

which_lang= data_tib_base %>%  mutate(language= case_when(D_588212264_D_588212264_D_163149180==1 ~ "English",
                                                          D_588212264_D_588212264_D_773342525==1 ~ "Spanish",
                                                          D_588212264_D_588212264_D_918819379==1 ~ "Spanish Creole",
                                                          D_588212264_D_588212264_D_733789220==1 ~ "French",
                                                          D_588212264_D_588212264_D_760008937==1 ~ "French Creole",
                                                          D_588212264_D_588212264_D_267472307==1 ~ "Italian",
                                                          D_588212264_D_588212264_D_563857306==1 ~ "Portuguese",
                                                          D_588212264_D_588212264_D_418464677==1 ~ "German",
                                                          D_588212264_D_588212264_D_236546933==1 ~ "Russian",
                                                          D_588212264_D_588212264_D_381749264==1 ~ "Polish",
                                                          D_588212264_D_588212264_D_553424289==1 ~ "Hindi",
                                                          D_588212264_D_588212264_D_750168061==1 ~ "Chinese",
                                                          D_588212264_D_588212264_D_240721579==1 ~ "Korean",
                                                          D_588212264_D_588212264_D_964924704==1 ~ "Vietnamese",
                                                          D_588212264_D_588212264_D_964924704==1 ~ "Tagalog",
                                                          D_588212264_D_588212264_D_367462243==1 ~ "Ilocano",
                                                          D_588212264_D_588212264_D_288079668==1 ~ "Japanese",
                                                          D_588212264_D_588212264_D_669977999==1 ~ "Arabic",
                                                          (D_588212264_D_588212264_D_807835037==1 | !is.na(D_588212264_D_486535201)) ~ "Other",
                                                          TRUE   ~ "Skipped this question"))

dt_language_summary <- which_lang %>% group_by(language) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(language, n, percentage)

dt_language_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("LANG: Language Spoken in Childhood Home")) %>% 
  cols_label(n= md("**Number of Participants**"), language = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = language,
    )
  ) %>% opt_row_striping()




 
tmp1Lang<- data_tib_base[, grepl("588212264", colnames(data_tib_base))]

tmp1Lang <- tmp1Lang[, c(2, 18, 20,15,17,5,13,9, 3,8, 12, 16, 4, 21,  11, 7, 6, 14, 19)]

lang_dx <- NULL
for (i in 1:19){
  dt <- as.data.frame(tab1(tmp1Lang[,i])$output.table)
  dt$lang_dx <- colnames(tmp1Lang)[i]
  lang_dx <- rbind(lang_dx,dt[2,])
  
}
lang_dx$lang_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

lang_dx$lang_dx <- c("English", "Spanish", "Spanish Creole", "French", "French Creole", "Italian", "Portuguese", "German", "Russian", "Polish", "Hindi", "Chinese","Korean", "Vietnamese", "Tagalog", "Ilocano", "Japanese", "Arabic", "Other")

```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(lang_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- lang_dx[, c(4,1,2)]
# 
# colnames(lang_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- lang_dx[, c(4,1,2)]

colnames(lang_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
lang1 <- lang_dx[, c(4,1,2)]

skipped_lang1 <- sum(table(which_lang$language=="Skipped this question")[2])
lang1[as.numeric(dim(lang1)[[1]])+1,] <- c("Skipped this Question", skipped_lang1, round((skipped_lang1/dim(data_tib_base)[[1]])*100,2))


dt_lang1 <- lang1 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("LANG: Language Spoken in Childhood Home")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_lang1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```


## SKINCANC, SKINCANC2 
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##Cancer
#Ever diagnosed
simple_funct1(D_537153788, "SKINCANC: Diagnosed with Non-Melanoma Skin Cancer")



skincnc_type= base_vars %>%  filter(base_vars$D_537153788==353358909) %>%  mutate(Type= case_when(D_508846529_D_864052438==1 & D_508846529_D_323177352==0~"Basal Cell",
                                                    D_508846529_D_323177352==1 & D_508846529_D_864052438==0 ~ "Squamous Cell",
                                                    D_508846529_D_323177352==1 & D_508846529_D_864052438==1 ~ "Both",
                                                    D_508846529_D_178420302==1 ~ "Unknown",
                                                    TRUE ~ "Skipped This Question"))
skincnc_type$Type <- factor(skincnc_type$Type,levels=c("Basal Cell", "Squamous Cell", "Both", "Unknown", "Skipped This Question"))

dt_skincnc_type_summary <- skincnc_type %>% dplyr::group_by(Type) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Type, n, percentage)


dt_skincnc_type_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SKINCANC2: Type(s) or Skin Cancer Diagnosed")) %>% 
  cols_label(n= md("**Number of Participants**"),Type = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Type,
    )
  ) %>% opt_row_striping()


boxp_funct(D_904550680_D_206625031, "Age Diagnosed with Skin Cancer", "Age")

```


## MH GROUP1
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}


mhgroup1COUNT= data_tib_base %>%  mutate(cardiov= case_when(D_167101091_D_698944820==1 ~ "B-12 Deficiency",
                                             D_167101091_D_838744325==1 ~ "Coronary Artery",
                                             D_167101091_D_769790179==1 ~ "Congestive Heart Failure",
                                             D_167101091_D_699553344==1 ~ "High Cholesterol",
                                             D_167101091_D_700811160==1 ~ "Heart Attack",
                                             D_167101091_D_336505365==1 ~ "Abnormal Heart Rhythm",
                                             D_167101091_D_132548932==1 ~ "Chest Pain",
                                             D_167101091_D_747787163==1 ~ "Heart Valve Problems",
                                             D_167101091_D_693851465==1 ~ "High Blood Pressure",
                                             D_167101091_D_512012656==1 ~ "Blood Clots",
                                             D_167101091_D_619337095==1 ~ "Stroke",
                                             D_167101091_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))
  
dt_cardiov_summary <- mhgroup1COUNT  %>% dplyr::group_by(cardiov) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(cardiov, n, percentage) 


gt_mh1<- dt_cardiov_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP1: Diagnosed Cardiovascular Conditions")) %>% 
  cols_label(cardiov = md("**Answer**"), n= md("**Number of Participants**"),percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = cardiov,
    )
  ) %>% opt_row_striping()




 
tmp1<- data_tib_base[, grepl("167101091", colnames(data_tib_base))]
cardio_dx <- NULL
for (i in 1:12){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$cardio_dx <- colnames(tmp1)[i]
  cardio_dx <- rbind(cardio_dx,dt[2,])
  
}
cardio_dx$cardio_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

cardio_dx$cardio_dx <- c("Chest Pain","Abnormal Heart Rhythm","Blood Clots","None","Stroke","High Blood Pressure","B-12 Deficiency","High Cholesterol","Heart Attack","Heart Valve Problems","Congestive Heart Failure","Coronary Artery")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(cardio_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- cardio_dx[, c(4,1,2)]
# 
# colnames(cardio_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- cardio_dx[, c(4,1,2)]

colnames(cardio_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
mgr1 <- cardio_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(mhgroup1COUNT$cardiov=="Skipped this question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_base)[[1]])*100,2))


dt_mgr1 <- mgr1 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP1: Diagnosed Cardiovascular Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  Condition = md("**Answer**")) %>% 
  # summary_rows( groups=F,
  #   column = c(Frequency,Percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```




```{r, warning=FALSE, echo=FALSE, message=FALSE}
# bq <- bq_project_query(project, query="SELECT Connect_ID, token, d_512820379,d_821247024,d_230663853,d_919254129,d_699625233,state_d_684926335,state_d_849518448,state_d_119643471,state_d_706256705, state_d_435027713,state_d_934298480,d_827220437,d_914594314,d_471593703,
# 
#                state_d_158291096,d_311580100,d_914639140,d_878865966,d_167958071, d_684635302, d_100767870,
# 
#                 d_949302066,d_536735468,d_663265240,d_976570371 FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE d_821247024 ='197316935'")
# 
#  
# 
# pd <- bq_table_download(bq,bigint="integer64")
# 
#  
# 
# numbers_only <- function(x) !grepl("\\D", x)
# 
#  
# 
# ###convert the numeric
# 
# recr <- pd
# 
# cnames <- names(recr)
# 
# ###to check variables in recr_noinact_wl1
# 
# for (i in 1: length(cnames)){
# 
#   varname <- cnames[i]
# 
#   var<-pull(recr,varname)
# 
#   recr[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
# 
# }
# 
#  
# 
# dt <- recr[which(recr$d_512820379 != 180583933),] #0 removeal
# 
# dt <- recr[which (recr$d_821247024 != 922622075 | recr$d_512820379 !=486306141),] #248 active duplicates removed
# 
# 
# Q167101091 <- data_tib_base %>% select(Connect_ID, all_of(contains("167101091"))) %>%   mutate(TotalQ=rowSums(pick(c(2:13))))
# 
# recr_D_167101091<- merge(dt,Q167101091,by="Connect_ID")
# 
# recr_D_167101091cplt <- filter(recr_D_167101091, d_821247024==197316935 & d_949302066 == 231311385) %>%
# 
#   mutate(Q_sum=rowSums(all_of(contains("167101091"))))
# 
# 
# col1_pct <- function(x){paste0(sum(x), " ( ",round(100*sum(x)/length(x),2), "%)")}
# 
# recr_D_167101091cplt <- filter(recr_D_167101091, d_821247024==197316935 & d_949302066 == 231311385) %>%
# 
#   mutate(D_167101091_No_reply = ifelse(rowSums(is.na(pick(contains("167101091")))) ==12, 1, 0))
# 
#  
# 
#  
# 
#  
# 
# answer1 <- as.data.frame(colSums(recr_D_167101091cplt[,grepl("167101091",colnames(recr_D_167101091cplt))],na.rm=TRUE))
# 
# names(answer1) <- "Count"
# 
# answer1$CID <- as.numeric(sapply(strsplit(rownames(answer1),"_"),tail,1))
# 
#  
# 
# answer1.lables <- unique(dd[grepl(paste(answer1$CID, collapse="|"),dd$CID),c("CID","Variable Label")])
# 
# answer <- merge(answer1,answer1.lables, by.x="CID",by.y="CID", all.x=TRUE)
# 
#  
# 
# total <- as.numeric(length(recr_D_167101091cplt$Connect_ID))
# 
# answer$percent <- paste(round(100*answer$Count/total,2), "%", sep=" ")
# 
# answer$`Variable Label`[is.na(answer$`Variable Label`)] <- "skip questions"
# 
# colnames(answer)[which(colnames(answer) == "Variable Label")] <- "Questions"
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
# 
# dd <- dplyr::bind_rows(dictionary,.id="CID")
# 
# #dd <- dd[!duplicated(dd),] #remove 140duplicates
# 
# #THIS TABLE HAS REPLICATED (CIDS+LABELS) WITH DIFFERENT VARIABLE NAMES,
# 
# dd$`Variable Label` <- ifelse(is.na(dd$`Variable Label`), dd$`Variable Name`, dd$`Variable Label`)
# 
#  
# 
# col1_pct <- function(x){paste0(sum(x), " ( ",round(100*sum(x)/length(x),2), "%)")}
# 
# recr_D_167101091cplt <- filter(recr_D_167101091, d_821247024==197316935 & d_949302066 == 231311385) %>%
# 
#   mutate(D_167101091_No_reply = ifelse(rowSums(is.na(pick(contains("167101091")))) ==12, 1, 0)) #this is the merged data set of M1 and recruitment with the complete M1
# 
#  
# 
# answer1 <- as.data.frame(colSums(recr_D_167101091cplt[,grepl("167101091",colnames(recr_D_167101091cplt))],na.rm=TRUE))
# 
# names(answer1) <- "Count"
# 
# answer1$CID <- as.numeric(sapply(strsplit(rownames(answer1),"_"),tail,1))
# 
#  
# 
# answer1.lables <- unique(dd[grepl(paste(answer1$CID, collapse="|"),dd$CID),c("CID","Variable Label")])
# 
# answer <- merge(answer1,answer1.lables, by.x="CID",by.y="CID", all.x=TRUE)
# 
#  
# 
# total <- as.numeric(length(recr_D_167101091cplt$Connect_ID))
# 
# answer$percent <- paste(round(100*answer$Count/total,2), "%", sep=" ")
# 
# answer$`Variable Label`[is.na(answer$`Variable Label`)] <- "skip questions"
# 
# colnames(answer)[which(colnames(answer) == "Variable Label")] <- "Questions"

```


## MH GROUP2
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup2= data_tib_base %>%  mutate(resp= case_when(D_894259747_D_359025642==1 ~ "Chronic Lung Disease",
                                             D_894259747_D_407340134==1 ~ "Asthma",
                                             D_894259747_D_427219143==1 ~ "Hay Fever",
                                             D_894259747_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_resp_summary <- mhgroup2  %>% dplyr::group_by(resp) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(resp, n, percentage)


gt_mh2<- dt_resp_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("MHGROUP2: Diagnosed Respiratory Conditions")) %>%
  cols_label(n= md("**Number of Participants**"), resp = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = resp,
    )
  ) %>% opt_row_striping()



tmp2<- data_tib_base[, grepl("894259747", colnames(data_tib_base))]
lung_dx <- NULL
for (i in 1:4){
  dt <- as.data.frame(tab1(tmp2[,i])$output.table)
  dt$lung_dx <- colnames(tmp2)[i]
  lung_dx <- rbind(lung_dx,dt[2,])
  
}

lung_dx$lung_dx <- c("Chronic lung disease","Asthma", "Hay Fever", "None")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(lung_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "lung_dx")
mgr2 <- lung_dx[, c(4,1,2)]

skipped_mhg2 <- sum(table(mhgroup2$resp=="Skipped this question")[2])
mgr2[as.numeric(dim(mgr2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg2, round((skipped_mhg2/dim(data_tib_base)[[1]])*100,2))


dt_mgr2 <- mgr2 %>%  gt(rowname_col = "row_lab") %>% 
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP2: Diagnosed Respiratory Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  lung_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = lung_dx,
    )
  ) %>% 
tab_footnote(
    footnote = "As this is a select all question, participants may select multiple responses.",
    locations=cells_column_labels(Percentage)
  ) %>%
  tab_footnote(
    footnote = md("Hay Fever includes Allergy to pollen or Allergic Rhinitis."),
    locations=cells_column_labels(lung_dx)
  )

dt_mgr2


```


## MH GROUP3
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup3= data_tib_base %>%  mutate(digest= case_when(D_180961306_D_406890409==1 ~ "Esophageal Acid Reflex",
                                             D_180961306_D_704544306==1 ~ "Barrett's Esophagus",
                                             D_180961306_D_691766591==1 ~ "Irritable Bowel Syndrome",
                                             D_180961306_D_308645635==1 ~ "Inflammatory Bowel Disease",
                                             D_180961306_D_731115613==1 ~ "Diverticulitis or Diverticulosis",
                                             D_180961306_D_567284980==1 ~ "Ulcerative Colitis",
                                             D_180961306_D_986548173==1 ~ "Crohn's Disease",
                                             D_180961306_D_285995100==1 ~ "Celiac Disease",
                                             D_180961306_D_545628561==1 ~ "Gallstones",
                                             D_180961306_D_709786039==1 ~ "Liver Cirrhosis",
                                             D_180961306_D_984479578==1 ~ "Pancreatitis",
                                             D_180961306_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_digest_summary <- mhgroup3  %>% dplyr::group_by(digest) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(digest, n, percentage) 


gt_mh3<- dt_digest_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP3: Diagnosed Digestive System Problems")) %>% 
  cols_label(n= md("**Number of Participants**"),digest = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = digest,
    )
  ) %>% opt_row_striping()




tmp3<- data_tib_base[, grepl("180961306", colnames(data_tib_base))]
dgst_dx <- NULL
for (i in 1:12){
  dt <- as.data.frame(tab1(tmp3[,i])$output.table)
  dt$dgst_dx <- colnames(tmp3)[i]
  dgst_dx <- rbind(dgst_dx,dt[2,])
  
}

dgst_dx$dgst_dx
dgst_dx$dgst_dx <- c("Celiac Disease", "Inflammatory Bowel Disease","Esophageal Acid Reflex","None","Gallstones","Ulcerative Colitis","Irritable Bowel Syndrome","Barrett's Esophagus","Liver Cirrhosis","Diverticulitis or Diverticulosis","Pancreatitis","Crohn's Disease")

```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(dgst_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "dgst_dx")
mgr3 <- dgst_dx[, c(4,1,2)]

skipped_mhg3 <- sum(table(mhgroup3$digest=="Skipped this question")[2])
mgr3[as.numeric(dim(mgr3)[[1]])+1,] <- c("Skipped this Question", skipped_mhg3, round((skipped_mhg3/dim(data_tib_base)[[1]])*100,2))


dt_mgr3 <- mgr3 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP3: Diagnosed Digestive System Problems")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"), dgst_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = dgst_dx,
    )
  )
tab_footnote(
  dt_mgr3,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)


```


## MH GROUP4
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup4= data_tib_base %>%  mutate(thy_d_g= case_when(D_900541533_D_726539692==1 ~ "Thyroid Disorder", 
                                             D_900541533_D_158044532==1 ~ "Diabetes",
                                             D_900541533_D_943054522==1 ~ "Graves' Disease",
                                             D_900541533_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_thy_d_g_summary <- mhgroup4 %>%  dplyr::group_by(thy_d_g) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(thy_d_g, n, percentage) 

gt_mh4<- dt_thy_d_g_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP4: Diagnosed with Any of These Conditions")) %>% 
  cols_label(n= md("**Number of Participants**"),thy_d_g = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = thy_d_g,
    )
  ) %>% opt_row_striping()




tmp4<- data_tib_base[, grepl("900541533", colnames(data_tib_base))]
thyrd_dx <- NULL
for (i in 1:4){
  dt <- as.data.frame(tab1(tmp4[,i])$output.table)
  dt$thyrd_dx <- colnames(tmp4)[i]
  thyrd_dx <- rbind(thyrd_dx,dt[2,])
  
}
thyrd_dx$thyrd_dx
thyrd_dx$thyrd_dx <- c("Diabetes",  "None", "Thyroid Disorder", "Graves' Disease")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(thyrd_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "thyrd_dx")
mgr4 <- thyrd_dx[, c(4,1, 2)]

skipped_mhg4 <- sum(table(mhgroup4$thy_d_g=="Skipped this question")[2])
mgr4[as.numeric(dim(mgr4)[[1]])+1,] <- c("Skipped this Question", skipped_mhg4, round((skipped_mhg4/dim(data_tib_base)[[1]])*100,2))


dt_mgr4 <- mgr4 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP4: Diagnosed with Any of These Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"),Percentage=md("**Percentage of Participants**"), thyrd_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = thyrd_dx,
    )
  )
tab_footnote(
  dt_mgr4,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```


## DM
```{r, warning=FALSE, echo=FALSE, message=FALSE}
dict <- c(dict, "146477090"="Type 1", "573635975"="Type 2")
one_logic_funct(D_494032093, D_900541533_D_158044532, 1, "Type of Diabetes")

# 
# diebts= data_tib_base %>% filter(D_900541533_D_158044532==1) %>%   mutate(meds= case_when(D_494032093=="146477090"~"Type 1",
#                                                D_494032093=="573635975"~"Type 2",
#                                                D_494032093=="178420302"~"Unknown",
#                                                TRUE  ~ "Skipped this question"))
# 
# 
# dtdiebts_summary <- diebts %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)
# 
# 
# dtdiebts_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("DM: Type of Diebetes")) %>% 
#   cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#     stub.font.weight = "bold"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = meds,
#     )
#   ) %>% opt_row_striping()

```

## MH GROUP5
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}
mhgroup5= data_tib_base %>%  mutate(kidn= case_when(D_874046190_D_827542780==1 ~ "Kidney Stones", 
                                             D_874046190_D_167238688==1 ~ "Chronic Kindey Disease",
                                             D_874046190_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_kidn_summary <- mhgroup5 %>% dplyr::group_by(kidn) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(kidn, n, percentage) 

gt_mh5<- dt_kidn_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP5: Diagnosed with Kidney Conditions")) %>% 
  cols_label(n= md("**Number of Participants**"), kidn = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = kidn,
    )
  ) %>% opt_row_striping()




tmp5<- data_tib_base[, grepl("874046190", colnames(data_tib_base))]
kidn_dx <- NULL
for (i in 1:3){
  dt <- as.data.frame(tab1(tmp5[,i])$output.table)
  dt$kidn_dx <- colnames(tmp5)[i]
  kidn_dx <- rbind(kidn_dx,dt[2,])
  
}
kidn_dx$kidn_dx
kidn_dx$kidn_dx <- c("Chronic Kindey Disease",  "None", "Kidney Stones")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(kidn_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "kidn_dx")
mgr5 <- kidn_dx[, c(4,1, 2)]

skipped_mhg5 <- sum(table(mhgroup5$kidn=="Skipped this question")[2])
mgr5[as.numeric(dim(mgr5)[[1]])+1,] <- c("Skipped this Question", skipped_mhg5, round((skipped_mhg5/dim(data_tib_base)[[1]])*100,2))



dt_mgr5 <- mgr5 %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP5: Diagnosed with Kidney Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"), kidn_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = kidn_dx,
    )
  )
tab_footnote(
  dt_mgr5,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


## MH GROUP6
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup6= data_tib_base %>%  mutate(sysoth= case_when(D_543728565_D_636030086==1 ~ "Rheumatoid Arthritis", 
                                             D_543728565_D_239687183==1 ~ "Lupus",
                                             D_543728565_D_134592375==1 ~ "Gout",
                                             D_543728565_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_sysoth_summary <- mhgroup6 %>% dplyr::group_by(sysoth) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(sysoth, n, percentage)


gt_mh6<- dt_sysoth_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP6: Diagnosed with Systemic Conditions")) %>% 
  cols_label(n= md("**Number of Participants**"), sysoth = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = sysoth,
    )
  ) %>% opt_row_striping()




tmp6<- data_tib_base[, grepl("543728565", colnames(data_tib_base))]
systm_dx <- NULL
for (i in 1:4){
  dt <- as.data.frame(tab1(tmp6[,i])$output.table)
  dt$systm_dx <- colnames(tmp6)[i]
  systm_dx <- rbind(systm_dx,dt[2,])
  
}
systm_dx$systm_dx
systm_dx$systm_dx <- c("Gout", "Lupus",  "None", "Rheumatoid Arthritis")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(systm_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "systm_dx")
mgr6 <- systm_dx[, c(4,1, 2)]

skipped_mhg6 <- sum(table(mhgroup6$sysoth=="Skipped this question")[2])
mgr6[as.numeric(dim(mgr6)[[1]])+1,] <- c("Skipped this Question", skipped_mhg6, round((skipped_mhg6/dim(data_tib_base)[[1]])*100,2))



dt_mgr6 <- mgr6 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP6: Diagnosed with Systemic Conditions")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"), systm_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = systm_dx,
    )
  )
tab_footnote(
  dt_mgr6,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


## MH GROUP7
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup7= data_tib_base %>%  mutate(sti_std= case_when(D_874709643_D_164910211==1 ~ "Mono",
                                             D_874709643_D_796616844==1 ~ "Shingles",
                                             D_874709643_D_436689514==1 ~ "Chronic Hepatitus B or C",
                                             D_874709643_D_296357383==1 ~ "Gonorrhea",
                                             D_874709643_D_901077233==1 ~ "Chlamydia",
                                             D_874709643_D_136956596==1 ~ "Trich",
                                             D_874709643_D_455776698==1 ~ "Syphilis",
                                             D_874709643_D_155874194==1 ~ "Genital Warts",
                                             D_874709643_D_880962432==1 ~ "HPV",
                                             D_874709643_D_691450854==1 ~ "HIV/AIDS",
                                             D_874709643_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_sti_std_summary <- mhgroup7 %>% dplyr::group_by(sti_std) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(sti_std, n, percentage)

gt_mh7<- dt_sti_std_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%  
  tab_header(title = md("MHGROUP7: Diagnosed Infections or Diseases")) %>% 
  cols_label(n= md("**Number of Participants**"), sti_std = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = sti_std,
    )
  ) %>% opt_row_striping()



tmp7<- data_tib_base[, grepl("874709643", colnames(data_tib_base))]
sti_dx <- NULL
for (i in 1:11){
  dt <- as.data.frame(tab1(tmp7[,i])$output.table)
  dt$sti_dx <- colnames(tmp7)[i]
  sti_dx <- rbind(sti_dx,dt[2,])
  
}
sti_dx$sti_dx
sti_dx$sti_dx <- c("Trich", "Genital Warts", "Mono","Gonorrhea", "Chronic Hepatitus B or C", "Syphilis", "None","HIV/AIDS","Shingles","HPV","Chlamydia")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(sti_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "sti_dx")
mgr7 <- sti_dx[, c(4,1, 2)]

skipped_mhg7 <- sum(table(mhgroup7$sti_std=="Skipped this question")[2])
mgr7[as.numeric(dim(mgr7)[[1]])+1,] <- c("Skipped this Question", skipped_mhg7, round((skipped_mhg7/dim(data_tib_base)[[1]])*100,2))



dt_mgr7 <- mgr7 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP7: Diagnosed Infections or Diseases")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  sti_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = sti_dx,
    )
  )

tab_footnote(
  dt_mgr7,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


## MH GROUP8
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup8= data_tib_base %>%  mutate(urn_repro= case_when(D_725626004_D_509721537==1 ~ "Uterine Fibroids",
                                             D_725626004_D_863286658==1 ~ "Endometriosis",
                                             D_725626004_D_386524148==1 ~ "Polycystic Ovary System",
                                             D_725626004_D_937208760==1 ~ "Enlarged Prostate",
                                             D_725626004_D_746542057==1 ~ "Fibrocystic Breast or Benign Breast isease",
                                             D_725626004_D_854945381==1 ~ "Ductal Carcinoma in situ",
                                             D_725626004_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_urn_repro_summary <- mhgroup8 %>% dplyr::group_by(urn_repro) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(urn_repro, n, percentage)

gt_mh8<- dt_urn_repro_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP8: Diagnosed Urinary and Reproductive Problems")) %>% 
  cols_label(n= md("**Number of Participants**"), urn_repro = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = urn_repro,
    )
  ) %>% opt_row_striping()



tmp8<- data_tib_base[, grepl("725626004", colnames(data_tib_base))]
urinrp_dx <- NULL
for (i in 1:7){
  dt <- as.data.frame(tab1(tmp8[,i])$output.table)
  dt$urinrp_dx <- colnames(tmp8)[i]
  urinrp_dx <- rbind(urinrp_dx,dt[2,])
  
}
urinrp_dx$urinrp_dx
urinrp_dx$urinrp_dx <- c("Polycystic Ovary System", "Uterine Fibroids", "None", "Fibrocystic Breast or Benign Breast isease","Ductal Carcinoma in situ","Endometriosis","Enlarged Prostate")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(urinrp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "urinrp_dx")
mgr8 <- urinrp_dx[, c(4,1, 2)]

skipped_mhg8 <- sum(table(mhgroup8$urn_repro=="Skipped this question")[2])
mgr8[as.numeric(dim(mgr8)[[1]])+1,] <- c("Skipped this Question", skipped_mhg8, round((skipped_mhg8/dim(data_tib_base)[[1]])*100,2))



dt_mgr8 <- mgr8 %>%  gt(rowname_col = "row_lab") %>% 
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP8: Diagnosed Urinary and Reproductive Problems")) %>% 
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  urinrp_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = urinrp_dx,
    )
  )
tab_footnote(
  dt_mgr8,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```


## BREASTDISC4
```{r, warning=FALSE, echo=FALSE, message=FALSE}

one_logic_funct(D_852236900, D_725626004_D_854945381, 1, "BREASTDIS4: DCIS Confirmed with Biopsy")


# breast_d4= data_tib_base %>% filter(D_725626004_D_854945381==1) %>%  mutate(meds= case_when(D_852236900==353358909 ~ "Yes",
#                                                D_852236900==104430631 ~ "No",
#                                                TRUE  ~ "Skipped this question"))
# 
# 
# dtbreast_d4_summary <- breast_d4 %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)
# 
# 
# dtbreast_d4_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("BREASTDIS4: DCIS Confirmed with Biopsy")) %>% 
#   cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#     stub.font.weight = "bold"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = meds,
#     )
#   ) %>% opt_row_striping()

```
## DEPRESS
```{r, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct1(D_347860896, "DEPRESS: Diagnosed with Clinical Depression")

# dprss= data_tib_base %>%  mutate(meds= case_when(D_347860896==353358909 ~ "Yes",
#                                                D_347860896==104430631 ~ "No",
#                                                TRUE  ~ "Skipped this question"))
# 
# 
# dtdprss_summary <- dprss %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)
# 
# 
# dtdprss_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("DEPRESS: Diagnosed with Clinical Depression")) %>% 
#   cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#     stub.font.weight = "bold"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = meds,
#     )
#   ) %>% opt_row_striping()

```


## MH GROUP9
```{r, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

mhgroup9= data_tib_base %>%  mutate(surgery= case_when(D_624179836_D_797189152==1 ~ "Tonsillectomy",
                                             D_624179836_D_633546100==1 ~ "Cholecystectomy",
                                             D_624179836_D_866002271==1 ~ "Appendectomy",
                                             D_624179836_D_118789503==1 ~ "Liposuction",
                                             D_624179836_D_715563991==1 ~ "Gastric Bypass",
                                             D_624179836_D_533491176==1 ~ "Breast Surgery",
                                             D_624179836_D_220755749==1 ~ "Hysterectomy", 
                                             D_624179836_D_465318416==1 ~ "Tubal Ligation",
                                             D_624179836_D_630100221==1 ~ "Oophorectomy",
                                             D_624179836_D_692881833==1 ~ "Salpingectomy",
                                             D_624179836_D_654450030==1 ~ "Vasectomy",
                                             D_624179836_D_532603425==1 ~ "Orchiectomy or Orchidectomy",
                                             D_624179836_D_733236542==1 ~ "Prostatectomy",
                                             D_624179836_D_961987554==1 ~ "Penectomy",
                                             D_624179836_D_535003378==1 ~ "None",
                                             TRUE ~ "Skipped this question"))

dt_surgery_summary <- mhgroup9 %>% dplyr::group_by(surgery) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(surgery, n, percentage)

gt_mh9<- dt_surgery_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP9: Surgeries Had")) %>% 
  cols_label(n= md("**Number of Participants**"),surgery = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = surgery,
    )
  ) %>% opt_row_striping()



tmp9<- data_tib_base[, grepl("624179836", colnames(data_tib_base))]
srgy_dx <- NULL
for (i in 1:15){
  dt <- as.data.frame(tab1(tmp9[,i])$output.table)
  dt$srgy_dx <- colnames(tmp9)[i]
  srgy_dx <- rbind(srgy_dx,dt[2,])
  
}
srgy_dx$srgy_dx
srgy_dx$srgy_dx <- c("Liposuction", "Hysterectomy", "Tubal Ligation","Orchiectomy or Orchidectomy","Breast Surgery","None","Oophorectomy","Cholecystectomy","Vasectomy","Salpingectomy","Gastric Bypass","Prostatectomy", "Tonsillectomy","Appendectomy","Penectomy")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(srgy_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "srgy_dx")
mgr9 <- srgy_dx[, c(4,1, 2)]

skipped_mhg8 <- sum(table(mhgroup9$surgery=="Skipped this question")[2])
mgr9[as.numeric(dim(mgr9)[[1]])+1,] <- c("Skipped this Question", skipped_mhg8, round((skipped_mhg8/dim(data_tib_base)[[1]])*100,2))


dt_mgr9 <- mgr9 %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MHGROUP9: Surgeries Had")) %>% 
  cols_label(Frequency= md("**Number of Participants**"),  Percentage=md("**Percentage of Participants**"), srgy_dx = md("**Answer**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = srgy_dx,
    )
  )  %>% 
tab_footnote(
    footnote = "As this is a select all question, participants may select multiple responses.",
    locations=cells_column_labels(Percentage)
  ) %>%
  tab_footnote(
    footnote = md("Breast Surgyeries include: Breast implants, Mastopexy, Breast reconstruction, Breast reduction, Breast-Conserving Surgery (BCS), Lumpectomy, Partial Mastectomy, Segmental Mastectomy, Mastectomy, Double Mastectomy, Bilateral Mastectomy, Surgery for a breast abscess, Microdochectomy."),
    locations=cells_column_labels(srgy_dx)
  )

dt_mgr9


```

## OVERHEALTH
```{r, warning=FALSE, echo=FALSE, message=FALSE}

##Overall
#dict <- c(dict,"131550264"="Fair","138752522"="Poor","565881164"="Very Good","670680466"="Excellent","719933364"="Good")

health= data_tib_base   %>%  mutate(status= case_when(D_875208305==131550264 ~ "Fair",
                                                      D_875208305==138752522 ~ "Poor", 
                                                      D_875208305==565881164 ~ "Very Good",
                                                      D_875208305==670680466 ~ "Excellent",
                                                      D_875208305==719933364 ~ "Good",
                                                      TRUE ~ "Skipped This Question"))

health$status <- factor(health$status,levels=c("Poor", "Fair", "Good", "Very Good", "Excellent", "Skipped This Question"))

dt_overall_summary <- health %>% dplyr::group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage) 

dt_overall_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("OVERHEALTH: General Health Rating")) %>% 
  cols_label(n= md("**Number of Participants**"), status = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,column = c(n,percentage), 
  #              fns= list( Sum= ~sum(.)), 
  #              decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = status,)) %>% 
  opt_row_striping()

```


## BMI
```{r, echo=FALSE, warning=FALSE, message=FALSE}
data_tib_base$D_114314839_D_340854069=as.numeric(data_tib_base$D_114314839_D_340854069)
data_tib_base$D_114314839_D_600462977=as.numeric(data_tib_base$D_114314839_D_600462977)

data_tib_base$in_D_inches= (ifelse(is.na(data_tib_base$D_114314839_D_340854069), 0,(data_tib_base$D_114314839_D_340854069*12)))+ 
  (ifelse(is.na(data_tib_base$D_114314839_D_600462977), 0, (data_tib_base$D_114314839_D_600462977))) 

data_tib_base$D_746012894=as.numeric(data_tib_base$D_746012894) 
data_tib_base$D_746012894=round(data_tib_base$D_746012894, digits=0)

data_tib_base= data_tib_base %>%  mutate(BMI= (D_746012894/in_D_inches^2)*703)

bmi_box= data_tib_base %>%  filter(!is.na(BMI)) %>%  ggplot(aes(x=BMI))+
    xlab("Score") + geom_boxplot()+  ggtitle("BMI Distribution of Participants") + xlim(c(0,100))

bmi_box

```


## Primary Relative Diagnosed with Cancer
### This Inludes Parents, Siblings, and Children
```{r, echo=FALSE, warning=FALSE, message=FALSE}

# degree1_cancer= module3 %>%  filter(ifelse(D_276353712==353358909 | D_659784914==353358909 | D_607773106_1_1==353358909 | D_607773106_2_2==353358909 | 
#                                       D_607773106_3_3==353358909 | D_607773106_4_4==353358909 | D_607773106_5_5==353358909 | D_607773106_6_6==353358909 |
#                                       D_607773106_7_7==353358909| D_607773106_8_8==353358909 | D_607773106_9_9==353358909| D_607773106_10_10==353358909 |
#                                       D_607773106_11_11==353358909 | D_607773106_12_12==353358909 | D_607773106_13_13==353358909 | D_718867914_1_1==353358909 | 
#                                       D_718867914_2_2==353358909 | D_718867914_3_3==353358909 | D_718867914_4_4==353358909 | D_718867914_5_5==353358909 |
#                                       D_718867914_6_6==353358909 | D_718867914_7_7==353358909 | D_718867914_8_8==353358909 | D_718867914_9_9==353358909 |
#                                       D_718867914_10_10==353358909), 1, 0)



family= data_tib_base  %>%  mutate(status= case_when((D_276353712==353358909 | D_659784914==353358909 | D_607773106_1_1==353358909 | D_607773106_2_2==353358909 | 
                                      D_607773106_3_3==353358909 | D_607773106_4_4==353358909 | D_607773106_5_5==353358909 | D_607773106_6_6==353358909 |
                                      D_607773106_7_7==353358909| D_607773106_8_8==353358909 | D_607773106_9_9==353358909| D_607773106_10_10==353358909 |
                                      D_607773106_11_11==353358909 | D_607773106_12_12==353358909 | D_607773106_13_13==353358909 | D_718867914_1_1==353358909 | 
                                      D_718867914_2_2==353358909 | D_718867914_3_3==353358909 | D_718867914_4_4==353358909 | D_718867914_5_5==353358909 |
                                      D_718867914_6_6==353358909 | D_718867914_7_7==353358909 | D_718867914_8_8==353358909 | D_718867914_9_9==353358909 |
                                      D_718867914_10_10==353358909) ~ "Yes", 
                                                    TRUE ~ "No"))
# family$percentage <- round(family$percentage, digits=2)
# dt_fam_canc_summary <- family %>% group_by(status) %>%   summarize_at(c("freq", "percentage"), sum, na.rm = TRUE)
# 
# knitr::kable(dt_fam_canc_summary,col.names=c("Diagnosed","Number of Participants" , "Percentage of Participants"), caption='Primary Relative(s) Diagnosed With Cancer')
# #,row.names=FALSE, align=c("l","c","c","c"), booktabs = TRUE )
# 
# dt_fam_canc_summary %>%  gt() %>%  ## why is this not a proper gt_tbl??
#   fmt_number(columns = "percentage", decimals = 2) %>%
#   tab_header(title = md("Primary Relative(s) Diagnosed With Cancer")) %>%
#   cols_label(status = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
#     summary_rows(
#     column = percentage,
#     fns= list(
#       Sum= ~sum(.)
#     ), decimals=0) %>%
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = status,
#     )
#   ) %>% opt_row_striping()



dt_fam_canc_summary <- family %>% group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage)


dt_fam_canc_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Primary Relative(s) Diagnosed With Cancer")) %>% 
  cols_label(n= md("**Number of Participants**"), status = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  ) %>% opt_row_striping()

```



## MOMCANC & MOMCANC2
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#cancer? 
simple_funct1(D_276353712, "MOMCANC: Mother Diagnosed with Cancer")


#MOMCANC2
#type:
dt_mom_cnc= data_tib_base %>% filter(D_276353712==353358909) 

momcnc= dt_mom_cnc  %>%  mutate(multc = ifelse(D_814510313_D_814510313_D_939782495==1, 1, 0) + ifelse(D_814510313_D_814510313_D_135725957==1, 1, 0) + ifelse(D_814510313_D_814510313_D_518416174==1, 1, 0) + ifelse(D_814510313_D_814510313_D_847945207==1, 1, 0) + ifelse(D_814510313_D_814510313_D_283025574==1, 1, 0) + ifelse(D_814510313_D_814510313_D_942970912==1, 1, 0) + ifelse(D_814510313_D_814510313_D_596122041==1, 1, 0) + ifelse(D_814510313_D_814510313_D_489400183==1, 1, 0) + ifelse(D_814510313_D_814510313_D_863246236==1, 1, 0) + ifelse(D_814510313_D_814510313_D_607793249==1, 1, 0) + ifelse(D_814510313_D_814510313_D_532172400==1, 1, 0) + ifelse(D_814510313_D_814510313_D_754745617==1, 1, 0) + ifelse(D_814510313_D_814510313_D_665036297==1, 1, 0) + ifelse(D_814510313_D_814510313_D_200837530==1, 1, 0) +  ifelse(D_814510313_D_814510313_D_990319383==1, 1, 0) + ifelse(D_814510313_D_814510313_D_603181162==1, 1, 0) + ifelse(D_814510313_D_814510313_D_482225200==1, 1, 0) + ifelse(D_814510313_D_814510313_D_764891959==1, 1, 0) + ifelse(D_814510313_D_814510313_D_139822395==1, 1, 0) + ifelse(D_814510313_D_814510313_D_487917585==1, 1, 0) + ifelse(D_814510313_D_814510313_D_723614811==1, 1, 0) + ifelse(D_814510313_D_814510313_D_807835037==1, 1, 0) + ifelse(D_814510313_D_814510313_D_178420302==1, 1, 0) )

momcnc= momcnc  %>%  mutate(cancer= case_when(as.numeric(multc)>1 ~ "Multiple Cancer Types",
                                              D_814510313_D_814510313_D_939782495==1 ~ "Anal",
                                             D_814510313_D_814510313_D_135725957==1 ~ "Bladder",
                                             D_814510313_D_814510313_D_518416174==1 ~ "Brain",
                                             D_814510313_D_814510313_D_847945207==1 ~ "Breast",
                                             D_814510313_D_814510313_D_283025574==1 ~ "Cervical",
                                             D_814510313_D_814510313_D_942970912==1 ~ "Colon/Rectal",
                                             D_814510313_D_814510313_D_596122041==1 ~ "Esophageal",
                                             D_814510313_D_814510313_D_489400183==1 ~ "Head, Neck, and Shoulders",
                                             D_814510313_D_814510313_D_863246236==1 ~ "Kidney",
                                             D_814510313_D_814510313_D_607793249==1 ~ "Leukemia",
                                             D_814510313_D_814510313_D_532172400==1 ~ "Liver",
                                             D_814510313_D_814510313_D_754745617==1 ~ "Lung",
                                             D_814510313_D_814510313_D_665036297==1 ~ "Non-Hodgkin's Lymphoma",
                                             D_814510313_D_814510313_D_200837530==1 ~ "Lymphoma",
                                             D_814510313_D_814510313_D_990319383==1 ~ "Melanoma Skin",
                                             D_814510313_D_814510313_D_487917585==1 ~ "Non-Melanoma Skin",
                                             D_814510313_D_814510313_D_603181162==1 ~ "Ovarian",
                                             D_814510313_D_814510313_D_482225200==1 ~ "Pancreatic",
                                             D_814510313_D_814510313_D_764891959==1 ~ "Stomach",
                                             D_814510313_D_814510313_D_139822395==1 ~ "Thyroid",
                                             D_814510313_D_814510313_D_723614811==1 ~ "Uterine",
                                             (D_814510313_D_814510313_D_807835037==1 | !is.na(D_814510313_D_677702321)) ~ "Other",
                                             D_814510313_D_814510313_D_178420302==1 ~ "Unknown",
                                             TRUE ~ "Skipped this question"))

dt_mom_cnc_summary <- momcnc %>%  dplyr::group_by(cancer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(cancer, n, percentage)

dt___mom_cnc_summary <- dt_mom_cnc_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MOMCANC2 Mom's Diagnosed Cancer Type")) %>% 
  cols_label(n= md("**Number of Participants**"), cancer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = cancer,
    )
  ) %>% opt_row_striping()

```

```{r, include=FALSE}

tmpMOMCANC <- data_tib_base %>%  filter(data_tib_base$D_276353712==353358909)
tmpMC2<- tmpMOMCANC[, grepl("814510313", colnames(tmpMOMCANC))]
tmpMC2$D_814510313_D_677702321 <- ifelse(is.na(tmpMC2$D_814510313_D_677702321), 0, 1)


# tmp2_1 <- data_tib_all2 %>%  select(D_814510313_D_814510313_D_939782495, D_814510313_D_814510313_D_135725957, D_814510313_D_814510313_D_518416174, D_814510313_D_814510313_D_847945207, D_814510313_D_814510313_D_283025574,
#D_814510313_D_814510313_D_942970912, D_814510313_D_814510313_D_596122041, D_814510313_D_814510313_D_489400183, D_814510313_D_814510313_D_863246236, D_814510313_D_814510313_D_607793249, D_814510313_D_814510313_D_532172400,
#D_814510313_D_814510313_D_754745617, D_814510313_D_814510313_D_665036297, D_814510313_D_814510313_D_200837530, D_814510313_D_814510313_D_990319383, D_814510313_D_814510313_D_487917585, D_814510313_D_814510313_D_603181162, D_814510313_D_814510313_D_482225200,
#D_814510313_D_814510313_D_764891959, D_814510313_D_814510313_D_139822395, D_814510313_D_814510313_D_723614811, D_814510313_D_814510313_D_807835037, D_814510313_D_814510313_D_178420302)

tmpM2 <- tmpMC2[, c(25,2,10,23,6, 
                    26,12, 9,24, 14, 11, 
                    20, 17, 5, 27, 8, 13, 7, 
                    21, 3,19, 22,  4)]
momcnc_dx <- NULL
for (i in 1:23){
  dt <- as.data.frame(tab1(tmpM2[,i])$output.table)
  dt$momcnc_dx <- colnames(tmpM2)[i]
  momcnc_dx <- rbind(momcnc_dx,dt[2,])

}



#momcnc_dx$momcnc_dx 

#momcnc_dx$momcnc_dx <- c("Other specified", "Pergonal", "hCG", "Nolvadex", "Seophene", "Danocrine", "Lupron depot", "Milophene", "None of the above", "Clomid", "Danazol", "Gonadotropins", "Synarel nasal solution", "Other specified-double nested", "Other Medication")
momcnc_dx$momcnc_dx <- c("Anal", "Bladder", "Brain", "Breast", "Cervical", "Colon/Rectal", "Esophageal", "Head, Neck and Shoulders", "Kidney", "Leukemia", "Liver", "Lung", "Non-Hodgkin's Lymphoma", "Lymphoma", "Melanoma", "Non-Melanoma Skin", "Ovarian", "Pancreatic", "Stomach", "Thyroid", "Uterine", "Other", "Unknown")
```

```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(momcnc_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
mgr1 <- momcnc_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(momcnc$cancer=="Skipped this question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_base)[[1]])*100,2))

dt_mgr1 <- mgr1 %>%  gt(rowname_col = "row_lab") %>%
  tab_header(title = md("MOMCANC2 Mom's Diagnosed Cancer Type")) %>%
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  Condition = md("**Answer**")) %>%
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```




## DADCANC & DADCANC2
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#cancer? 
simple_funct1(D_659784914, "DADCANC: Father Diagnosed with Cancer")



#DADCANC2
#type:
dt_dad_cnc= data_tib_base %>%   filter(D_659784914==353358909) 

dt_dad_cnc= dt_dad_cnc  %>%  mutate(multc = ifelse(D_173240848_D_173240848_D_939782495==1, 1, 0) + ifelse(D_173240848_D_173240848_D_135725957==1, 1, 0) + ifelse(D_173240848_D_173240848_D_518416174==1, 1, 0) + ifelse(D_173240848_D_173240848_D_847945207==1, 1, 0) + ifelse(D_173240848_D_173240848_D_942970912==1, 1, 0) + ifelse(D_173240848_D_173240848_D_596122041==1, 1, 0) + ifelse(D_173240848_D_173240848_D_489400183==1, 1, 0) + ifelse(D_173240848_D_173240848_D_863246236==1, 1, 0) + ifelse(D_173240848_D_173240848_D_607793249==1, 1, 0) + ifelse(D_173240848_D_173240848_D_532172400==1, 1, 0) + ifelse(D_173240848_D_173240848_D_754745617==1, 1, 0) + ifelse(D_173240848_D_173240848_D_665036297==1, 1, 0) + ifelse(D_173240848_D_173240848_D_200837530==1, 1, 0) + ifelse(D_173240848_D_173240848_D_990319383==1, 1, 0) +   ifelse(D_173240848_D_173240848_D_482225200==1, 1, 0) + ifelse(D_173240848_D_173240848_D_764891959==1, 1, 0) + ifelse(D_173240848_D_173240848_D_139822395==1, 1, 0) + ifelse(D_173240848_D_173240848_D_248374037==1, 1, 0) + ifelse(D_173240848_D_173240848_D_807835037==1, 1, 0) + ifelse(D_173240848_D_173240848_D_178420302==1, 1, 0) + ifelse(D_173240848_D_173240848_D_295976386==1, 1, 0) )


dadcnc= dt_dad_cnc  %>%  mutate(cancer= case_when(as.numeric(multc)>1 ~ "Multiple Cancer Types",
                                                  D_173240848_D_173240848_D_939782495==1 ~ "Anal",
                                             D_173240848_D_173240848_D_135725957==1 ~ "Bladder",
                                             D_173240848_D_173240848_D_518416174==1 ~ "Brain",
                                             D_173240848_D_173240848_D_847945207==1 ~ "Breast",
                                             D_173240848_D_173240848_D_942970912==1 ~ "Colon/Rectal",
                                             D_173240848_D_173240848_D_596122041==1 ~ "Esophageal",
                                             D_173240848_D_173240848_D_489400183==1 ~ "Head, Neck, and Shoulders",
                                             D_173240848_D_173240848_D_863246236==1 ~ "Kidney",
                                             D_173240848_D_173240848_D_607793249==1 ~ "Leukemia",
                                             D_173240848_D_173240848_D_532172400==1 ~ "Liver",
                                             D_173240848_D_173240848_D_754745617==1 ~ "Lung",
                                             D_173240848_D_173240848_D_665036297==1 ~ "Non-Hodgkin's Lymphoma",
                                             D_173240848_D_173240848_D_200837530==1 ~ "Lymphoma",
                                             D_173240848_D_173240848_D_990319383==1 ~ "Melanoma Skin",
                                             D_173240848_D_173240848_D_487917585==1 ~ "Non-Melanoma Skin",
                                             D_173240848_D_173240848_D_482225200==1 ~ "Pancreatic",
                                             D_173240848_D_173240848_D_295976386==1 ~ "Prostate",
                                             D_173240848_D_173240848_D_764891959==1 ~ "Stomach",
                                             D_173240848_D_173240848_D_248374037==1 ~ "Testicular",
                                             D_173240848_D_173240848_D_139822395==1 ~ "Thyroid",
                                             (D_173240848_D_173240848_D_807835037==1 | !is.na(D_173240848_D_195093589)) ~ "Other",
                                             D_173240848_D_173240848_D_178420302==1 ~ "Unknown",
                                             TRUE ~ "Skipped this question"))

dt_dad_cnc_summary <- dadcnc %>% dplyr::group_by(cancer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(cancer, n, percentage)  

dt___dad_cnc_summary <- dt_dad_cnc_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("DADCANC2: Father's Diagnosed Cancer Type")) %>% 
  cols_label(n= md("**Number of Participants**"), cancer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = cancer,
    )
  ) %>% opt_row_striping()

```


```{r, include=FALSE}

tmpDADCANC <- data_tib_base %>%  filter(data_tib_base$D_659784914==353358909)
tmpMC2<- tmpDADCANC[, grepl("173240848", colnames(tmpDADCANC))]
tmpMC2$D_173240848_D_195093589 <- ifelse(is.na(tmpMC2$D_173240848_D_195093589), 0, 1)


tmpM2 <- tmpMC2[, c(21,1,11,19,22,13,
                    10,20, 14,12, 16, 15,
                    5, 23,9, 8, 17, 2, 6,
                    18, 3,7)]
DADcnc_dx <- NULL
for (i in 1:22){
  dt <- as.data.frame(tab1(tmpM2[,i])$output.table)
  dt$DADcnc_dx <- colnames(tmpM2)[i]
  DADcnc_dx <- rbind(DADcnc_dx,dt[2,])

}


DADcnc_dx$DADcnc_dx <- c("Anal", "Bladder", "Brain", "Breast", "Colon/Rectal", "Esophageal", "Head, Neck and Shoulders", "Kidney", "Leukemia", "Liver", "Lung", "Non-Hodgkin's Lymphoma", "Lymphoma", "Melanoma", "Non-Melanoma Skin", "Pancreatic", "Prostate", "Stomach", "Testicular", "Thyroid",  "Other", "Unknown")
```

```{r, warning=FALSE, echo=FALSE, message=FALSE}
colnames(DADcnc_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
mgr1 <- DADcnc_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dadcnc$cancer=="Skipped this question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_base)[[1]])*100,2))

dt_mgr1 <- mgr1 %>%  gt(rowname_col = "row_lab") %>%
  tab_header(title = md("DADCANC2 DAD's Diagnosed Cancer Type")) %>%
  cols_label(Frequency= md("**Number of Participants**"), Percentage=md("**Percentage of Participants**"),  Condition = md("**Answer**")) %>%
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #grand_summary_rows(columns=c(Frequency, Percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```




## EDU
```{r, warning=FALSE, echo=FALSE, message=FALSE}

edu= data_tib_base  %>%  mutate(edlevel= case_when(D_367803647_D_367803647==978204320 ~ "Grade School(Grades 1-8)",
                                                  D_367803647_D_367803647==935502060 ~ "Some High School, No Diploma",
                                                  D_367803647_D_367803647==404564707 ~ "High School Graduate or GED",
                                                  D_367803647_D_367803647==432193665 ~ "Some College, No Degree",
                                                  D_367803647_D_367803647==890756124 ~ "Technical or Trade School After High School",
                                                  D_367803647_D_367803647==766964355 ~ "Associate's Degree",
                                                  D_367803647_D_367803647==875342283 ~ "Bachelor's Degree",
                                                  D_367803647_D_367803647==598242454 ~ "Advanced Degree",
                                                  D_367803647_D_367803647==807835037 ~ "Other",
                                                  TRUE ~ "Skipped This Question"))

edu$edlevel <- factor(edu$edlevel,levels=c("Grade School(Grades 1-8)", "Some High School, No Diploma", "High School Graduate or GED","Some College, No Degree","Technical or Trade School After High School","Associate's Degree","Bachelor's Degree","Advanced Degree", "Other", "Skipped This Question"))

dt_edu_summary <- edu %>% dplyr::group_by(edlevel) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(edlevel, n, percentage)

dt_edu_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("EDU: Highest Level of School Completed")) %>% 
  cols_label(n= md("**Number of Participants**"), edlevel = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
    # summary_rows( groups=F,column = c(n,percentage), fns= list( Sum= ~sum(.)), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = edlevel,)) %>% opt_row_striping()

```

## INCOME
```{r,  warning=FALSE, echo=FALSE}

inc= data_tib_base  %>%  mutate(status= case_when(D_759004335==209571450 ~ "35,000-49,000",
                                                  D_759004335==212249150 ~ "50,000-74,000",
                                                  D_759004335==374508062 ~ "0-9,000",
                                                  D_759004335==530094502 ~ "Error- Unlisted Response Selected", 
                                                  D_759004335==742032816 ~ "200,000+", 
                                                  D_759004335==745561936 ~ "25,000-34,000",
                                                  D_759004335==746038746 ~ "Prefer not to Answer",
                                                  D_759004335==777814771 ~ "75,000-99,000", 
                                                  D_759004335==913602274 ~ "150,000-199,000", 
                                                  D_759004335==922395188 ~ "100,000-149,000",
                                                  D_759004335==976555124 ~ "10,000-24,000",
                                                  D_759004335==178420302 ~ "Unknown",
                                                  TRUE ~ "Skipped This Question"))

inc$status <- factor(inc$status,levels=c("0-9,000","10,000-24,000","25,000-34,000","35,000-49,000","50,000-74,000","75,000-99,000","100,000-149,000","150,000-199,000",
                                         "200,000+","Prefer not to Answer","Unknown","Error- Unlisted Response Selected","Skipped This Question"))

dt_income_summary <- inc  %>% dplyr::group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage)   

dt_income_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Household Income")) %>% 
  cols_label(n= md("**Number of Participants**"), status = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
    #summary_rows(column = c(participants,percentage), fns= list( Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = status,)) %>% opt_row_striping()

```


## ALTADDRESS1
```{r, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct1(D_646504105, "ALTADDRESS1: Any Other Mailing Address")


# alt_add1= data_tib_base %>%  mutate(meds= case_when(D_646504105==353358909 ~ "Yes",
#                                                D_646504105==104430631 ~ "No",
#                                                TRUE  ~ "Skipped this question"))
# 
# 
# dtalt_add1_summary <- alt_add1 %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)
# 
# 
# dtalt_add1_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("ALTADDRESS1: Any Other Mailing Address")) %>% 
#   cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(n,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#     stub.font.weight = "bold"
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = meds,
#     )
#   ) %>% opt_row_striping()

```




























\newpage



```{r, include=FALSE}

library(data.table)

######## Merge Version 1 and Version 2 of Module 2 ##############

dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')

dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")

project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" ##project and billing should be consistent
##517311251 Date/time Status of Completion of Background and Overall Health                         SrvBOH_TmComplete_v1r0
##949302066 Flag for Baseline Module Background and Overall Health                        SrvBOH_BaseStatus_v1r0
recr_m2 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379, 
                            d_536735468 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935'")
recr_m2 <- bq_table_download(recr_m2,bigint = "integer64")
cnames <- names(recr_m2)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m2,varname)
  recr_m2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

sql_m2_1 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v1_JP` where Connect_ID is not null")
sql_m2_2 <- bq_project_query(project, query="SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v2_JP` where Connect_ID is not null")


M2_V1 <- bq_table_download(sql_m2_1,bigint = "integer64") #1436 #1436 vars: 1507 01112023 
M2_V2 <- bq_table_download(sql_m2_2,bigint = "integer64") #2333 #3033 01112023 var:1531 #6339 obs 1893 vars 05022023

mod2_v1 <- M2_V1
cnames <- names(M2_V1)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod2_v1,varname)
  mod2_v1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}
mod2_v2 <- M2_V2
cnames <- names(M2_V2)
###to check variables and convert to numeric
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(mod2_v2,varname)
  mod2_v2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}

M2_V1.var <- colnames(M2_V1)
M2_V2.var <- colnames(M2_V2)
var.matched <- M2_V1.var[which(M2_V1.var %in% M2_V2.var)]
length(var.matched)  #1275 #1278 vars 01112023 #1348 vars 05022023

V1_only_vars <- colnames(M2_V1)[colnames(M2_V1) %nin% var.matched] #232 #229 01112023 #159 05022023
V2_only_vars <- colnames(M2_V2)[colnames(M2_V2) %nin% var.matched] #253 #253 01112023 #545 05022023

length(M2_V1$Connect_ID[M2_V1$Connect_ID %in% M2_V2$Connect_ID])
#[1] 59 with the completion of two versions of module2 
#[1] 62 with completing both versions of M1 ###double checked 03/28/2023
#68 double checked 05/02/2023

common.IDs <- M2_V1$Connect_ID[M2_V1$Connect_ID %in% M2_V2$Connect_ID]
M2_V1_common <- mod2_v1[,var.matched]

M2_V2_common <- mod2_v2[,var.matched]
M2_V1_common$version <- 1
M2_V2_common$version <- 2

##to check the completion of M1 among these duplicates
partM2_dups <- recr_m2[which(recr_m2$Connect_ID %in% common.IDs),]
table(partM2_dups$d_536735468)

M2_common  <- rbind(M2_V1_common, M2_V2_common) #including 136 duplicates (version 1 and version 2) from 68 participants 05022023
#M2_response <- matrix(data=NA, nrow=118, ncol=967)

M2_v1_only <- mod2_v1[,c("Connect_ID", V1_only_vars)] #230 vars 03282023 #160 vars 05/02/2023
M2_v2_only <- mod2_v2[,c("Connect_ID", V2_only_vars)] #255 vars 03282023 #546 vars 05/02/2023
M2_v1_only$version <- 1
M2_v2_only$version <- 2
#for (i in 1:length)
##to check the completion in each version
length(recr_m2$Connect_ID[which(recr_m2$Connect_ID %in% M2_v1_only$Connect_ID & recr_m2$d_536735468 ==231311385)]) #1364 03282023 # 1370 05022023
length(recr_m2$Connect_ID[which(recr_m2$Connect_ID %in% M2_v2_only$Connect_ID & recr_m2$d_536735468 ==231311385)]) #4870 03282023 # 5731 05022023

#library(janitor)

M2_common <- rbind(M2_V1_common,M2_V2_common)
M2_common_v1 <- base::merge(M2_common, M2_v1_only, by=c("Connect_ID","version"),all.x=TRUE)
M2_combined_v1v2 <- base::merge(M2_common_v1,M2_v2_only,by=c("Connect_ID","version"),all.x=TRUE)
M2_complete <- M2_combined_v1v2[which(M2_combined_v1v2$Connect_ID %in% recr_m2$Connect_ID[which(recr_m2$d_536735468 ==231311385 )]),] #7289 including duplicates 05022023

M2_complete <- M2_complete %>% arrange(desc(version)) 


M2_complete_nodup <- M2_complete[!duplicated(M2_complete$Connect_ID),] 
table(M2_complete_nodup$version)


M2_complete_nodup$Connect_ID <- as.numeric(M2_complete_nodup$Connect_ID)


merge_m2= left_join(merged, M2_complete_nodup, by="Connect_ID") #%>%  left_join(m3_data, by="Connect_ID")

```

```{r, warning=FALSE, echo=FALSE,  message=FALSE, collapse=TRUE}



#Mod1 completed
#module2 <- merge_m2 %>% filter(d_949302066==231311385)
#cat("Module 1 completed:", dim(module2)[[1]])

#Mod2 completed
module2 <- merge_m2 %>% filter(d_536735468==231311385)
#cat("Module 2 Completed:", dim(module2)[[1]])

data_tib_all2 <- as_tibble(module2)
``` 


```{r, warning=FALSE, echo=FALSE,  message=FALSE, include=FALSE}

hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% mutate(!!CID_SYM:=round(as.numeric(as.character(!!CID_SYM)), digits=0)) %>% 
     filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+ #, fill=as.factor(D_407056417)
     xlab(Xlab) + ylab(Ylab) + geom_histogram(binwidth = 0.5)+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) + 
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}


#Histogram for female at birth only questions
hist_funct_F <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  module2 %>% mutate(!!CID_SYM:=as.numeric(as.character(!!CID_SYM))) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+   ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}

hist_funct_D <- function(CID,Title, Xlab, Ylab) {
  #CID_SYM <- rlang::ensym(CID)
  module2 %>% ggplot(aes(x=CID))+ #, fill=as.factor(D_407056417)
     xlab(Xlab) + ylab(Ylab) + geom_histogram(binwidth = 0.5)+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(CID, na.rm=T)), colour="red", linetype="solid")
  
}




#GT table for questions asked to all (no skip logic)
simple_funct2 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_all2 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%  
  # summary_rows(
  #   columns = c(n,percentage),    
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) #%>% opt_row_striping()
}


#Error in `dplyr::mutate()`:
# ! Problem while computing `answer = recode(...)`.
# Caused by error in `FUN()`:
# ! 'recode': all recodings should be formula but: "(Whatever is the first entry into the dict)"
# Run `rlang::last_error()` to see where the error occurred.




#GT table with one filter/skip logic
one_logic_funct <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all2 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"),  answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}

``` 


## HORNONCISWOM
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Used hormones to reflect gender

hormn <- data_tib_all2 %>%  filter((D_407056417==654207589 | D_407056417==576796184) & (D_289664241_D_289664241==536341288 | D_289664241_D_289664241==218837028 | D_289664241_D_289664241==873138103 | D_289664241_D_289664241==805712793 | D_289664241_D_289664241==486192236 | D_289664241_D_289664241==807835037))

agep <- hormn %>%  mutate(age= case_when(D_798889867=="200323667"~"In the past yes",
                                      D_798889867=="249673703"~"Currently yes",
                                      TRUE ~ "Skipped this Question"))

dt_agep_summary <- agep %>% group_by(age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(age, n, percentage)


dt_agep_summary %>%  gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("HORNONCISWOM: Used Hormones to Make Body Look More Feminine")) %>% 
  cols_label(n= md("**Number of Participants**"), age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = age,
    )
  ) %>% opt_row_striping()

```



## PREG 1
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#Currently pregnant

one_logic_funct(D_849945160,  D_407056417, 536341288, "PREG: Currently Pregnant")

```













\newpage

```{r, include=FALSE}


querymod3 <- "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module3_v1_JP` where Connect_ID IS NOT NULL"
mod3_table <- bq_project_query(project, querymod3)
mod3_data <- bq_table_download(mod3_table, bigint = "integer64")
mod3_data$Connect_ID <- as.numeric(mod3_data$Connect_ID)


merge_m3P= left_join(merged, mod3_data, by="Connect_ID")

data_all3 <- merge_m3P %>% filter(d_976570371==231311385)

data_tib_all3 <- as_tibble(data_all3)


```

```{r, warning=FALSE, include=FALSE}
#Created Functions for this code

#Histogram 
hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+
    xlab(Xlab) + ylab(Ylab) +  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="red", linetype="solid")
  
}


#Boxplot
boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))
}


#Bar--times used
bar_totals_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
data_all3 %>% filter(!is.na(!!CID_SYM)) %>% ggplot(aes(x=!!CID_SYM)) +geom_bar()+ 
  ggtitle(Title)+xlab(Xlab)+ylab("Frequency") + 
  #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male")) +
  scale_x_discrete(labels=c("151488193"="10 or less", 
                            "805449318"="11-49",
                            "486319890"="50-99",
                            "132232896"="100+"))
}

#Bar--Frequency used 
bar_use_funct <- function(CID,Title){
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% filter(!is.na(!!CID_SYM)) %>% ggplot(aes(x=!!CID_SYM)) +geom_bar()+ 
    ggtitle(Title)+xlab("Frequency")+ylab("Count") +
    theme(axis.text.x = element_text(angle = 90))+
    scale_x_discrete(labels=c("419415087"="No, not at all", 
                              "299561721"="Yes, but rarely",
                              "716761013"="Yes, but some days",
                              "804785430"="Yes, every day"))
    #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))
}

#Bar--time frame used
bar_last_funct <- function(CID,Title){
  CID_SYM <- rlang::ensym(CID)
data_all3 %>% filter(!is.na(!!CID_SYM)) %>% ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+
  geom_bar()+ggtitle(Title)+xlab("Time Frame")+ylab("Count") +
  scale_x_discrete(labels=c("317567178"="In the past month", 
                            "484055234"="In the past year",
                            "802197176"="More than a year"))
  #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))
}

#Bar--time spent using
bar_life_A_C_funct <- function(CID,Title){
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% filter(!is.na(!!CID_SYM)) %>%ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+ 
  ylab("Frequency") + xlab("Time") + geom_bar()+  
  ggtitle(Title)+
  scale_x_discrete(labels=c("428999623"="0-14 minutes", 
                            "248303092"="16-30 min.",
                            "998679771"="31-59 min.",
                            "638092100"="1 hr",
                            "127455035"="2+ hrs"))
  #scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))
}

# #Bar--ALCLIFE2 grid
# alclife2_funct <- function(CID,Title){
#   CID_SYM <- rlang::ensym(CID)
# module3 %>% filter(!is.na(!!CID_SYM) & D_429228540==132232896) %>% ggplot(aes(x=!!CID_SYM)) +geom_bar()+ #& D_429228540==132232896 new skip logic
#   ggtitle(Title)+xlab("Frequency")+ylab("Count") +
#   theme(axis.text.x = element_text(angle = 90))+
#   scale_x_discrete(labels=c("265550580"="Didn't Drink ", 
#                             "950039557"="A few times per Year",
#                             "402048066"="A few times per Month",
#                             "522395860"="Once per Week",
#                             "756073829"="A few times per Week",
#                             "858624942"="Once per day",
#                             "424768954"="2-3 times per Day",
#                             "687445652"="4-5 times per Day",
#                             "333682419"="6+ times per Day")) 
#  # scale_fill_discrete(name = "Sex at Birth", labels=c("Female", "Male"))
# }

#DICT IS ON MERGED-MODULE-1-SUMMARY-STATISTICS.RMD
# dict <- list("104430631"="No", "353358909"="Yes", "589959753"="A little shorter", "623310018"="A lot shorter", "978204320"= "Grade School(Grades 1-8)", "935502060"="Some High School, No Diploma", "404564707"= "High School Graduate or GED", "432193665"="Some College, No Degree", "890756124"="Technical or Trade School After High School", "766964355"="Associate's Degree", "875342283"="Bachelor's Degree", "598242454"="Advanced Degree", "709650750"="Biological Child", "810290359"="Adopted Child", "509607548"="Step Child", "288105839"=" Yes, fraternal twins", "626558982"="Yes, triplets or higher multiple birth", "178420302"="Do not Know", "536341288"="Female", "576796184"="Intersex or Other", "654207589"="Male","555374628"="Full Sibling", "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", "274062548"="More than 3 months ago", "958538953"="In the past 3 months", "317567178"="In the past month", "484055234"="In the past year",  "802197176"="More than 1 year ago",  "0"="No", "1"="Yes", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago","958538953"="In the past 3 months",  "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible", "764708931"="Very flexible",  "428999623"="0-15 mins", "248303092"="16-30 mins", "998679771"="31-59 mins", "638092100"="1 hr", "127455035"="2 hrs" )

dict <- list("104430631"="No", "353358909"="Yes", "265550580"="Didn't Drink ", "950039557"="A few times per Year","402048066"="A few times per Month","522395860"="Once per Week",
             "756073829"="A few times per Week","858624942"="Once per day","424768954"="2-3 times per Day","687445652"="4-5 times per Day","333682419"="6+ times per Day", "595249233"="Less Than once per Month ", "637900673"="Once a month","207952166"="2-3 times per Month","198347104"="1-2 times per week","471294296"="3-4 times per Week","594557208"="5-6 times per Week","647504893"="Every Day", "428999623"="0-14 minutes", "248303092"="16-30 min.", "998679771"="31-59 min.","638092100"="1 hr","127455035"="2+ hrs", "419415087"="No, not at all", "299561721"="Yes, but rarely","716761013"="Yes, but some days","804785430"="Yes, every day", "151488193"="10 or less", "805449318"="11-49","486319890"="50-99","132232896"="100+", "317567178"="In the past month", "484055234"="In the past year", "802197176"="More than a year")


##GT TABLE: PRODUCT8C
dict <- list("104430631"="No", "353358909"="Yes")
funct_8c <- function(PRODUCT8C_CID, PRODUCT5_CID, Product1_CID, Title){  
  CID_SYM_P1 <- rlang::ensym(Product1_CID)
  CID_SYM_P8C <- rlang::ensym(PRODUCT8C_CID)
  CID_SYM_P5 <- rlang::ensym(PRODUCT5_CID)
  #dt_prod8C <- data_tib_all3[ , c("Connect_ID", !!CID_SYM_P8C, !!CID_SYM_P5, !!CID_SYM_P1)]
  
  dt_prod8C <- data_tib_all3 %>%  select(Connect_ID, !!CID_SYM_P8C, !!CID_SYM_P5, !!CID_SYM_P1)
  gt_prod8C <- dt_prod8C %>% filter((!!CID_SYM_P1==486319890 | !!CID_SYM_P1==132232896) & !!CID_SYM_P5!=317567178) %>% group_by(!!CID_SYM_P8C) %>% 
    summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM_P8C, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_prod8C %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n, percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}



##GT TABLE: PRODUCT9B
funct_9b <- function(PRODUCT1_CID, PRODUCT4_CID, PRODUCT5_CID, PRODUCT8C_CID, PRODUCT9B_CID, Title){ 
  CID_SYM_P1 <- rlang::ensym(PRODUCT1_CID)
  CID_SYM_P4 <- rlang::ensym(PRODUCT4_CID)
  CID_SYM_P5 <- rlang::ensym(PRODUCT5_CID)
  CID_SYM_P8C <- rlang::ensym(PRODUCT8C_CID)
  CID_SYM_P9B <- rlang::ensym(PRODUCT9B_CID)

  dt_prod9b <- data_tib_all3 %>%  select(Connect_ID, !!CID_SYM_P8C, !!CID_SYM_P4, !!CID_SYM_P5, !!CID_SYM_P1, !!CID_SYM_P9B)
  gt_prod9b <- dt_prod9b %>% filter((!!CID_SYM_P1==486319890 | !!CID_SYM_P1==132232896) & !(!!CID_SYM_P4== 804785430|
           ((!is.na(!!CID_SYM_P4) | !!CID_SYM_P4!=419415087) & !!CID_SYM_P5==484055234 & !!CID_SYM_P8C== 353358909) | 
           ((!is.na(!!CID_SYM_P4) |  !!CID_SYM_P4!=419415087) & !!CID_SYM_P5==802197176 & !!CID_SYM_P8C== 353358909))) %>% 
    group_by(!!CID_SYM_P9B) %>% 
    summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM_P9B, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)

  gt_prod9b %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n, percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}


#GT table for questions asked to all (no skip logic)
simple_funct3 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_all3 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}

#GT table with one filter/skip logic
one_logic_funct3 <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all3 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n, percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}




# ALCLLIFE functions
alclife2_funct <- function(CID, Title){  

  dt_alcl= data_tib_all3  %>%   filter(D_429228540==132232896 & !is.na(D_556837046_D_141874857) & (D_338467033==353358909 | (D_338467033==104430631 & !is.na(D_480426504))))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(CID==265550580 ~"Didn't Drink", 
                                                CID==950039557 ~"A few times per Year",
                                                CID==402048066 ~"A few times per Month",
                                                CID==522395860 ~"Once per Week",
                                                CID==756073829 ~"A few times per Week",
                                                CID==858624942 ~"Once per day",
                                                CID==424768954 ~"2-3 times per Day",
                                                CID==687445652 ~"4-5 times per Day",
                                                CID==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()
}



#GT table with two filters/skip logics----this one is having issues
# two_logic_funct <- function(CID, CID_prev, Prev_Answer, Prev_Answer_two, Title){  
#   CID_SYM <- rlang::ensym(CID)
#   CID_SYM_P <- rlang::ensym(CID_prev)
#   dt_select <- data_tib_m3 %>%  filter((!!CID_SYM_P == Prev_Answer) | (!!CID_SYM_P == Prev_Answer_two)) %>%  select(Connect_ID, !!CID_SYM) 
#   gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
#     replace_na(list(answer="Skipped this Question")) %>%  select(answer, percentage)
#   
#   gt_yn %>%  gt(rowname_col = "row_lab")  %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md(Title)) %>% 
#   cols_label(answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   summary_rows(
#     column = c(participants,percentage),
#     fns= list(
#       Sum= ~sum(.)
#     ), decimals=0) %>%
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = answer,
#     )
#   ) %>% opt_row_striping()
# }
# two_logic_funct(D_790436165_D_79043616, D_763164658, 486319890, 132232896, "CIG3_never: Smoking on a Regular Basis")
# 
# data_tib_m3_CIG <- data_tib_m3 %>%  filter(data_tib_m3$D_763164658==486319890| data_tib_m3$D_763164658==132232896)
# 
# dt_cig3 <- data_tib_m3_CIG[ , c("Connect_ID", "D_790436165_D_790436165_D_648960871")] 
# 
# dtCIG3= dt_cig3 %>%  mutate(participants=rep(1, dim(dt_cig3)[[1]]))
# 
# dtCIG3$percentage= (dtCIG3$participants/dim(dtCIG3)[[1]])*100 
# #dtCIG3= dtCIG3 %>%  mutate(percentage=(dtCIG3$participants/dim(dtCIG3)[[1]])*100) <--- doesn't work to avoid error message
# 
# 
# cig3_ans= dtCIG3 %>%  mutate(answer= case_when(D_790436165_D_790436165_D_648960871=="[]" ~ "Answered with age",
#                                              D_790436165_D_790436165_D_648960871=="[648960871]" ~ "Never smoked on a regular basis",
#                                              is.na(D_790436165_D_790436165_D_648960871) ~ "Skipped this question"))
# 
# dtCIG3_summary <- cig3_ans %>% group_by(answer) %>%   summarize_at(c("participants","percentage"), sum, na.rm = TRUE) 
# gtm3_print <- gt(dtCIG3_summary)
# #gtm3_print
# 
# dtCIG3_summary %>%  gt(rowname_col = "row_lab") %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("CIG3_never: Smoking on a Regular Basis")) %>% 
#   cols_label(answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   summary_rows(
#     column = c(participants,percentage),
#     fns= list(
#       Sum= ~sum(.)
#     ), decimals=0) %>%
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = answer,
#     )
#   ) %>% opt_row_striping()

```


## Frequency of Cigarette Smoking

```{r, echo=FALSE, warning=FALSE, message=FALSE}

cig_frequency= data_tib_all3  %>% 
  mutate(often= case_when((D_947205597_D_712653855==0 | (D_947205597_D_712653855==1 & (D_763164658==151488193| D_763164658==805449318)))~"Never a Cigarette Smoker",
                             (D_947205597_D_712653855==1 & (D_763164658==486319890| D_763164658==132232896) & D_798549704==317567178)~"Currently a Cigarette Smoker",
                             (D_947205597_D_712653855==1 & (D_763164658==486319890| D_763164658==132232896)  & (D_798549704==484055234 | D_798549704==802197176))~"Formerly a Cigarette Smoker",
                             TRUE~"Skipped all these questions"))

dt_cig_frequency_summary <- cig_frequency %>% group_by(often) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(often, n, percentage)


dt_cig_frequency_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Frequency of Cigarette Smoking")) %>% 
  cols_label(n= md("**Number of Participants**"), often = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = often,
    )
  ) %>% opt_row_striping()


```



## Frequency of Cigar Smoking

```{r, echo=FALSE, warning=FALSE, message=FALSE}


cigar_frequency= data_tib_all3  %>% 
  mutate(often= case_when(D_947205597_D_198133418==0 | (D_947205597_D_198133418==1 & (D_182431332==151488193| D_182431332==805449318))~"Never a Cigar Smoker",
                             D_947205597_D_198133418==1 & (D_182431332==486319890| D_182431332==132232896) & D_798549704==317567178~"Currently a Cigar Smoker",
                             D_947205597_D_198133418==1 & (D_182431332==486319890| D_182431332==132232896)  & (D_789271762==484055234 | D_789271762==802197176)~"Formerly a Cigar Smoker",
                             TRUE~"Skipped all These Questions"))



dt_cigar_frequency_summary <- cigar_frequency %>% group_by(often) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(often, n, percentage)

dt_cigar_frequency_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Frequency of Cigar Smoking")) %>% 
  cols_label(n= md("**Number of Participants**"), often = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = often,
    )
  ) %>% opt_row_striping()


```




## Frequency of E-cig Smoking

```{r, echo=FALSE, warning=FALSE, message=FALSE}


e_cig_frequency= data_tib_all3  %>% 
  mutate(often= case_when(D_947205597_D_706254326==0 | (D_947205597_D_706254326==1 & (D_624111331==151488193| D_624111331==805449318))~"Never a E-cigarette Smoker",
                             D_947205597_D_706254326==1 & (D_624111331==486319890| D_624111331==132232896) & D_238422161==317567178~"Currently a E-cigarette Smoker",
                             D_947205597_D_706254326==1 & (D_624111331==486319890| D_624111331==132232896)  & (D_238422161==484055234 | D_238422161==802197176)~"Formerly a E-cigarette Smoker",
                             TRUE~"Skipped all These Questions"))



dt_e_cig_frequency_summary <- e_cig_frequency %>% group_by(often) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(often, n, percentage)

dt_e_cig_frequency_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Frequency of Electronic Cigarette Smoking")) %>% 
  cols_label(n= md("**Number of Participants**"), often = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = often,
    )
  ) %>% opt_row_striping()


```





## Frequency of Cannabis Use

```{r, echo=FALSE, warning=FALSE, message=FALSE}


mj_frequency= data_tib_all3  %>% 
  mutate(often= case_when((D_830608495_D_535003378==1 | (D_830608495_D_760521319==1 & (D_319397722==151488193| D_319397722==805449318))) |
                            (D_830608495_D_158841370==1 & (D_524914900==151488193| D_524914900==805449318)) |
                            (D_830608495_D_349034127==1 & (D_325229459==151488193| D_325229459==805449318)) |
                            (D_830608495_D_713594719==1 & (D_101170268==151488193| D_101170268==805449318)) | 
                            (D_830608495_D_675129470==1 & (D_355689185==151488193| D_355689185==805449318)) ~"Never a Cannabis Smoker",
                          (D_830608495_D_760521319==1 & (D_319397722==486319890| D_319397722==132232896) & D_180308733==317567178) |
                            (D_830608495_D_158841370==1 & (D_524914900==486319890| D_524914900==132232896) & D_444759994==317567178) |
                            (D_830608495_D_349034127==1 & (D_325229459==486319890| D_325229459==132232896) & D_859228803==317567178) |
                            (D_830608495_D_713594719==1 & (D_101170268==486319890| D_101170268==132232896) & D_921663542==317567178) |
                            (D_830608495_D_675129470==1 & (D_355689185==486319890| D_355689185==132232896) & D_532755074==317567178) ~"Currently a Cannabis Smoker",
                          (D_830608495_D_760521319==1 & (D_319397722==486319890| D_319397722==132232896)  & (D_180308733==484055234 | D_180308733==802197176)) |
                            (D_830608495_D_158841370==1 & (D_524914900==486319890| D_524914900==132232896)  & (D_444759994==484055234 | D_444759994==802197176)) |
                            (D_830608495_D_349034127==1 & (D_325229459==486319890| D_325229459==132232896)  & (D_859228803==484055234 | D_859228803==802197176)) |
                            (D_830608495_D_713594719==1 & (D_101170268==486319890| D_101170268==132232896)  & (D_921663542==484055234 | D_921663542==802197176)) |
                            (D_830608495_D_675129470==1 & (D_355689185==486319890| D_355689185==132232896)  & (D_532755074==484055234 | D_532755074==802197176)) ~"Formerly a Cannabis Smoker",
                             TRUE~"Skipped all These Questions"))



dt_mj_frequency_summary <- mj_frequency %>% group_by(often) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(often, n, percentage)

dt_mj_frequency_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Frequency of Cannabis Smoking")) %>% 
  cols_label(n= md("**Number of Participants**"), often = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = often,
    )
  ) %>% opt_row_striping()
```


## ALCLIFE2, ALCLIFE5
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#ALCOHOL2

#one_logic_funct3(D_429228540,D_448968121, 353358909, "ALCOHOL2: Alcoholic Beverages in a Lifetime")
dt_ALC2= data_tib_all3  %>% filter(D_448968121==353358909)

ALC2_ans= dt_ALC2 %>%  mutate(answer= case_when(D_429228540=="151488193"~"10 or less",
                            D_429228540=="805449318"~"11-49",
                            D_429228540=="486319890"~"50-99",
                            D_429228540=="132232896"~"100+",
                            TRUE ~ "Skipped this question"))
ALC2_ans$answer <- factor(ALC2_ans$answer,levels=c("10 or less", "11-49", "50-99", "100+", "Skipped this question"))

dtALC2_summary <- ALC2_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtALC2_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("ALCOHOL2: Alcoholic Beverages in a Lifetime")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


#ALCOHOL5
dt_ALC5= data_tib_all3  %>% filter(data_tib_all3$D_429228540==486319890| data_tib_all3$D_429228540==132232896) 

ALC5_ans= dt_ALC5 %>%  mutate(answer= case_when(D_338467033==104430631 ~ "No",
                                             D_338467033==353358909 ~ "Yes",
                                             is.na(D_338467033) ~ "Skipped this question"))

dtALC5_summary <- ALC5_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtALC5_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCOHOL5: Consumed an Alcoholic Beverage in the Last 12 Months")) %>% 
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()

```

## BEER1
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#simple_funct3(D_726847824, "BEER1: Frequency of Drinking Beer/Hard Cider in the Last Year")

dt_BEER1= data_tib_all3  %>% filter(D_447720598_D_549079588==1)

BEER1_ans= dt_BEER1 %>%  mutate(answer= case_when(D_726847824=="595249233"~"Less Than once per Month ", 
                                              D_726847824=="637900673"~"Once a month",
                                              D_726847824=="207952166"~"2-3 times per Month",
                                              D_726847824=="198347104"~"1-2 times per week",
                                              D_726847824=="471294296"~"3-4 times per Week",
                                              D_726847824=="594557208"~"5-6 times per Week",
                                              D_726847824=="647504893"~"Every Day",
                                              TRUE ~ "Skipped this question"))
BEER1_ans$answer <- factor(BEER1_ans$answer,levels=c("Less Than once per Month ", "Once a month","2-3 times per Month","1-2 times per week","3-4 times per Week","5-6 times per Week","Every Day", "Skipped this question"))

dtBEER1_summary <- BEER1_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtBEER1_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("BEER1: Frequency of Drinking Beer/Hard Cider in the Last Year")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



```

## LIQUOR1
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#simple_funct3(D_411088265, "LIQUOR1: Frequency of Drinking Liquor of Mixed Drinks in the Last Year")


dt_LIQ1= data_tib_all3  %>% filter(D_447720598_D_896953195==1)

LIQ1_ans= dt_LIQ1 %>%  mutate(answer= case_when(D_411088265=="595249233"~"Less Than once per Month ", 
                                              D_411088265=="637900673"~"Once a month",
                                              D_411088265=="207952166"~"2-3 times per Month",
                                              D_411088265=="198347104"~"1-2 times per week",
                                              D_411088265=="471294296"~"3-4 times per Week",
                                              D_411088265=="594557208"~"5-6 times per Week",
                                              D_411088265=="647504893"~"Every Day",
                                              TRUE ~ "Skipped this question"))
LIQ1_ans$answer <- factor(LIQ1_ans$answer,levels=c("Less Than once per Month ", "Once a month","2-3 times per Month","1-2 times per week","3-4 times per Week","5-6 times per Week","Every Day", "Skipped this question"))

dtLIQ1_summary <- LIQ1_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtLIQ1_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("LIQUOR1: Frequency of Drinking Liquor of Mixed Drinks in the Last Year")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


```

## WINE1
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#simple_funct3(D_178665310, "WINE1: Frequency of Drinking Wine in the Last Year")

dt_WINE1= data_tib_all3  %>% filter(D_447720598_D_889023234==1)

WINE1_ans= dt_WINE1 %>%  mutate(answer= case_when(D_178665310=="595249233"~"Less Than once per Month ", 
                                              D_178665310=="637900673"~"Once a month",
                                              D_178665310=="207952166"~"2-3 times per Month",
                                              D_178665310=="198347104"~"1-2 times per week",
                                              D_178665310=="471294296"~"3-4 times per Week",
                                              D_178665310=="594557208"~"5-6 times per Week",
                                              D_178665310=="647504893"~"Every Day",
                                              TRUE ~ "Skipped this question"))
WINE1_ans$answer <- factor(WINE1_ans$answer,levels=c("Less Than once per Month ", "Once a month","2-3 times per Month","1-2 times per week","3-4 times per Week","5-6 times per Week","Every Day", "Skipped this question"))

dtWINE1_summary <- WINE1_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtWINE1_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WINE1: Frequency of Drinking Wine in the Last Year")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()



```

## OTHERALC1
```{r, warning=FALSE, echo=FALSE, message=FALSE}


#simple_funct3(D_228752045, "OTHERALC1: Frequency of Drinking Other Alcoholic Beverages in the Last Year")
dt_OALC1= data_tib_all3  %>% filter(D_447720598_D_181769837==1)

OALC1_ans= dt_OALC1 %>%  mutate(answer= case_when(D_228752045=="595249233"~"Less Than once per Month ", 
                                              D_228752045=="637900673"~"Once a month",
                                              D_228752045=="207952166"~"2-3 times per Month",
                                              D_228752045=="198347104"~"1-2 times per week",
                                              D_228752045=="471294296"~"3-4 times per Week",
                                              D_228752045=="594557208"~"5-6 times per Week",
                                              D_228752045=="647504893"~"Every Day",
                                              TRUE ~ "Skipped this question"))
OALC1_ans$answer <- factor(OALC1_ans$answer,levels=c("Less Than once per Month ", "Once a month","2-3 times per Month","1-2 times per week","3-4 times per Week","5-6 times per Week","Every Day", "Skipped this question"))

dtOALC1_summary <- OALC1_ans %>% group_by(answer) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtOALC1_summary %>%  gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("OTHERALC1: Frequency of Drinking Other Alcoholic Beverages in the Last Year")) %>%
  cols_label(n= md("**Number of Participants**"), answer = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>%
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()


```


## ALCLIFEA-H
```{r, warning=FALSE, echo=FALSE, message=FALSE}
##ALCLIFE2 GRID
#ALCLIFE2A
#alclife2_funct(D_633553324_D_294629316,"ALCLIFE2A: Frequency of Drinking: Ages 0-17")


#### COMPLICATED SKIP LOGIC
  # DERIVED AGE VARIABLE PUSHED TO PROD AFTER MOD3 RELEASE, SO WE CAN'T USE IT-- needed to create one below
# ALC2=3, ALC4 IS NOT NA, & (ALC5=1 OR (ALC5=0 & ALC6 IS NOT NA)) AND (ALC4<ALCLIFEAGE & (ALCLIFEAGE<ALC6 | AGE>ALCLIFEAGE))
                                                                        # IF THEY NEVER STOPPED DRINKING, THEN AGE STARTED<ALCLIFE, IF STOPPED TEHN STARTED<ALCLIFE AND ALCLIFE<AGESTOPPED


data_tib_all3$DOB <- paste0(str_sub(data_all3$d_371067537,1,4), "-", str_sub(data_all3$d_371067537,5,6), "-", str_sub(data_all3$d_371067537,7,8)) 
data_tib_all3$DOB <- as.Date(data_tib_all3$DOB) #, format='%y-%m-%d')
currentDate <- as.Date(Sys.Date(), format='%y/%m/%d')


data_tib_all3$AGEGRID <- time_length(difftime(currentDate, data_tib_all3$DOB), "years")



dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<17) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<17 & as.numeric(data_tib_all3$D_480426504)>17)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_294629316==265550580 ~"Didn't Drink", 
                                                D_633553324_D_294629316==950039557 ~"A few times per Year",
                                                D_633553324_D_294629316==402048066 ~"A few times per Month",
                                                D_633553324_D_294629316==522395860 ~"Once per Week",
                                                D_633553324_D_294629316==756073829 ~"A few times per Week",
                                                D_633553324_D_294629316==858624942 ~"Once per day",
                                                D_633553324_D_294629316==424768954 ~"2-3 times per Day",
                                                D_633553324_D_294629316==687445652 ~"4-5 times per Day",
                                                D_633553324_D_294629316==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2A: Frequency of Drinking: Ages 0-17")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()

#ALCLIFE2B
#alclife2_funct(D_633553324_D_164707243,"ALCLIFE2B: Frequency of Drinking: Ages 18-24")
#grid.arrange(alclf2A, alclf2B, nrow=2)


dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<24) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<24 & as.numeric(data_tib_all3$D_480426504)>24)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_164707243==265550580 ~"Didn't Drink", 
                                                D_633553324_D_164707243==950039557 ~"A few times per Year",
                                                D_633553324_D_164707243==402048066 ~"A few times per Month",
                                                D_633553324_D_164707243==522395860 ~"Once per Week",
                                                D_633553324_D_164707243==756073829 ~"A few times per Week",
                                                D_633553324_D_164707243==858624942 ~"Once per day",
                                                D_633553324_D_164707243==424768954 ~"2-3 times per Day",
                                                D_633553324_D_164707243==687445652 ~"4-5 times per Day",
                                                D_633553324_D_164707243==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2B: Frequency of Drinking: Ages 18-24")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()


#ALCLIFE2C
#alclife2_funct(D_633553324_D_771426895,"ALCLIFE2C: Frequency of Drinking: Ages 25-29")
dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<29) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<29 & as.numeric(data_tib_all3$D_480426504)>29)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_771426895==265550580 ~"Didn't Drink", 
                                                D_633553324_D_771426895==950039557 ~"A few times per Year",
                                                D_633553324_D_771426895==402048066 ~"A few times per Month",
                                                D_633553324_D_771426895==522395860 ~"Once per Week",
                                                D_633553324_D_771426895==756073829 ~"A few times per Week",
                                                D_633553324_D_771426895==858624942 ~"Once per day",
                                                D_633553324_D_771426895==424768954 ~"2-3 times per Day",
                                                D_633553324_D_771426895==687445652 ~"4-5 times per Day",
                                                D_633553324_D_771426895==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2C: Frequency of Drinking: Ages 25-29")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()

#ALCLIFE2D
#alclife2_funct(D_633553324_D_818310825,"ALCLIFE2D: Frequency of Drinking: Ages 30-39")
dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<39) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<39 & as.numeric(data_tib_all3$D_480426504)>39)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_818310825==265550580 ~"Didn't Drink", 
                                                D_633553324_D_818310825==950039557 ~"A few times per Year",
                                                D_633553324_D_818310825==402048066 ~"A few times per Month",
                                                D_633553324_D_818310825==522395860 ~"Once per Week",
                                                D_633553324_D_818310825==756073829 ~"A few times per Week",
                                                D_633553324_D_818310825==858624942 ~"Once per day",
                                                D_633553324_D_818310825==424768954 ~"2-3 times per Day",
                                                D_633553324_D_818310825==687445652 ~"4-5 times per Day",
                                                D_633553324_D_818310825==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2D: Frequency of Drinking: Ages 30-39")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()




#ALCLIFE2E
#alclife2_funct(D_633553324_D_843593800,"ALCLIFE2E: Frequency of Drinking: Ages 40-49")
dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$AGEGRID>40 & data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<49) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<49 & as.numeric(data_tib_all3$D_480426504)>49)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_843593800==265550580 ~"Didn't Drink", 
                                                D_633553324_D_843593800==950039557 ~"A few times per Year",
                                                D_633553324_D_843593800==402048066 ~"A few times per Month",
                                                D_633553324_D_843593800==522395860 ~"Once per Week",
                                                D_633553324_D_843593800==756073829 ~"A few times per Week",
                                                D_633553324_D_843593800==858624942 ~"Once per day",
                                                D_633553324_D_843593800==424768954 ~"2-3 times per Day",
                                                D_633553324_D_843593800==687445652 ~"4-5 times per Day",
                                                D_633553324_D_843593800==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2E: Frequency of Drinking: Ages 40-49")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()

#ALCLIFE2F
#alclife2_funct(D_633553324_D_175385712,"ALCLIFE2F: Frequency of Drinking: Ages 50-59")
dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$AGEGRID>50 & data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<59) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<59 & as.numeric(data_tib_all3$D_480426504)>59)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_175385712==265550580 ~"Didn't Drink", 
                                                D_633553324_D_175385712==950039557 ~"A few times per Year",
                                                D_633553324_D_175385712==402048066 ~"A few times per Month",
                                                D_633553324_D_175385712==522395860 ~"Once per Week",
                                                D_633553324_D_175385712==756073829 ~"A few times per Week",
                                                D_633553324_D_175385712==858624942 ~"Once per day",
                                                D_633553324_D_175385712==424768954 ~"2-3 times per Day",
                                                D_633553324_D_175385712==687445652 ~"4-5 times per Day",
                                                D_633553324_D_175385712==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2F: Frequency of Drinking: Ages 50-59")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()


#ALCLIFE2G
#alclife2_funct(D_633553324_D_772143730,"ALCLIFE2G: Frequency of Drinking: Ages 60-69")
dt_alcl= data_tib_all3  %>%   filter(data_tib_all3$AGEGRID>60 & data_tib_all3$D_429228540==132232896 & !is.na(data_tib_all3$D_556837046_D_141874857) & 
                                       (data_tib_all3$D_338467033==353358909 | (data_tib_all3$D_338467033==104430631 & !is.na(data_tib_all3$D_480426504))) & 
                                       ((is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<69) | 
                                          (!is.na(data_tib_all3$D_480426504) & as.numeric(data_tib_all3$D_556837046_D_141874857)<69 & as.numeric(data_tib_all3$D_480426504)>69)))
                                          # (as.numeric(data_tib_all3$D_480426504)>17 | (is.na(data_tib_all3$D_48042650) & (data_tib_all3$state_d_934298480==124276120 |data_tib_all3$state_d_934298480==450985724 |
                                          #                                                                                   data_tib_all3$state_d_934298480==363147933 | 
                                          #                                                                                   data_tib_all3$state_d_934298480==636706443 |data_tib_all3$state_d_934298480==771230670))) ))

alcl= dt_alcl  %>%  mutate(oth_age= case_when(D_633553324_D_772143730==265550580 ~"Didn't Drink", 
                                                D_633553324_D_772143730==950039557 ~"A few times per Year",
                                                D_633553324_D_772143730==402048066 ~"A few times per Month",
                                                D_633553324_D_772143730==522395860 ~"Once per Week",
                                                D_633553324_D_772143730==756073829 ~"A few times per Week",
                                                D_633553324_D_772143730==858624942 ~"Once per day",
                                                D_633553324_D_772143730==424768954 ~"2-3 times per Day",
                                                D_633553324_D_772143730==687445652 ~"4-5 times per Day",
                                                D_633553324_D_772143730==333682419 ~"6+ times per Day",
                                              TRUE ~ "Skipped this question"))
alcl$oth_age <- factor(alcl$oth_age,levels=c("Didn't Drink","A few times per Year","A few times per Month","Once per Week", "A few times per Week","Once per day","2-3 times per Day","4-5 times per Day","6+ times per Day","Skipped this question"))

dt_alcl_summary <- alcl %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_alcl_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ALCLIFE2G: Frequency of Drinking: Ages 60-69")) %>% 
  cols_label(n= md("**Number of Participants**"), oth_age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F, column = c(n,percentage), fns= list(Sum= ~sum(.)), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) %>% opt_row_striping()

#ALCLIFE2H-- no one yet
# alclife2_funct(D_633553324_D_602102163,"ALCLIFE2A: Frequency of Drinking: Ages 70+")


```
























\newpage

```{r, include=FALSE}

querymod4 <- "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module4_v1_JP` where Connect_ID IS NOT NULL"
mod4_table <- bq_project_query(project, querymod4)
mod4_data <- bq_table_download(mod4_table, bigint = "integer64")
mod4_data$Connect_ID <- as.numeric(mod4_data$Connect_ID)

merge_m4P= left_join(merged, mod4_data, by="Connect_ID") 

data_all4 <- merge_m4P %>% filter(d_663265240==231311385)

data_tib_all4 <- as_tibble(data_all4)


library(naniar)
library(UpSetR)
library(tidyverse)



Mod4 <- as_tibble(data_tib_all4)

```


## WORK2019
```{r, echo=FALSE, warning=FALSE, message=FALSE}


WORK2019= data_tib_all4 %>%  mutate(meds= case_when(D_694113343==353358909 ~ "Yes",
                                               D_694113343==104430631 ~ "No",
                                               TRUE  ~ "Skipped this question"))


dtWORK2019_summary <- WORK2019 %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtWORK2019_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WORK2019: Work for Pay in 2019")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```


## WORKRES
```{r, echo=FALSE, warning=FALSE, message=FALSE}

dt_WORKRES= data_tib_all4 %>%  filter(D_694113343==353358909)

WORKRES= dt_WORKRES %>%  mutate(meds= case_when(D_374639590==353358909 ~ "Yes",
                                               D_374639590==104430631 ~ "No",
                                               TRUE  ~ "Skipped this question"))


dtWORKRES_summary <- WORKRES %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtWORKRES_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WORKRES: Daily Work Tasks Include Driving")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()


```



## NUMWORK
```{r, echo=FALSE, warning=FALSE, message=FALSE}

dt_NUMWORK= data_tib_all4 %>%  filter(D_374639590!=353358909)

NUMWORK= dt_NUMWORK %>%  mutate(meds= case_when(D_828801156==759356722 ~ "One",
                                               D_828801156==185036360 ~ "More Than One",
                                               D_828801156==684900118 ~ "I Don't Commute to Work",
                                               TRUE  ~ "Skipped this question"))


dtNUMWORK_summary <- NUMWORK %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtNUMWORK_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("NUMWORK: Number of Workplaces You Currently Commute to")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```


## PREWORK
```{r, echo=FALSE, warning=FALSE, message=FALSE}


PREWORK= data_tib_all4 %>%  mutate(meds= case_when(D_995620555==353358909 ~ "Yes",
                                               D_995620555==104430631 ~ "No",
                                               TRUE  ~ "Skipped this question"))


dtPREWORK_summary <- PREWORK %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtPREWORK_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREWORK: Commuted to Work at Least Once a Week in the Last 20 Years")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```



## PREWORKRES
```{r, echo=FALSE, warning=FALSE, message=FALSE}

dt_PREWORKRES= data_tib_all4 %>%  filter(D_995620555==353358909)

PREWORKRES= data_tib_all4 %>%  mutate(meds= case_when(D_980007418==353358909 ~ "Yes",
                                               D_980007418==104430631 ~ "No",
                                               TRUE  ~ "Skipped this question"))


dtPREWORKRES_summary <- PREWORKRES %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtPREWORKRES_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PREWORKRES: Daily Responsibilities of Longest Held Job Include Driving")) %>% 
  cols_label(n= md("**Number of Participants**"), meds = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

```














## Map of Current Addresses
```{r, echo=FALSE, warning=FALSE, message=FALSE}

states <- map_data("state")
us_base <- ggplot(data = states) +
  geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") +
  coord_fixed(1.3) +
  guides(fill=FALSE)  # do this to leave off the color legend


ca_base <- ggplot(data = states, mapping = aes(x = long, y = lat, group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "black", fill = "gray")
#ca_base + theme_nothing()


# Example with zip codes : https://stackoverflow.com/questions/59801437/is-there-an-r-package-that-can-take-zipcodes-and-create-a-heat-map-of-the-united


#Attempt 1
 zipc_heat <- data_tib_all4 %>% mutate(ZIP= str_sub(data_tib_all4$D_121490150_D_202784871,1,5),
                                       State= D_121490150_D_195068098)

 zipc_heat <- zipc_heat %>%  select(ZIP) %>%  filter(!is.na(ZIP) & ZIP!="Gfchh" & str_sub(ZIP,1,1)!=" " & str_sub(ZIP,1,2)!="  " & str_sub(ZIP,5,5)!=" " & str_sub(ZIP,4,5)!="  ") ## need to remove the 4 digit zip code and random letter zip code

 #zipc_heat$ZIP <- as.numeric(zipc_heat$ZIP)

 ZP_HT <- as.data.frame(table(zipc_heat))


 #ZP_HT$ZIP<- clean.zipcodes(ZP_HT$ZIP)
 ZP_HT_US<-aggregate(data.frame(count=ZP_HT$Freq),list(zip=ZP_HT$ZIP),length)


 
# EXAMPLE OF PER COUNTY GRAPH OF JUST CA- have to figure out how to add counties of all countries and populations equal to our participant population 
   # https://eriqande.github.io/rep-res-web/lectures/making-maps-with-R.html
  #https://jtr13.github.io/cc19/different-ways-of-plotting-u-s-map-in-r.html
 #https://www.sharpsightlabs.com/blog/how-to-create-a-crime-heatmap-in-r/
 #https://rpubs.com/jcraggy/841199
 
 #Attemp1 10 
 zip_to_lat_lon_North.America <- read.csv("zip_to_lat_lon_North_America.csv")
 all_zips <- zip_to_lat_lon_North.America %>%  filter(Country=="United States" & (postal.code %in%  ZP_HT_US$zip)) 
 all_zips$ZIP <- all_zips$postal.code
us_zip <- left_join(ZP_HT, all_zips, by="ZIP")
us_zip$lat <- us_zip$latitude
us_zip$long <- us_zip$longitude
us_zip <- us_zip %>% filter(!is.na(state))
us_zip$state <- tolower(us_zip$state)

state_group <- states %>% select(group, region)
state_group$state <- state_group$region

usa_zip <- left_join(us_zip, state_group, by="state")



ditch_the_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank()
  )
 
elbow_room1 <- ca_base + 
      geom_polygon(data = usa_zip, aes(fill = Freq), color = "white") +
      geom_polygon(color = "black", fill = NA) +
      theme_bw() +
      ditch_the_axes

eb2 <- elbow_room1 + 
    scale_fill_gradientn(colours = rev(rainbow(7)),
                         breaks = c(2, 4, 10, 100, 1000, 10000),
                         trans = "log10")


eb2 + xlim(-125, -67.1) + ylim(25,50)

 
 # 
 # #Attempt 2-7
 # us<-map_data('state')
 # 
 # 
 # ggplot(ZP_HT_US) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
 #   geom_point(aes(color = count,size=.15,alpha=.25))  +    # <- why can't I get this to run?  #need x and y aesthetic but x=zip, y=count, causes: Error: Discrete value supplied to continuous scale
 #   xlim(-125,-65)+ylim(20,50)
 # 
 # 
 # ggplot(ZP_HT_US, aes(x=zip, y=count)) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA)+ #,alpha=.35
 #   geom_point() #aes(color = count) +  #,size=.15,alpha=.25  # <- why can't I get this to run?  #need x and y aesthetic but x=zip, y=count, causes: Error: Discrete value supplied to continuous scale
 #   #xlim(-125,-65)+ylim(20,50)
 # 
 # 
 # zipus <- ggplot(ZP_HT_US) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
 #   #geom_point(aes(color = count,size=.15,alpha=.25))  +    # <- why can't I get this to run?  #need x and y aesthetic but x=zip, y=count, causes: Error: Discrete value supplied to continuous scale
 #   xlim(-125,-65)+ylim(20,50)
 # 
 # 
 # zipus <- ggplot(ZP_HT_US) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
 #   geom_point(aes(color = count,size=.15,alpha=.25))  +  #missing x and y aesthetic
 #   scale_x_discrete(limits=c(1,150)) +
 #   xlim(-125,-65)+ylim(20,50)
 # 
 # 
 # zipus <- ggplot(ZP_HT_US) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
 #   geom_point(aes(x=count, y=zip, color = count,size=.15,alpha=.25))  +   # Error: Discrete value supplied to continuous scale
 #   scale_x_discrete(limits=c(1,150)) +
 #   xlim(-125,-65)+ylim(20,50)
 # 
 # 
 # zipus <- ggplot(ZP_HT_US) + #, aes(x=zip, y=count)) + #,aes(longitude,latitude)
 #   geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+
 #   geom_point(aes(x=count, y=zip, color = count,size=.15,alpha=.25))  +   # Error: Discrete value supplied to continuous scale
 #   scale_x_continuous(limits=c(1,150)) +
 #   xlim(-125,-65)+ylim(20,50)
 # 
 # zipus + geom_point(aes(color = count,size=.15,alpha=.25))  #requires and x and y aesthetic
 # zipus + geom_point() # aes(color = count,size=.15,alpha=.25) inculding these or not, requires and x and y aesthetic
 # zipus + geom_point(aes(x=zip, y=count, color = count,size=.15,alpha=.25))  ##Error: Discrete value supplied to continuous scale
 # zipus + geom_point(aes(x=zip, y=count, color = count,size=.15,alpha=.25)) + scale_x_discrete(limits=c(1,150)) ###Error: Discrete value supplied to continuous scale
 # 
 # 
 
 
 
 #Attempt 8
 library(usmap)
 #plot_usmap(regions = "states", color= "black") + theme(panel.background=element_blank()) + geom_point(ZP_HT_US, aes(x=count, y=zip, color = count,size=.15,alpha=.25)) 
 #plot_usmap(data = ZP_HT_US, values = "count", regions = "states", color= "black") + scale_fill_continuous(low = "white", high = "blue", name = "Population Estimates", label = scales::comma) + labs(title = "Participant Addresses") + theme(legend.position = "right")   #Error in map_with_data(data, values = values, include = include, exclude = exclude) : `data` must be a data.frame containing either a `state` or `fips` column.
 
 
 
 
 # Attempt 9
 
 
 
 #Attempt 10
 ##us_base + ggplot(ZP_HT_US, aes(x=count, y=zip)) + geom_point(color = count) --- can't add ggplot to a ggplot. But can add to geom_polygons? Also can't run even removing us +
 #ggplot(ZP_HT_US, aes(x=count, y=zip)) + scale_x_discrete(limits=c(1,150)) + geom_polygon(data=us,aes(x=long,y=lat,group=group),color='gray',fill=NA,alpha=.35)+ geom_point(color = count) #Error: Discrete value supplied to continuous scale

 
 
 
 
 
 

 
 
#     # # make a data frame
#     # x <- readLines("data/ca-counties-wikipedia.txt")
#     # pop_and_area <- str_match(x, "^([a-zA-Z ]+)County\t.*\t([0-9,]{2,10})\t([0-9,]{2,10}) sq mi$")[, -1] %>%
#     #   na.omit() %>%
#     #   str_replace_all(",", "") %>% 
#     #   str_trim() %>%
#     #   tolower() %>%
#     #   as.data.frame(stringsAsFactors = FALSE)
#     #   
#     # # give names and make population and area numeric
#     # names(pop_and_area) <- c("subregion", "population", "area")
#     # pop_and_area$population <- as.numeric(pop_and_area$population)
#     # pop_and_area$area <- as.numeric(pop_and_area$area)
# 
# # cacopa <- inner_join(ca_county, pop_and_area, by = "subregion")
# # cacopa$people_per_mile <- cacopa$population / cacopa$area
# # 
# # # prepare to drop the axes and ticks but leave the guides and legends
# # # We can't just throw down a theme_nothing()!
# # ditch_the_axes <- theme(
# #   axis.text = element_blank(),
# #   axis.line = element_blank(),
# #   axis.ticks = element_blank(),
# #   panel.border = element_blank(),
# #   panel.grid = element_blank(),
# #   axis.title = element_blank()
# #   )
# # 
# # elbow_room1 <- ca_base + 
# #       geom_polygon(data = cacopa, aes(fill = people_per_mile), color = "white") +
# #       geom_polygon(color = "black", fill = NA) +
# #       theme_bw() +
# #       ditch_the_axes
# # 
# # elbow_room1 
# # 
# # 
# # 
# # eb2 <- elbow_room1 + 
# #     scale_fill_gradientn(colours = rev(rainbow(7)),
# #                          breaks = c(2, 4, 10, 100, 1000, 10000),
# #                          trans = "log10")
# # eb2
# 
# 
# ZP_HT_US$x<-log(ZP_HT_US$count)
# 
# ZP_HT_US %>% ggplot(aes(fill=x, color=x)) + geom_sf()  + 
#   scale_fill_viridis(option = "B",direction=-1) + 
#   scale_color_viridis(option = "B",direction=-1) + theme_map(base_size=11)
# 
# 
# 
# ditch_the_axes <- theme(
#   axis.text = element_blank(),
#   axis.line = element_blank(),
#   axis.ticks = element_blank(),
#   panel.border = element_blank(),
#   panel.grid = element_blank(),
#   axis.title = element_blank()
#   )
# 
# elbow_room1 <- us_base + 
#       geom_polygon(data = ZP_HT, aes(fill = Freq), color = "white") +
#       geom_polygon(color = "black", fill = NA) +
#       theme_bw() +
#       ditch_the_axes
# 
# elbow_room1
# 
# 
# 
# eb2 <- elbow_room1 + 
#     scale_fill_gradientn(colours = rev(rainbow(7)),
#                          breaks = c(10, 25, 50, 75, 100),
#                          trans = "log10")
# eb2
# 
# 

```


## Home1 Address
```{r, warning=FALSE, echo=FALSE, message=FALSE}
Mod4$Street_Number <- Mod4$D_121490150_D_255248624
Mod4$Street_Name <- Mod4$D_121490150_D_945532934
Mod4$Apt_Number <- Mod4$D_121490150_D_469838242
Mod4$City <- Mod4$D_121490150_D_303500597
Mod4$State <- Mod4$D_121490150_D_195068098
Mod4$ZIP <- Mod4$D_121490150_D_202784871
Mod4$Country <- Mod4$D_121490150_D_831127170

#home_add1_1= Mod4 %>% select(Street_Number, Street_Name, City, State, ZIP, Country)

#vis_miss(home_add1_1)+labs(y= "Participants", title="Home 1 Address Missingness")
#gg_miss_var(home_add1_1, show_pct=T)+labs(y= "Percent of Participants That Skipped")


#for( i in 1:nrow(Mod4)){
  home1skip <- Mod4 %>% select(Connect_ID, Street_Number, Street_Name, City, State, ZIP, Country)
  home1skip= home1skip %>%  mutate(Address1= case_when(is.na(Street_Number)~"Skipped Street Number"))

dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
dt_home1skip_summary <- dt_home1skip_summary[1,]

dt_home1skip_summary[2,1] <- "Skipped Street Name" #c("Skipped Street Name", sum(is.na(home1skip$Street_Name)), sum(is.na(home1skip$Street_Name))/dim(home1skip$Street_Name)[[1]])
dt_home1skip_summary[2,2] <- sum(is.na(home1skip$Street_Name))
dt_home1skip_summary[2,3] <- (sum(is.na(home1skip$Street_Name))/dim(home1skip)[[1]])*100

dt_home1skip_summary[3,1] <- "Skipped City"
dt_home1skip_summary[3,2] <- sum(is.na(home1skip$City))
dt_home1skip_summary[3,3] <- (sum(is.na(home1skip$City))/dim(home1skip)[[1]])*100

dt_home1skip_summary[4,1] <- "Skipped State"
dt_home1skip_summary[4,2] <- sum(is.na(home1skip$State))
dt_home1skip_summary[4,3] <- (sum(is.na(home1skip$State))/dim(home1skip)[[1]])*100

dt_home1skip_summary[5,1] <- "Skipped ZIP"
dt_home1skip_summary[5,2] <- sum(is.na(home1skip$ZIP))
dt_home1skip_summary[5,3] <- (sum(is.na(home1skip$ZIP))/dim(home1skip)[[1]])*100

dt_home1skip_summary[6,1] <- "Skipped Country"
dt_home1skip_summary[6,2] <- sum(is.na(home1skip$Country))
dt_home1skip_summary[6,3] <- (sum(is.na(home1skip$Country))/dim(home1skip)[[1]])*100

dt_home1skip_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Address 1 Components Skipped")) %>% 
  cols_label(n= md("**Number of Participants**"),Address1 = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) %>% opt_row_striping()



```




\newpage

# QC/Operational Metrics
Objectives of enrollment and survey operational metrics: Identify trends and issues related to enrollment and the completion of baseline activities that require prompt resolution by the Operations team, Qx Subcommittee, DevOps team, and sites. 

## SSN
```{r, warning=FALSE,echo=FALSE, message=FALSE}





ssn_surv = data_tib_merged %>%  mutate(started=case_when(d_126331570==615768760 ~ "Started",
                                                d_126331570==231311385 ~ "Submitted",
                                                TRUE ~ "Not Started"))

ssn_surv_summary <- ssn_surv  %>% dplyr::group_by(started) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(started, n, percentage) 


ssn_surv_summary_gt <- ssn_surv_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Status of the SSN Suvery")) %>% 
  cols_label(n= md("**Number of Participants**"), started = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   groups = everything(),
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum, #, na.rm = TRUE), 
  #     decimals=0)) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = started,
    )
  )   #%>% opt_row_striping()
tab_footnote(
  ssn_surv_summary_gt,
  md("The SSN Survey Completion Flag was created after the SSN Survey had opened. There are additional participants with no flag that have given a SSN. Those will be included in the next table."),
  locations = cells_column_labels(columns = started),
  placement = c("left")
)

# ssn_surv_summary[(dim(ssn_surv_summary)[[1]] + 1), ] <- c("Total", sum(ssn_surv_summary$n), sum(ssn_surv_summary$percentage))
# ssn_surv_summary[3,1] <- c("Test", "Test", "Test")
# ssn_surv_summary[4,] <- c("Total", 1, 2)


ssn_stsb= data_tib_merged %>%  filter(!is.na(d_914639140) | !is.na(d_311580100)) # (ssn_surv== 615768760 | ssn_surv==  231311385)


gavePssn = ssn_stsb %>%  mutate(provided4=case_when(d_914639140==353358909 ~ "Partial SSN Given",
                                                    d_311580100==353358909 ~ "Full SSN Given",
                                                   TRUE ~ "No SSN given"),
                                Completion= case_when(d_949302066==231311385 & d_976570371==231311385 & d_536735468==231311385 & d_663265240 ==231311385 & 
                                                    (d_878865966==353358909 | d_684635302==353358909 | d_167958071==353358909)~ "All Baseline Activities Completed",
                                                    d_949302066==231311385 & d_976570371==231311385 & d_536735468==231311385 & d_663265240 ==231311385 ~ "All Baseline Modules Completed",
                                                    TRUE ~ "Fully Enrolled"))

gavePssn$provided4 <- factor(gavePssn$provided4,levels=c("Partial SSN Given", "Full SSN Given", "No SSN given"))

gavePssn %>% dplyr::select(Completion, provided4)  %>% tbl_cross(
  row = Completion,
  col = provided4,
  percent = "row",
  digits=c(0,2),
  label=list(Completion~"Completion", provided4~" "), 
  missing="ifany",
  missing_text="Unknown") %>%
  bold_labels() %>%
  #italicize_levels() %>% 
  modify_header() %>%
  modify_caption("Portion of SSN Given for Submitted SSN Surveys") #%>%
  #as_kable_extra(escape = FALSE, addtl_fmt = TRUE)

gavePssn_summary <- gavePssn  %>% dplyr::group_by(provided4) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(provided4, n, percentage) 

dt_gavePssn_summary <- gavePssn_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Portion of SSN Given for Submitted SSN Surveys")) %>% 
  cols_label(n= md("**Number of Participants**"), provided4 = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = provided4,
    )
  ) %>% opt_row_striping()



# 
# gaveFssn = ssn_stsb %>%  mutate(providedall=case_when(d_311580100==353358909 ~ "Yes",
#                                                    TRUE ~ "No"))
# dt_gaveFssn_summary <- gaveFssn  %>% dplyr::group_by(providedall) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(providedall, n, percentage) 
# 
# dt_gaveFssn_summary %>%  gt() %>%  
#   fmt_number(columns = "percentage", decimals = 2) %>% 
#   tab_header(title = md("Full SSN Given of Those Who Started or Submitted the SSN Suvery")) %>% 
#   cols_label(n= md("**Number of Participants**"), providedall = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
#   # summary_rows(
#   #   column = c(participants,percentage),
#   #   fns= list(
#   #     Sum= ~sum(.)
#   #   ), decimals=0) %>%
#   tab_options(
#       stub.font.weight = "bold"
#     ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_body(
#       columns = providedall,
#     )
#   ) %>% opt_row_striping()


```


## Age at Enrollment
```{r, warning=FALSE,echo=FALSE}

which_age= data_tib_base %>%  mutate(age= case_when(state_d_934298480==124276120 ~ "Age 40-45",
                                             state_d_934298480==450985724 ~ "Age 46-50",
                                             state_d_934298480==363147933 ~ "Age 51-55",
                                             state_d_934298480==636706443 ~ "Age 56-60",
                                             state_d_934298480==771230670 ~ "Age 61-65",
                                             !is.na(D_150344905) ~ "Answered with Corrected Age in Mod1",
                                             TRUE  ~ "Skipped this question"))

dt_all_ages_summary <- which_age  %>% dplyr::group_by(age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(age, n, percentage)  


dt_all_ages_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Age of Participants at Recruitment")) %>% 
  cols_label(n= md("**Number of Participants**"), age = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(participants,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = age,
    )
  ) %>% opt_row_striping()

```


## SIBCANC & SIBCANC2
```{r, warning=FALSE, echo=FALSE, message=FALSE}
#SIBCANC


sibcanc1= data_tib_base  %>%  filter(as.numeric(D_694265648) >0) %>%  mutate(status= case_when((D_607773106_1_1==353358909 | D_607773106_2_2==353358909 | 
                                      D_607773106_3_3==353358909 | D_607773106_4_4==353358909 | D_607773106_5_5==353358909 | D_607773106_6_6==353358909 |
                                      D_607773106_7_7==353358909| D_607773106_8_8==353358909 | D_607773106_9_9==353358909| D_607773106_10_10==353358909 |
                                      D_607773106_11_11==353358909 | D_607773106_12_12==353358909  | D_607773106_13_13==353358909)  ~ "Sibling Diagnosed",
                                      (D_607773106_1_1==104430631 | D_607773106_2_2==104430631 | 
                                      D_607773106_3_3==104430631 | D_607773106_4_4==104430631 | D_607773106_5_5==104430631 | D_607773106_6_6==104430631 |
                                      D_607773106_7_7==104430631| D_607773106_8_8==104430631 | D_607773106_9_9==104430631| D_607773106_10_10==104430631 |
                                      D_607773106_11_11==104430631 | D_607773106_12_12==104430631  | D_607773106_13_13==104430631)  ~ "No Sibling Diagnosed",
                                                    TRUE ~ "Skipped This Question"))

dt_sibcanc1_summary <- sibcanc1 %>% dplyr::group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage) 


dt_sibcanc1_summary %>%  gt(rowname_col = "row_lab") %>%  ## why is this not a proper gt_tbl??
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("SIBCANC: Siblings 1-13 Diagnosed with Cancer")) %>%
  cols_label(status = md("**Answer**"), n = md("**Number of Participants**"), percentage = md("**Percentage of Participants**")) %>%
    # summary_rows(
    # column = c(n,percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  ) %>% opt_row_striping()




#SIBCANC2
#type:

sibling <- sibcanc1 %>%  filter(status=="Sibling Diagnosed")

sibling= sibling  %>%  mutate(multc1 = ifelse(D_578895128_1_1_D_578895128_1_1_D_939782495==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_135725957==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_518416174==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_847945207==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_942970912==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_596122041==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_489400183==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_863246236==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_607793249==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_532172400==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_754745617==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_665036297==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_200837530==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_990319383==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_482225200==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_764891959==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_139822395==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_248374037==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_807835037==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_487917585==1, 1, 0) + ifelse(D_578895128_1_1_D_578895128_1_1_D_295976386==1, 1, 0),
                              multc2 = ifelse(D_578895128_2_2_D_578895128_2_2_D_939782495==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_135725957==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_518416174==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_847945207==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_942970912==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_596122041==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_489400183==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_863246236==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_607793249==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_532172400==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_754745617==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_665036297==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_200837530==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_990319383==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_482225200==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_764891959==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_139822395==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_248374037==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_807835037==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_487917585==1, 1, 0) + ifelse(D_578895128_2_2_D_578895128_2_2_D_295976386==1, 1, 0),
                              multc3 = ifelse(D_578895128_3_3_D_578895128_3_3_D_939782495==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_135725957==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_518416174==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_847945207==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_942970912==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_596122041==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_489400183==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_863246236==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_607793249==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_532172400==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_754745617==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_665036297==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_200837530==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_990319383==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_482225200==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_764891959==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_139822395==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_248374037==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_807835037==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_487917585==1, 1, 0) + ifelse(D_578895128_3_3_D_578895128_3_3_D_295976386==1, 1, 0),
                              multc4 = ifelse(D_578895128_4_4_D_578895128_4_4_D_939782495==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_135725957==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_518416174==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_847945207==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_942970912==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_596122041==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_489400183==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_863246236==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_607793249==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_532172400==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_754745617==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_665036297==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_200837530==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_990319383==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_482225200==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_764891959==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_139822395==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_248374037==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_807835037==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_487917585==1, 1, 0) + ifelse(D_578895128_4_4_D_578895128_4_4_D_295976386==1, 1, 0))

body_sibling= sibling  %>%  mutate(bodyp= case_when((as.numeric(multc1)>1 | as.numeric(multc2)>1 | as.numeric(multc3)>1 | as.numeric(multc4)>1) ~ "Multiple Cancer Types",
                                                    (D_578895128_2_2_D_578895128_2_2_D_939782495==1 | D_578895128_1_1_D_578895128_1_1_D_939782495==1 | D_578895128_3_3_D_578895128_3_3_D_939782495==1 | D_578895128_4_4_D_578895128_4_4_D_939782495==1) ~ "Anal",
                                                 (D_578895128_2_2_D_578895128_2_2_D_135725957==1 | D_578895128_1_1_D_578895128_1_1_D_135725957==1 | D_578895128_3_3_D_578895128_3_3_D_135725957==1 | D_578895128_4_4_D_578895128_4_4_D_135725957==1) ~ "Bladder",
                                                 (D_578895128_2_2_D_578895128_2_2_D_518416174==1 | D_578895128_1_1_D_578895128_1_1_D_518416174==1 | D_578895128_3_3_D_578895128_3_3_D_518416174==1 | D_578895128_4_4_D_578895128_4_4_D_518416174==1) ~ "Brain",
                                                 (D_578895128_2_2_D_578895128_2_2_D_847945207==1 | D_578895128_1_1_D_578895128_1_1_D_847945207==1 | D_578895128_3_3_D_578895128_3_3_D_847945207==1 | D_578895128_4_4_D_578895128_4_4_D_847945207==1) ~ "Breast",
                                                 (D_578895128_2_2_D_578895128_2_2_D_942970912==1 | D_578895128_1_1_D_578895128_1_1_D_942970912==1 | D_578895128_3_3_D_578895128_3_3_D_942970912==1 | D_578895128_4_4_D_578895128_4_4_D_942970912==1) ~ "Colon/Rectal",
                                                 (D_578895128_2_2_D_578895128_2_2_D_596122041==1 | D_578895128_1_1_D_578895128_1_1_D_596122041==1 | D_578895128_3_3_D_578895128_3_3_D_596122041==1 | D_578895128_4_4_D_578895128_4_4_D_596122041==1) ~ "Esophageal",
                                                 (D_578895128_2_2_D_578895128_2_2_D_489400183==1 | D_578895128_1_1_D_578895128_1_1_D_489400183==1 | D_578895128_3_3_D_578895128_3_3_D_489400183==1 | D_578895128_4_4_D_578895128_4_4_D_489400183==1) ~ "Head, Neck, and Shoulders",
                                                 (D_578895128_2_2_D_578895128_2_2_D_863246236==1 | D_578895128_1_1_D_578895128_1_1_D_863246236==1 | D_578895128_3_3_D_578895128_3_3_D_863246236==1 | D_578895128_4_4_D_578895128_4_4_D_863246236==1) ~ "Kidney",
                                                 (D_578895128_2_2_D_578895128_2_2_D_607793249==1 | D_578895128_1_1_D_578895128_1_1_D_607793249==1 | D_578895128_3_3_D_578895128_3_3_D_607793249==1 | D_578895128_4_4_D_578895128_4_4_D_607793249==1) ~ "Leukemia",
                                                 (D_578895128_2_2_D_578895128_2_2_D_532172400==1 | D_578895128_1_1_D_578895128_1_1_D_532172400==1 | D_578895128_3_3_D_578895128_3_3_D_532172400==1 | D_578895128_4_4_D_578895128_4_4_D_532172400==1) ~ "Liver",
                                                 (D_578895128_2_2_D_578895128_2_2_D_754745617==1 | D_578895128_1_1_D_578895128_1_1_D_754745617==1 | D_578895128_3_3_D_578895128_3_3_D_754745617==1 | D_578895128_4_4_D_578895128_4_4_D_754745617==1) ~ "Lung",
                                                 (D_578895128_2_2_D_578895128_2_2_D_665036297==1 | D_578895128_1_1_D_578895128_1_1_D_665036297==1 | D_578895128_3_3_D_578895128_3_3_D_665036297==1 | D_578895128_4_4_D_578895128_4_4_D_665036297==1) ~ "Non-Hodgkin's Lymphoma",
                                                 (D_578895128_2_2_D_578895128_2_2_D_200837530==1 | D_578895128_1_1_D_578895128_1_1_D_200837530==1 | D_578895128_3_3_D_578895128_3_3_D_200837530==1 | D_578895128_4_4_D_578895128_4_4_D_200837530==1) ~ "Lymphoma",
                                                 (D_578895128_2_2_D_578895128_2_2_D_990319383==1 | D_578895128_1_1_D_578895128_1_1_D_990319383==1  | D_578895128_3_3_D_578895128_3_3_D_990319383==1 | D_578895128_4_4_D_578895128_4_4_D_990319383==1) ~ "Melanoma Skin",
                                                 (D_578895128_2_2_D_578895128_2_2_D_487917585==1 | D_578895128_1_1_D_578895128_1_1_D_487917585==1 | D_578895128_3_3_D_578895128_3_3_D_487917585==1 | D_578895128_4_4_D_578895128_4_4_D_487917585==1) ~ "Non-Melanoma Skin",
                                                 (D_578895128_2_2_D_578895128_2_2_D_482225200==1 | D_578895128_1_1_D_578895128_1_1_D_482225200==1 | D_578895128_3_3_D_578895128_3_3_D_482225200==1 | D_578895128_4_4_D_578895128_4_4_D_482225200==1) ~ "Pancreatic",
                                                 (D_578895128_2_2_D_578895128_2_2_D_295976386==1 | D_578895128_1_1_D_578895128_1_1_D_295976386==1 | D_578895128_3_3_D_578895128_3_3_D_295976386==1 | D_578895128_4_4_D_578895128_4_4_D_295976386==1) ~ "Prostate",
                                                 (D_578895128_2_2_D_578895128_2_2_D_764891959==1 | D_578895128_1_1_D_578895128_1_1_D_764891959==1 | D_578895128_3_3_D_578895128_3_3_D_764891959==1  | D_578895128_4_4_D_578895128_4_4_D_764891959==1) ~ "Stomach",
                                                 (D_578895128_2_2_D_578895128_2_2_D_248374037==1 | D_578895128_1_1_D_578895128_1_1_D_248374037==1 | D_578895128_3_3_D_578895128_3_3_D_248374037==1 | D_578895128_4_4_D_578895128_4_4_D_248374037==1) ~ "Testicular",
                                                 (D_578895128_2_2_D_578895128_2_2_D_139822395==1 | D_578895128_1_1_D_578895128_1_1_D_139822395==1 | D_578895128_3_3_D_578895128_3_3_D_139822395==1 | D_578895128_4_4_D_578895128_4_4_D_139822395==1) ~ "Thyroid",
                                                 ((D_578895128_1_1_D_578895128_1_1_D_807835037 | D_578895128_2_2_D_578895128_2_2_D_807835037 | D_578895128_3_3_D_578895128_3_3_D_807835037 | D_578895128_4_4_D_578895128_4_4_D_807835037==1 | !is.na(D_578895128_1_1_D_957429734_1) | !is.na(D_578895128_2_2_D_957429734_2) | !is.na(D_578895128_3_3_D_957429734_3) | !is.na(D_578895128_4_4_D_957429734_4))) ~ "Other",
                                                 (D_578895128_1_1_D_578895128_1_1_D_178420302==1 | D_578895128_2_2_D_578895128_2_2_D_178420302==1 | D_578895128_3_3_D_578895128_3_3_D_178420302==1 | D_578895128_4_4_D_578895128_4_4_D_178420302==1) ~ "Unknown", 
                                                 TRUE ~ "Skipped this Question"))
                                 
dt_body_sibling_summary <- body_sibling %>% dplyr::group_by(bodyp) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(bodyp, percentage)  

sibling_bd_canc <- dt_body_sibling_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SIBCANC2: Type of Cancer Sibling 1-4 Diagnosed With")) %>% 
  cols_label(bodyp = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = bodyp,
    )
  ) %>% opt_row_striping()

sibling_bd_canc


```



## CHILDCANC & CHILDCANC2
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#CHILDCANC
CHILDcanc1= data_tib_base  %>%  filter(as.numeric(D_446999144) >0) %>%  mutate(status= case_when((D_718867914_1_1==353358909 |D_718867914_2_2==353358909 | D_718867914_3_3==353358909 | 
                                                                                                    D_718867914_4_4==353358909 | D_718867914_5_5==353358909 |
                                      D_718867914_6_6==353358909 | D_718867914_7_7==353358909 | D_718867914_8_8==353358909 | D_718867914_9_9==353358909 |
                                      D_718867914_10_10==353358909) ~ "Child Diagnosed",
                                      (D_718867914_1_1==104430631 |D_718867914_2_2==104430631 | D_718867914_3_3==104430631 | 
                                                                                                    D_718867914_4_4==104430631 | D_718867914_5_5==104430631 |
                                      D_718867914_6_6==104430631 | D_718867914_7_7==104430631 | D_718867914_8_8==104430631 | D_718867914_9_9==104430631 |
                                      D_718867914_10_10==104430631) ~ "No Child Diagnosed",
                                                    TRUE ~ "Skipped This Question"))

dt_CHILDcanc1_summary <- CHILDcanc1 %>% dplyr::group_by(status) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(status, n, percentage) 


dt_CHILDcanc1_summary %>%  gt(rowname_col = "row_lab") %>%  ## why is this not a proper gt_tbl??
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("CHILDCANC: Children 1-10 Diagnosed with Cancer")) %>%
  cols_label(status = md("**Answer**"), n = md("**Number of Participants**"), percentage = md("**Percentage of Participants**")) %>%
    # summary_rows(
    # column = c(n,percentage),
    # fns= list(
    #   Sum= ~sum(.)
    # ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = status,
    )
  ) %>% opt_row_striping()


#CHILCANC2

kid <- CHILDcanc1 %>%  filter(status=="Child Diagnosed")



kid= kid  %>%  mutate(multc1 = ifelse(D_812370563_1_1_D_812370563_1_1_D_939782495==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_135725957==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_518416174==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_847945207==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_942970912==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_596122041==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_489400183==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_863246236==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_607793249==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_532172400==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_754745617==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_665036297==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_200837530==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_990319383==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_482225200==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_764891959==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_139822395==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_248374037==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_807835037==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_487917585==1, 1, 0) + ifelse(D_812370563_1_1_D_812370563_1_1_D_295976386==1, 1, 0),
                              multc2 = ifelse(D_812370563_2_2_D_812370563_2_2_D_939782495==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_135725957==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_518416174==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_847945207==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_942970912==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_596122041==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_489400183==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_863246236==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_607793249==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_532172400==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_754745617==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_665036297==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_200837530==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_990319383==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_482225200==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_764891959==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_139822395==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_248374037==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_807835037==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_487917585==1, 1, 0) + ifelse(D_812370563_2_2_D_812370563_2_2_D_295976386==1, 1, 0),
                              multc3 = ifelse(D_812370563_3_3_D_812370563_3_3_D_939782495==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_135725957==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_518416174==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_847945207==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_942970912==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_596122041==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_489400183==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_863246236==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_607793249==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_532172400==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_754745617==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_665036297==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_200837530==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_990319383==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_482225200==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_764891959==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_139822395==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_248374037==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_807835037==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_487917585==1, 1, 0) + ifelse(D_812370563_3_3_D_812370563_3_3_D_295976386==1, 1, 0),
                              multc4 = ifelse(D_812370563_4_4_D_812370563_4_4_D_939782495==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_135725957==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_518416174==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_847945207==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_942970912==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_596122041==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_489400183==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_863246236==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_607793249==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_532172400==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_754745617==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_665036297==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_200837530==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_990319383==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_482225200==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_764891959==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_139822395==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_248374037==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_807835037==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_487917585==1, 1, 0) + ifelse(D_812370563_4_4_D_812370563_4_4_D_295976386==1, 1, 0))

body_kid= kid  %>%  mutate(bodyp= case_when((as.numeric(multc1)>1 | as.numeric(multc2)>1 | as.numeric(multc3)>1 | as.numeric(multc4)>1) ~ "Multiple Cancer Types",
                                            (D_812370563_1_1_D_812370563_1_1_D_939782495==1 | D_812370563_2_2_D_812370563_2_2_D_939782495==1 | D_812370563_3_3_D_812370563_3_3_D_939782495==1 | D_812370563_4_4_D_812370563_4_4_D_939782495==1) ~ "Anal",
                                                     (D_812370563_1_1_D_812370563_1_1_D_135725957==1 | D_812370563_2_2_D_812370563_2_2_D_135725957==1 | D_812370563_3_3_D_812370563_3_3_D_135725957==1 | D_812370563_4_4_D_812370563_4_4_D_135725957==1) ~ "Bladder",
                                                     (D_812370563_1_1_D_812370563_1_1_D_518416174==1 | D_812370563_2_2_D_812370563_2_2_D_518416174==1 | D_812370563_3_3_D_812370563_3_3_D_518416174==1 | D_812370563_4_4_D_812370563_4_4_D_518416174==1) ~ "Brain",
                                                     (D_812370563_1_1_D_812370563_1_1_D_847945207==1 | D_812370563_2_2_D_812370563_2_2_D_847945207==1 | D_812370563_3_3_D_812370563_3_3_D_847945207==1 | D_812370563_4_4_D_812370563_4_4_D_847945207==1) ~ "Breast",
                                                     (D_812370563_1_1_D_812370563_1_1_D_283025574==1 | D_812370563_2_2_D_812370563_2_2_D_283025574==1 | D_812370563_3_3_D_812370563_3_3_D_283025574==1 | D_812370563_4_4_D_812370563_4_4_D_283025574==1) ~ "Cerivical",
                                                     (D_812370563_1_1_D_812370563_1_1_D_942970912==1 | D_812370563_2_2_D_812370563_2_2_D_942970912==1 | D_812370563_3_3_D_812370563_3_3_D_942970912==1 | D_812370563_4_4_D_812370563_4_4_D_942970912==1) ~ "Colon/Rectal",
                                                     (D_812370563_1_1_D_812370563_1_1_D_596122041==1 | D_812370563_2_2_D_812370563_2_2_D_596122041==1 | D_812370563_3_3_D_812370563_3_3_D_596122041==1 | D_812370563_4_4_D_812370563_4_4_D_596122041==1 ) ~ "Esophageal",
                                                     (D_812370563_1_1_D_812370563_1_1_D_489400183==1 | D_812370563_2_2_D_812370563_2_2_D_489400183==1 | D_812370563_3_3_D_812370563_3_3_D_489400183==1 | D_812370563_4_4_D_812370563_4_4_D_489400183==1) ~ "Head, Neck, and Shoulders",
                                                     (D_812370563_1_1_D_812370563_1_1_D_863246236==1 | D_812370563_2_2_D_812370563_2_2_D_863246236==1 | D_812370563_3_3_D_812370563_3_3_D_863246236==1 | D_812370563_4_4_D_812370563_4_4_D_863246236==1) ~ "Kidney",
                                                     (D_812370563_1_1_D_812370563_1_1_D_607793249==1 | D_812370563_2_2_D_812370563_2_2_D_607793249==1 | D_812370563_3_3_D_812370563_3_3_D_607793249==1 | D_812370563_4_4_D_812370563_4_4_D_607793249==1) ~ "Leukemia",
                                                     (D_812370563_1_1_D_812370563_1_1_D_532172400==1 | D_812370563_2_2_D_812370563_2_2_D_532172400==1 | D_812370563_3_3_D_812370563_3_3_D_532172400==1 ) ~ "Liver", 
                                            #| D_812370563_1_1_D_812370563_4_4_D_532172400==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_754745617==1 | D_812370563_2_2_D_812370563_2_2_D_754745617==1 | D_812370563_3_3_D_812370563_3_3_D_754745617==1 ) ~ "Lung",
                                            #| D_812370563_1_1_D_812370563_4_4_D_754745617==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_665036297==1 | D_812370563_2_2_D_812370563_2_2_D_665036297==1 | D_812370563_3_3_D_812370563_3_3_D_665036297==1 ) ~ "Non-Hodgkin's Lymphoma", #| D_812370563_1_1_D_812370563_4_4_D_665036297==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_200837530==1 | D_812370563_2_2_D_812370563_2_2_D_200837530==1 | D_812370563_3_3_D_812370563_3_3_D_200837530==1 ) ~ "Lymphoma",
                                            #| D_812370563_1_1_D_812370563_4_4_D_200837530==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_990319383==1 | D_812370563_2_2_D_812370563_2_2_D_990319383==1 | D_812370563_3_3_D_812370563_3_3_D_990319383==1 ) ~ "Melanoma Skin",
                                            #| D_812370563_1_1_D_812370563_4_4_D_990319383==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_487917585==1 | D_812370563_2_2_D_812370563_2_2_D_487917585==1 | D_812370563_3_3_D_812370563_3_3_D_487917585==1 ) ~ "Non-Melanoma Skin",
                                            #| D_812370563_1_1_D_812370563_4_4_D_487917585==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_603181162==1 | D_812370563_2_2_D_812370563_2_2_D_603181162==1 | D_812370563_3_3_D_812370563_3_3_D_603181162==1 ) ~ "Ovarian",
                                            #| D_812370563_1_1_D_812370563_4_4_D_603181162==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_482225200==1 | D_812370563_2_2_D_812370563_2_2_D_482225200==1 | D_812370563_3_3_D_812370563_3_3_D_482225200==1 ) ~ "Pancreatic",
                                            #| D_812370563_1_1_D_812370563_4_4_D_482225200==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_295976386==1 | D_812370563_2_2_D_812370563_2_2_D_295976386==1 | D_812370563_3_3_D_812370563_3_3_D_295976386==1 ) ~ "Prostate",
                                            #| D_812370563_1_1_D_812370563_4_4_D_295976386==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_764891959==1 | D_812370563_2_2_D_812370563_2_2_D_764891959==1 | D_812370563_3_3_D_812370563_3_3_D_764891959==1 ) ~ "Stomach",
                                            #| D_812370563_1_1_D_812370563_4_4_D_764891959==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_248374037==1 | D_812370563_2_2_D_812370563_2_2_D_248374037==1 | D_812370563_3_3_D_812370563_3_3_D_248374037==1 ) ~ "Testicular",
                                            #| D_812370563_1_1_D_812370563_4_4_D_248374037==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_139822395==1 | D_812370563_2_2_D_812370563_2_2_D_139822395==1 | D_812370563_3_3_D_812370563_3_3_D_139822395==1 ) ~ "Thyroid",
                                            #| D_812370563_1_1_D_812370563_4_4_D_139822395==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_723614811==1 | D_812370563_2_2_D_812370563_2_2_D_723614811==1 | D_812370563_3_3_D_812370563_3_3_D_723614811==1 ) ~ "Uterine",
                                            #| D_812370563_1_1_D_812370563_4_4_D_723614811==1
                                                     (D_812370563_1_1_D_812370563_1_1_D_807835037==1  | D_812370563_2_2_D_812370563_2_2_D_807835037==1  | D_812370563_3_3_D_812370563_3_3_D_807835037==1   | !is.na(D_812370563_1_1_D_933110091_1) | !is.na(D_812370563_2_2_D_933110091_2) | !is.na(D_812370563_3_3_D_933110091_3)) ~ "Other",
                                            #| D_812370563_1_1_D_812370563_4_4_D_807835037==1  | !is.na(D_812370563_4_4_D_933110091_4)
                                                     (D_812370563_1_1_D_812370563_1_1_D_178420302==1 | D_812370563_2_2_D_812370563_2_2_D_178420302==1 | D_812370563_3_3_D_812370563_3_3_D_178420302==1 ) ~ "Unknown",
                                            #| D_812370563_1_1_D_812370563_4_4_D_178420302==1
                                             TRUE ~ "Skipped this Question"))
                                 
dt_body_kid_summary <- body_kid %>% dplyr::group_by(bodyp) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(bodyp, percentage)  


kid_bd_canc <- dt_body_kid_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHILDCAN2: Type of Cancer Children 1-4 Diagnosed With")) %>% 
  cols_label(bodyp = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = bodyp,
    )
  ) %>% opt_row_striping()

kid_bd_canc

```



## BSNSSTYP1 & BSNSSTYP2
```{r, warning=FALSE, echo=FALSE, message=FALSE}

dt_curr_bus= data_tib_base %>% filter(D_613744428=="353358909")

dt_curr_bus= dt_curr_bus  %>%  mutate(multb1 = ifelse(D_700374192_D_700374192_D_641572847==1, 1, 0) + ifelse(D_700374192_D_700374192_D_592592455==1, 1, 0) + ifelse(D_700374192_D_700374192_D_711138281==1, 1, 0) + ifelse(D_700374192_D_700374192_D_596792238==1, 1, 0) + ifelse(D_700374192_D_700374192_D_133362151==1, 1, 0) + ifelse(D_700374192_D_700374192_D_372993567==1, 1, 0) + ifelse(D_700374192_D_700374192_D_620577362==1, 1, 0) + ifelse(D_700374192_D_700374192_D_580409149==1, 1, 0) + ifelse(D_700374192_D_700374192_D_867237640==1, 1, 0) + ifelse(D_700374192_D_700374192_D_698814077==1, 1, 0) + ifelse(D_700374192_D_700374192_D_751475124==1, 1, 0) + ifelse(D_700374192_D_700374192_D_308286913==1, 1, 0) + ifelse(D_700374192_D_700374192_D_807835037==1, 1, 0) + ifelse(D_700374192_D_700374192_D_178420302==1, 1, 0))


bsn= dt_curr_bus  %>%  mutate(category= case_when(as.numeric(multb1)>1 ~ "Multiple Business Types",
                                                  D_700374192_D_700374192_D_641572847==1 ~ "Manufacturing",
                                             D_700374192_D_700374192_D_592592455==1 ~ "Retail Store",
                                             D_700374192_D_700374192_D_711138281==1 ~ "Wholesale or Distributor",
                                             #D_700374192_D_700374192_D_149230791 ==1 ~ "Transportation, warehousing, and utilities",
                                             D_700374192_D_700374192_D_596792238==1 ~ "A Service Provider",
                                             #D_700374192_D_700374192_D_439857718==1 ~ "Professional and business services",
                                             D_700374192_D_700374192_D_133362151==1 ~ "Construction",
                                             D_700374192_D_700374192_D_372993567==1 ~ "Mining",
                                             D_700374192_D_700374192_D_620577362==1 ~ "Farming",
                                             #D_700374192_D_700374192_D_709307391==1 ~ "Accommodation and food services",
                                             D_700374192_D_700374192_D_580409149==1 ~ "Fishing",
                                             D_700374192_D_700374192_D_867237640==1 ~ "Forestry",
                                             #D_700374192_D_700374192_D_766533183==1 ~ "Healthcare or social assistance",
                                             D_700374192_D_700374192_D_698814077==1 ~ "Government",
                                             D_700374192_D_700374192_D_751475124==1 ~ "Military",
                                             #D_700374192_D_700374192_D_942545134==1 ~ "Military, police, firefighting, security services",
                                             D_700374192_D_700374192_D_308286913==1 ~ "Shipyard",
                                             #D_700374192_D_700374192_D_924908599==1 ~ "Education",
                                             #D_700374192_D_700374192_D_868510850==1 ~ "Arts, entertainment, and recreation",
                                             (D_700374192_D_700374192_D_807835037==1 | !is.na(D_700374192_D_923333992)) ~ "Other", 
                                             D_700374192_D_700374192_D_178420302==1 ~ "Unknown",
                                             TRUE ~ "Skipped this question"))

dt_curr_bus_summary <- bsn %>% group_by(category) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(category, n, percentage)

dt_curr_bus_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("BSNSSTYP1: Current Employer Business Type")) %>% 
  cols_label(n= md("**Number of Participants**"), category = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = category,
    )
  ) 

```



```{r, warning=FALSE, echo=FALSE, message=FALSE}

dt_curr_bus2= data_tib_base %>% filter(D_403258164==353358909 | D_847533056!=353358909)

dt_curr_bus2= dt_curr_bus2  %>%  mutate(multb2 = ifelse(D_530742915_D_530742915_D_641572847==1, 1, 0) + ifelse(D_530742915_D_530742915_D_592592455==1, 1, 0) + ifelse(D_530742915_D_530742915_D_711138281==1, 1, 0) + ifelse(D_530742915_D_530742915_D_596792238==1, 1, 0) + ifelse(D_530742915_D_530742915_D_133362151==1, 1, 0) + ifelse(D_530742915_D_530742915_D_372993567==1, 1, 0) + ifelse(D_530742915_D_530742915_D_620577362==1, 1, 0) + ifelse(D_530742915_D_530742915_D_580409149==1, 1, 0) + ifelse(D_530742915_D_530742915_D_867237640==1, 1, 0) + ifelse(D_530742915_D_530742915_D_698814077==1, 1, 0) + ifelse(D_530742915_D_530742915_D_751475124==1, 1, 0) + ifelse(D_530742915_D_530742915_D_308286913==1, 1, 0) + ifelse(D_530742915_D_530742915_D_807835037==1, 1, 0) + ifelse(D_530742915_D_530742915_D_178420302==1, 1, 0))


bsn= dt_curr_bus2  %>%  mutate(category= case_when(as.numeric(multb2)>1 ~ "Multiple Business Types",
                                                  D_530742915_D_530742915_D_641572847==1 ~ "Manufacturing",
                                                  D_530742915_D_530742915_D_592592455==1 ~ "Retail Store",
                                             D_530742915_D_530742915_D_711138281==1 ~ "Wholesale or Distributor",
                                             D_530742915_D_530742915_D_596792238==1 ~ "A Service Provider",
                                             D_530742915_D_530742915_D_133362151==1 ~ "Construction",
                                             D_530742915_D_530742915_D_372993567==1 ~ "Mining",
                                             D_530742915_D_530742915_D_620577362==1 ~ "Farming",
                                             D_530742915_D_530742915_D_580409149==1 ~ "Fishing",
                                             D_530742915_D_530742915_D_867237640==1 ~ "Forestry",
                                             D_530742915_D_530742915_D_698814077==1 ~ "Government",
                                             D_530742915_D_530742915_D_751475124==1 ~ "Military",
                                             D_530742915_D_530742915_D_308286913==1 ~ "Shipyard",
                                             (D_530742915_D_530742915_D_807835037==1 | !is.na(D_530742915_D_739237614)) ~ "Other", 
                                             D_530742915_D_530742915_D_178420302==1 ~ "Unknown",
                                             TRUE ~ "Skipped this question"))

dt_long_bus_summary <- bsn %>% group_by(category) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(category, n, percentage)

#gt_dt_long_bus <- 
dt_long_bus_summary %>%  gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("BSNSSTYP2: Employer Business Type for Longest Held Position")) %>% 
  cols_label(n= md("**Number of Participants**"), category = md("**Answer**"), percentage = md("**Percentage of Participants**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  #summary_rows(groups=F, fns = list(label = md("**ALL**"), id = "totals") ~ sum(.)) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = category,
    )
  ) %>% opt_row_striping()

#gt_dt_long_bus %>%   summary_rows(groups=T, column = c(n,percentage), fns = list(label = md("**ALL**"), id = "totals") ~ sum(.)) 
                                                
                                                  
```                                                  


